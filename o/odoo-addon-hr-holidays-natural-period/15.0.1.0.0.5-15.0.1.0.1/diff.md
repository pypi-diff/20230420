# Comparing `tmp/odoo_addon_hr_holidays_natural_period-15.0.1.0.0.5-py3-none-any.whl.zip` & `tmp/odoo_addon_hr_holidays_natural_period-15.0.1.0.1-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,25 +1,25 @@
-Zip file size: 27680 bytes, number of entries: 23
--rw-r--r--  2.0 unx     3471 b- defN 23-Feb-25 04:41 odoo/addons/hr_holidays_natural_period/README.rst
--rw-r--r--  2.0 unx       21 b- defN 23-Feb-25 04:41 odoo/addons/hr_holidays_natural_period/__init__.py
--rw-r--r--  2.0 unx      550 b- defN 23-Feb-25 04:41 odoo/addons/hr_holidays_natural_period/__manifest__.py
--rw-r--r--  2.0 unx      333 b- defN 23-Feb-25 04:41 odoo/addons/hr_holidays_natural_period/demo/hr_leave_type_data.xml
--rw-r--r--  2.0 unx     1602 b- defN 23-Feb-25 04:41 odoo/addons/hr_holidays_natural_period/i18n/ca.po
--rw-r--r--  2.0 unx     1590 b- defN 23-Feb-25 04:41 odoo/addons/hr_holidays_natural_period/i18n/es.po
--rw-r--r--  2.0 unx     1785 b- defN 23-Feb-25 04:41 odoo/addons/hr_holidays_natural_period/i18n/hr.po
--rw-r--r--  2.0 unx     1335 b- defN 23-Feb-25 04:41 odoo/addons/hr_holidays_natural_period/i18n/hr_holidays_natural_period.pot
--rw-r--r--  2.0 unx       83 b- defN 23-Feb-25 04:41 odoo/addons/hr_holidays_natural_period/models/__init__.py
--rw-r--r--  2.0 unx      517 b- defN 23-Feb-25 04:41 odoo/addons/hr_holidays_natural_period/models/hr_leave.py
--rw-r--r--  2.0 unx      364 b- defN 23-Feb-25 04:41 odoo/addons/hr_holidays_natural_period/models/hr_leave_type.py
--rw-r--r--  2.0 unx     2012 b- defN 23-Feb-25 04:41 odoo/addons/hr_holidays_natural_period/models/resource_calendar.py
--rw-r--r--  2.0 unx       83 b- defN 23-Feb-25 04:41 odoo/addons/hr_holidays_natural_period/readme/CONTRIBUTORS.rst
--rw-r--r--  2.0 unx       87 b- defN 23-Feb-25 04:41 odoo/addons/hr_holidays_natural_period/readme/DESCRIPTION.rst
--rw-r--r--  2.0 unx      453 b- defN 23-Feb-25 04:41 odoo/addons/hr_holidays_natural_period/readme/USAGE.rst
--rw-r--r--  2.0 unx     9455 b- defN 23-Feb-25 04:41 odoo/addons/hr_holidays_natural_period/static/description/icon.png
--rw-r--r--  2.0 unx    12895 b- defN 23-Feb-25 04:41 odoo/addons/hr_holidays_natural_period/static/description/index.html
--rw-r--r--  2.0 unx       28 b- defN 23-Feb-25 04:41 odoo/addons/hr_holidays_natural_period/tests/__init__.py
--rw-r--r--  2.0 unx     2256 b- defN 23-Feb-25 04:41 odoo/addons/hr_holidays_natural_period/tests/test_hr_leave.py
--rw-r--r--  2.0 unx     4024 b- defN 23-Feb-25 04:41 odoo_addon_hr_holidays_natural_period-15.0.1.0.0.5.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Feb-25 04:41 odoo_addon_hr_holidays_natural_period-15.0.1.0.0.5.dist-info/WHEEL
--rw-r--r--  2.0 unx        5 b- defN 23-Feb-25 04:41 odoo_addon_hr_holidays_natural_period-15.0.1.0.0.5.dist-info/top_level.txt
-?rw-rw-r--  2.0 unx     2625 b- defN 23-Feb-25 04:41 odoo_addon_hr_holidays_natural_period-15.0.1.0.0.5.dist-info/RECORD
-23 files, 45666 bytes uncompressed, 23136 bytes compressed:  49.3%
+Zip file size: 28365 bytes, number of entries: 23
+-rw-r--r--  2.0 unx     3471 b- defN 23-Apr-20 08:05 odoo/addons/hr_holidays_natural_period/README.rst
+-rw-r--r--  2.0 unx       21 b- defN 23-Apr-20 08:05 odoo/addons/hr_holidays_natural_period/__init__.py
+-rw-r--r--  2.0 unx      550 b- defN 23-Apr-20 08:06 odoo/addons/hr_holidays_natural_period/__manifest__.py
+-rw-r--r--  2.0 unx      385 b- defN 23-Apr-20 08:05 odoo/addons/hr_holidays_natural_period/demo/hr_leave_type_data.xml
+-rw-r--r--  2.0 unx     1602 b- defN 23-Apr-20 08:05 odoo/addons/hr_holidays_natural_period/i18n/ca.po
+-rw-r--r--  2.0 unx     1590 b- defN 23-Apr-20 08:05 odoo/addons/hr_holidays_natural_period/i18n/es.po
+-rw-r--r--  2.0 unx     1785 b- defN 23-Apr-20 08:05 odoo/addons/hr_holidays_natural_period/i18n/hr.po
+-rw-r--r--  2.0 unx     1335 b- defN 23-Apr-20 08:05 odoo/addons/hr_holidays_natural_period/i18n/hr_holidays_natural_period.pot
+-rw-r--r--  2.0 unx       83 b- defN 23-Apr-20 08:05 odoo/addons/hr_holidays_natural_period/models/__init__.py
+-rw-r--r--  2.0 unx      517 b- defN 23-Apr-20 08:05 odoo/addons/hr_holidays_natural_period/models/hr_leave.py
+-rw-r--r--  2.0 unx     1186 b- defN 23-Apr-20 08:05 odoo/addons/hr_holidays_natural_period/models/hr_leave_type.py
+-rw-r--r--  2.0 unx     2012 b- defN 23-Apr-20 08:05 odoo/addons/hr_holidays_natural_period/models/resource_calendar.py
+-rw-r--r--  2.0 unx       83 b- defN 23-Apr-20 08:05 odoo/addons/hr_holidays_natural_period/readme/CONTRIBUTORS.rst
+-rw-r--r--  2.0 unx       87 b- defN 23-Apr-20 08:05 odoo/addons/hr_holidays_natural_period/readme/DESCRIPTION.rst
+-rw-r--r--  2.0 unx      453 b- defN 23-Apr-20 08:05 odoo/addons/hr_holidays_natural_period/readme/USAGE.rst
+-rw-r--r--  2.0 unx     9455 b- defN 23-Apr-20 08:05 odoo/addons/hr_holidays_natural_period/static/description/icon.png
+-rw-r--r--  2.0 unx    12895 b- defN 23-Apr-20 08:05 odoo/addons/hr_holidays_natural_period/static/description/index.html
+-rw-r--r--  2.0 unx       28 b- defN 23-Apr-20 08:05 odoo/addons/hr_holidays_natural_period/tests/__init__.py
+-rw-r--r--  2.0 unx     4575 b- defN 23-Apr-20 08:05 odoo/addons/hr_holidays_natural_period/tests/test_hr_leave.py
+-rw-r--r--  2.0 unx     4022 b- defN 23-Apr-20 08:06 odoo_addon_hr_holidays_natural_period-15.0.1.0.1.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Apr-20 08:06 odoo_addon_hr_holidays_natural_period-15.0.1.0.1.dist-info/WHEEL
+-rw-r--r--  2.0 unx        5 b- defN 23-Apr-20 08:06 odoo_addon_hr_holidays_natural_period-15.0.1.0.1.dist-info/top_level.txt
+?rw-rw-r--  2.0 unx     2618 b- defN 23-Apr-20 08:06 odoo_addon_hr_holidays_natural_period-15.0.1.0.1.dist-info/RECORD
+23 files, 48850 bytes uncompressed, 23837 bytes compressed:  51.2%
```

## zipnote {}

```diff
@@ -51,20 +51,20 @@
 
 Filename: odoo/addons/hr_holidays_natural_period/tests/__init__.py
 Comment: 
 
 Filename: odoo/addons/hr_holidays_natural_period/tests/test_hr_leave.py
 Comment: 
 
-Filename: odoo_addon_hr_holidays_natural_period-15.0.1.0.0.5.dist-info/METADATA
+Filename: odoo_addon_hr_holidays_natural_period-15.0.1.0.1.dist-info/METADATA
 Comment: 
 
-Filename: odoo_addon_hr_holidays_natural_period-15.0.1.0.0.5.dist-info/WHEEL
+Filename: odoo_addon_hr_holidays_natural_period-15.0.1.0.1.dist-info/WHEEL
 Comment: 
 
-Filename: odoo_addon_hr_holidays_natural_period-15.0.1.0.0.5.dist-info/top_level.txt
+Filename: odoo_addon_hr_holidays_natural_period-15.0.1.0.1.dist-info/top_level.txt
 Comment: 
 
-Filename: odoo_addon_hr_holidays_natural_period-15.0.1.0.0.5.dist-info/RECORD
+Filename: odoo_addon_hr_holidays_natural_period-15.0.1.0.1.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## odoo/addons/hr_holidays_natural_period/__manifest__.py

```diff
@@ -1,14 +1,14 @@
 # Copyright 2020 Tecnativa - Víctor Martínez
 # License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl.html).
 
 {
     "name": "Holidays natural period",
     "summary": "Apply natural days in holidays",
-    "version": "15.0.1.0.0",
+    "version": "15.0.1.0.1",
     "category": "Human Resources",
     "website": "https://github.com/OCA/hr-holidays",
     "author": "Tecnativa, Odoo Community Association (OCA)",
     "license": "AGPL-3",
     "installable": True,
     "depends": ["hr_holidays"],
     "maintainers": ["victoralmau"],
```

## odoo/addons/hr_holidays_natural_period/demo/hr_leave_type_data.xml

### odoo/addons/hr_holidays_natural_period/demo/hr_leave_type_data.xml

```diff
@@ -1,8 +1,9 @@
 <?xml version="1.0" encoding="utf-8"?>
 <odoo noupdate="1">
   <record id="hr_leave_type_natural_day_test" model="hr.leave.type">
     <field name="name">Test Time Off (natural day)</field>
     <field name="request_unit">natural_day</field>
     <field name="responsible_id" ref="base.user_admin"/>
+    <field name="employee_requests">yes</field>
   </record>
 </odoo>
```

## odoo/addons/hr_holidays_natural_period/models/hr_leave_type.py

```diff
@@ -1,13 +1,32 @@
-# Copyright 2020 Tecnativa - Víctor Martínez
+# Copyright 2020-2023 Tecnativa - Víctor Martínez
 # License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl.html).
 
 from odoo import fields, models
 
 
 class HrLeaveType(models.Model):
     _inherit = "hr.leave.type"
 
     request_unit = fields.Selection(
         selection_add=[("natural_day", "Natural day")],
         ondelete={"natural_day": "set default"},
     )
+
+    def _get_employees_days_per_allocation(self, employee_ids, date=None):
+        """We need to set request_unit as 'day' to avoid the calculations being done
+        as hours.
+        Related code:
+        hr_holidays/models/hr_leave_type.py#L313
+        hr_holidays/models/hr_leave_type.py#L367
+        """
+        old_request_unit_data = {}
+        for item in self.filtered(lambda x: x.request_unit == "natural_day"):
+            old_request_unit_data[item.id] = item.request_unit
+            item.sudo().request_unit = "day"
+        res = super()._get_employees_days_per_allocation(
+            employee_ids=employee_ids, date=date
+        )
+        for item in self:
+            if item.id in old_request_unit_data:
+                item.sudo().request_unit = old_request_unit_data[item.id]
+        return res
```

## odoo/addons/hr_holidays_natural_period/tests/test_hr_leave.py

```diff
@@ -1,21 +1,25 @@
-# Copyright 2020-2022 Tecnativa - Víctor Martínez
+# Copyright 2020-2023 Tecnativa - Víctor Martínez
 # License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl.html).
 
-from odoo.tests import Form, common
+from odoo import fields
+from odoo.tests import Form, common, new_test_user
+from odoo.tests.common import users
 
 
 class TestHrLeave(common.TransactionCase):
     @classmethod
     def setUpClass(cls):
         super().setUpClass()
         cls.HrLeave = cls.env["hr.leave"]
         cls.leave_type = cls.env.ref(
             "hr_holidays_natural_period.hr_leave_type_natural_day_test"
         )
+        cls.leave_type_day = cls.env.ref("hr_holidays.holiday_status_cl")
+        cls.leave_type_day.employee_requests = "yes"
         calendar = cls.env.ref("resource.resource_calendar_std")
         calendar = calendar.copy({"name": "Test calendar"})
         calendar.switch_calendar_type()
         calendar.attendance_ids.filtered(
             lambda x: x.week_type == "0"
             and not x.display_type
             and x.day_period == "afternoon"
@@ -28,36 +32,77 @@
         partner = cls.env["res.partner"].create(
             {
                 "name": "Test employee",
                 "type": "private",
                 "country_id": cls.env.ref("base.es").id,
             }
         )
+        ctx = {
+            "mail_create_nolog": True,
+            "mail_create_nosubscribe": True,
+            "mail_notrack": True,
+            "no_reset_password": True,
+        }
+        cls.user = new_test_user(
+            cls.env,
+            login="test-user",
+            context=ctx,
+        )
         cls.employee = cls.env["hr.employee"].create(
             {
                 "name": "Test employee",
                 "address_home_id": partner.id,
                 "resource_calendar_id": calendar.id,
+                "user_id": cls.user.id,
             }
         )
 
-    def test_hr_leave_natural_day(self):
-        leave_form = Form(
-            self.HrLeave.with_context(
-                default_employee_id=self.employee.id,
+    def _create_leave_allocation(self, leave_type, days):
+        leave_allocation_form = Form(
+            self.env["hr.leave.allocation"].with_context(
+                default_date_from="2021-01-01",
+                default_date_to="%s-12-31" % (fields.Date.today().year),
             )
         )
-        leave_form.holiday_status_id = self.leave_type
-        leave_form.request_date_from = "2021-01-02"
-        leave_form.request_date_to = "2021-01-05"
-        self.assertEqual(leave_form.number_of_days, 4.0)
+        leave_allocation_form.name = "TEST"
+        leave_allocation_form.holiday_status_id = leave_type
+        leave_allocation_form.number_of_days_display = days
+        return leave_allocation_form.save()
 
+    def _create_hr_leave(self, leave_type, date_from, date_to):
+        leave_form = Form(self.env["hr.leave"])
+        leave_form.holiday_status_id = leave_type
+        leave_form.request_date_from = date_from
+        leave_form.request_date_to = date_to
+        return leave_form.save()
+
+    @users("test-user")
+    def test_hr_leave_natural_day(self):
+        leave_allocation = self._create_leave_allocation(self.leave_type, 5)
+        leave_allocation.action_confirm()
+        leave_allocation.sudo().action_validate()
+        res_leave_type = self.env["hr.leave.type"].get_days_all_request()[0][1]
+        self.assertEqual(res_leave_type["remaining_leaves"], "5")
+        self.assertEqual(res_leave_type["virtual_remaining_leaves"], "5")
+        self.assertEqual(res_leave_type["max_leaves"], "5")
+        self.assertEqual(res_leave_type["leaves_taken"], "0")
+        self.assertEqual(res_leave_type["virtual_leaves_taken"], "0")
+        self.assertEqual(res_leave_type["request_unit"], "natural_day")
+        leave = self._create_hr_leave(self.leave_type, "2021-01-02", "2021-01-05")
+        self.assertEqual(leave.number_of_days, 4.0)
+        self.assertEqual(leave.number_of_days_display, 4.0)
+
+    @users("test-user")
     def test_hr_leave_day(self):
-        leave_form = Form(
-            self.HrLeave.with_context(
-                default_employee_id=self.employee.id,
-            )
-        )
-        leave_form.holiday_status_id = self.env.ref("hr_holidays.holiday_status_cl")
-        leave_form.request_date_from = "2021-01-02"  # Saturday
-        leave_form.request_date_to = "2021-01-04"  # Monday
-        self.assertEqual(leave_form.number_of_days, 1)
+        leave_allocation = self._create_leave_allocation(self.leave_type_day, 5)
+        leave_allocation.action_confirm()
+        leave_allocation.sudo().action_validate()
+        res_leave_type = self.env["hr.leave.type"].get_days_all_request()[0][1]
+        self.assertEqual(res_leave_type["remaining_leaves"], "5")
+        self.assertEqual(res_leave_type["virtual_remaining_leaves"], "5")
+        self.assertEqual(res_leave_type["max_leaves"], "5")
+        self.assertEqual(res_leave_type["leaves_taken"], "0")
+        self.assertEqual(res_leave_type["virtual_leaves_taken"], "0")
+        self.assertEqual(res_leave_type["request_unit"], "day")
+        leave = self._create_hr_leave(self.leave_type_day, "2021-01-02", "2021-01-04")
+        self.assertEqual(leave.number_of_days, 1)
+        self.assertEqual(leave.number_of_days_display, 1)
```

## Comparing `odoo_addon_hr_holidays_natural_period-15.0.1.0.0.5.dist-info/METADATA` & `odoo_addon_hr_holidays_natural_period-15.0.1.0.1.dist-info/METADATA`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: odoo-addon-hr-holidays-natural-period
-Version: 15.0.1.0.0.5
+Version: 15.0.1.0.1
 Summary: Apply natural days in holidays
 Home-page: https://github.com/OCA/hr-holidays
 Author: Tecnativa, Odoo Community Association (OCA)
 Author-email: support@odoo-community.org
 License: AGPL-3
 Platform: UNKNOWN
 Classifier: Programming Language :: Python
```

## Comparing `odoo_addon_hr_holidays_natural_period-15.0.1.0.0.5.dist-info/RECORD` & `odoo_addon_hr_holidays_natural_period-15.0.1.0.1.dist-info/RECORD`

 * *Files 7% similar despite different names*

```diff
@@ -1,23 +1,23 @@
 odoo/addons/hr_holidays_natural_period/README.rst,sha256=1KoRMyV3mseFwECJ9wjycJ8B4lOQXgk8Xv2vTiQlSxg,3471
 odoo/addons/hr_holidays_natural_period/__init__.py,sha256=X9EJGOE2GtZbS0G82PtSXmWSZ_R8jEM0rlJTDliQjp4,21
-odoo/addons/hr_holidays_natural_period/__manifest__.py,sha256=9SXVcTNXqmA1EZcpCwugQ81hpHKRIg1cm5UyQCHZBdE,550
-odoo/addons/hr_holidays_natural_period/demo/hr_leave_type_data.xml,sha256=wHy2SpK-MkG-3YKJpWuK_xoksvpfcIbimorNDqiAEtU,333
+odoo/addons/hr_holidays_natural_period/__manifest__.py,sha256=WOfF6Fg8lX4YS7Y-Hzwq9raWEsSpNM7stiDdJxxcAIw,550
+odoo/addons/hr_holidays_natural_period/demo/hr_leave_type_data.xml,sha256=7uUBXPCQ-MW06Y68j-L-1ZrwBz_Z4RFbuZ5WiZyKfFE,385
 odoo/addons/hr_holidays_natural_period/i18n/ca.po,sha256=N65bMOhOSx-rW-DRREkULRZAu5nTpzBxDFJL94y9fiw,1602
 odoo/addons/hr_holidays_natural_period/i18n/es.po,sha256=Of1DwCZr-YeYP9gBlLGMkCN1g5TfxQgDRLkz7y6WD1E,1590
 odoo/addons/hr_holidays_natural_period/i18n/hr.po,sha256=etfU0OOOZOhLDNbyxlcMHLbXj4AgtUOMHRXn6utvkaM,1785
 odoo/addons/hr_holidays_natural_period/i18n/hr_holidays_natural_period.pot,sha256=nENa-fEnKE3ZXKRVTd-3OV1bYuNxSIX1n7koOd18JNc,1335
 odoo/addons/hr_holidays_natural_period/models/__init__.py,sha256=Jm1MEb6ijkAgD_WpVgoAauvbY6UkWo9jXKa5n-zXMKc,83
 odoo/addons/hr_holidays_natural_period/models/hr_leave.py,sha256=ImAiO5JPg6BirJWOCqnsv6zP5KP1x4KMpAQc1pGJAhY,517
-odoo/addons/hr_holidays_natural_period/models/hr_leave_type.py,sha256=AhvZy1HX74kMQgkmEGpIGUMzd3eK0yczScVNCEgR6JI,364
+odoo/addons/hr_holidays_natural_period/models/hr_leave_type.py,sha256=kV35xstXj_poeyOJkkjP0mqC7vMg12n2vHkD4QwwRpg,1186
 odoo/addons/hr_holidays_natural_period/models/resource_calendar.py,sha256=oFkCcfQiQRyiwB-efaQ-f0gs00ROU11kzXL-PoQgMHo,2012
 odoo/addons/hr_holidays_natural_period/readme/CONTRIBUTORS.rst,sha256=0lG74zaIket4QEwfdg534S5UNh_ejZMNpMui0ApLfLc,83
 odoo/addons/hr_holidays_natural_period/readme/DESCRIPTION.rst,sha256=BXKqLJpHvfC2r7UrAovRki8-YkoTQZEB8naz_5F33ig,87
 odoo/addons/hr_holidays_natural_period/readme/USAGE.rst,sha256=3bD98RtkJ6cm-_LOiwrasHR3n7T-Aw9CAiUl5MPGkjY,453
 odoo/addons/hr_holidays_natural_period/static/description/icon.png,sha256=6xBPJauaFOF0KDHfHgQopSc28kKvxMaeoQFQWZtfZDo,9455
 odoo/addons/hr_holidays_natural_period/static/description/index.html,sha256=sWiqJFIc0xHEo0OAJoCYlm8gmjR2BTF5HciAEn1Trw8,12895
 odoo/addons/hr_holidays_natural_period/tests/__init__.py,sha256=wIX2VFvRDlCHNZoBrZ6meV8B6lEoWLJ-sFUkXGB5Xlc,28
-odoo/addons/hr_holidays_natural_period/tests/test_hr_leave.py,sha256=-rIDqucR3s_0QWxa0s47DO9MAqSZ2mrGrlrcPEj-fT0,2256
-odoo_addon_hr_holidays_natural_period-15.0.1.0.0.5.dist-info/METADATA,sha256=PtnCTK3VD5zw74sB6v-_fnX0DhkVkBzOKmnbORr-9yY,4024
-odoo_addon_hr_holidays_natural_period-15.0.1.0.0.5.dist-info/WHEEL,sha256=2wepM1nk4DS4eFpYrW1TTqPcoGNfHhhO_i5m4cOimbo,92
-odoo_addon_hr_holidays_natural_period-15.0.1.0.0.5.dist-info/top_level.txt,sha256=qBj40grFkGOfDZ2WDSw3y1RnDlgG0u8rP8pvGNdbz4w,5
-odoo_addon_hr_holidays_natural_period-15.0.1.0.0.5.dist-info/RECORD,,
+odoo/addons/hr_holidays_natural_period/tests/test_hr_leave.py,sha256=qG3S3C4_oAy57Mog9dFacVL5NB82VdEjiXPY5BeYRGk,4575
+odoo_addon_hr_holidays_natural_period-15.0.1.0.1.dist-info/METADATA,sha256=y2eM8Y8mBPKd1mWpX2um9aiOryYaG21AvCR3DiVwxfg,4022
+odoo_addon_hr_holidays_natural_period-15.0.1.0.1.dist-info/WHEEL,sha256=2wepM1nk4DS4eFpYrW1TTqPcoGNfHhhO_i5m4cOimbo,92
+odoo_addon_hr_holidays_natural_period-15.0.1.0.1.dist-info/top_level.txt,sha256=qBj40grFkGOfDZ2WDSw3y1RnDlgG0u8rP8pvGNdbz4w,5
+odoo_addon_hr_holidays_natural_period-15.0.1.0.1.dist-info/RECORD,,
```

