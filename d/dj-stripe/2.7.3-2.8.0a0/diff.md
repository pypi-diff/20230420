# Comparing `tmp/dj_stripe-2.7.3.tar.gz` & `tmp/dj_stripe-2.8.0a0.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "dj_stripe-2.7.3.tar", max compression
+gzip compressed data, was "dj_stripe-2.8.0a0.tar", max compression
```

## Comparing `dj_stripe-2.7.3.tar` & `dj_stripe-2.8.0a0.tar`

### file list

```diff
@@ -1,66 +1,70 @@
--rw-r--r--   0        0        0     1084 2022-10-18 02:15:05.677111 dj_stripe-2.7.3/LICENSE
--rw-r--r--   0        0        0        0 2022-10-18 02:15:05.677111 dj_stripe-2.7.3/djstripe/__init__.py
--rw-r--r--   0        0        0      130 2022-10-18 02:15:05.677111 dj_stripe-2.7.3/djstripe/admin/__init__.py
--rw-r--r--   0        0        0     4221 2022-10-18 02:15:05.677111 dj_stripe-2.7.3/djstripe/admin/actions.py
--rw-r--r--   0        0        0    24829 2022-11-26 19:35:50.980920 dj_stripe-2.7.3/djstripe/admin/admin.py
--rw-r--r--   0        0        0     2103 2022-10-18 02:15:05.677111 dj_stripe-2.7.3/djstripe/admin/admin_inline.py
--rw-r--r--   0        0        0     2861 2022-10-18 02:15:05.677111 dj_stripe-2.7.3/djstripe/admin/filters.py
--rw-r--r--   0        0        0     9226 2022-10-18 02:15:05.677111 dj_stripe-2.7.3/djstripe/admin/forms.py
--rw-r--r--   0        0        0     1657 2022-11-26 19:35:50.980920 dj_stripe-2.7.3/djstripe/admin/utils.py
--rw-r--r--   0        0        0     4645 2022-10-18 02:15:05.677111 dj_stripe-2.7.3/djstripe/admin/views.py
--rw-r--r--   0        0        0      732 2022-10-18 02:15:05.677111 dj_stripe-2.7.3/djstripe/apps.py
--rw-r--r--   0        0        0    11213 2022-11-26 19:35:50.980920 dj_stripe-2.7.3/djstripe/checks.py
--rw-r--r--   0        0        0      688 2022-10-18 02:15:05.677111 dj_stripe-2.7.3/djstripe/context_managers.py
--rw-r--r--   0        0        0    25920 2022-11-26 19:35:50.980920 dj_stripe-2.7.3/djstripe/enums.py
--rw-r--r--   0        0        0    14415 2022-10-18 02:15:05.677111 dj_stripe-2.7.3/djstripe/event_handlers.py
--rw-r--r--   0        0        0      633 2022-10-18 02:15:05.677111 dj_stripe-2.7.3/djstripe/exceptions.py
--rw-r--r--   0        0        0     6178 2022-11-26 19:35:50.980920 dj_stripe-2.7.3/djstripe/fields.py
--rw-r--r--   0        0        0    17624 2022-10-18 02:15:05.677111 dj_stripe-2.7.3/djstripe/locale/fr/LC_MESSAGES/django.po
--rw-r--r--   0        0        0    19987 2022-10-18 02:15:05.677111 dj_stripe-2.7.3/djstripe/locale/ru/LC_MESSAGES/django.po
--rw-r--r--   0        0        0        0 2022-10-18 02:15:05.677111 dj_stripe-2.7.3/djstripe/management/__init__.py
--rw-r--r--   0        0        0        0 2022-10-18 02:15:05.677111 dj_stripe-2.7.3/djstripe/management/commands/__init__.py
--rw-r--r--   0        0        0      271 2022-10-18 02:15:05.677111 dj_stripe-2.7.3/djstripe/management/commands/djstripe_clear_expired_idempotency_keys.py
--rw-r--r--   0        0        0     1016 2022-10-18 02:15:05.677111 dj_stripe-2.7.3/djstripe/management/commands/djstripe_init_customers.py
--rw-r--r--   0        0        0     4067 2022-11-26 19:35:50.980920 dj_stripe-2.7.3/djstripe/management/commands/djstripe_process_events.py
--rw-r--r--   0        0        0      924 2022-11-26 19:35:50.980920 dj_stripe-2.7.3/djstripe/management/commands/djstripe_sync_customers.py
--rw-r--r--   0        0        0    20654 2022-11-26 19:35:50.980920 dj_stripe-2.7.3/djstripe/management/commands/djstripe_sync_models.py
--rw-r--r--   0        0        0      371 2022-11-26 19:35:50.980920 dj_stripe-2.7.3/djstripe/management/commands/djstripe_sync_plans_from_stripe.py
--rw-r--r--   0        0        0     2898 2022-10-18 02:15:05.677111 dj_stripe-2.7.3/djstripe/management/commands/djstripe_update_invoiceitem_ids.py
--rw-r--r--   0        0        0     3267 2022-10-18 02:15:05.677111 dj_stripe-2.7.3/djstripe/managers.py
--rw-r--r--   0        0        0   209454 2022-10-18 02:15:05.680445 dj_stripe-2.7.3/djstripe/migrations/0001_initial.py
--rw-r--r--   0        0        0    11474 2022-10-18 02:15:05.680445 dj_stripe-2.7.3/djstripe/migrations/0008_2_5.py
--rw-r--r--   0        0        0    14131 2022-10-18 02:15:05.680445 dj_stripe-2.7.3/djstripe/migrations/0009_2_6.py
--rw-r--r--   0        0        0      472 2022-10-18 02:15:05.680445 dj_stripe-2.7.3/djstripe/migrations/0010_alter_customer_balance.py
--rw-r--r--   0        0        0    18336 2022-10-18 02:15:05.680445 dj_stripe-2.7.3/djstripe/migrations/0011_2_7.py
--rw-r--r--   0        0        0        0 2022-10-18 02:15:05.680445 dj_stripe-2.7.3/djstripe/migrations/__init__.py
--rw-r--r--   0        0        0     1971 2022-10-18 02:15:05.680445 dj_stripe-2.7.3/djstripe/mixins.py
--rw-r--r--   0        0        0     1882 2022-10-18 02:15:05.680445 dj_stripe-2.7.3/djstripe/models/__init__.py
--rw-r--r--   0        0        0    10058 2022-10-18 02:15:05.680445 dj_stripe-2.7.3/djstripe/models/account.py
--rw-r--r--   0        0        0     4097 2022-10-18 02:15:05.680445 dj_stripe-2.7.3/djstripe/models/api.py
--rw-r--r--   0        0        0    40589 2022-11-26 19:35:50.980920 dj_stripe-2.7.3/djstripe/models/base.py
--rw-r--r--   0        0        0    92028 2022-11-26 19:35:50.980920 dj_stripe-2.7.3/djstripe/models/billing.py
--rw-r--r--   0        0        0     4555 2022-10-18 02:15:05.680445 dj_stripe-2.7.3/djstripe/models/checkout.py
--rw-r--r--   0        0        0    12886 2022-10-18 02:15:05.680445 dj_stripe-2.7.3/djstripe/models/connect.py
--rw-r--r--   0        0        0    86499 2022-11-26 19:35:50.980920 dj_stripe-2.7.3/djstripe/models/core.py
--rw-r--r--   0        0        0        0 2022-10-18 02:15:05.680445 dj_stripe-2.7.3/djstripe/models/fraud.py
--rw-r--r--   0        0        0     7465 2022-10-18 02:15:05.680445 dj_stripe-2.7.3/djstripe/models/orders.py
--rw-r--r--   0        0        0    36261 2022-11-26 19:35:50.980920 dj_stripe-2.7.3/djstripe/models/payment_methods.py
--rw-r--r--   0        0        0     1489 2022-10-18 02:15:05.680445 dj_stripe-2.7.3/djstripe/models/sigma.py
--rw-r--r--   0        0        0    11447 2022-11-26 19:35:50.984254 dj_stripe-2.7.3/djstripe/models/webhooks.py
--rw-r--r--   0        0        0     9290 2022-11-26 19:35:50.984254 dj_stripe-2.7.3/djstripe/settings.py
--rw-r--r--   0        0        0     8289 2022-11-26 19:35:50.984254 dj_stripe-2.7.3/djstripe/signals.py
--rw-r--r--   0        0        0      579 2022-10-18 02:15:05.680445 dj_stripe-2.7.3/djstripe/sync.py
--rw-r--r--   0        0        0      251 2022-10-18 02:15:05.680445 dj_stripe-2.7.3/djstripe/templates/djstripe/admin/add_form.html
--rw-r--r--   0        0        0      984 2022-10-18 02:15:05.680445 dj_stripe-2.7.3/djstripe/templates/djstripe/admin/change_form.html
--rw-r--r--   0        0        0     2790 2022-10-18 02:15:05.680445 dj_stripe-2.7.3/djstripe/templates/djstripe/admin/confirm_action.html
--rw-r--r--   0        0        0      250 2022-10-18 02:15:05.680445 dj_stripe-2.7.3/djstripe/templates/djstripe/admin/webhook_endpoint/add_form.html
--rw-r--r--   0        0        0      227 2022-10-18 02:15:05.680445 dj_stripe-2.7.3/djstripe/templates/djstripe/admin/webhook_endpoint/change_form.html
--rw-r--r--   0        0        0     1251 2022-10-18 02:15:05.680445 dj_stripe-2.7.3/djstripe/templates/djstripe/admin/webhook_endpoint/delete_confirmation.html
--rw-r--r--   0        0        0      679 2022-10-18 02:15:05.680445 dj_stripe-2.7.3/djstripe/urls.py
--rw-r--r--   0        0        0     2994 2022-10-18 02:15:05.680445 dj_stripe-2.7.3/djstripe/utils.py
--rw-r--r--   0        0        0     2106 2022-10-18 02:15:05.683778 dj_stripe-2.7.3/djstripe/views.py
--rw-r--r--   0        0        0     3045 2022-10-18 02:15:05.683778 dj_stripe-2.7.3/djstripe/webhooks.py
--rw-r--r--   0        0        0     3398 2022-10-18 02:15:05.683778 dj_stripe-2.7.3/docs/README.md
--rw-r--r--   0        0        0     4479 2022-11-26 19:36:01.564321 dj_stripe-2.7.3/pyproject.toml
--rw-r--r--   0        0        0     4591 1970-01-01 00:00:00.000000 dj_stripe-2.7.3/setup.py
--rw-r--r--   0        0        0     4801 1970-01-01 00:00:00.000000 dj_stripe-2.7.3/PKG-INFO
+-rw-r--r--   0        0        0     1084 2022-10-18 02:15:05.677111 dj_stripe-2.8.0a0/LICENSE
+-rw-r--r--   0        0        0        0 2022-10-18 02:15:05.677111 dj_stripe-2.8.0a0/djstripe/__init__.py
+-rw-r--r--   0        0        0      130 2022-10-18 02:15:05.677111 dj_stripe-2.8.0a0/djstripe/admin/__init__.py
+-rw-r--r--   0        0        0     4219 2023-04-18 16:12:01.671673 dj_stripe-2.8.0a0/djstripe/admin/actions.py
+-rw-r--r--   0        0        0    26470 2023-04-20 18:31:54.175370 dj_stripe-2.8.0a0/djstripe/admin/admin.py
+-rw-r--r--   0        0        0     2390 2023-04-18 16:12:01.675006 dj_stripe-2.8.0a0/djstripe/admin/admin_inline.py
+-rw-r--r--   0        0        0     2861 2022-10-18 02:15:05.677111 dj_stripe-2.8.0a0/djstripe/admin/filters.py
+-rw-r--r--   0        0        0     9552 2023-04-20 18:37:25.954015 dj_stripe-2.8.0a0/djstripe/admin/forms.py
+-rw-r--r--   0        0        0      880 2023-04-18 16:12:01.675006 dj_stripe-2.8.0a0/djstripe/admin/utils.py
+-rw-r--r--   0        0        0     4645 2022-10-18 02:15:05.677111 dj_stripe-2.8.0a0/djstripe/admin/views.py
+-rw-r--r--   0        0        0      766 2023-04-18 16:12:01.675006 dj_stripe-2.8.0a0/djstripe/apps.py
+-rw-r--r--   0        0        0    14315 2023-04-20 18:37:25.954015 dj_stripe-2.8.0a0/djstripe/checks.py
+-rw-r--r--   0        0        0    27096 2023-04-20 18:37:25.954015 dj_stripe-2.8.0a0/djstripe/enums.py
+-rw-r--r--   0        0        0    16030 2023-04-20 18:37:24.120670 dj_stripe-2.8.0a0/djstripe/event_handlers.py
+-rw-r--r--   0        0        0      633 2022-10-18 02:15:05.677111 dj_stripe-2.8.0a0/djstripe/exceptions.py
+-rw-r--r--   0        0        0     6138 2023-04-18 16:12:01.675006 dj_stripe-2.8.0a0/djstripe/fields.py
+-rw-r--r--   0        0        0    17624 2022-10-18 02:15:05.677111 dj_stripe-2.8.0a0/djstripe/locale/fr/LC_MESSAGES/django.po
+-rw-r--r--   0        0        0    19987 2022-10-18 02:15:05.677111 dj_stripe-2.8.0a0/djstripe/locale/ru/LC_MESSAGES/django.po
+-rw-r--r--   0        0        0        0 2022-10-18 02:15:05.677111 dj_stripe-2.8.0a0/djstripe/management/__init__.py
+-rw-r--r--   0        0        0        0 2022-10-18 02:15:05.677111 dj_stripe-2.8.0a0/djstripe/management/commands/__init__.py
+-rw-r--r--   0        0        0      271 2022-10-18 02:15:05.677111 dj_stripe-2.8.0a0/djstripe/management/commands/djstripe_clear_expired_idempotency_keys.py
+-rw-r--r--   0        0        0     1016 2022-10-18 02:15:05.677111 dj_stripe-2.8.0a0/djstripe/management/commands/djstripe_init_customers.py
+-rw-r--r--   0        0        0     4089 2023-04-18 16:12:01.675006 dj_stripe-2.8.0a0/djstripe/management/commands/djstripe_process_events.py
+-rw-r--r--   0        0        0      861 2023-04-18 16:12:01.675006 dj_stripe-2.8.0a0/djstripe/management/commands/djstripe_sync_customers.py
+-rw-r--r--   0        0        0    22901 2023-04-20 18:37:25.954015 dj_stripe-2.8.0a0/djstripe/management/commands/djstripe_sync_models.py
+-rw-r--r--   0        0        0     2898 2022-10-18 02:15:05.677111 dj_stripe-2.8.0a0/djstripe/management/commands/djstripe_update_invoiceitem_ids.py
+-rw-r--r--   0        0        0     3267 2022-10-18 02:15:05.677111 dj_stripe-2.8.0a0/djstripe/managers.py
+-rw-r--r--   0        0        0   229743 2023-04-20 18:37:25.957348 dj_stripe-2.8.0a0/djstripe/migrations/0001_initial.py
+-rw-r--r--   0        0        0    12750 2023-04-20 18:37:25.957348 dj_stripe-2.8.0a0/djstripe/migrations/0008_2_5.py
+-rw-r--r--   0        0        0    14990 2023-04-20 18:37:25.957348 dj_stripe-2.8.0a0/djstripe/migrations/0009_2_6.py
+-rw-r--r--   0        0        0      471 2023-04-18 16:12:01.675006 dj_stripe-2.8.0a0/djstripe/migrations/0010_alter_customer_balance.py
+-rw-r--r--   0        0        0    20038 2023-04-20 18:37:25.957348 dj_stripe-2.8.0a0/djstripe/migrations/0011_2_7.py
+-rw-r--r--   0        0        0        0 2022-10-18 02:15:05.680445 dj_stripe-2.8.0a0/djstripe/migrations/__init__.py
+-rw-r--r--   0        0        0     1059 2023-04-18 16:12:01.675006 dj_stripe-2.8.0a0/djstripe/migrations/sql/migrate_mysql_backward.sql
+-rw-r--r--   0        0        0     1085 2023-04-18 16:12:01.675006 dj_stripe-2.8.0a0/djstripe/migrations/sql/migrate_mysql_forward.sql
+-rw-r--r--   0        0        0     1446 2023-04-18 16:12:01.675006 dj_stripe-2.8.0a0/djstripe/migrations/sql/migrate_postgresql_backward.sql
+-rw-r--r--   0        0        0     1216 2023-04-18 16:12:01.675006 dj_stripe-2.8.0a0/djstripe/migrations/sql/migrate_postgresql_forward.sql
+-rw-r--r--   0        0        0     5867 2023-04-18 16:12:01.675006 dj_stripe-2.8.0a0/djstripe/migrations/sql/migrate_sqlite_backward.sql
+-rw-r--r--   0        0        0     3269 2023-04-18 16:12:01.675006 dj_stripe-2.8.0a0/djstripe/migrations/sql/migrate_sqlite_forward.sql
+-rw-r--r--   0        0        0     1971 2022-10-18 02:15:05.680445 dj_stripe-2.8.0a0/djstripe/mixins.py
+-rw-r--r--   0        0        0     2153 2023-04-20 18:37:24.117337 dj_stripe-2.8.0a0/djstripe/models/__init__.py
+-rw-r--r--   0        0        0    10318 2023-04-20 18:37:25.957348 dj_stripe-2.8.0a0/djstripe/models/account.py
+-rw-r--r--   0        0        0     4290 2023-04-20 18:31:54.175370 dj_stripe-2.8.0a0/djstripe/models/api.py
+-rw-r--r--   0        0        0    40571 2023-04-20 18:37:25.957348 dj_stripe-2.8.0a0/djstripe/models/base.py
+-rw-r--r--   0        0        0   103701 2023-04-20 18:37:25.957348 dj_stripe-2.8.0a0/djstripe/models/billing.py
+-rw-r--r--   0        0        0     7709 2023-04-20 18:37:25.957348 dj_stripe-2.8.0a0/djstripe/models/checkout.py
+-rw-r--r--   0        0        0    13440 2023-04-20 18:37:25.957348 dj_stripe-2.8.0a0/djstripe/models/connect.py
+-rw-r--r--   0        0        0    87807 2023-04-20 18:37:25.957348 dj_stripe-2.8.0a0/djstripe/models/core.py
+-rw-r--r--   0        0        0        0 2022-10-18 02:15:05.680445 dj_stripe-2.8.0a0/djstripe/models/fraud.py
+-rw-r--r--   0        0        0     1340 2023-04-20 18:37:24.117337 dj_stripe-2.8.0a0/djstripe/models/identity.py
+-rw-r--r--   0        0        0     8809 2023-04-20 18:37:25.957348 dj_stripe-2.8.0a0/djstripe/models/orders.py
+-rw-r--r--   0        0        0    42070 2023-04-20 18:37:25.957348 dj_stripe-2.8.0a0/djstripe/models/payment_methods.py
+-rw-r--r--   0        0        0     1558 2023-04-20 18:37:25.957348 dj_stripe-2.8.0a0/djstripe/models/sigma.py
+-rw-r--r--   0        0        0    11808 2023-04-20 18:37:25.957348 dj_stripe-2.8.0a0/djstripe/models/webhooks.py
+-rw-r--r--   0        0        0     8205 2023-04-18 16:12:01.675006 dj_stripe-2.8.0a0/djstripe/settings.py
+-rw-r--r--   0        0        0     8324 2023-04-20 18:37:24.127337 dj_stripe-2.8.0a0/djstripe/signals.py
+-rw-r--r--   0        0        0      579 2022-10-18 02:15:05.680445 dj_stripe-2.8.0a0/djstripe/sync.py
+-rw-r--r--   0        0        0      251 2022-10-18 02:15:05.680445 dj_stripe-2.8.0a0/djstripe/templates/djstripe/admin/add_form.html
+-rw-r--r--   0        0        0      984 2022-10-18 02:15:05.680445 dj_stripe-2.8.0a0/djstripe/templates/djstripe/admin/change_form.html
+-rw-r--r--   0        0        0     2790 2022-10-18 02:15:05.680445 dj_stripe-2.8.0a0/djstripe/templates/djstripe/admin/confirm_action.html
+-rw-r--r--   0        0        0      250 2022-10-18 02:15:05.680445 dj_stripe-2.8.0a0/djstripe/templates/djstripe/admin/webhook_endpoint/add_form.html
+-rw-r--r--   0        0        0      227 2022-10-18 02:15:05.680445 dj_stripe-2.8.0a0/djstripe/templates/djstripe/admin/webhook_endpoint/change_form.html
+-rw-r--r--   0        0        0     1251 2022-10-18 02:15:05.680445 dj_stripe-2.8.0a0/djstripe/templates/djstripe/admin/webhook_endpoint/delete_confirmation.html
+-rw-r--r--   0        0        0      679 2022-10-18 02:15:05.680445 dj_stripe-2.8.0a0/djstripe/urls.py
+-rw-r--r--   0        0        0     3362 2023-04-18 16:12:01.675006 dj_stripe-2.8.0a0/djstripe/utils.py
+-rw-r--r--   0        0        0     2158 2023-04-18 16:12:01.675006 dj_stripe-2.8.0a0/djstripe/views.py
+-rw-r--r--   0        0        0     3045 2022-10-18 02:15:05.683778 dj_stripe-2.8.0a0/djstripe/webhooks.py
+-rw-r--r--   0        0        0     3634 2023-04-18 16:12:01.675006 dj_stripe-2.8.0a0/docs/README.md
+-rw-r--r--   0        0        0     4696 2023-04-20 18:38:52.354537 dj_stripe-2.8.0a0/pyproject.toml
+-rw-r--r--   0        0        0     5077 1970-01-01 00:00:00.000000 dj_stripe-2.8.0a0/PKG-INFO
```

### Comparing `dj_stripe-2.7.3/LICENSE` & `dj_stripe-2.8.0a0/LICENSE`

 * *Files identical despite different names*

### Comparing `dj_stripe-2.7.3/djstripe/admin/actions.py` & `dj_stripe-2.8.0a0/djstripe/admin/actions.py`

 * *Files 1% similar despite different names*

```diff
@@ -10,15 +10,14 @@
 from django.utils.text import capfirst
 
 from . import views
 from .forms import CustomActionForm
 
 
 class CustomActionMixin:
-
     # So that actions get shown even if there are 0 instances
     # https://docs.djangoproject.com/en/dev/ref/contrib/admin/#django.contrib.admin.ModelAdmin.show_full_result_count
     show_full_result_count = False
 
     def get_urls(self):
         custom_urls = [
             path(
@@ -26,15 +25,14 @@
                 self.admin_site.admin_view(views.ConfirmCustomAction.as_view()),
                 name="djstripe_custom_action",
             ),
         ]
         return custom_urls + super().get_urls()
 
     def get_admin_action_context(self, queryset, action_name, form_class):
-
         context = {
             "action_name": action_name,
             "model_name": self.model._meta.model_name,
             "info": [],
             "queryset": queryset,
             "changelist_url": reverse(
                 f"admin:{self.model._meta.app_label}_{self.model._meta.model_name}_changelist"
```

### Comparing `dj_stripe-2.7.3/djstripe/admin/admin.py` & `dj_stripe-2.8.0a0/djstripe/admin/admin.py`

 * *Files 2% similar despite different names*

```diff
@@ -9,40 +9,28 @@
 from stripe.error import InvalidRequestError
 
 from djstripe import models
 
 from .actions import CustomActionMixin
 from .admin_inline import (
     InvoiceItemInline,
+    LineItemInline,
     SubscriptionInline,
     SubscriptionItemInline,
     SubscriptionScheduleInline,
     TaxIdInline,
 )
 from .filters import CustomerHasSourceListFilter, CustomerSubscriptionStatusListFilter
 from .forms import (
     APIKeyAdminCreateForm,
     CustomActionForm,
     WebhookEndpointAdminCreateForm,
     WebhookEndpointAdminEditForm,
 )
-from .utils import (
-    ReadOnlyMixin,
-    custom_display_for_JSONfield,
-    get_forward_relation_fields_for_model,
-)
-
-
-def admin_display_for_field_override():
-    admin.utils.display_for_field = custom_display_for_JSONfield
-    admin.helpers.display_for_field = custom_display_for_JSONfield
-
-
-# execute override
-admin_display_for_field_override()
+from .utils import ReadOnlyMixin, get_forward_relation_fields_for_model
 
 
 @admin.register(models.IdempotencyKey)
 class IdempotencyKeyAdmin(ReadOnlyMixin, admin.ModelAdmin):
     list_display = ("uuid", "action", "created", "is_expired", "livemode")
     list_filter = ("livemode",)
     search_fields = ("uuid", "action")
@@ -64,15 +52,15 @@
     list_filter = ("created", "valid", "processed")
     list_select_related = ("event",)
     raw_id_fields = get_forward_relation_fields_for_model(models.WebhookEventTrigger)
 
     def reprocess(self, request, queryset):
         for trigger in queryset:
             if not trigger.valid:
-                self.message_user(request, "Skipped invalid trigger {}".format(trigger))
+                self.message_user(request, "Skipped invalid trigger {trigger!r}")
                 continue
 
             trigger.process()
 
     def get_queryset(self, request):
         return (
             super()
@@ -256,14 +244,38 @@
             .get_queryset(request)
             .select_related(
                 "subscriber", "default_source", "default_payment_method", "coupon"
             )
         )
 
 
+@admin.register(models.Discount)
+class DiscountAdmin(ReadOnlyMixin, StripeModelAdmin):
+    list_display = (
+        "customer",
+        "coupon",
+        "invoice_item",
+        "promotion_code",
+        "subscription",
+    )
+    list_filter = ("customer", "start", "end", "promotion_code", "coupon")
+
+    def get_actions(self, request):
+        """
+        Returns _resync_instances only for
+        models with a defined model.stripe_class.retrieve
+        """
+        actions = super().get_actions(request)
+
+        # remove "_sync_all_instances" as Discounts cannot be listed
+        actions.pop("_sync_all_instances", None)
+
+        return actions
+
+
 @admin.register(models.Dispute)
 class DisputeAdmin(ReadOnlyMixin, StripeModelAdmin):
     list_display = ("reason", "status", "amount", "currency", "is_charge_refundable")
     list_filter = ("is_charge_refundable", "reason", "status")
 
 
 @admin.register(models.Event)
@@ -334,22 +346,28 @@
         "destination",
         "amount",
         "arrival_date",
         "method",
         "status",
         "type",
     )
-    list_filter = ("destination__id",)
+    list_filter = ("destination__id", "original_payout")
     search_fields = ("destination__id", "balance_transaction__id")
 
     def get_queryset(self, request):
         return (
             super()
             .get_queryset(request)
-            .select_related("balance_transaction", "destination")
+            .select_related(
+                "balance_transaction",
+                "destination",
+                "failure_balance_transaction",
+                "original_payout",
+                "reversed_by",
+            )
         )
 
 
 @admin.register(models.SetupIntent)
 class SetupIntentAdmin(StripeModelAdmin):
     list_display = (
         "created",
@@ -421,14 +439,27 @@
             super()
             .get_queryset(request)
             .select_related("customer")
             .prefetch_related("default_tax_rates")
         )
 
 
+@admin.register(models.LineItem)
+class LineItemAdmin(StripeModelAdmin):
+    list_display = (
+        "amount",
+        "invoice_item",
+        "subscription",
+        "subscription_item",
+        "type",
+    )
+    list_filter = ("type", "invoice_item", "subscription", "subscription_item")
+    list_select_related = ("invoice_item", "subscription", "subscription_item")
+
+
 @admin.register(models.Mandate)
 class MandateAdmin(StripeModelAdmin):
     list_display = ("status", "type", "payment_method")
     list_filter = ("multi_use", "single_use")
     search_fields = ("payment_method__id",)
 
     def get_queryset(self, request):
@@ -490,15 +521,22 @@
             .select_related("product")
             .prefetch_related("product__prices")
         )
 
 
 @admin.register(models.Product)
 class ProductAdmin(StripeModelAdmin):
-    list_display = ("name", "type", "active", "url", "statement_descriptor")
+    list_display = (
+        "name",
+        "default_price",
+        "type",
+        "active",
+        "url",
+        "statement_descriptor",
+    )
     list_filter = ("type", "active", "shippable")
     search_fields = ("name", "statement_descriptor")
 
     def get_queryset(self, request):
         return super().get_queryset(request).prefetch_related("prices")
 
 
@@ -528,14 +566,26 @@
         return (
             super()
             .get_queryset(request)
             .select_related("customer", "customer__subscriber")
         )
 
 
+@admin.register(models.SourceTransaction)
+class SourceTransactionAdmin(StripeModelAdmin):
+    list_display = ("status", "amount", "currency")
+    list_filter = (
+        "status",
+        "source__id",
+        "source__customer",
+        "source__customer__subscriber",
+    )
+    list_select_related = ("source", "source__customer", "source__customer__subscriber")
+
+
 @admin.register(models.PaymentMethod)
 class PaymentMethodAdmin(StripeModelAdmin):
     list_display = ("customer", "type", "billing_details")
     list_filter = ("type",)
     search_fields = ("customer__id",)
 
     def get_queryset(self, request):
@@ -587,18 +637,18 @@
     list_display = ("display_name", "active", "tax_behavior", "tax_code")
     list_filter = ("active", "tax_behavior")
     list_select_related = ("tax_code",)
 
 
 @admin.register(models.Subscription)
 class SubscriptionAdmin(StripeModelAdmin):
-    list_display = ("customer", "status", "get_default_tax_rates")
+    list_display = ("customer", "status", "get_product_name", "get_default_tax_rates")
     list_filter = ("status", "cancel_at_period_end")
 
-    inlines = (SubscriptionItemInline, SubscriptionScheduleInline)
+    inlines = (SubscriptionItemInline, SubscriptionScheduleInline, LineItemInline)
 
     def get_actions(self, request):
         # get all actions
         actions = super().get_actions(request)
         actions["_cancel"] = self.get_action("_cancel")
         return actions
 
@@ -610,14 +660,16 @@
 
     def get_queryset(self, request):
         return (
             super()
             .get_queryset(request)
             .select_related(
                 "customer",
+                "plan",
+                "plan__product",
             )
             .prefetch_related(
                 "customer__subscriptions",
                 "customer__subscriptions__plan",
                 "customer__subscriptions__plan__product",
                 "default_tax_rates",
             )
@@ -625,14 +677,19 @@
 
     @admin.display(description="Default Tax Rates")
     def get_default_tax_rates(self, obj):
         result = [str(tax_rate) for tax_rate in obj.default_tax_rates.all()]
         if result:
             return ", ".join(result)
 
+    @admin.display(description="Product Name")
+    def get_product_name(self, obj):
+        if obj.plan and obj.plan.product:
+            return obj.plan.product.name
+
 
 @admin.register(models.SubscriptionSchedule)
 class SubscriptionScheduleAdmin(StripeModelAdmin):
     list_display = ("status", "subscription", "current_phase", "customer")
     list_filter = ("status", "subscription", "customer")
     list_select_related = ("customer", "customer__subscriber", "subscription")
```

### Comparing `dj_stripe-2.7.3/djstripe/admin/admin_inline.py` & `dj_stripe-2.8.0a0/djstripe/admin/admin_inline.py`

 * *Files 3% similar despite different names*

```diff
@@ -67,7 +67,17 @@
     """A TabularInline for use InvoiceItem."""
 
     model = models.InvoiceItem
     extra = 0
     readonly_fields = ("id", "created", "djstripe_owner_account")
     raw_id_fields = get_forward_relation_fields_for_model(model)
     show_change_link = True
+
+
+class LineItemInline(admin.StackedInline):
+    """A TabularInline for LineItem."""
+
+    model = models.LineItem
+    extra = 0
+    readonly_fields = ("id", "created", "djstripe_owner_account")
+    raw_id_fields = get_forward_relation_fields_for_model(model)
+    show_change_link = True
```

### Comparing `dj_stripe-2.7.3/djstripe/admin/filters.py` & `dj_stripe-2.8.0a0/djstripe/admin/filters.py`

 * *Files identical despite different names*

### Comparing `dj_stripe-2.7.3/djstripe/admin/forms.py` & `dj_stripe-2.8.0a0/djstripe/admin/forms.py`

 * *Files 4% similar despite different names*

```diff
@@ -3,25 +3,24 @@
 """
 from typing import Optional
 from urllib.parse import urljoin
 
 from django import forms
 from django.contrib.admin import helpers
 from django.urls import reverse
-from stripe.error import AuthenticationError, InvalidRequestError
+from stripe.error import AuthenticationError, InvalidRequestError, PermissionError
 
 from djstripe import enums, models, utils
 from djstripe.signals import ENABLED_EVENTS
 
 
 class CustomActionForm(forms.Form):
     """Form for Custom Django Admin Actions"""
 
     def __init__(self, *args, **kwargs):
-
         # remove model_name kwarg
         model_name = kwargs.pop("model_name")
 
         # remove action_name kwarg
         action_name = kwargs.pop("action_name")
 
         super().__init__(*args, **kwargs)
@@ -52,21 +51,28 @@
         fields = ["name", "secret"]
 
     def _post_clean(self):
         super()._post_clean()
 
         if not self.errors:
             if (
-                self.instance.type == enums.APIKeyType.secret
+                self.instance.type
+                in (
+                    enums.APIKeyType.secret,
+                    enums.APIKeyType.restricted,
+                )
                 and self.instance.djstripe_owner_account is None
             ):
                 try:
                     self.instance.refresh_account()
                 except AuthenticationError as e:
                     self.add_error("secret", str(e))
+                # Abandon Key Creation if the given key doesn't allow Accounts to be retrieved from Stripe
+                except PermissionError as e:
+                    self.add_error("secret", str(e))
 
 
 class WebhookEndpointAdminBaseForm(forms.ModelForm):
     def __init__(self, *args, **kwargs):
         super().__init__(*args, **kwargs)
         self.fields["description"].help_text = ""
         self.fields["description"].widget.attrs["rows"] = 3
@@ -108,16 +114,16 @@
         self.fields["djstripe_owner_account"].label = "Stripe account"
         self.fields["djstripe_owner_account"].help_text = ""
 
     enabled_events = forms.MultipleChoiceField(
         label="Enabled Events",
         required=True,
         help_text=(
-            "The list of events to enable for this endpoint. "
-            "['*'] indicates that all events are enabled, except those that require explicit selection."
+            "The list of events to enable for this endpoint. ['*'] indicates that all"
+            " events are enabled, except those that require explicit selection."
         ),
         choices=zip(ENABLED_EVENTS, ENABLED_EVENTS),
         initial=["*"],
     )
     livemode = forms.BooleanField(
         label="Live mode",
         required=False,
@@ -190,21 +196,20 @@
             field_name = self._get_field_name(e.param)
             self.add_error(field_name, e.user_message)
 
         return super()._post_clean()
 
 
 class WebhookEndpointAdminEditForm(WebhookEndpointAdminBaseForm):
-
     enabled_events = forms.MultipleChoiceField(
         label="Enabled Events",
         required=True,
         help_text=(
-            "The list of events to enable for this endpoint. "
-            "['*'] indicates that all events are enabled, except those that require explicit selection."
+            "The list of events to enable for this endpoint. ['*'] indicates that all"
+            " events are enabled, except those that require explicit selection."
         ),
         choices=zip(ENABLED_EVENTS, ENABLED_EVENTS),
     )
     base_url = forms.URLField(
         required=False,
         help_text=(
             "Updating this changes the base URL of the endpoint. "
```

### Comparing `dj_stripe-2.7.3/djstripe/admin/views.py` & `dj_stripe-2.8.0a0/djstripe/admin/views.py`

 * *Files identical despite different names*

### Comparing `dj_stripe-2.7.3/djstripe/apps.py` & `dj_stripe-2.8.0a0/djstripe/apps.py`

 * *Files 11% similar despite different names*

```diff
@@ -15,15 +15,15 @@
 
     name = "djstripe"
     default_auto_field = "django.db.models.AutoField"
 
     def ready(self):
         import stripe
 
-        from . import checks, event_handlers
+        from . import checks, event_handlers  # noqa (register event handlers)
 
         # Set app info
         # https://stripe.com/docs/building-plugins#setappinfo
         stripe.set_app_info(
             "dj-stripe",
             version=__version__,
             url="https://github.com/dj-stripe/dj-stripe",
```

### Comparing `dj_stripe-2.7.3/djstripe/checks.py` & `dj_stripe-2.8.0a0/djstripe/checks.py`

 * *Files 15% similar despite different names*

```diff
@@ -7,35 +7,89 @@
 from django.db.utils import DatabaseError
 
 STRIPE_API_VERSION_PATTERN = re.compile(
     r"(?P<year>\d{4})-(?P<month>\d{1,2})-(?P<day>\d{1,2})(; [\w=]*)?$"
 )
 
 
+# 4 possibilities:
+# Keys in admin and in settings
+# Keys in admin and not in settings
+# Keys not in admin but in settings
+# Keys not in admin and not in settings
 @checks.register("djstripe")
 def check_stripe_api_key(app_configs=None, **kwargs):
     """Check the user has configured API live/test keys correctly."""
+
+    def _check_stripe_api_in_settings(messages):
+        if djstripe_settings.STRIPE_LIVE_MODE:
+            if not djstripe_settings.LIVE_API_KEY.startswith(("sk_live_", "rk_live_")):
+                msg = "Bad Stripe live API key."
+                hint = 'STRIPE_LIVE_SECRET_KEY should start with "sk_live_"'
+                messages.append(checks.Info(msg, hint=hint, id="djstripe.I003"))
+        elif not djstripe_settings.TEST_API_KEY.startswith(("sk_test_", "rk_test_")):
+            msg = "Bad Stripe test API key."
+            hint = 'STRIPE_TEST_SECRET_KEY should start with "sk_test_"'
+            messages.append(checks.Info(msg, hint=hint, id="djstripe.I004"))
+
+    from djstripe.models import APIKey
+
     from .settings import djstripe_settings
 
     messages = []
 
-    if not djstripe_settings.STRIPE_SECRET_KEY:
-        msg = "Could not find a Stripe API key."
-        hint = "Add STRIPE_TEST_SECRET_KEY and STRIPE_LIVE_SECRET_KEY to your settings."
-        messages.append(checks.Critical(msg, hint=hint, id="djstripe.C001"))
-    elif djstripe_settings.STRIPE_LIVE_MODE:
-        if not djstripe_settings.LIVE_API_KEY.startswith(("sk_live_", "rk_live_")):
-            msg = "Bad Stripe live API key."
-            hint = 'STRIPE_LIVE_SECRET_KEY should start with "sk_live_"'
-            messages.append(checks.Critical(msg, hint=hint, id="djstripe.C002"))
-    else:
-        if not djstripe_settings.TEST_API_KEY.startswith(("sk_test_", "rk_test_")):
-            msg = "Bad Stripe test API key."
-            hint = 'STRIPE_TEST_SECRET_KEY should start with "sk_test_"'
-            messages.append(checks.Critical(msg, hint=hint, id="djstripe.C003"))
+    try:
+        # get all APIKey objects in the db
+        api_qs = APIKey.objects.all()
+
+        if not api_qs.exists():
+            msg = (
+                "You don't have any API Keys in the database. Did you forget to add"
+                " them?"
+            )
+            hint = (
+                "Add STRIPE_TEST_SECRET_KEY and STRIPE_LIVE_SECRET_KEY directly from"
+                " the Django Admin."
+            )
+            messages.append(checks.Info(msg, hint=hint, id="djstripe.I001"))
+
+            # Keys not in admin but in settings
+            if djstripe_settings.STRIPE_SECRET_KEY:
+                msg = (
+                    "Your keys are defined in the settings files. You can now add and"
+                    " manage them directly from the django admin."
+                )
+                hint = (
+                    "Add STRIPE_TEST_SECRET_KEY and STRIPE_LIVE_SECRET_KEY directly"
+                    " from the Django Admin."
+                )
+                messages.append(checks.Info(msg, hint=hint, id="djstripe.I002"))
+
+                # Ensure keys defined in settings files are valid
+                _check_stripe_api_in_settings(messages)
+
+        # Keys in admin and in settings
+        elif djstripe_settings.STRIPE_SECRET_KEY:
+            msg = (
+                "Your keys are defined in the settings files and are also in the admin."
+                " You can now add and manage them directly from the django admin."
+            )
+            hint = (
+                "We suggest adding STRIPE_TEST_SECRET_KEY and STRIPE_LIVE_SECRET_KEY"
+                " directly from the Django Admin. And removing them from the settings"
+                " files."
+            )
+            messages.append(checks.Info(msg, hint=hint, id="djstripe.I002"))
+
+            # Ensure keys defined in settings files are valid
+            _check_stripe_api_in_settings(messages)
+
+    except DatabaseError:
+        # Skip the check - Database most likely not migrated yet
+        return []
 
     return messages
 
 
 def validate_stripe_api_version(version):
     """
     Check the API version is formatted correctly for Stripe.
@@ -57,27 +111,25 @@
     from .settings import djstripe_settings
 
     messages = []
     default_version = djstripe_settings.DEFAULT_STRIPE_API_VERSION
     version = djstripe_settings.STRIPE_API_VERSION
 
     if not validate_stripe_api_version(version):
-        msg = "Invalid Stripe API version: {}".format(version)
+        msg = f"Invalid Stripe API version: {version!r}"
         hint = "STRIPE_API_VERSION should be formatted as: YYYY-MM-DD"
         messages.append(checks.Critical(msg, hint=hint, id="djstripe.C004"))
 
     if version != default_version:
         msg = (
-            "The Stripe API version has a non-default value of '{}'. "
+            f"The Stripe API version has a non-default value of '{version!r}'. "
             "Non-default versions are not explicitly supported, and may "
-            "cause compatibility issues.".format(version)
-        )
-        hint = "Use the dj-stripe default for Stripe API version: {}".format(
-            default_version
+            "cause compatibility issues."
         )
+        hint = f"Use the dj-stripe default for Stripe API version: {default_version}"
         messages.append(checks.Warning(msg, hint=hint, id="djstripe.W001"))
 
     return messages
 
 
 @checks.register("djstripe")
 def check_stripe_api_host(app_configs=None, **kwargs):
@@ -87,16 +139,18 @@
     from django.conf import settings
 
     messages = []
 
     if not settings.DEBUG and hasattr(settings, "STRIPE_API_HOST"):
         messages.append(
             checks.Warning(
-                "STRIPE_API_HOST should not be set in production! "
-                "This is most likely unintended.",
+                (
+                    "STRIPE_API_HOST should not be set in production! "
+                    "This is most likely unintended."
+                ),
                 hint="Remove STRIPE_API_HOST from your Django settings.",
                 id="djstripe.W002",
             )
         )
 
     return messages
 
@@ -144,81 +198,83 @@
         secret = djstripe_settings.WEBHOOK_SECRET
         # check secret
         check_webhook_endpoint_secret(secret, messages)
 
     return messages
 
 
+def _check_webhook_endpoint_validation(secret, messages, endpoint=None):
+    if not secret:
+        if endpoint:
+            extra_msg = f"but Webhook Endpoint: {endpoint} has no secret set"
+            secret_attr = "secret"
+        else:
+            extra_msg = "but DJSTRIPE_WEBHOOK_SECRET is not set"
+            secret_attr = "DJSTRIPE_WEBHOOK_SECRET"
+
+        messages.append(
+            checks.Info(
+                f"DJSTRIPE_WEBHOOK_VALIDATION is set to 'verify_signature' {extra_msg}",
+                hint=(
+                    f"Set {secret_attr} from Django shell or set"
+                    " DJSTRIPE_WEBHOOK_VALIDATION='retrieve_event'"
+                ),
+                id="djstripe.I006",
+            )
+        )
+    return messages
+
+
 @checks.register("djstripe")
 def check_webhook_validation(app_configs=None, **kwargs):
     """
     Check that DJSTRIPE_WEBHOOK_VALIDATION is valid
     """
-
-    def check_webhook_endpoint_validation(secret, messages, endpoint=None):
-        if not secret:
-            if endpoint:
-                extra_msg = f"but Webhook Endpoint: {endpoint} has no secret set"
-                secret_attr = "secret"
-            else:
-                extra_msg = "but DJSTRIPE_WEBHOOK_SECRET is not set"
-                secret_attr = "DJSTRIPE_WEBHOOK_SECRET"
-
-            messages.append(
-                checks.Critical(
-                    f"DJSTRIPE_WEBHOOK_VALIDATION='verify_signature' {extra_msg}",
-                    hint=f"Set {secret_attr} or set DJSTRIPE_WEBHOOK_VALIDATION='retrieve_event'",
-                    id="djstripe.C006",
-                )
-            )
-        return messages
-
     from .models import WebhookEndpoint
     from .settings import djstripe_settings
 
+    setting_name = "DJSTRIPE_WEBHOOK_VALIDATION"
+
     messages = []
 
     validation_options = ("verify_signature", "retrieve_event")
 
     if djstripe_settings.WEBHOOK_VALIDATION is None:
         messages.append(
             checks.Warning(
-                "Webhook validation is disabled, this is a security risk if the "
-                "webhook view is enabled",
-                hint="Set DJSTRIPE_WEBHOOK_VALIDATION to one of {}".format(
-                    ", ".join(validation_options)
+                (
+                    "Webhook validation is disabled, this is a security risk if the "
+                    "webhook view is enabled"
                 ),
+                hint=f"Set {setting_name} to one of: {validation_options}",
                 id="djstripe.W004",
             )
         )
     elif djstripe_settings.WEBHOOK_VALIDATION == "verify_signature":
-
         try:
             webhooks = list(WebhookEndpoint.objects.all())
         except DatabaseError:
             # Skip the db-based check (database most likely not migrated yet)
             webhooks = []
 
         if webhooks:
             for endpoint in webhooks:
                 secret = endpoint.secret
                 # check secret
-                check_webhook_endpoint_validation(secret, messages, endpoint=endpoint)
+                _check_webhook_endpoint_validation(secret, messages, endpoint=endpoint)
         else:
             secret = djstripe_settings.WEBHOOK_SECRET
             # check secret
-            check_webhook_endpoint_validation(secret, messages)
+            _check_webhook_endpoint_validation(secret, messages)
 
     elif djstripe_settings.WEBHOOK_VALIDATION not in validation_options:
         messages.append(
             checks.Critical(
-                "DJSTRIPE_WEBHOOK_VALIDATION is invalid",
-                hint="Set DJSTRIPE_WEBHOOK_VALIDATION to one of {} or None".format(
-                    ", ".join(validation_options)
-                ),
+                f"{setting_name} is invalid",
+                hint=f"Set {setting_name} to one of: {validation_options} or None",
                 id="djstripe.C007",
             )
         )
 
     return messages
 
 
@@ -232,20 +288,26 @@
     try:
         qs = list(WebhookEndpoint.objects.filter(secret="").all())
     except DatabaseError:
         # Skip the check - Database most likely not migrated yet
         return []
 
     for webhook in qs:
+        webhook_url = webhook.get_stripe_dashboard_url()
         messages.append(
             checks.Warning(
-                f"The secret of Webhook Endpoint: {webhook} is not populated in the db. Events sent to it will not work properly.",
+                (
+                    f"The secret of Webhook Endpoint: {webhook} is not populated "
+                    "in the db. Events sent to it will not work properly."
+                ),
                 hint=(
-                    "This can happen if it was deleted and resynced as Stripe sends the webhook secret ONLY on the creation call."
-                    f" Please use the django shell and update the secret with the value from {webhook.get_stripe_dashboard_url()}"
+                    "This can happen if it was deleted and resynced as Stripe "
+                    "sends the webhook secret ONLY on the creation call. "
+                    "Please use the django shell and update the secret with "
+                    f"the value from {webhook_url}"
                 ),
                 id="djstripe.W005",
             )
         )
 
     return messages
 
@@ -258,21 +320,23 @@
     Docs: https://stripe.com/docs/api#metadata
     """
     from .settings import djstripe_settings
 
     messages = []
 
     key = djstripe_settings.SUBSCRIBER_CUSTOMER_KEY
-    key_size = len(str(key))
-    if key and key_size > 40:
+    key_max_length = 40
+    if key and len(key) > key_max_length:
         messages.append(
             checks.Error(
-                "DJSTRIPE_SUBSCRIBER_CUSTOMER_KEY must be no more than "
-                "40 characters long",
-                hint="Current value: %r (%i characters)" % (key, key_size),
+                (
+                    "DJSTRIPE_SUBSCRIBER_CUSTOMER_KEY must be no more than "
+                    f"{key_max_length} characters long"
+                ),
+                hint=f"Current value: {key!r}",
                 id="djstripe.E001",
             )
         )
 
     return messages
 
 
@@ -282,31 +346,31 @@
     Check that DJSTRIPE_FOREIGN_KEY_TO_FIELD is set to a valid value.
     """
     from django.conf import settings
 
     setting_name = "DJSTRIPE_FOREIGN_KEY_TO_FIELD"
     hint = (
         f'Set {setting_name} to "id" if this is a new installation, '
-        f'otherwise set it to "djstripe_id".'
+        'otherwise set it to "djstripe_id".'
     )
     messages = []
 
     if not hasattr(settings, setting_name):
         messages.append(
             checks.Error(
-                "%s is not set." % (setting_name),
+                f"{setting_name} is not set.",
                 hint=hint,
                 id="djstripe.E002",
             )
         )
     elif getattr(settings, setting_name) not in ("id", "djstripe_id"):
+        setting_value = getattr(settings, setting_name)
         messages.append(
             checks.Error(
-                "%r is not a valid value for %s."
-                % (getattr(settings, setting_name), setting_name),
+                f"{setting_value} is not a valid value for {setting_name}.",
                 hint=hint,
                 id="djstripe.E003",
             )
         )
 
     return messages
 
@@ -323,19 +387,43 @@
     messages = []
 
     # callable can have exactly 2 arguments or
     # if more than two, the rest need to be optional.
     callable = djstripe_settings.WEBHOOK_EVENT_CALLBACK
 
     if callable:
+        # Deprecated in 2.8.0. Raise a warning.
+        messages.append(
+            checks.Warning(
+                (
+                    "DJSTRIPE_WEBHOOK_EVENT_CALLBACK is deprecated. See release notes"
+                    " for details."
+                ),
+                hint=(
+                    "If you need to trigger a function during webhook processing, "
+                    "you can use djstripe.signals instead.\n"
+                    "Available signals:\n"
+                    "- djstripe.signals.webhook_pre_validate\n"
+                    "- djstripe.signals.webhook_post_validate\n"
+                    "- djstripe.signals.webhook_pre_process\n"
+                    "- djstripe.signals.webhook_post_process\n"
+                    "- djstripe.signals.webhook_processing_error"
+                ),
+            )
+        )
+
         sig = signature(callable)
+        signature_sz = len(sig.parameters.keys())
 
-        if len(sig.parameters.keys()) < 2:
+        if signature_sz < 2:
             messages.append(
                 checks.Error(
-                    f"{callable} accepts {len(sig.parameters.keys())} arguments.",
-                    hint="You may have forgotten to add api_key parameter to your custom callback.",
+                    f"{callable} accepts {signature_sz} arguments.",
+                    hint=(
+                        "You may have forgotten to add api_key parameter to your custom"
+                        " callback."
+                    ),
                     id="djstripe.E004",
                 )
             )
 
     return messages
```

### Comparing `dj_stripe-2.7.3/djstripe/enums.py` & `dj_stripe-2.8.0a0/djstripe/enums.py`

 * *Files 6% similar despite different names*

```diff
@@ -269,15 +269,15 @@
     tiered = _("Tiered")
 
 
 class BusinessType(Enum):
     individual = _("Individual")
     company = _("Company")
     non_profit = _("Non Profit")
-    # government_entity = _("Government Entity")
+    government_entity = _("Government Entity")
 
 
 class CaptureMethod(Enum):
     automatic = _("Automatic")
     manual = _("Manual")
 
 
@@ -313,14 +313,26 @@
 
 class ChargeStatus(Enum):
     succeeded = _("Succeeded")
     pending = _("Pending")
     failed = _("Failed")
 
 
+class SessionStatus(Enum):
+    open = _("Open")
+    complete = _("Complete")
+    expired = _("Expired")
+
+
+class SessionPaymentStatus(Enum):
+    paid = _("Paid")
+    unpaid = _("Unpaid")
+    no_payment_required = _("No Payment Required")
+
+
 class ConfirmationMethod(Enum):
     automatic = _("Automatic")
     manual = _("Manual")
 
 
 class CouponDuration(Enum):
     once = _("Once")
@@ -410,14 +422,20 @@
     draft = _("Draft")
     open = _("Open")
     paid = _("Paid")
     uncollectible = _("Uncollectible")
     void = _("Void")
 
 
+class InvoiceorLineItemType(Enum):
+    invoice_item = _("Invoice Item")
+    line_item = _("Line Item")
+    unsupported = _("Unsupported")
+
+
 class IntentUsage(Enum):
     on_session = _("On session")
     off_session = _("Off session")
 
 
 class IntentStatus(Enum):
     """
@@ -433,14 +451,19 @@
     processing = _("Required actions have been handled.")
     canceled = _(
         "Cancellation invalidates the intent for future confirmation and "
         "cannot be undone."
     )
 
 
+class LineItem(Enum):
+    invoiceitem = _("Invoice Item")
+    subscription = _("Subscription")
+
+
 class MandateStatus(Enum):
     active = _("Active")
     inactive = _("Inactive")
     pending = _("Pending")
 
 
 class MandateType(Enum):
@@ -540,18 +563,20 @@
     )
     insufficient_funds = _("Stripe account has insufficient funds.")
     invalid_account_number = _("Invalid account number")
     incorrect_account_holder_name = _(
         "Your bank notified us that the bank account holder name on file is incorrect."
     )
     incorrect_account_holder_address = _(
-        "Your bank notified us that the bank account holder address on file is incorrect."
+        "Your bank notified us that the bank account holder address on file is"
+        " incorrect."
     )
     incorrect_account_holder_tax_id = _(
-        "Your bank notified us that the bank account holder tax ID on file is incorrect."
+        "Your bank notified us that the bank account holder tax ID on file is"
+        " incorrect."
     )
     invalid_currency = _("Bank account does not support currency.")
     no_account = _("Bank account could not be located.")
     unsupported_card = _("Card no longer supported.")
 
 
 class PayoutMethod(Enum):
@@ -740,14 +765,21 @@
 class SourceRedirectStatus(Enum):
     pending = _("Pending")
     succeeded = _("Succeeded")
     not_required = _("Not required")
     failed = _("Failed")
 
 
+class SourceTransactionStatus(Enum):
+    pending = _("Pending")
+    succeeded = _("Succeeded")
+    chargeable = _("Chargeable")
+    failed = _("Failed")
+
+
 class SubmitTypeStatus(Enum):
     auto = _("Auto")
     book = _("Book")
     donate = _("donate")
     pay = _("pay")
 
 
@@ -827,14 +859,34 @@
 
 
 class UsageAction(Enum):
     increment = _("increment")
     set = _("set")
 
 
+class VerificationSessionStatus(Enum):
+    """
+    https://stripe.com/docs/api/identity/verification_sessions/object#identity_verification_session_object-status
+    """
+
+    requires_input = _("Requires input")
+    processing = _("Processing")
+    verified = _("Verified")
+    canceled = _("Canceled")
+
+
+class VerificationType(Enum):
+    """
+    https://stripe.com/docs/api/identity/verification_sessions/object#identity_verification_session_object-type
+    """
+
+    document = _("Document")
+    id_number = _("ID number")
+
+
 class WebhookEndpointStatus(Enum):
     enabled = _("enabled")
     disabled = _("disabled")
 
 
 class DjstripePaymentMethodType(Enum):
     """
```

### Comparing `dj_stripe-2.7.3/djstripe/event_handlers.py` & `dj_stripe-2.8.0a0/djstripe/event_handlers.py`

 * *Files 12% similar despite different names*

```diff
@@ -64,15 +64,14 @@
     https://stripe.com/docs/api#customer_object
     """
     # will recieve all events of the type customer.X.Y so
     # need to ensure the data object is related to Customer Object
     target_object_type = event.data.get("object", {}).get("object", {})
 
     if event.customer and target_object_type == "customer":
-
         metadata = event.data.get("object", {}).get("metadata", {})
         customer_id = event.data.get("object", {}).get("id", "")
         subscriber_key = djstripe_settings.SUBSCRIBER_CUSTOMER_KEY
 
         # only update customer.subscriber if both the customer and subscriber already exist
         update_customer_helper(metadata, customer_id, subscriber_key)
 
@@ -137,14 +136,24 @@
             models.DjstripePaymentMethod.objects.filter(
                 id=customer_data.get("id", "")
             ).delete()
         else:
             _handle_crud_like_event(target_cls=models.Card, event=event)
 
 
+@webhooks.handler("identity.verification_session")
+def identity_verification_session_handler(event):
+    """
+    Handle updates to Stripe Identity Verification Session objects.
+
+    Docs: https://stripe.com/docs/api/identity/verification_sessions
+    """
+    _handle_crud_like_event(target_cls=models.VerificationSession, event=event)
+
+
 @webhooks.handler("customer.subscription")
 def customer_subscription_webhook_handler(event):
     """Handle updates to customer subscription objects.
 
     Docs an example subscription webhook response:
     https://stripe.com/docs/api#subscription_object
     """
@@ -252,36 +261,61 @@
     # need to ensure the data object is related to Dispute Object
     target_object_type = event.data.get("object", {}).get("object", {})
 
     if target_object_type == "dispute":
         _handle_crud_like_event(target_cls=models.Dispute, event=event)
 
 
+@webhooks.handler("source")
+def source_webhook_handler(event):
+    """Handle updates to Source objects
+    - charge: https://stripe.com/docs/api/charges
+    """
+    # will recieve all events of the type source.X.Y so
+    # need to ensure the data object is related to Source Object
+    target_object_type = event.data.get("object", {}).get("object", {})
+
+    if target_object_type == "source":
+        _handle_crud_like_event(target_cls=models.Source, event=event)
+
+
+@webhooks.handler("source.transaction")
+def source_transaction_webhook_handler(event):
+    """Handle updates to Source objects
+    - charge: https://stripe.com/docs/api/charges
+    """
+    # will recieve all events of the type source.transaction.Y so
+    # need to ensure the data object is related to SourceTransaction Object
+    target_object_type = event.data.get("object", {}).get("object", {})
+
+    if target_object_type == "source_transaction":
+        _handle_crud_like_event(target_cls=models.SourceTransaction, event=event)
+
+
 @webhooks.handler(
     "checkout",
     "coupon",
     "file",
     "invoice",
     "invoiceitem",
     "order",
     "payment_intent",
     "payout",
     "plan",
     "price",
     "product",
     "setup_intent",
     "subscription_schedule",
-    "source",
     "tax_rate",
     "transfer",
 )
 def other_object_webhook_handler(event):
     """
     Handle updates to checkout, coupon, file, invoice, invoiceitem, payment_intent,
-    plan, product, setup_intent, subscription_schedule, source, tax_rate
+    plan, product, setup_intent, subscription_schedule, tax_rate
     and transfer objects.
 
     Docs for:
     - checkout: https://stripe.com/docs/api/checkout/sessions
     - coupon: https://stripe.com/docs/api/coupons
     - file: https://stripe.com/docs/api/files
     - invoice: https://stripe.com/docs/api/invoices
@@ -290,15 +324,14 @@
     - payment_intent: https://stripe.com/docs/api/payment_intents
     - payout: https://stripe.com/docs/api/payouts
     - plan: https://stripe.com/docs/api/plans
     - price: https://stripe.com/docs/api/prices
     - product: https://stripe.com/docs/api/products
     - setup_intent: https://stripe.com/docs/api/setup_intents
     - subscription_schedule: https://stripe.com/docs/api/subscription_schedules
-    - source: https://stripe.com/docs/api/sources
     - tax_rate: https://stripe.com/docs/api/tax_rates/
     - transfer: https://stripe.com/docs/api/transfers
     """
 
     target_cls = {
         "checkout": models.Session,
         "coupon": models.Coupon,
@@ -310,15 +343,14 @@
         "payout": models.Payout,
         "plan": models.Plan,
         "price": models.Price,
         "product": models.Product,
         "transfer": models.Transfer,
         "setup_intent": models.SetupIntent,
         "subscription_schedule": models.SubscriptionSchedule,
-        "source": models.Source,
         "tax_rate": models.TaxRate,
     }.get(event.category)
 
     _handle_crud_like_event(target_cls=target_cls, event=event)
 
 
 #
@@ -405,14 +437,21 @@
         if hasattr(target_cls, "customer"):
             kwargs["customer"] = event.customer
 
         # For account.external_account.* events
         if event.parts[:2] == ["account", "external_account"] and stripe_account:
             kwargs["account"] = models.Account._get_or_retrieve(id=stripe_account)
 
-        data = target_cls(**kwargs).api_retrieve(
-            stripe_account=stripe_account, api_key=event.default_api_key
-        )
+        # Stripe doesn't allow direct retrieval of Discount and SourceTransaction Objects
+        # indirect retrieval via Source will not work as SourceTransaction will not have a source attached in
+        # source.transaction.created event
+        if target_cls not in (models.Discount, models.SourceTransaction):
+            data = target_cls(**kwargs).api_retrieve(
+                stripe_account=stripe_account, api_key=event.default_api_key
+            )
+        else:
+            data = data.get("object")
+
         # create or update the object from the retrieved Stripe Data
         obj = target_cls.sync_from_stripe_data(data, api_key=event.default_api_key)
 
     return obj
```

### Comparing `dj_stripe-2.7.3/djstripe/exceptions.py` & `dj_stripe-2.8.0a0/djstripe/exceptions.py`

 * *Files identical despite different names*

### Comparing `dj_stripe-2.7.3/djstripe/fields.py` & `dj_stripe-2.8.0a0/djstripe/fields.py`

 * *Files 4% similar despite different names*

```diff
@@ -2,27 +2,19 @@
 dj-stripe Custom Field Definitions
 """
 import decimal
 
 from django.conf import SettingsReference, settings
 from django.core.validators import MaxValueValidator, MinValueValidator
 from django.db import models
+from django.db.models import JSONField as BaseJSONField
 
-from .settings import djstripe_settings
 from .utils import convert_tstamp
 
 
-def import_jsonfield():
-    if djstripe_settings.USE_NATIVE_JSONFIELD:
-        from django.db.models import JSONField as BaseJSONField
-    else:
-        from jsonfield import JSONField as BaseJSONField
-    return BaseJSONField
-
-
 class FieldDeconstructMixin:
     IGNORED_ATTRS = [
         "verbose_name",
         "help_text",
         "choices",
         "get_latest_by",
         "ordering",
@@ -63,14 +55,20 @@
 
 class PaymentMethodForeignKey(FieldDeconstructMixin, models.ForeignKey):
     def __init__(self, **kwargs):
         kwargs.setdefault("to", "DjstripePaymentMethod")
         super().__init__(**kwargs)
 
 
+class InvoiceOrLineItemForeignKey(models.ForeignKey):
+    def __init__(self, **kwargs):
+        kwargs.setdefault("to", "InvoiceOrLineItem")
+        super().__init__(**kwargs)
+
+
 class StripePercentField(FieldDeconstructMixin, models.DecimalField):
     """A field used to define a percent according to djstripe logic."""
 
     def __init__(self, *args, **kwargs):
         """Assign default args to this field."""
         defaults = {
             "decimal_places": 2,
@@ -174,11 +172,11 @@
         val = data.get(self.name)
 
         # Note: 0 is a possible return value, which is 'falseish'
         if val is not None:
             return convert_tstamp(val)
 
 
-class JSONField(FieldDeconstructMixin, import_jsonfield()):
+class JSONField(FieldDeconstructMixin, BaseJSONField):
     """A field used to define a JSONField value according to djstripe logic."""
 
     pass
```

### Comparing `dj_stripe-2.7.3/djstripe/locale/fr/LC_MESSAGES/django.po` & `dj_stripe-2.8.0a0/djstripe/locale/fr/LC_MESSAGES/django.po`

 * *Files identical despite different names*

### Comparing `dj_stripe-2.7.3/djstripe/locale/ru/LC_MESSAGES/django.po` & `dj_stripe-2.8.0a0/djstripe/locale/ru/LC_MESSAGES/django.po`

 * *Files identical despite different names*

### Comparing `dj_stripe-2.7.3/djstripe/management/commands/djstripe_init_customers.py` & `dj_stripe-2.8.0a0/djstripe/management/commands/djstripe_init_customers.py`

 * *Files identical despite different names*

### Comparing `dj_stripe-2.7.3/djstripe/management/commands/djstripe_process_events.py` & `dj_stripe-2.8.0a0/djstripe/management/commands/djstripe_process_events.py`

 * *Files 4% similar despite different names*

```diff
@@ -55,28 +55,28 @@
         type_filter = options["type"]
 
         # Args are mutually exclusive,
         # so output what we are doing based on that assumption.
         if failed:
             self.output("Processing all failed events")
         elif type_filter:
-            self.output(
-                "Processing all events that match {filter}".format(filter=type_filter)
-            )
+            self.output(f"Processing all events that match {type_filter}")
         elif event_ids:
-            self.output("Processing specific events {events}".format(events=event_ids))
+            self.output(f"Processing specific events {event_ids}")
         else:
             self.output("Processing all available events")
 
         # Either use the specific event IDs to retrieve data, or use the api_list
         # if no specific event IDs are specified.
         if event_ids:
             listed_events = (
                 models.Event.stripe_class.retrieve(
-                    id=event_id, api_key=djstripe_settings.STRIPE_SECRET_KEY
+                    id=event_id,
+                    api_key=djstripe_settings.STRIPE_SECRET_KEY,
+                    stripe_version=djstripe_settings.STRIPE_API_VERSION,
                 )
                 for event_id in event_ids
             )
         else:
             list_kwargs = {}
             if failed:
                 list_kwargs["delivery_success"] = False
```

### Comparing `dj_stripe-2.7.3/djstripe/management/commands/djstripe_sync_customers.py` & `dj_stripe-2.8.0a0/djstripe/management/commands/djstripe_sync_customers.py`

 * *Files 10% similar despite different names*

```diff
@@ -17,14 +17,12 @@
         qs = djstripe_settings.get_subscriber_model().objects.filter(
             djstripe_customers__isnull=True
         )
         count = 0
         total = qs.count()
         for subscriber in qs:
             count += 1
-            perc = int(round(100 * (float(count) / float(total))))
+            pc = int(round(100 * (float(count) / float(total))))
             print(
-                "[{0}/{1} {2}%] Syncing {3} [{4}]".format(
-                    count, total, perc, subscriber.email, subscriber.pk
-                )
+                f"[{count}/{total} {pc}%] Syncing {subscriber.email} [{subscriber.pk}]"
             )
             sync_subscriber(subscriber)
```

### Comparing `dj_stripe-2.7.3/djstripe/management/commands/djstripe_sync_models.py` & `dj_stripe-2.8.0a0/djstripe/management/commands/djstripe_sync_models.py`

 * *Files 4% similar despite different names*

```diff
@@ -6,28 +6,30 @@
         python manage.py djstripe_sync_models
 
     2) To sync all Objects only for sk_test_XXX API key:
         python manage.py djstripe_sync_models --api-keys sk_test_XXX
 
     3) To sync all Objects only for sk_test_XXX and sk_test_YYY API keys:
         python manage.py djstripe_sync_models --api-keys sk_test_XXX sk_test_XXX
+                                    OR
+        python manage.py djstripe_sync_models --api-keys sk_test_XXX --api-keys sk_test_XXX
 
     4) To only sync Stripe Accounts for all API keys:
         python manage.py djstripe_sync_models Account
 
     5) To only sync Stripe Accounts for sk_test_XXX API key:
         python manage.py djstripe_sync_models Account --api-keys sk_test_XXX
 
     6) To only sync Stripe Accounts for sk_test_XXX and sk_test_YYY API keys:
         python manage.py djstripe_sync_models Account --api-keys sk_test_XXX sk_test_YYY
 
     7) To only sync Stripe Accounts and Charges for sk_test_XXX and sk_test_YYY API keys:
         python manage.py djstripe_sync_models Account Charge --api-keys sk_test_XXX sk_test_YYY
 """
-from typing import List
+import typing
 
 from django.apps import apps
 from django.core.exceptions import FieldDoesNotExist
 from django.core.management.base import BaseCommand, CommandError
 from django.db import models as django_models
 
 from ... import enums, models
@@ -43,41 +45,40 @@
     help = "Sync models from stripe."
 
     def add_arguments(self, parser):
         parser.add_argument(
             "args",
             metavar="ModelName",
             nargs="*",
-            help="restricts sync to these model names (default is to sync all "
-            "supported models)",
+            help=(
+                "restricts sync to these model names (default is to sync all "
+                "supported models)"
+            ),
         )
         # Named (optional) arguments
         parser.add_argument(
             "--api-keys",
             metavar="ApiKeys",
             nargs="*",
             type=str,
-            # todo uncomment this once support for python 3.7 is dropped.
-            # action="extend",
+            action="extend",
             help="Specify the api_keys you would like to perform this sync for.",
         )
 
-    def handle(self, *args, api_keys, **options):
+    def handle(self, *args, api_keys: typing.List[str], **options):
         app_label = "djstripe"
         app_config = apps.get_app_config(app_label)
-        model_list = []  # type: List[models.StripeModel]
+        model_list: typing.List[models.StripeModel] = []
 
         if args:
             for model_label in args:
                 try:
                     model = app_config.get_model(model_label)
                 except LookupError:
-                    raise CommandError(
-                        "Unknown model: {}.{}".format(app_label, model_label)
-                    )
+                    raise CommandError(f"Unknown model: {app_label}.{model_label}")
 
                 model_list.append(model)
         else:
             model_list = app_config.get_models()
 
         if api_keys is not None:
             for api_key in api_keys:
@@ -90,15 +91,16 @@
             api_qs = models.APIKey.objects.filter(secret__in=api_keys)
         else:
             # get all APIKey objects in the db
             api_qs = models.APIKey.objects.all()
 
             if not api_qs.exists():
                 self.stderr.write(
-                    "You don't have any API Keys in the database. Did you forget to add them?"
+                    "You don't have any API Keys in the database. Did you forget to add"
+                    " them?"
                 )
                 return
 
         for model in model_list:
             for api_key in api_qs:
                 self.sync_model(model, api_key=api_key)
 
@@ -108,15 +110,17 @@
 
         if model.stripe_class is None:
             return False, "no stripe_class"
 
         if not hasattr(model.stripe_class, "list"):
             if model in (
                 models.ApplicationFeeRefund,
+                models.LineItem,
                 models.Source,
+                models.SourceTransaction,
                 models.TransferReversal,
                 models.TaxId,
                 models.UsageRecordSummary,
             ):
                 return True, ""
             return False, "no stripe_class.list"
 
@@ -148,22 +152,25 @@
                 if (
                     model is models.Account
                     and stripe_account
                     == models.Account.get_default_account(api_key=api_key.secret).id
                 ):
                     # special case, since own account isn't returned by Account.api_list
                     stripe_obj = models.Account.stripe_class.retrieve(
-                        api_key=api_key.secret
+                        api_key=api_key.secret,
+                        stripe_version=djstripe_settings.STRIPE_API_VERSION,
                     )
 
                     djstripe_obj = model.sync_from_stripe_data(
                         stripe_obj, api_key=api_key.secret
                     )
                     self.stdout.write(
-                        f"  id={djstripe_obj.id}, pk={djstripe_obj.pk} ({djstripe_obj} on {stripe_account} for {api_key})"
+                        f"  id={djstripe_obj.id},"
+                        f" pk={djstripe_obj.pk} ({djstripe_obj} on {stripe_account} for"
+                        f" {api_key})"
                     )
 
                     # syncing BankAccount and Card objects of Stripe Connected Express and Custom Accounts
                     self.sync_bank_accounts_and_cards(
                         djstripe_obj,
                         stripe_account=stripe_account,
                         api_key=api_key.secret,
@@ -174,15 +181,17 @@
                     for stripe_obj in model.api_list(**list_kwargs):
                         # Skip model instances that throw an error
                         try:
                             djstripe_obj = model.sync_from_stripe_data(
                                 stripe_obj, api_key=api_key.secret
                             )
                             self.stdout.write(
-                                f"  id={djstripe_obj.id}, pk={djstripe_obj.pk} ({djstripe_obj} on {stripe_account} for {api_key})"
+                                f"  id={djstripe_obj.id},"
+                                f" pk={djstripe_obj.pk} ({djstripe_obj} on"
+                                f" {stripe_account} for {api_key})"
                             )
                             # syncing BankAccount and Card objects of Stripe Connected Express and Custom Accounts
                             self.sync_bank_accounts_and_cards(
                                 djstripe_obj,
                                 stripe_account=stripe_account,
                                 api_key=api_key.secret,
                             )
@@ -204,15 +213,18 @@
 
     @classmethod
     def get_stripe_account(cls, api_key: str, *args, **kwargs):
         """Get set of all stripe account ids including the Platform Acccount"""
         accs_set = set()
 
         # special case, since own account isn't returned by Account.api_list
-        stripe_platform_obj = models.Account.stripe_class.retrieve(api_key=api_key)
+        stripe_platform_obj = models.Account.stripe_class.retrieve(
+            api_key=api_key,
+            stripe_version=djstripe_settings.STRIPE_API_VERSION,
+        )
         accs_set.add(stripe_platform_obj.id)
 
         for stripe_connected_obj in models.Account.api_list(api_key=api_key, **kwargs):
             accs_set.add(stripe_connected_obj.id)
 
         return accs_set
 
@@ -233,15 +245,14 @@
                     field_inst = model._meta.get_field(field)
 
                     # get expand_fields on Forward FK and OneToOneField relations on the current model
                     if isinstance(
                         field_inst,
                         (django_models.ForeignKey, django_models.OneToOneField),
                     ):
-
                         try:
                             for (
                                 related_model_expand_field
                             ) in field_inst.related_model.expand_fields:
                                 # add expand_field on the current model
                                 expand.append(
                                     f"data.{field}.{related_model_expand_field}"
@@ -257,15 +268,14 @@
                                 if isinstance(
                                     related_model_expand_field_inst,
                                     (
                                         django_models.ForeignKey,
                                         django_models.OneToOneField,
                                     ),
                                 ):
-
                                     try:
                                         # need to prepend "field_name." to each of the entry in the expand_fields list
                                         related_model_expand_fields = map(
                                             lambda i: f"data.{field_inst.name}.{related_model_expand_field}.{i}",
                                             related_model_expand_field_inst.related_model.expand_fields,
                                         )
 
@@ -300,16 +310,33 @@
                 }
                 for account in accounts_set
             ]
 
         return default_list_kwargs
 
     @staticmethod
+    def get_list_kwargs_il(default_list_kwargs):
+        """Returns sequence of kwargs to sync Line Items for
+        all Stripe Accounts"""
+
+        all_list_kwargs = []
+
+        for def_kwarg in default_list_kwargs:
+            stripe_account = def_kwarg.get("stripe_account")
+            api_key = def_kwarg.get("api_key")
+            for stripe_invoice in models.Invoice.api_list(
+                stripe_account=stripe_account, api_key=api_key
+            ):
+                all_list_kwargs.append({"id": stripe_invoice.id, **def_kwarg})
+
+        return all_list_kwargs
+
+    @staticmethod
     def get_list_kwargs_pm(default_list_kwargs):
-        """Returns sequence of kwrags to sync Payment Methods for
+        """Returns sequence of kwargs to sync Payment Methods for
         all Stripe Accounts"""
 
         all_list_kwargs = []
         payment_method_types = enums.PaymentMethodType.__members__
 
         for def_kwarg in default_list_kwargs:
             stripe_account = def_kwarg.get("stripe_account")
@@ -336,32 +363,55 @@
             for stripe_customer in models.Customer.api_list(
                 stripe_account=stripe_account, api_key=api_key
             ):
                 all_list_kwargs.append({"id": stripe_customer.id, **def_kwarg})
 
         return all_list_kwargs
 
+    def get_list_kwargs_srctxn(default_list_kwargs):
+        """Returns sequence of kwargs to sync SourceTransactions for
+        all Stripe Accounts"""
+
+        all_list_kwargs = []
+        for def_kwarg in default_list_kwargs:
+            stripe_account = def_kwarg.get("stripe_account")
+            api_key = def_kwarg.get("api_key")
+            for stripe_customer in models.Customer.api_list(
+                stripe_account=stripe_account, api_key=api_key
+            ):
+                all_list_kwargs.append({"id": stripe_customer.id, **def_kwarg})
+
+                # fetch all Sources associated with the current customer instance
+                for source in models.Customer.stripe_class.list_sources(
+                    id=stripe_customer.id,
+                    stripe_account=stripe_account,
+                    object="source",
+                    api_key=api_key,
+                ).auto_paging_iter():
+                    all_list_kwargs.append({"id": source.id, **def_kwarg})
+        return all_list_kwargs
+
     @staticmethod
     def get_list_kwargs_si(default_list_kwargs):
-        """Returns sequence of kwrags to sync Subscription Items for
+        """Returns sequence of kwargs to sync Subscription Items for
         all Stripe Accounts"""
 
         all_list_kwargs = []
         for def_kwarg in default_list_kwargs:
             stripe_account = def_kwarg.get("stripe_account")
             api_key = def_kwarg.get("api_key")
             for subscription in models.Subscription.api_list(
                 stripe_account=stripe_account, api_key=api_key
             ):
                 all_list_kwargs.append({"subscription": subscription.id, **def_kwarg})
         return all_list_kwargs
 
     @staticmethod
     def get_list_kwargs_country_spec(default_list_kwargs):
-        """Returns sequence of kwrags to sync Country Specs for
+        """Returns sequence of kwargs to sync Country Specs for
         all Stripe Accounts"""
 
         all_list_kwargs = []
         for def_kwarg in default_list_kwargs:
             all_list_kwargs.append({"limit": 50, **def_kwarg})
 
         return all_list_kwargs
@@ -372,60 +422,60 @@
         all Stripe Accounts"""
 
         # tax codes are the same for all Stripe Accounts
         return [{}]
 
     @staticmethod
     def get_list_kwargs_trr(default_list_kwargs):
-        """Returns sequence of kwrags to sync Transfer Reversals for
+        """Returns sequence of kwargs to sync Transfer Reversals for
         all Stripe Accounts"""
         all_list_kwargs = []
         for def_kwarg in default_list_kwargs:
             stripe_account = def_kwarg.get("stripe_account")
             api_key = def_kwarg.get("api_key")
             for transfer in models.Transfer.api_list(
                 stripe_account=stripe_account, api_key=api_key
             ):
                 all_list_kwargs.append({"id": transfer.id, **def_kwarg})
 
         return all_list_kwargs
 
     @staticmethod
     def get_list_kwargs_fee_refund(default_list_kwargs):
-        """Returns sequence of kwrags to sync Application Fee Refunds for
+        """Returns sequence of kwargs to sync Application Fee Refunds for
         all Stripe Accounts"""
         all_list_kwargs = []
         for def_kwarg in default_list_kwargs:
             stripe_account = def_kwarg.get("stripe_account")
             api_key = def_kwarg.get("api_key")
             for fee in models.ApplicationFee.api_list(
                 stripe_account=stripe_account, api_key=api_key
             ):
                 all_list_kwargs.append({"id": fee.id, **def_kwarg})
 
         return all_list_kwargs
 
     @staticmethod
     def get_list_kwargs_tax_id(default_list_kwargs):
-        """Returns sequence of kwrags to sync Tax Ids for
+        """Returns sequence of kwargs to sync Tax Ids for
         all Stripe Accounts"""
         all_list_kwargs = []
         for def_kwarg in default_list_kwargs:
             stripe_account = def_kwarg.get("stripe_account")
             api_key = def_kwarg.get("api_key")
             for customer in models.Customer.api_list(
                 stripe_account=stripe_account, api_key=api_key
             ):
                 all_list_kwargs.append({"id": customer.id, **def_kwarg})
 
         return all_list_kwargs
 
     @staticmethod
     def get_list_kwargs_sis(default_list_kwargs):
-        """Returns sequence of kwrags to sync Usage Record Summarys for
+        """Returns sequence of kwargs to sync Usage Record Summarys for
         all Stripe Accounts"""
         all_list_kwargs = []
         for def_kwarg in default_list_kwargs:
             stripe_account = def_kwarg.get("stripe_account")
             api_key = def_kwarg.get("api_key")
             for subscription in models.Subscription.api_list(
                 stripe_account=stripe_account, api_key=api_key
@@ -447,16 +497,18 @@
         This allows us to sync models that require parameters to api_list
 
         :param model:
         :return: Sequence[dict]
         """
 
         list_kwarg_handlers_dict = {
+            "LineItem": self.get_list_kwargs_il,
             "PaymentMethod": self.get_list_kwargs_pm,
             "Source": self.get_list_kwargs_src,
+            "SourceTransaction": self.get_list_kwargs_srctxn,
             "SubscriptionItem": self.get_list_kwargs_si,
             "CountrySpec": self.get_list_kwargs_country_spec,
             "TransferReversal": self.get_list_kwargs_trr,
             "ApplicationFeeRefund": self.get_list_kwargs_fee_refund,
             "TaxCode": self.get_list_kwargs_txcd,
             "TaxId": self.get_list_kwargs_tax_id,
             "UsageRecordSummary": self.get_list_kwargs_sis,
@@ -482,20 +534,20 @@
         Syncs Bank Accounts and Cards for both customers and all external accounts
         """
         type = getattr(instance, "type", None)
         kwargs = {
             "id": instance.id,
             "api_key": api_key,
             "stripe_account": stripe_account,
+            "stripe_version": djstripe_settings.STRIPE_API_VERSION,
         }
 
         if type in (enums.AccountType.custom, enums.AccountType.express) and isinstance(
             instance, models.Account
         ):
-
             # fetch all Card and BankAccount objects associated with the instance
             items = models.Account.stripe_class.list_external_accounts(
                 **kwargs
             ).auto_paging_iter()
 
             self.start_sync(items, instance, api_key=api_key)
         elif isinstance(instance, models.Customer):
@@ -509,25 +561,25 @@
 
                 self.start_sync(items, instance, api_key=api_key)
 
     def start_sync(self, items, instance, api_key: str):
         bank_count = 0
         card_count = 0
         for item in items:
-
             if item.object == "bank_account":
                 model = models.BankAccount
                 bank_count += 1
             elif item.object == "card":
                 model = models.Card
                 card_count += 1
 
             item_obj = model.sync_from_stripe_data(item, api_key=api_key)
 
             self.stdout.write(
-                f"\tSyncing {model._meta.verbose_name} ({instance}): id={item_obj.id}, pk={item_obj.pk}"
+                f"\tSyncing {model._meta.verbose_name} ({instance}): id={item_obj.id},"
+                f" pk={item_obj.pk}"
             )
 
         if bank_count + card_count > 0:
             self.stdout.write(
                 f"\tSynced {bank_count} BankAccounts and {card_count} Cards"
             )
```

### Comparing `dj_stripe-2.7.3/djstripe/management/commands/djstripe_update_invoiceitem_ids.py` & `dj_stripe-2.8.0a0/djstripe/management/commands/djstripe_update_invoiceitem_ids.py`

 * *Files identical despite different names*

### Comparing `dj_stripe-2.7.3/djstripe/managers.py` & `dj_stripe-2.8.0a0/djstripe/managers.py`

 * *Files identical despite different names*

### Comparing `dj_stripe-2.7.3/djstripe/migrations/0001_initial.py` & `dj_stripe-2.8.0a0/djstripe/migrations/0001_initial.py`

 * *Files 14% similar despite different names*

```diff
@@ -35,15 +35,14 @@
             DJSTRIPE_SUBSCRIBER_MODEL_MIGRATION_DEPENDENCY,
         ),
         DJSTRIPE_SUBSCRIBER_MODEL,
     )
 
 
 class Migration(migrations.Migration):
-
     initial = True
 
     dependencies = [DJSTRIPE_SUBSCRIBER_MODEL_DEPENDENCY]
 
     operations = [
         migrations.CreateModel(
             name="Account",
@@ -56,15 +55,20 @@
                 ),
                 ("id", djstripe.fields.StripeIdField(max_length=255, unique=True)),
                 (
                     "livemode",
                     models.BooleanField(
                         blank=True,
                         default=None,
-                        help_text="Null here indicates that the livemode status is unknown or was previously unrecorded. Otherwise, this field indicates whether this record comes from Stripe test mode or live mode operation.",
+                        help_text=(
+                            "Null here indicates that the livemode status is unknown or"
+                            " was previously unrecorded. Otherwise, this field"
+                            " indicates whether this record comes from Stripe test mode"
+                            " or live mode operation."
+                        ),
                         null=True,
                     ),
                 ),
                 ("created", djstripe.fields.StripeDateTimeField(blank=True, null=True)),
                 ("metadata", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "description",
@@ -100,15 +104,18 @@
                 (
                     "default_currency",
                     djstripe.fields.StripeCurrencyCodeField(max_length=3),
                 ),
                 (
                     "details_submitted",
                     models.BooleanField(
-                        help_text="Whether account details have been submitted. Standard accounts cannot receive payouts before this is true."
+                        help_text=(
+                            "Whether account details have been submitted. Standard"
+                            " accounts cannot receive payouts before this is true."
+                        )
                     ),
                 ),
                 (
                     "email",
                     models.CharField(
                         help_text="The primary user's email address.", max_length=255
                     ),
@@ -122,15 +129,19 @@
                     ),
                 ),
                 (
                     "product_description",
                     models.CharField(
                         blank=True,
                         default="",
-                        help_text="Internal-only description of the product sold or service provided by the business. It's used by Stripe for risk and underwriting purposes.",
+                        help_text=(
+                            "Internal-only description of the product sold or service"
+                            " provided by the business. It's used by Stripe for risk"
+                            " and underwriting purposes."
+                        ),
                         max_length=255,
                     ),
                 ),
                 ("requirements", djstripe.fields.JSONField(blank=True, null=True)),
                 ("settings", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "type",
@@ -153,15 +164,20 @@
                 ),
                 ("id", djstripe.fields.StripeIdField(max_length=255, unique=True)),
                 (
                     "livemode",
                     models.BooleanField(
                         blank=True,
                         default=None,
-                        help_text="Null here indicates that the livemode status is unknown or was previously unrecorded. Otherwise, this field indicates whether this record comes from Stripe test mode or live mode operation.",
+                        help_text=(
+                            "Null here indicates that the livemode status is unknown or"
+                            " was previously unrecorded. Otherwise, this field"
+                            " indicates whether this record comes from Stripe test mode"
+                            " or live mode operation."
+                        ),
                         null=True,
                     ),
                 ),
                 ("created", djstripe.fields.StripeDateTimeField(blank=True, null=True)),
                 ("metadata", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "description",
@@ -183,15 +199,19 @@
                         decimal_places=2, max_digits=11
                     ),
                 ),
                 (
                     "captured",
                     models.BooleanField(
                         default=False,
-                        help_text="If the charge was created without capturing, this boolean represents whether or not it is still uncaptured or has since been captured.",
+                        help_text=(
+                            "If the charge was created without capturing, this boolean"
+                            " represents whether or not it is still uncaptured or has"
+                            " since been captured."
+                        ),
                     ),
                 ),
                 ("currency", djstripe.fields.StripeCurrencyCodeField(max_length=3)),
                 (
                     "failure_code",
                     djstripe.fields.StripeEnumField(
                         blank=True,
@@ -201,113 +221,148 @@
                     ),
                 ),
                 (
                     "failure_message",
                     models.TextField(
                         blank=True,
                         default="",
-                        help_text="Message to user further explaining reason for charge failure if available.",
+                        help_text=(
+                            "Message to user further explaining reason for charge"
+                            " failure if available."
+                        ),
                         max_length=5000,
                     ),
                 ),
                 ("fraud_details", djstripe.fields.JSONField(blank=True, null=True)),
                 ("outcome", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "paid",
                     models.BooleanField(
                         default=False,
-                        help_text="True if the charge succeeded, or was successfully authorized for later capture, False otherwise.",
+                        help_text=(
+                            "True if the charge succeeded, or was successfully"
+                            " authorized for later capture, False otherwise."
+                        ),
                     ),
                 ),
                 (
                     "payment_method_details",
                     djstripe.fields.JSONField(blank=True, null=True),
                 ),
                 (
                     "receipt_email",
                     models.TextField(
                         blank=True,
                         default="",
-                        help_text="The email address that the receipt for this charge was sent to.",
+                        help_text=(
+                            "The email address that the receipt for this charge was"
+                            " sent to."
+                        ),
                         max_length=800,
                     ),
                 ),
                 (
                     "receipt_number",
                     models.CharField(
                         blank=True,
                         default="",
-                        help_text="The transaction number that appears on email receipts sent for this charge.",
+                        help_text=(
+                            "The transaction number that appears on email receipts sent"
+                            " for this charge."
+                        ),
                         max_length=14,
                     ),
                 ),
                 (
                     "receipt_url",
                     models.TextField(
                         blank=True,
                         default="",
-                        help_text="This is the URL to view the receipt for this charge. The receipt is kept up-to-date to the latest state of the charge, including any refunds. If the charge is for an Invoice, the receipt will be stylized as an Invoice receipt.",
+                        help_text=(
+                            "This is the URL to view the receipt for this charge. The"
+                            " receipt is kept up-to-date to the latest state of the"
+                            " charge, including any refunds. If the charge is for an"
+                            " Invoice, the receipt will be stylized as an Invoice"
+                            " receipt."
+                        ),
                         max_length=5000,
                     ),
                 ),
                 (
                     "refunded",
                     models.BooleanField(
                         default=False,
-                        help_text="Whether or not the charge has been fully refunded. If the charge is only partially refunded, this attribute will still be false.",
+                        help_text=(
+                            "Whether or not the charge has been fully refunded. If the"
+                            " charge is only partially refunded, this attribute will"
+                            " still be false."
+                        ),
                     ),
                 ),
                 ("shipping", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "statement_descriptor",
                     models.CharField(
                         blank=True,
-                        help_text="For card charges, use statement_descriptor_suffix instead. Otherwise, you can use this value as the complete description of a charge on your customers' statements. Must contain at least one letter, maximum 22 characters.",
+                        help_text=(
+                            "For card charges, use statement_descriptor_suffix instead."
+                            " Otherwise, you can use this value as the complete"
+                            " description of a charge on your customers' statements."
+                            " Must contain at least one letter, maximum 22 characters."
+                        ),
                         max_length=22,
                         null=True,
                     ),
                 ),
                 (
                     "status",
                     djstripe.fields.StripeEnumField(
                         enum=djstripe.enums.ChargeStatus, max_length=9
                     ),
                 ),
                 (
                     "transfer_group",
                     models.CharField(
                         blank=True,
-                        help_text="A string that identifies this transaction as part of a group.",
+                        help_text=(
+                            "A string that identifies this transaction as part of a"
+                            " group."
+                        ),
                         max_length=255,
                         null=True,
                     ),
                 ),
                 (
                     "on_behalf_of",
                     djstripe.fields.StripeForeignKey(
                         blank=True,
                         null=True,
                         on_delete=django.db.models.deletion.CASCADE,
                         related_name="charges",
                         to="djstripe.account",
                         to_field=settings.DJSTRIPE_FOREIGN_KEY_TO_FIELD,
-                        help_text="The account (if any) the charge was made on behalf of without triggering an automatic transfer.",
+                        help_text=(
+                            "The account (if any) the charge was made on behalf of"
+                            " without triggering an automatic transfer."
+                        ),
                     ),
                 ),
                 (
                     "amount_captured",
                     djstripe.fields.StripeDecimalCurrencyAmountField(
                         decimal_places=2, max_digits=11, null=True
                     ),
                 ),
                 (
                     "application",
                     models.CharField(
                         blank=True,
-                        help_text="ID of the Connect application that created the charge.",
+                        help_text=(
+                            "ID of the Connect application that created the charge."
+                        ),
                         max_length=255,
                     ),
                 ),
                 (
                     "application_fee_amount",
                     djstripe.fields.StripeDecimalCurrencyAmountField(
                         blank=True, decimal_places=2, max_digits=11, null=True
@@ -317,29 +372,41 @@
                     "billing_details",
                     djstripe.fields.JSONField(null=True),
                 ),
                 (
                     "calculated_statement_descriptor",
                     models.CharField(
                         default="",
-                        help_text="The full statement descriptor that is passed to card networks, and that is displayed on your customers' credit card and bank statements. Allows you to see what the statement descriptor looks like after the static and dynamic portions are combined.",
+                        help_text=(
+                            "The full statement descriptor that is passed to card"
+                            " networks, and that is displayed on your customers' credit"
+                            " card and bank statements. Allows you to see what the"
+                            " statement descriptor looks like after the static and"
+                            " dynamic portions are combined."
+                        ),
                         max_length=22,
                     ),
                 ),
                 (
                     "disputed",
                     models.BooleanField(
                         default=False, help_text="Whether the charge has been disputed."
                     ),
                 ),
                 (
                     "statement_descriptor_suffix",
                     models.CharField(
                         blank=True,
-                        help_text="Provides information about the charge that customers see on their statements. Concatenated with the prefix (shortened descriptor) or statement descriptor that's set on the account to form the complete statement descriptor. Maximum 22 characters for the concatenated descriptor.",
+                        help_text=(
+                            "Provides information about the charge that customers see"
+                            " on their statements. Concatenated with the prefix"
+                            " (shortened descriptor) or statement descriptor that's set"
+                            " on the account to form the complete statement descriptor."
+                            " Maximum 22 characters for the concatenated descriptor."
+                        ),
                         max_length=22,
                         null=True,
                     ),
                 ),
                 (
                     "transfer_data",
                     djstripe.fields.JSONField(blank=True, null=True),
@@ -357,15 +424,20 @@
                     ),
                 ),
                 (
                     "livemode",
                     models.BooleanField(
                         blank=True,
                         default=None,
-                        help_text="Null here indicates that the livemode status is unknown or was previously unrecorded. Otherwise, this field indicates whether this record comes from Stripe test mode or live mode operation.",
+                        help_text=(
+                            "Null here indicates that the livemode status is unknown or"
+                            " was previously unrecorded. Otherwise, this field"
+                            " indicates whether this record comes from Stripe test mode"
+                            " or live mode operation."
+                        ),
                         null=True,
                     ),
                 ),
                 ("created", djstripe.fields.StripeDateTimeField(blank=True, null=True)),
                 ("metadata", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "description",
@@ -394,23 +466,29 @@
                         default="once", enum=djstripe.enums.CouponDuration, max_length=9
                     ),
                 ),
                 (
                     "duration_in_months",
                     models.PositiveIntegerField(
                         blank=True,
-                        help_text="If `duration` is `repeating`, the number of months the coupon applies.",
+                        help_text=(
+                            "If `duration` is `repeating`, the number of months the"
+                            " coupon applies."
+                        ),
                         null=True,
                     ),
                 ),
                 (
                     "max_redemptions",
                     models.PositiveIntegerField(
                         blank=True,
-                        help_text="Maximum number of times this coupon can be redeemed, in total, before it is no longer valid.",
+                        help_text=(
+                            "Maximum number of times this coupon can be redeemed, in"
+                            " total, before it is no longer valid."
+                        ),
                         null=True,
                     ),
                 ),
                 (
                     "percent_off",
                     djstripe.fields.StripePercentField(
                         blank=True,
@@ -428,23 +506,29 @@
                     djstripe.fields.StripeDateTimeField(blank=True, null=True),
                 ),
                 (
                     "times_redeemed",
                     models.PositiveIntegerField(
                         default=0,
                         editable=False,
-                        help_text="Number of times this coupon has been applied to a customer.",
+                        help_text=(
+                            "Number of times this coupon has been applied to a"
+                            " customer."
+                        ),
                     ),
                 ),
                 (
                     "name",
                     models.TextField(
                         blank=True,
                         default="",
-                        help_text="Name of the coupon displayed to customers on for instance invoices or receipts.",
+                        help_text=(
+                            "Name of the coupon displayed to customers on for instance"
+                            " invoices or receipts."
+                        ),
                         max_length=5000,
                     ),
                 ),
                 (
                     "djstripe_owner_account",
                     djstripe.fields.StripeForeignKey(
                         blank=True,
@@ -472,15 +556,20 @@
                 ),
                 ("id", djstripe.fields.StripeIdField(max_length=255, unique=True)),
                 (
                     "livemode",
                     models.BooleanField(
                         blank=True,
                         default=None,
-                        help_text="Null here indicates that the livemode status is unknown or was previously unrecorded. Otherwise, this field indicates whether this record comes from Stripe test mode or live mode operation.",
+                        help_text=(
+                            "Null here indicates that the livemode status is unknown or"
+                            " was previously unrecorded. Otherwise, this field"
+                            " indicates whether this record comes from Stripe test mode"
+                            " or live mode operation."
+                        ),
                         null=True,
                     ),
                 ),
                 ("created", djstripe.fields.StripeDateTimeField(blank=True, null=True)),
                 ("metadata", djstripe.fields.JSONField(blank=True, null=True)),
                 ("djstripe_created", models.DateTimeField(auto_now_add=True)),
                 ("djstripe_updated", models.DateTimeField(auto_now=True)),
@@ -520,15 +609,20 @@
                 ),
                 ("id", djstripe.fields.StripeIdField(max_length=255, unique=True)),
                 (
                     "livemode",
                     models.BooleanField(
                         blank=True,
                         default=None,
-                        help_text="Null here indicates that the livemode status is unknown or was previously unrecorded. Otherwise, this field indicates whether this record comes from Stripe test mode or live mode operation.",
+                        help_text=(
+                            "Null here indicates that the livemode status is unknown or"
+                            " was previously unrecorded. Otherwise, this field"
+                            " indicates whether this record comes from Stripe test mode"
+                            " or live mode operation."
+                        ),
                         null=True,
                     ),
                 ),
                 ("created", djstripe.fields.StripeDateTimeField(blank=True, null=True)),
                 ("metadata", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "description",
@@ -548,15 +642,18 @@
                         blank=True, default="", max_length=3
                     ),
                 ),
                 (
                     "delinquent",
                     models.BooleanField(
                         default=False,
-                        help_text="Whether or not the latest charge for the customer's latest invoice has failed.",
+                        help_text=(
+                            "Whether or not the latest charge for the customer's latest"
+                            " invoice has failed."
+                        ),
                     ),
                 ),
                 (
                     "coupon_start",
                     djstripe.fields.StripeDateTimeField(
                         blank=True, editable=False, null=True
                     ),
@@ -601,15 +698,18 @@
                 ),
                 ("address", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "invoice_prefix",
                     models.CharField(
                         blank=True,
                         default="",
-                        help_text="The prefix for the customer used to generate unique invoice numbers.",
+                        help_text=(
+                            "The prefix for the customer used to generate unique"
+                            " invoice numbers."
+                        ),
                         max_length=255,
                     ),
                 ),
                 ("invoice_settings", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "name",
                     models.TextField(
@@ -640,15 +740,18 @@
                     djstripe.fields.StripeForeignKey(
                         blank=True,
                         null=True,
                         on_delete=django.db.models.deletion.SET_NULL,
                         related_name="+",
                         to="djstripe.paymentmethod",
                         to_field=settings.DJSTRIPE_FOREIGN_KEY_TO_FIELD,
-                        help_text="default payment method used for subscriptions and invoices for the customer.",
+                        help_text=(
+                            "default payment method used for subscriptions and invoices"
+                            " for the customer."
+                        ),
                     ),
                 ),
                 (
                     "djstripe_owner_account",
                     djstripe.fields.StripeForeignKey(
                         blank=True,
                         null=True,
@@ -677,15 +780,20 @@
                 ),
                 ("id", djstripe.fields.StripeIdField(max_length=255, unique=True)),
                 (
                     "livemode",
                     models.BooleanField(
                         blank=True,
                         default=None,
-                        help_text="Null here indicates that the livemode status is unknown or was previously unrecorded. Otherwise, this field indicates whether this record comes from Stripe test mode or live mode operation.",
+                        help_text=(
+                            "Null here indicates that the livemode status is unknown or"
+                            " was previously unrecorded. Otherwise, this field"
+                            " indicates whether this record comes from Stripe test mode"
+                            " or live mode operation."
+                        ),
                         null=True,
                     ),
                 ),
                 ("created", djstripe.fields.StripeDateTimeField(blank=True, null=True)),
                 ("metadata", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "description",
@@ -698,15 +806,20 @@
                 ("amount", djstripe.fields.StripeQuantumCurrencyAmountField()),
                 ("currency", djstripe.fields.StripeCurrencyCodeField(max_length=3)),
                 ("evidence", djstripe.fields.JSONField()),
                 ("evidence_details", djstripe.fields.JSONField()),
                 (
                     "is_charge_refundable",
                     models.BooleanField(
-                        help_text="If true, it is still possible to refund the disputed payment. Once the payment has been fully refunded, no further funds will be withdrawn from your Stripe account as a result of this dispute."
+                        help_text=(
+                            "If true, it is still possible to refund the disputed"
+                            " payment. Once the payment has been fully refunded, no"
+                            " further funds will be withdrawn from your Stripe account"
+                            " as a result of this dispute."
+                        )
                     ),
                 ),
                 (
                     "reason",
                     djstripe.fields.StripeEnumField(
                         enum=djstripe.enums.DisputeReason, max_length=25
                     ),
@@ -742,15 +855,20 @@
                 ),
                 ("id", djstripe.fields.StripeIdField(max_length=255, unique=True)),
                 (
                     "livemode",
                     models.BooleanField(
                         blank=True,
                         default=None,
-                        help_text="Null here indicates that the livemode status is unknown or was previously unrecorded. Otherwise, this field indicates whether this record comes from Stripe test mode or live mode operation.",
+                        help_text=(
+                            "Null here indicates that the livemode status is unknown or"
+                            " was previously unrecorded. Otherwise, this field"
+                            " indicates whether this record comes from Stripe test mode"
+                            " or live mode operation."
+                        ),
                         null=True,
                     ),
                 ),
                 ("created", djstripe.fields.StripeDateTimeField(blank=True, null=True)),
                 ("metadata", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "description",
@@ -760,25 +878,35 @@
                 ),
                 ("djstripe_created", models.DateTimeField(auto_now_add=True)),
                 ("djstripe_updated", models.DateTimeField(auto_now=True)),
                 (
                     "api_version",
                     models.CharField(
                         blank=True,
-                        help_text="the API version at which the event data was rendered. Blank for old entries only, all new entries will have this value",
+                        help_text=(
+                            "the API version at which the event data was rendered."
+                            " Blank for old entries only, all new entries will have"
+                            " this value"
+                        ),
                         max_length=15,
                     ),
                 ),
                 ("data", djstripe.fields.JSONField()),
                 (
                     "request_id",
                     models.CharField(
                         blank=True,
                         default="",
-                        help_text="Information about the request that triggered this event, for traceability purposes. If empty string then this is an old entry without that data. If Null then this is not an old entry, but a Stripe 'automated' event with no associated request.",
+                        help_text=(
+                            "Information about the request that triggered this event,"
+                            " for traceability purposes. If empty string then this is"
+                            " an old entry without that data. If Null then this is not"
+                            " an old entry, but a Stripe 'automated' event with no"
+                            " associated request."
+                        ),
                         max_length=50,
                     ),
                 ),
                 ("idempotency_key", models.TextField(blank=True, default="")),
                 (
                     "type",
                     models.CharField(
@@ -810,15 +938,20 @@
                 ),
                 ("id", djstripe.fields.StripeIdField(max_length=255, unique=True)),
                 (
                     "livemode",
                     models.BooleanField(
                         blank=True,
                         default=None,
-                        help_text="Null here indicates that the livemode status is unknown or was previously unrecorded. Otherwise, this field indicates whether this record comes from Stripe test mode or live mode operation.",
+                        help_text=(
+                            "Null here indicates that the livemode status is unknown or"
+                            " was previously unrecorded. Otherwise, this field"
+                            " indicates whether this record comes from Stripe test mode"
+                            " or live mode operation."
+                        ),
                         null=True,
                     ),
                 ),
                 ("created", djstripe.fields.StripeDateTimeField(blank=True, null=True)),
                 ("metadata", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "description",
@@ -827,15 +960,18 @@
                     ),
                 ),
                 ("djstripe_created", models.DateTimeField(auto_now_add=True)),
                 ("djstripe_updated", models.DateTimeField(auto_now=True)),
                 (
                     "filename",
                     models.CharField(
-                        help_text="A filename for the file, suitable for saving to a filesystem.",
+                        help_text=(
+                            "A filename for the file, suitable for saving to a"
+                            " filesystem."
+                        ),
                         max_length=255,
                     ),
                 ),
                 (
                     "purpose",
                     djstripe.fields.StripeEnumField(
                         enum=djstripe.enums.FilePurpose, max_length=35
@@ -852,15 +988,17 @@
                     djstripe.fields.StripeEnumField(
                         enum=djstripe.enums.FileType, max_length=4
                     ),
                 ),
                 (
                     "url",
                     models.CharField(
-                        help_text="A read-only URL where the uploaded file can be accessed.",
+                        help_text=(
+                            "A read-only URL where the uploaded file can be accessed."
+                        ),
                         max_length=200,
                     ),
                 ),
                 (
                     "djstripe_owner_account",
                     djstripe.fields.StripeForeignKey(
                         blank=True,
@@ -895,15 +1033,20 @@
                 ),
                 ("id", djstripe.fields.StripeIdField(max_length=255, unique=True)),
                 (
                     "livemode",
                     models.BooleanField(
                         blank=True,
                         default=None,
-                        help_text="Null here indicates that the livemode status is unknown or was previously unrecorded. Otherwise, this field indicates whether this record comes from Stripe test mode or live mode operation.",
+                        help_text=(
+                            "Null here indicates that the livemode status is unknown or"
+                            " was previously unrecorded. Otherwise, this field"
+                            " indicates whether this record comes from Stripe test mode"
+                            " or live mode operation."
+                        ),
                         null=True,
                     ),
                 ),
                 ("created", djstripe.fields.StripeDateTimeField(blank=True, null=True)),
                 ("metadata", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "description",
@@ -956,24 +1099,29 @@
                         enum=djstripe.enums.PlanInterval, max_length=5
                     ),
                 ),
                 (
                     "interval_count",
                     models.PositiveIntegerField(
                         blank=True,
-                        help_text="The number of intervals (specified in the interval property) between each subscription billing.",
+                        help_text=(
+                            "The number of intervals (specified in the interval"
+                            " property) between each subscription billing."
+                        ),
                         null=True,
                     ),
                 ),
                 (
                     "nickname",
                     models.TextField(
                         blank=True,
                         default="",
-                        help_text="A brief description of the plan, hidden from customers.",
+                        help_text=(
+                            "A brief description of the plan, hidden from customers."
+                        ),
                         max_length=5000,
                     ),
                 ),
                 ("tiers", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "tiers_mode",
                     djstripe.fields.StripeEnumField(
@@ -984,15 +1132,19 @@
                     ),
                 ),
                 ("transform_usage", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "trial_period_days",
                     models.IntegerField(
                         blank=True,
-                        help_text="Number of trial period days granted when subscribing a customer to this plan. Null if the plan has no trial period.",
+                        help_text=(
+                            "Number of trial period days granted when subscribing a"
+                            " customer to this plan. Null if the plan has no trial"
+                            " period."
+                        ),
                         null=True,
                     ),
                 ),
                 (
                     "usage_type",
                     djstripe.fields.StripeEnumField(
                         default="licensed",
@@ -1014,15 +1166,20 @@
                 ),
                 ("id", djstripe.fields.StripeIdField(max_length=255, unique=True)),
                 (
                     "livemode",
                     models.BooleanField(
                         blank=True,
                         default=None,
-                        help_text="Null here indicates that the livemode status is unknown or was previously unrecorded. Otherwise, this field indicates whether this record comes from Stripe test mode or live mode operation.",
+                        help_text=(
+                            "Null here indicates that the livemode status is unknown or"
+                            " was previously unrecorded. Otherwise, this field"
+                            " indicates whether this record comes from Stripe test mode"
+                            " or live mode operation."
+                        ),
                         null=True,
                     ),
                 ),
                 ("created", djstripe.fields.StripeDateTimeField(blank=True, null=True)),
                 ("metadata", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "description",
@@ -1031,70 +1188,92 @@
                     ),
                 ),
                 ("djstripe_created", models.DateTimeField(auto_now_add=True)),
                 ("djstripe_updated", models.DateTimeField(auto_now=True)),
                 (
                     "name",
                     models.TextField(
-                        help_text="The product's name, meant to be displayable to the customer. Applicable to both `service` and `good` types.",
+                        help_text=(
+                            "The product's name, meant to be displayable to the"
+                            " customer. Applicable to both `service` and `good` types."
+                        ),
                         max_length=5000,
                     ),
                 ),
                 (
                     "type",
                     djstripe.fields.StripeEnumField(
                         enum=djstripe.enums.ProductType, max_length=7
                     ),
                 ),
                 (
                     "active",
                     models.BooleanField(
-                        help_text="Whether the product is currently available for purchase. Only applicable to products of `type=good`.",
+                        help_text=(
+                            "Whether the product is currently available for purchase."
+                            " Only applicable to products of `type=good`."
+                        ),
                         null=True,
                     ),
                 ),
                 ("attributes", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "caption",
                     models.TextField(
                         blank=True,
                         default="",
-                        help_text="A short one-line description of the product, meant to be displayableto the customer. Only applicable to products of `type=good`.",
+                        help_text=(
+                            "A short one-line description of the product, meant to be"
+                            " displayableto the customer. Only applicable to products"
+                            " of `type=good`."
+                        ),
                         max_length=5000,
                     ),
                 ),
                 ("deactivate_on", djstripe.fields.JSONField(blank=True, null=True)),
                 ("images", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "package_dimensions",
                     djstripe.fields.JSONField(blank=True, null=True),
                 ),
                 (
                     "shippable",
                     models.BooleanField(
                         blank=True,
-                        help_text="Whether this product is a shipped good. Only applicable to products of `type=good`.",
+                        help_text=(
+                            "Whether this product is a shipped good. Only applicable to"
+                            " products of `type=good`."
+                        ),
                         null=True,
                     ),
                 ),
                 (
                     "url",
                     models.CharField(
                         blank=True,
-                        help_text="A URL of a publicly-accessible webpage for this product. Only applicable to products of `type=good`.",
+                        help_text=(
+                            "A URL of a publicly-accessible webpage for this product."
+                            " Only applicable to products of `type=good`."
+                        ),
                         max_length=799,
                         null=True,
                     ),
                 ),
                 (
                     "statement_descriptor",
                     models.CharField(
                         blank=True,
                         default="",
-                        help_text="Extra information about a product which will appear on your customer's credit card statement. In the case that multiple products are billed at once, the first statement descriptor will be used. Only available on products of type=`service`.",
+                        help_text=(
+                            "Extra information about a product which will appear on"
+                            " your customer's credit card statement. In the case that"
+                            " multiple products are billed at once, the first statement"
+                            " descriptor will be used. Only available on products of"
+                            " type=`service`."
+                        ),
                         max_length=22,
                     ),
                 ),
                 ("unit_label", models.CharField(blank=True, default="", max_length=12)),
                 (
                     "djstripe_owner_account",
                     djstripe.fields.StripeForeignKey(
@@ -1120,15 +1299,20 @@
                 ),
                 ("id", djstripe.fields.StripeIdField(max_length=255, unique=True)),
                 (
                     "livemode",
                     models.BooleanField(
                         blank=True,
                         default=None,
-                        help_text="Null here indicates that the livemode status is unknown or was previously unrecorded. Otherwise, this field indicates whether this record comes from Stripe test mode or live mode operation.",
+                        help_text=(
+                            "Null here indicates that the livemode status is unknown or"
+                            " was previously unrecorded. Otherwise, this field"
+                            " indicates whether this record comes from Stripe test mode"
+                            " or live mode operation."
+                        ),
                         null=True,
                     ),
                 ),
                 ("created", djstripe.fields.StripeDateTimeField(blank=True, null=True)),
                 ("metadata", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "description",
@@ -1161,28 +1345,39 @@
                     "billing_cycle_anchor",
                     djstripe.fields.StripeDateTimeField(blank=True, null=True),
                 ),
                 (
                     "cancel_at_period_end",
                     models.BooleanField(
                         default=False,
-                        help_text="If the subscription has been canceled with the ``at_period_end`` flag set to true, ``cancel_at_period_end`` on the subscription will be true. You can use this attribute to determine whether a subscription that has a status of active is scheduled to be canceled at the end of the current period.",
+                        help_text=(
+                            "If the subscription has been canceled with the"
+                            " ``at_period_end`` flag set to true,"
+                            " ``cancel_at_period_end`` on the subscription will be"
+                            " true. You can use this attribute to determine whether a"
+                            " subscription that has a status of active is scheduled to"
+                            " be canceled at the end of the current period."
+                        ),
                     ),
                 ),
                 (
                     "canceled_at",
                     djstripe.fields.StripeDateTimeField(blank=True, null=True),
                 ),
                 ("current_period_end", djstripe.fields.StripeDateTimeField()),
                 ("current_period_start", djstripe.fields.StripeDateTimeField()),
                 (
                     "days_until_due",
                     models.IntegerField(
                         blank=True,
-                        help_text="Number of days a customer has to pay invoices generated by this subscription. This value will be `null` for subscriptions where `billing=charge_automatically`.",
+                        help_text=(
+                            "Number of days a customer has to pay invoices generated by"
+                            " this subscription. This value will be `null` for"
+                            " subscriptions where `billing=charge_automatically`."
+                        ),
                         null=True,
                     ),
                 ),
                 ("discount", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "ended_at",
                     djstripe.fields.StripeDateTimeField(blank=True, null=True),
@@ -1196,15 +1391,18 @@
                     djstripe.fields.JSONField(blank=True, null=True),
                 ),
                 ("pending_update", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "quantity",
                     models.IntegerField(
                         blank=True,
-                        help_text="The quantity applied to this subscription. This value will be `null` for multi-plan subscriptions",
+                        help_text=(
+                            "The quantity applied to this subscription. This value will"
+                            " be `null` for multi-plan subscriptions"
+                        ),
                         null=True,
                     ),
                 ),
                 (
                     "start_date",
                     djstripe.fields.StripeDateTimeField(blank=True, null=True),
                 ),
@@ -1245,15 +1443,18 @@
                         help_text="The customer associated with this subscription.",
                     ),
                 ),
                 (
                     "plan",
                     models.ForeignKey(
                         blank=True,
-                        help_text="The plan associated with this subscription. This value will be `null` for multi-plan subscriptions",
+                        help_text=(
+                            "The plan associated with this subscription. This value"
+                            " will be `null` for multi-plan subscriptions"
+                        ),
                         null=True,
                         on_delete=django.db.models.deletion.CASCADE,
                         related_name="subscriptions",
                         to="djstripe.plan",
                     ),
                 ),
                 (
@@ -1278,15 +1479,20 @@
                 ),
                 ("id", djstripe.fields.StripeIdField(max_length=255, unique=True)),
                 (
                     "livemode",
                     models.BooleanField(
                         blank=True,
                         default=None,
-                        help_text="Null here indicates that the livemode status is unknown or was previously unrecorded. Otherwise, this field indicates whether this record comes from Stripe test mode or live mode operation.",
+                        help_text=(
+                            "Null here indicates that the livemode status is unknown or"
+                            " was previously unrecorded. Otherwise, this field"
+                            " indicates whether this record comes from Stripe test mode"
+                            " or live mode operation."
+                        ),
                         null=True,
                     ),
                 ),
                 ("created", djstripe.fields.StripeDateTimeField(blank=True, null=True)),
                 ("metadata", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "description",
@@ -1316,15 +1522,19 @@
                         blank=True, max_length=255, null=True
                     ),
                 ),
                 (
                     "reversed",
                     models.BooleanField(
                         default=False,
-                        help_text="Whether or not the transfer has been fully reversed. If the transfer is only partially reversed, this attribute will still be false.",
+                        help_text=(
+                            "Whether or not the transfer has been fully reversed. If"
+                            " the transfer is only partially reversed, this attribute"
+                            " will still be false."
+                        ),
                     ),
                 ),
                 (
                     "source_transaction",
                     djstripe.fields.StripeIdField(max_length=255, null=True),
                 ),
                 (
@@ -1334,15 +1544,18 @@
                     ),
                 ),
                 (
                     "transfer_group",
                     models.CharField(
                         blank=True,
                         default="",
-                        help_text="A string that identifies this transaction as part of a group.",
+                        help_text=(
+                            "A string that identifies this transaction as part of a"
+                            " group."
+                        ),
                         max_length=255,
                     ),
                 ),
             ],
             options={"abstract": False, "get_latest_by": "created"},
         ),
         migrations.CreateModel(
@@ -1357,37 +1570,46 @@
                 ),
                 ("headers", djstripe.fields.JSONField()),
                 ("body", models.TextField(blank=True)),
                 (
                     "valid",
                     models.BooleanField(
                         default=False,
-                        help_text="Whether or not the webhook event has passed validation",
+                        help_text=(
+                            "Whether or not the webhook event has passed validation"
+                        ),
                     ),
                 ),
                 (
                     "processed",
                     models.BooleanField(
                         default=False,
-                        help_text="Whether or not the webhook event has been successfully processed",
+                        help_text=(
+                            "Whether or not the webhook event has been successfully"
+                            " processed"
+                        ),
                     ),
                 ),
                 ("exception", models.CharField(blank=True, max_length=128)),
                 (
                     "traceback",
                     models.TextField(
                         blank=True,
-                        help_text="Traceback if an exception was thrown during processing",
+                        help_text=(
+                            "Traceback if an exception was thrown during processing"
+                        ),
                     ),
                 ),
                 (
                     "djstripe_version",
                     models.CharField(
                         default=djstripe.models.webhooks._get_version,
-                        help_text="The version of dj-stripe when the webhook was received",
+                        help_text=(
+                            "The version of dj-stripe when the webhook was received"
+                        ),
                         max_length=32,
                     ),
                 ),
                 ("created", models.DateTimeField(auto_now_add=True)),
                 ("updated", models.DateTimeField(auto_now=True)),
                 (
                     "event",
@@ -1408,15 +1630,18 @@
             field=djstripe.fields.StripeForeignKey(
                 blank=True,
                 null=True,
                 on_delete=django.db.models.deletion.SET_NULL,
                 related_name="payment_methods",
                 to="djstripe.customer",
                 to_field=settings.DJSTRIPE_FOREIGN_KEY_TO_FIELD,
-                help_text="Customer to which this PaymentMethod is saved. This will not be set when the PaymentMethod has not been saved to a Customer.",
+                help_text=(
+                    "Customer to which this PaymentMethod is saved. This will not be"
+                    " set when the PaymentMethod has not been saved to a Customer."
+                ),
             ),
         ),
         migrations.AddField(
             model_name="plan",
             name="product",
             field=djstripe.fields.StripeForeignKey(
                 blank=True,
@@ -1438,15 +1663,20 @@
                 ),
                 ("id", djstripe.fields.StripeIdField(max_length=255, unique=True)),
                 (
                     "livemode",
                     models.BooleanField(
                         blank=True,
                         default=None,
-                        help_text="Null here indicates that the livemode status is unknown or was previously unrecorded. Otherwise, this field indicates whether this record comes from Stripe test mode or live mode operation.",
+                        help_text=(
+                            "Null here indicates that the livemode status is unknown or"
+                            " was previously unrecorded. Otherwise, this field"
+                            " indicates whether this record comes from Stripe test mode"
+                            " or live mode operation."
+                        ),
                         null=True,
                     ),
                 ),
                 ("created", djstripe.fields.StripeDateTimeField(blank=True, null=True)),
                 ("metadata", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "description",
@@ -1479,22 +1709,35 @@
                     djstripe.fields.StripeDecimalCurrencyAmountField(
                         blank=True, decimal_places=2, max_digits=11, null=True
                     ),
                 ),
                 (
                     "attempt_count",
                     models.IntegerField(
-                        help_text="Number of payment attempts made for this invoice, from the perspective of the payment retry schedule. Any payment attempt counts as the first attempt, and subsequently only automatic retries increment the attempt count. In other words, manual payment attempts after the first attempt do not affect the retry schedule."
+                        help_text=(
+                            "Number of payment attempts made for this invoice, from the"
+                            " perspective of the payment retry schedule. Any payment"
+                            " attempt counts as the first attempt, and subsequently"
+                            " only automatic retries increment the attempt count. In"
+                            " other words, manual payment attempts after the first"
+                            " attempt do not affect the retry schedule."
+                        )
                     ),
                 ),
                 (
                     "attempted",
                     models.BooleanField(
                         default=False,
-                        help_text="Whether or not an attempt has been made to pay the invoice. An invoice is not attempted until 1 hour after the ``invoice.created`` webhook, for example, so you might not want to display that invoice as unpaid to your users.",
+                        help_text=(
+                            "Whether or not an attempt has been made to pay the"
+                            " invoice. An invoice is not attempted until 1 hour after"
+                            " the ``invoice.created`` webhook, for example, so you"
+                            " might not want to display that invoice as unpaid to your"
+                            " users."
+                        ),
                     ),
                 ),
                 (
                     "collection_method",
                     djstripe.fields.StripeEnumField(
                         enum=djstripe.enums.InvoiceCollectionMethod,
                         max_length=20,
@@ -1511,68 +1754,95 @@
                     djstripe.fields.StripeQuantumCurrencyAmountField(null=True),
                 ),
                 (
                     "hosted_invoice_url",
                     models.TextField(
                         blank=True,
                         default="",
-                        help_text="The URL for the hosted invoice page, which allows customers to view and pay an invoice. If the invoice has not been frozen yet, this will be null.",
+                        help_text=(
+                            "The URL for the hosted invoice page, which allows"
+                            " customers to view and pay an invoice. If the invoice has"
+                            " not been frozen yet, this will be null."
+                        ),
                         max_length=799,
                     ),
                 ),
                 (
                     "invoice_pdf",
                     models.TextField(
                         blank=True,
                         default="",
-                        help_text="The link to download the PDF for the invoice. If the invoice has not been frozen yet, this will be null.",
+                        help_text=(
+                            "The link to download the PDF for the invoice. If the"
+                            " invoice has not been frozen yet, this will be null."
+                        ),
                         max_length=799,
                     ),
                 ),
                 (
                     "next_payment_attempt",
                     djstripe.fields.StripeDateTimeField(blank=True, null=True),
                 ),
                 (
                     "number",
                     models.CharField(
                         blank=True,
                         default="",
-                        help_text="A unique, identifying string that appears on emails sent to the customer for this invoice. This starts with the customer's unique invoice_prefix if it is specified.",
+                        help_text=(
+                            "A unique, identifying string that appears on emails sent"
+                            " to the customer for this invoice. This starts with the"
+                            " customer's unique invoice_prefix if it is specified."
+                        ),
                         max_length=64,
                     ),
                 ),
                 (
                     "paid",
                     models.BooleanField(
                         default=False,
-                        help_text="Whether payment was successfully collected for this invoice. An invoice can be paid (most commonly) with a charge or with credit from the customer's account balance.",
+                        help_text=(
+                            "Whether payment was successfully collected for this"
+                            " invoice. An invoice can be paid (most commonly) with a"
+                            " charge or with credit from the customer's account"
+                            " balance."
+                        ),
                     ),
                 ),
                 ("period_end", djstripe.fields.StripeDateTimeField()),
                 ("period_start", djstripe.fields.StripeDateTimeField()),
                 (
                     "receipt_number",
                     models.CharField(
                         blank=True,
-                        help_text="This is the transaction number that appears on email receipts sent for this invoice.",
+                        help_text=(
+                            "This is the transaction number that appears on email"
+                            " receipts sent for this invoice."
+                        ),
                         max_length=64,
                         null=True,
                     ),
                 ),
                 (
                     "starting_balance",
                     djstripe.fields.StripeQuantumCurrencyAmountField(),
                 ),
                 (
                     "statement_descriptor",
                     models.CharField(
                         blank=True,
                         default="",
-                        help_text="An arbitrary string to be displayed on your customer's credit card statement. The statement description may not include <>\"' characters, and will appear on your customer's statement in capital letters. Non-ASCII characters are automatically stripped. While most banks display this information consistently, some may display it incorrectly or not at all.",
+                        help_text=(
+                            "An arbitrary string to be displayed on your customer's"
+                            " credit card statement. The statement description may not"
+                            " include <>\"' characters, and will appear on your"
+                            " customer's statement in capital letters. Non-ASCII"
+                            " characters are automatically stripped. While most banks"
+                            " display this information consistently, some may display"
+                            " it incorrectly or not at all."
+                        ),
                         max_length=22,
                     ),
                 ),
                 (
                     "subscription_proration_date",
                     djstripe.fields.StripeDateTimeField(blank=True, null=True),
                 ),
@@ -1612,15 +1882,17 @@
                 (
                     "webhooks_delivered_at",
                     djstripe.fields.StripeDateTimeField(null=True),
                 ),
                 (
                     "charge",
                     models.OneToOneField(
-                        help_text="The latest charge generated for this invoice, if any.",
+                        help_text=(
+                            "The latest charge generated for this invoice, if any."
+                        ),
                         null=True,
                         on_delete=django.db.models.deletion.CASCADE,
                         related_name="latest_%(class)s",
                         to="djstripe.charge",
                     ),
                 ),
                 (
@@ -1637,42 +1909,55 @@
                     "subscription",
                     djstripe.fields.StripeForeignKey(
                         null=True,
                         on_delete=django.db.models.deletion.SET_NULL,
                         related_name="%(class)ss",
                         to="djstripe.subscription",
                         to_field=settings.DJSTRIPE_FOREIGN_KEY_TO_FIELD,
-                        help_text="The subscription that this invoice was prepared for, if any.",
+                        help_text=(
+                            "The subscription that this invoice was prepared for, if"
+                            " any."
+                        ),
                     ),
                 ),
                 (
                     "auto_advance",
                     models.BooleanField(
-                        help_text="Controls whether Stripe will perform automatic collection of the invoice. When false, the invoice's state will not automatically advance without an explicit action.",
+                        help_text=(
+                            "Controls whether Stripe will perform automatic collection"
+                            " of the invoice. When false, the invoice's state will not"
+                            " automatically advance without an explicit action."
+                        ),
                         null=True,
                     ),
                 ),
                 (
                     "status_transitions",
                     djstripe.fields.JSONField(blank=True, null=True),
                 ),
                 (
                     "account_country",
                     models.CharField(
                         blank=True,
                         default="",
-                        help_text="The country of the business associated with this invoice, most often the business creating the invoice.",
+                        help_text=(
+                            "The country of the business associated with this invoice,"
+                            " most often the business creating the invoice."
+                        ),
                         max_length=2,
                     ),
                 ),
                 (
                     "account_name",
                     models.TextField(
                         blank=True,
-                        help_text="The public name of the business associated with this invoice, most often the business creating the invoice.",
+                        help_text=(
+                            "The public name of the business associated with this"
+                            " invoice, most often the business creating the invoice."
+                        ),
                         max_length=5000,
                     ),
                 ),
                 (
                     "billing_reason",
                     djstripe.fields.StripeEnumField(
                         blank=True,
@@ -1685,31 +1970,44 @@
                     "customer_address",
                     djstripe.fields.JSONField(blank=True, null=True),
                 ),
                 (
                     "customer_email",
                     models.TextField(
                         blank=True,
-                        help_text="The customer's email. Until the invoice is finalized, this field will equal customer.email. Once the invoice is finalized, this field will no longer be updated.",
+                        help_text=(
+                            "The customer's email. Until the invoice is finalized, this"
+                            " field will equal customer.email. Once the invoice is"
+                            " finalized, this field will no longer be updated."
+                        ),
                         max_length=5000,
                     ),
                 ),
                 (
                     "customer_name",
                     models.TextField(
                         blank=True,
-                        help_text="The customer's name. Until the invoice is finalized, this field will equal customer.name. Once the invoice is finalized, this field will no longer be updated.",
+                        help_text=(
+                            "The customer's name. Until the invoice is finalized, this"
+                            " field will equal customer.name. Once the invoice is"
+                            " finalized, this field will no longer be updated."
+                        ),
                         max_length=5000,
                     ),
                 ),
                 (
                     "customer_phone",
                     models.TextField(
                         blank=True,
-                        help_text="The customer's phone number. Until the invoice is finalized, this field will equal customer.phone. Once the invoice is finalized, this field will no longer be updated.",
+                        help_text=(
+                            "The customer's phone number. Until the invoice is"
+                            " finalized, this field will equal customer.phone. Once the"
+                            " invoice is finalized, this field will no longer be"
+                            " updated."
+                        ),
                         max_length=5000,
                     ),
                 ),
                 (
                     "customer_shipping",
                     djstripe.fields.JSONField(blank=True, null=True),
                 ),
@@ -1836,15 +2134,18 @@
             name="transfer",
             field=djstripe.fields.StripeForeignKey(
                 blank=True,
                 null=True,
                 on_delete=django.db.models.deletion.CASCADE,
                 to="djstripe.transfer",
                 to_field=settings.DJSTRIPE_FOREIGN_KEY_TO_FIELD,
-                help_text="The transfer to the `destination` account (only applicable if the charge was created using the `destination` parameter).",
+                help_text=(
+                    "The transfer to the `destination` account (only applicable if the"
+                    " charge was created using the `destination` parameter)."
+                ),
             ),
         ),
         migrations.CreateModel(
             name="BankAccount",
             fields=[
                 (
                     "djstripe_id",
@@ -1854,15 +2155,20 @@
                 ),
                 ("id", djstripe.fields.StripeIdField(max_length=255, unique=True)),
                 (
                     "livemode",
                     models.BooleanField(
                         blank=True,
                         default=None,
-                        help_text="Null here indicates that the livemode status is unknown or was previously unrecorded. Otherwise, this field indicates whether this record comes from Stripe test mode or live mode operation.",
+                        help_text=(
+                            "Null here indicates that the livemode status is unknown or"
+                            " was previously unrecorded. Otherwise, this field"
+                            " indicates whether this record comes from Stripe test mode"
+                            " or live mode operation."
+                        ),
                         null=True,
                     ),
                 ),
                 ("created", djstripe.fields.StripeDateTimeField(blank=True, null=True)),
                 ("metadata", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "description",
@@ -1872,50 +2178,66 @@
                 ),
                 ("djstripe_created", models.DateTimeField(auto_now_add=True)),
                 ("djstripe_updated", models.DateTimeField(auto_now=True)),
                 (
                     "account_holder_name",
                     models.TextField(
                         blank=True,
-                        help_text="The name of the person or business that owns the bank account.",
+                        help_text=(
+                            "The name of the person or business that owns the bank"
+                            " account."
+                        ),
                         max_length=5000,
                     ),
                 ),
                 (
                     "account_holder_type",
                     djstripe.fields.StripeEnumField(
                         enum=djstripe.enums.BankAccountHolderType, max_length=10
                     ),
                 ),
                 (
                     "bank_name",
                     models.CharField(
-                        help_text="Name of the bank associated with the routing number (e.g., `WELLS FARGO`).",
+                        help_text=(
+                            "Name of the bank associated with the routing number (e.g.,"
+                            " `WELLS FARGO`)."
+                        ),
                         max_length=255,
                     ),
                 ),
                 (
                     "country",
                     models.CharField(
-                        help_text="Two-letter ISO code representing the country the bank account is located in.",
+                        help_text=(
+                            "Two-letter ISO code representing the country the bank"
+                            " account is located in."
+                        ),
                         max_length=2,
                     ),
                 ),
                 ("currency", djstripe.fields.StripeCurrencyCodeField(max_length=3)),
                 (
                     "default_for_currency",
                     models.BooleanField(
-                        help_text="Whether this external account is the default account for its currency.",
+                        help_text=(
+                            "Whether this external account is the default account for"
+                            " its currency."
+                        ),
                         null=True,
                     ),
                 ),
                 (
                     "fingerprint",
                     models.CharField(
-                        help_text="Uniquely identifies this particular bank account. You can use this attribute to check whether two bank accounts are the same.",
+                        help_text=(
+                            "Uniquely identifies this particular bank account. You can"
+                            " use this attribute to check whether two bank accounts are"
+                            " the same."
+                        ),
                         max_length=16,
                     ),
                 ),
                 ("last4", models.CharField(max_length=4)),
                 (
                     "routing_number",
                     models.CharField(
@@ -1975,15 +2297,20 @@
                 ),
                 ("id", djstripe.fields.StripeIdField(max_length=255, unique=True)),
                 (
                     "livemode",
                     models.BooleanField(
                         blank=True,
                         default=None,
-                        help_text="Null here indicates that the livemode status is unknown or was previously unrecorded. Otherwise, this field indicates whether this record comes from Stripe test mode or live mode operation.",
+                        help_text=(
+                            "Null here indicates that the livemode status is unknown or"
+                            " was previously unrecorded. Otherwise, this field"
+                            " indicates whether this record comes from Stripe test mode"
+                            " or live mode operation."
+                        ),
                         null=True,
                     ),
                 ),
                 ("created", djstripe.fields.StripeDateTimeField(blank=True, null=True)),
                 ("metadata", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "description",
@@ -2048,15 +2375,20 @@
                 ),
                 ("id", djstripe.fields.StripeIdField(max_length=255, unique=True)),
                 (
                     "livemode",
                     models.BooleanField(
                         blank=True,
                         default=None,
-                        help_text="Null here indicates that the livemode status is unknown or was previously unrecorded. Otherwise, this field indicates whether this record comes from Stripe test mode or live mode operation.",
+                        help_text=(
+                            "Null here indicates that the livemode status is unknown or"
+                            " was previously unrecorded. Otherwise, this field"
+                            " indicates whether this record comes from Stripe test mode"
+                            " or live mode operation."
+                        ),
                         null=True,
                     ),
                 ),
                 ("created", djstripe.fields.StripeDateTimeField(blank=True, null=True)),
                 ("metadata", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "description",
@@ -2068,24 +2400,31 @@
                 ("djstripe_updated", models.DateTimeField(auto_now=True)),
                 ("amount", djstripe.fields.StripeQuantumCurrencyAmountField()),
                 ("amount_refunded", djstripe.fields.StripeQuantumCurrencyAmountField()),
                 ("currency", djstripe.fields.StripeCurrencyCodeField(max_length=3)),
                 (
                     "refunded",
                     models.BooleanField(
-                        help_text="Whether the fee has been fully refunded. If the fee is only partially refunded, this attribute will still be false."
+                        help_text=(
+                            "Whether the fee has been fully refunded. If the fee is"
+                            " only partially refunded, this attribute will still be"
+                            " false."
+                        )
                     ),
                 ),
                 (
                     "balance_transaction",
                     djstripe.fields.StripeForeignKey(
                         on_delete=django.db.models.deletion.CASCADE,
                         to="djstripe.balancetransaction",
                         to_field=settings.DJSTRIPE_FOREIGN_KEY_TO_FIELD,
-                        help_text="Balance transaction that describes the impact on your account balance.",
+                        help_text=(
+                            "Balance transaction that describes the impact on your"
+                            " account balance."
+                        ),
                     ),
                 ),
                 (
                     "charge",
                     djstripe.fields.StripeForeignKey(
                         on_delete=django.db.models.deletion.CASCADE,
                         to="djstripe.charge",
@@ -2111,27 +2450,33 @@
             model_name="charge",
             name="balance_transaction",
             field=djstripe.fields.StripeForeignKey(
                 null=True,
                 on_delete=django.db.models.deletion.SET_NULL,
                 to="djstripe.balancetransaction",
                 to_field=settings.DJSTRIPE_FOREIGN_KEY_TO_FIELD,
-                help_text="The balance transaction that describes the impact of this charge on your account balance (not including refunds or disputes).",
+                help_text=(
+                    "The balance transaction that describes the impact of this charge"
+                    " on your account balance (not including refunds or disputes)."
+                ),
             ),
         ),
         migrations.AddField(
             model_name="transfer",
             name="balance_transaction",
             field=djstripe.fields.StripeForeignKey(
                 blank=True,
                 null=True,
                 on_delete=django.db.models.deletion.SET_NULL,
                 to="djstripe.balancetransaction",
                 to_field=settings.DJSTRIPE_FOREIGN_KEY_TO_FIELD,
-                help_text="Balance transaction that describes the impact on your account balance.",
+                help_text=(
+                    "Balance transaction that describes the impact on your account"
+                    " balance."
+                ),
             ),
         ),
         migrations.CreateModel(
             name="SetupIntent",
             fields=[
                 (
                     "djstripe_id",
@@ -2141,15 +2486,20 @@
                 ),
                 ("id", djstripe.fields.StripeIdField(max_length=255, unique=True)),
                 (
                     "livemode",
                     models.BooleanField(
                         blank=True,
                         default=None,
-                        help_text="Null here indicates that the livemode status is unknown or was previously unrecorded. Otherwise, this field indicates whether this record comes from Stripe test mode or live mode operation.",
+                        help_text=(
+                            "Null here indicates that the livemode status is unknown or"
+                            " was previously unrecorded. Otherwise, this field"
+                            " indicates whether this record comes from Stripe test mode"
+                            " or live mode operation."
+                        ),
                         null=True,
                     ),
                 ),
                 ("created", djstripe.fields.StripeDateTimeField(blank=True, null=True)),
                 ("metadata", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "description",
@@ -2159,15 +2509,18 @@
                 ),
                 ("djstripe_created", models.DateTimeField(auto_now_add=True)),
                 ("djstripe_updated", models.DateTimeField(auto_now=True)),
                 (
                     "application",
                     models.CharField(
                         blank=True,
-                        help_text="ID of the Connect application that created the SetupIntent.",
+                        help_text=(
+                            "ID of the Connect application that created the"
+                            " SetupIntent."
+                        ),
                         max_length=255,
                     ),
                 ),
                 (
                     "cancellation_reason",
                     djstripe.fields.StripeEnumField(
                         blank=True,
@@ -2175,15 +2528,18 @@
                         max_length=21,
                     ),
                 ),
                 (
                     "client_secret",
                     models.TextField(
                         blank=True,
-                        help_text="The client secret of this SetupIntent. Used for client-side retrieval using a publishable key.",
+                        help_text=(
+                            "The client secret of this SetupIntent. Used for"
+                            " client-side retrieval using a publishable key."
+                        ),
                         max_length=5000,
                     ),
                 ),
                 ("last_setup_error", djstripe.fields.JSONField(blank=True, null=True)),
                 ("next_action", djstripe.fields.JSONField(blank=True, null=True)),
                 ("payment_method_types", djstripe.fields.JSONField()),
                 (
@@ -2204,27 +2560,31 @@
                     "customer",
                     djstripe.fields.StripeForeignKey(
                         blank=True,
                         null=True,
                         on_delete=django.db.models.deletion.SET_NULL,
                         to="djstripe.customer",
                         to_field=settings.DJSTRIPE_FOREIGN_KEY_TO_FIELD,
-                        help_text="Customer this SetupIntent belongs to, if one exists.",
+                        help_text=(
+                            "Customer this SetupIntent belongs to, if one exists."
+                        ),
                     ),
                 ),
                 (
                     "on_behalf_of",
                     djstripe.fields.StripeForeignKey(
                         blank=True,
                         null=True,
                         on_delete=django.db.models.deletion.SET_NULL,
                         related_name="setup_intents",
                         to="djstripe.account",
                         to_field=settings.DJSTRIPE_FOREIGN_KEY_TO_FIELD,
-                        help_text="The account (if any) for which the setup is intended.",
+                        help_text=(
+                            "The account (if any) for which the setup is intended."
+                        ),
                     ),
                 ),
                 (
                     "payment_method",
                     djstripe.fields.StripeForeignKey(
                         blank=True,
                         null=True,
@@ -2259,15 +2619,20 @@
                 ),
                 ("id", djstripe.fields.StripeIdField(max_length=255, unique=True)),
                 (
                     "livemode",
                     models.BooleanField(
                         blank=True,
                         default=None,
-                        help_text="Null here indicates that the livemode status is unknown or was previously unrecorded. Otherwise, this field indicates whether this record comes from Stripe test mode or live mode operation.",
+                        help_text=(
+                            "Null here indicates that the livemode status is unknown or"
+                            " was previously unrecorded. Otherwise, this field"
+                            " indicates whether this record comes from Stripe test mode"
+                            " or live mode operation."
+                        ),
                         null=True,
                     ),
                 ),
                 ("created", djstripe.fields.StripeDateTimeField(blank=True, null=True)),
                 ("metadata", djstripe.fields.JSONField(blank=True, null=True)),
                 ("djstripe_created", models.DateTimeField(auto_now_add=True)),
                 ("djstripe_updated", models.DateTimeField(auto_now=True)),
@@ -2296,15 +2661,18 @@
                     djstripe.fields.StripeEnumField(
                         enum=djstripe.enums.CaptureMethod, max_length=9
                     ),
                 ),
                 (
                     "client_secret",
                     models.TextField(
-                        help_text="The client secret of this PaymentIntent. Used for client-side retrieval using a publishable key.",
+                        help_text=(
+                            "The client secret of this PaymentIntent. Used for"
+                            " client-side retrieval using a publishable key."
+                        ),
                         max_length=5000,
                     ),
                 ),
                 (
                     "confirmation_method",
                     djstripe.fields.StripeEnumField(
                         enum=djstripe.enums.ConfirmationMethod, max_length=9
@@ -2312,29 +2680,35 @@
                 ),
                 ("currency", djstripe.fields.StripeCurrencyCodeField(max_length=3)),
                 (
                     "description",
                     models.TextField(
                         blank=True,
                         default="",
-                        help_text="An arbitrary string attached to the object. Often useful for displaying to users.",
+                        help_text=(
+                            "An arbitrary string attached to the object. Often useful"
+                            " for displaying to users."
+                        ),
                         max_length=1000,
                     ),
                 ),
                 (
                     "last_payment_error",
                     djstripe.fields.JSONField(blank=True, null=True),
                 ),
                 ("next_action", djstripe.fields.JSONField(blank=True, null=True)),
                 ("payment_method_types", djstripe.fields.JSONField()),
                 (
                     "receipt_email",
                     models.CharField(
                         blank=True,
-                        help_text="Email address that the receipt for the resulting payment will be sent to.",
+                        help_text=(
+                            "Email address that the receipt for the resulting payment"
+                            " will be sent to."
+                        ),
                         max_length=255,
                     ),
                 ),
                 (
                     "setup_future_usage",
                     djstripe.fields.StripeEnumField(
                         blank=True,
@@ -2344,30 +2718,39 @@
                     ),
                 ),
                 ("shipping", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "statement_descriptor",
                     models.CharField(
                         blank=True,
-                        help_text="For non-card charges, you can use this value as the complete description that appears on your customers' statements. Must contain at least one letter, maximum 22 characters.",
+                        help_text=(
+                            "For non-card charges, you can use this value as the"
+                            " complete description that appears on your customers'"
+                            " statements. Must contain at least one letter, maximum 22"
+                            " characters."
+                        ),
                         max_length=22,
                     ),
                 ),
                 (
                     "status",
                     djstripe.fields.StripeEnumField(
                         enum=djstripe.enums.PaymentIntentStatus, max_length=23
                     ),
                 ),
                 ("transfer_data", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "transfer_group",
                     models.CharField(
                         blank=True,
-                        help_text="A string that identifies the resulting payment as part of a group. See the PaymentIntents Connect usage guide for details.",
+                        help_text=(
+                            "A string that identifies the resulting payment as part of"
+                            " a group. See the PaymentIntents Connect usage guide for"
+                            " details."
+                        ),
                         max_length=255,
                     ),
                 ),
                 (
                     "customer",
                     djstripe.fields.StripeForeignKey(
                         null=True,
@@ -2382,15 +2765,18 @@
                     djstripe.fields.StripeForeignKey(
                         blank=True,
                         null=True,
                         on_delete=django.db.models.deletion.CASCADE,
                         related_name="payment_intents",
                         to="djstripe.account",
                         to_field=settings.DJSTRIPE_FOREIGN_KEY_TO_FIELD,
-                        help_text="The account (if any) for which the funds of the PaymentIntent are intended.",
+                        help_text=(
+                            "The account (if any) for which the funds of the"
+                            " PaymentIntent are intended."
+                        ),
                     ),
                 ),
                 (
                     "payment_method",
                     djstripe.fields.StripeForeignKey(
                         blank=True,
                         null=True,
@@ -2426,15 +2812,20 @@
                 help_text="PaymentIntent associated with this charge, if one exists.",
             ),
         ),
         migrations.AddField(
             model_name="invoice",
             name="payment_intent",
             field=models.OneToOneField(
-                help_text="The PaymentIntent associated with this invoice. The PaymentIntent is generated when the invoice is finalized, and can then be used to pay the invoice.Note that voiding an invoice will cancel the PaymentIntent",
+                help_text=(
+                    "The PaymentIntent associated with this invoice. The PaymentIntent"
+                    " is generated when the invoice is finalized, and can then be used"
+                    " to pay the invoice.Note that voiding an invoice will cancel the"
+                    " PaymentIntent"
+                ),
                 null=True,
                 on_delete=django.db.models.deletion.CASCADE,
                 to="djstripe.paymentintent",
             ),
         ),
         migrations.AddField(
             model_name="subscription",
@@ -2442,15 +2833,20 @@
             field=djstripe.fields.StripeForeignKey(
                 blank=True,
                 null=True,
                 on_delete=django.db.models.deletion.CASCADE,
                 related_name="setup_intents",
                 to="djstripe.setupintent",
                 to_field=settings.DJSTRIPE_FOREIGN_KEY_TO_FIELD,
-                help_text="We can use this SetupIntent to collect user authentication when creating a subscription without immediate payment or updating a subscription's payment method, allowing you to optimize for off-session payments.",
+                help_text=(
+                    "We can use this SetupIntent to collect user authentication when"
+                    " creating a subscription without immediate payment or updating a"
+                    " subscription's payment method, allowing you to optimize for"
+                    " off-session payments."
+                ),
             ),
         ),
         migrations.AddField(
             model_name="charge",
             name="payment_method",
             field=djstripe.fields.StripeForeignKey(
                 null=True,
@@ -2467,15 +2863,20 @@
             field=djstripe.fields.StripeForeignKey(
                 blank=True,
                 null=True,
                 on_delete=django.db.models.deletion.SET_NULL,
                 related_name="+",
                 to="djstripe.paymentmethod",
                 to_field=settings.DJSTRIPE_FOREIGN_KEY_TO_FIELD,
-                help_text="Default payment method for the invoice. It must belong to the customer associated with the invoice. If not set, defaults to the subscription's default payment method, if any, or to the default payment method in the customer's invoice settings.",
+                help_text=(
+                    "Default payment method for the invoice. It must belong to the"
+                    " customer associated with the invoice. If not set, defaults to the"
+                    " subscription's default payment method, if any, or to the default"
+                    " payment method in the customer's invoice settings."
+                ),
             ),
         ),
         migrations.CreateModel(
             name="UpcomingInvoice",
             fields=[
                 (
                     "djstripe_id",
@@ -2484,15 +2885,20 @@
                     ),
                 ),
                 (
                     "livemode",
                     models.BooleanField(
                         blank=True,
                         default=None,
-                        help_text="Null here indicates that the livemode status is unknown or was previously unrecorded. Otherwise, this field indicates whether this record comes from Stripe test mode or live mode operation.",
+                        help_text=(
+                            "Null here indicates that the livemode status is unknown or"
+                            " was previously unrecorded. Otherwise, this field"
+                            " indicates whether this record comes from Stripe test mode"
+                            " or live mode operation."
+                        ),
                         null=True,
                     ),
                 ),
                 ("created", djstripe.fields.StripeDateTimeField(blank=True, null=True)),
                 ("metadata", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "description",
@@ -2503,23 +2909,29 @@
                 ("djstripe_created", models.DateTimeField(auto_now_add=True)),
                 ("djstripe_updated", models.DateTimeField(auto_now=True)),
                 (
                     "account_country",
                     models.CharField(
                         blank=True,
                         default="",
-                        help_text="The country of the business associated with this invoice, most often the business creating the invoice.",
+                        help_text=(
+                            "The country of the business associated with this invoice,"
+                            " most often the business creating the invoice."
+                        ),
                         max_length=2,
                     ),
                 ),
                 (
                     "account_name",
                     models.TextField(
                         blank=True,
-                        help_text="The public name of the business associated with this invoice, most often the business creating the invoice.",
+                        help_text=(
+                            "The public name of the business associated with this"
+                            " invoice, most often the business creating the invoice."
+                        ),
                         max_length=5000,
                     ),
                 ),
                 (
                     "amount_due",
                     djstripe.fields.StripeDecimalCurrencyAmountField(
                         decimal_places=2, max_digits=11
@@ -2542,28 +2954,45 @@
                     djstripe.fields.StripeDecimalCurrencyAmountField(
                         blank=True, decimal_places=2, max_digits=11, null=True
                     ),
                 ),
                 (
                     "attempt_count",
                     models.IntegerField(
-                        help_text="Number of payment attempts made for this invoice, from the perspective of the payment retry schedule. Any payment attempt counts as the first attempt, and subsequently only automatic retries increment the attempt count. In other words, manual payment attempts after the first attempt do not affect the retry schedule."
+                        help_text=(
+                            "Number of payment attempts made for this invoice, from the"
+                            " perspective of the payment retry schedule. Any payment"
+                            " attempt counts as the first attempt, and subsequently"
+                            " only automatic retries increment the attempt count. In"
+                            " other words, manual payment attempts after the first"
+                            " attempt do not affect the retry schedule."
+                        )
                     ),
                 ),
                 (
                     "attempted",
                     models.BooleanField(
                         default=False,
-                        help_text="Whether or not an attempt has been made to pay the invoice. An invoice is not attempted until 1 hour after the ``invoice.created`` webhook, for example, so you might not want to display that invoice as unpaid to your users.",
+                        help_text=(
+                            "Whether or not an attempt has been made to pay the"
+                            " invoice. An invoice is not attempted until 1 hour after"
+                            " the ``invoice.created`` webhook, for example, so you"
+                            " might not want to display that invoice as unpaid to your"
+                            " users."
+                        ),
                     ),
                 ),
                 (
                     "auto_advance",
                     models.BooleanField(
-                        help_text="Controls whether Stripe will perform automatic collection of the invoice. When false, the invoice's state will not automatically advance without an explicit action.",
+                        help_text=(
+                            "Controls whether Stripe will perform automatic collection"
+                            " of the invoice. When false, the invoice's state will not"
+                            " automatically advance without an explicit action."
+                        ),
                         null=True,
                     ),
                 ),
                 (
                     "billing_reason",
                     djstripe.fields.StripeEnumField(
                         blank=True,
@@ -2582,31 +3011,44 @@
                 ),
                 ("currency", djstripe.fields.StripeCurrencyCodeField(max_length=3)),
                 ("customer_address", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "customer_email",
                     models.TextField(
                         blank=True,
-                        help_text="The customer's email. Until the invoice is finalized, this field will equal customer.email. Once the invoice is finalized, this field will no longer be updated.",
+                        help_text=(
+                            "The customer's email. Until the invoice is finalized, this"
+                            " field will equal customer.email. Once the invoice is"
+                            " finalized, this field will no longer be updated."
+                        ),
                         max_length=5000,
                     ),
                 ),
                 (
                     "customer_name",
                     models.TextField(
                         blank=True,
-                        help_text="The customer's name. Until the invoice is finalized, this field will equal customer.name. Once the invoice is finalized, this field will no longer be updated.",
+                        help_text=(
+                            "The customer's name. Until the invoice is finalized, this"
+                            " field will equal customer.name. Once the invoice is"
+                            " finalized, this field will no longer be updated."
+                        ),
                         max_length=5000,
                     ),
                 ),
                 (
                     "customer_phone",
                     models.TextField(
                         blank=True,
-                        help_text="The customer's phone number. Until the invoice is finalized, this field will equal customer.phone. Once the invoice is finalized, this field will no longer be updated.",
+                        help_text=(
+                            "The customer's phone number. Until the invoice is"
+                            " finalized, this field will equal customer.phone. Once the"
+                            " invoice is finalized, this field will no longer be"
+                            " updated."
+                        ),
                         max_length=5000,
                     ),
                 ),
                 ("customer_shipping", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "customer_tax_exempt",
                     djstripe.fields.StripeEnumField(
@@ -2630,45 +3072,61 @@
                     ),
                 ),
                 (
                     "hosted_invoice_url",
                     models.TextField(
                         blank=True,
                         default="",
-                        help_text="The URL for the hosted invoice page, which allows customers to view and pay an invoice. If the invoice has not been frozen yet, this will be null.",
+                        help_text=(
+                            "The URL for the hosted invoice page, which allows"
+                            " customers to view and pay an invoice. If the invoice has"
+                            " not been frozen yet, this will be null."
+                        ),
                         max_length=799,
                     ),
                 ),
                 (
                     "invoice_pdf",
                     models.TextField(
                         blank=True,
                         default="",
-                        help_text="The link to download the PDF for the invoice. If the invoice has not been frozen yet, this will be null.",
+                        help_text=(
+                            "The link to download the PDF for the invoice. If the"
+                            " invoice has not been frozen yet, this will be null."
+                        ),
                         max_length=799,
                     ),
                 ),
                 (
                     "next_payment_attempt",
                     djstripe.fields.StripeDateTimeField(blank=True, null=True),
                 ),
                 (
                     "number",
                     models.CharField(
                         blank=True,
                         default="",
-                        help_text="A unique, identifying string that appears on emails sent to the customer for this invoice. This starts with the customer's unique invoice_prefix if it is specified.",
+                        help_text=(
+                            "A unique, identifying string that appears on emails sent"
+                            " to the customer for this invoice. This starts with the"
+                            " customer's unique invoice_prefix if it is specified."
+                        ),
                         max_length=64,
                     ),
                 ),
                 (
                     "paid",
                     models.BooleanField(
                         default=False,
-                        help_text="Whether payment was successfully collected for this invoice. An invoice can be paid (most commonly) with a charge or with credit from the customer's account balance.",
+                        help_text=(
+                            "Whether payment was successfully collected for this"
+                            " invoice. An invoice can be paid (most commonly) with a"
+                            " charge or with credit from the customer's account"
+                            " balance."
+                        ),
                     ),
                 ),
                 ("period_end", djstripe.fields.StripeDateTimeField()),
                 ("period_start", djstripe.fields.StripeDateTimeField()),
                 (
                     "post_payment_credit_notes_amount",
                     djstripe.fields.StripeQuantumCurrencyAmountField(
@@ -2681,29 +3139,40 @@
                         blank=True, null=True
                     ),
                 ),
                 (
                     "receipt_number",
                     models.CharField(
                         blank=True,
-                        help_text="This is the transaction number that appears on email receipts sent for this invoice.",
+                        help_text=(
+                            "This is the transaction number that appears on email"
+                            " receipts sent for this invoice."
+                        ),
                         max_length=64,
                         null=True,
                     ),
                 ),
                 (
                     "starting_balance",
                     djstripe.fields.StripeQuantumCurrencyAmountField(),
                 ),
                 (
                     "statement_descriptor",
                     models.CharField(
                         blank=True,
                         default="",
-                        help_text="An arbitrary string to be displayed on your customer's credit card statement. The statement description may not include <>\"' characters, and will appear on your customer's statement in capital letters. Non-ASCII characters are automatically stripped. While most banks display this information consistently, some may display it incorrectly or not at all.",
+                        help_text=(
+                            "An arbitrary string to be displayed on your customer's"
+                            " credit card statement. The statement description may not"
+                            " include <>\"' characters, and will appear on your"
+                            " customer's statement in capital letters. Non-ASCII"
+                            " characters are automatically stripped. While most banks"
+                            " display this information consistently, some may display"
+                            " it incorrectly or not at all."
+                        ),
                         max_length=22,
                     ),
                 ),
                 (
                     "status_transitions",
                     djstripe.fields.JSONField(blank=True, null=True),
                 ),
@@ -2748,15 +3217,17 @@
                 (
                     "webhooks_delivered_at",
                     djstripe.fields.StripeDateTimeField(null=True),
                 ),
                 (
                     "charge",
                     models.OneToOneField(
-                        help_text="The latest charge generated for this invoice, if any.",
+                        help_text=(
+                            "The latest charge generated for this invoice, if any."
+                        ),
                         null=True,
                         on_delete=django.db.models.deletion.CASCADE,
                         related_name="latest_%(class)s",
                         to="djstripe.charge",
                     ),
                 ),
                 (
@@ -2774,35 +3245,49 @@
                     djstripe.fields.StripeForeignKey(
                         blank=True,
                         null=True,
                         on_delete=django.db.models.deletion.SET_NULL,
                         related_name="+",
                         to="djstripe.paymentmethod",
                         to_field=settings.DJSTRIPE_FOREIGN_KEY_TO_FIELD,
-                        help_text="Default payment method for the invoice. It must belong to the customer associated with the invoice. If not set, defaults to the subscription's default payment method, if any, or to the default payment method in the customer's invoice settings.",
+                        help_text=(
+                            "Default payment method for the invoice. It must belong to"
+                            " the customer associated with the invoice. If not set,"
+                            " defaults to the subscription's default payment method, if"
+                            " any, or to the default payment method in the customer's"
+                            " invoice settings."
+                        ),
                     ),
                 ),
                 (
                     "payment_intent",
                     models.OneToOneField(
-                        help_text="The PaymentIntent associated with this invoice. The PaymentIntent is generated when the invoice is finalized, and can then be used to pay the invoice.Note that voiding an invoice will cancel the PaymentIntent",
+                        help_text=(
+                            "The PaymentIntent associated with this invoice. The"
+                            " PaymentIntent is generated when the invoice is finalized,"
+                            " and can then be used to pay the invoice.Note that voiding"
+                            " an invoice will cancel the PaymentIntent"
+                        ),
                         null=True,
                         on_delete=django.db.models.deletion.CASCADE,
                         to="djstripe.paymentintent",
                     ),
                 ),
                 (
                     "subscription",
                     djstripe.fields.StripeForeignKey(
                         null=True,
                         on_delete=django.db.models.deletion.SET_NULL,
                         related_name="%(class)ss",
                         to="djstripe.subscription",
                         to_field=settings.DJSTRIPE_FOREIGN_KEY_TO_FIELD,
-                        help_text="The subscription that this invoice was prepared for, if any.",
+                        help_text=(
+                            "The subscription that this invoice was prepared for, if"
+                            " any."
+                        ),
                     ),
                 ),
                 (
                     "status",
                     djstripe.fields.StripeEnumField(
                         blank=True,
                         default="",
@@ -2845,15 +3330,20 @@
                 ),
                 ("id", djstripe.fields.StripeIdField(max_length=255, unique=True)),
                 (
                     "livemode",
                     models.BooleanField(
                         blank=True,
                         default=None,
-                        help_text="Null here indicates that the livemode status is unknown or was previously unrecorded. Otherwise, this field indicates whether this record comes from Stripe test mode or live mode operation.",
+                        help_text=(
+                            "Null here indicates that the livemode status is unknown or"
+                            " was previously unrecorded. Otherwise, this field"
+                            " indicates whether this record comes from Stripe test mode"
+                            " or live mode operation."
+                        ),
                         null=True,
                     ),
                 ),
                 ("created", djstripe.fields.StripeDateTimeField(blank=True, null=True)),
                 ("metadata", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "description",
@@ -2863,30 +3353,41 @@
                 ),
                 ("djstripe_created", models.DateTimeField(auto_now_add=True)),
                 ("djstripe_updated", models.DateTimeField(auto_now=True)),
                 (
                     "active",
                     models.BooleanField(
                         default=True,
-                        help_text="Defaults to true. When set to false, this tax rate cannot be applied to objects in the API, but will still be applied to subscriptions and invoices that already have it set.",
+                        help_text=(
+                            "Defaults to true. When set to false, this tax rate cannot"
+                            " be applied to objects in the API, but will still be"
+                            " applied to subscriptions and invoices that already have"
+                            " it set."
+                        ),
                     ),
                 ),
                 (
                     "display_name",
                     models.CharField(
                         blank=True,
                         default="",
-                        help_text="The display name of the tax rates as it will appear to your customer on their receipt email, PDF, and the hosted invoice page.",
+                        help_text=(
+                            "The display name of the tax rates as it will appear to"
+                            " your customer on their receipt email, PDF, and the hosted"
+                            " invoice page."
+                        ),
                         max_length=50,
                     ),
                 ),
                 (
                     "inclusive",
                     models.BooleanField(
-                        help_text="This specifies if the tax rate is inclusive or exclusive."
+                        help_text=(
+                            "This specifies if the tax rate is inclusive or exclusive."
+                        )
                     ),
                 ),
                 (
                     "jurisdiction",
                     models.CharField(
                         blank=True,
                         default="",
@@ -2935,15 +3436,19 @@
         ),
         migrations.AddField(
             model_name="subscription",
             name="default_tax_rates",
             field=models.ManyToManyField(
                 blank=True,
                 db_table="djstripe_djstripesubscriptiondefaulttaxrate",
-                help_text="The tax rates that will apply to any subscription item that does not have tax_rates set. Invoices created will have their default_tax_rates populated from the subscription.",
+                help_text=(
+                    "The tax rates that will apply to any subscription item that does"
+                    " not have tax_rates set. Invoices created will have their"
+                    " default_tax_rates populated from the subscription."
+                ),
                 related_name="+",
                 to="djstripe.TaxRate",
             ),
         ),
         migrations.CreateModel(
             name="DjstripeUpcomingInvoiceTotalTaxAmount",
             fields=[
@@ -2973,15 +3478,17 @@
                 ),
                 (
                     "tax_rate",
                     djstripe.fields.StripeForeignKey(
                         on_delete=django.db.models.deletion.CASCADE,
                         to="djstripe.taxrate",
                         to_field=settings.DJSTRIPE_FOREIGN_KEY_TO_FIELD,
-                        help_text="The tax rate that was applied to get this tax amount.",
+                        help_text=(
+                            "The tax rate that was applied to get this tax amount."
+                        ),
                     ),
                 ),
             ],
             options={"unique_together": {("invoice", "tax_rate")}},
         ),
         migrations.CreateModel(
             name="DjstripeInvoiceTotalTaxAmount",
@@ -3013,15 +3520,17 @@
                 ),
                 (
                     "tax_rate",
                     djstripe.fields.StripeForeignKey(
                         on_delete=django.db.models.deletion.CASCADE,
                         to="djstripe.taxrate",
                         to_field=settings.DJSTRIPE_FOREIGN_KEY_TO_FIELD,
-                        help_text="The tax rate that was applied to get this tax amount.",
+                        help_text=(
+                            "The tax rate that was applied to get this tax amount."
+                        ),
                     ),
                 ),
             ],
             options={"unique_together": {("invoice", "tax_rate")}},
         ),
         migrations.AddField(
             model_name="subscription",
@@ -3029,15 +3538,20 @@
             field=djstripe.fields.StripeForeignKey(
                 blank=True,
                 null=True,
                 on_delete=django.db.models.deletion.SET_NULL,
                 related_name="+",
                 to="djstripe.paymentmethod",
                 to_field=settings.DJSTRIPE_FOREIGN_KEY_TO_FIELD,
-                help_text="The default payment method for the subscription. It must belong to the customer associated with the subscription. If not set, invoices will use the default payment method in the customer's invoice settings.",
+                help_text=(
+                    "The default payment method for the subscription. It must belong to"
+                    " the customer associated with the subscription. If not set,"
+                    " invoices will use the default payment method in the customer's"
+                    " invoice settings."
+                ),
             ),
         ),
         migrations.AddField(
             model_name="invoice",
             name="default_source",
             field=djstripe.fields.PaymentMethodForeignKey(
                 blank=True,
@@ -3069,15 +3583,20 @@
                 ),
                 ("id", djstripe.fields.StripeIdField(max_length=255, unique=True)),
                 (
                     "livemode",
                     models.BooleanField(
                         blank=True,
                         default=None,
-                        help_text="Null here indicates that the livemode status is unknown or was previously unrecorded. Otherwise, this field indicates whether this record comes from Stripe test mode or live mode operation.",
+                        help_text=(
+                            "Null here indicates that the livemode status is unknown or"
+                            " was previously unrecorded. Otherwise, this field"
+                            " indicates whether this record comes from Stripe test mode"
+                            " or live mode operation."
+                        ),
                         null=True,
                     ),
                 ),
                 ("created", djstripe.fields.StripeDateTimeField(blank=True, null=True)),
                 ("metadata", djstripe.fields.JSONField(blank=True, null=True)),
                 ("djstripe_created", models.DateTimeField(auto_now_add=True)),
                 ("djstripe_updated", models.DateTimeField(auto_now=True)),
@@ -3085,15 +3604,18 @@
                 ("currency", djstripe.fields.StripeCurrencyCodeField(max_length=3)),
                 (
                     "balance_transaction",
                     djstripe.fields.StripeForeignKey(
                         on_delete=django.db.models.deletion.CASCADE,
                         to="djstripe.balancetransaction",
                         to_field=settings.DJSTRIPE_FOREIGN_KEY_TO_FIELD,
-                        help_text="Balance transaction that describes the impact on your account balance.",
+                        help_text=(
+                            "Balance transaction that describes the impact on your"
+                            " account balance."
+                        ),
                     ),
                 ),
                 (
                     "fee",
                     djstripe.fields.StripeForeignKey(
                         on_delete=django.db.models.deletion.CASCADE,
                         related_name="refunds",
@@ -3127,15 +3649,20 @@
                 ),
                 ("id", djstripe.fields.StripeIdField(max_length=255, unique=True)),
                 (
                     "livemode",
                     models.BooleanField(
                         blank=True,
                         default=None,
-                        help_text="Null here indicates that the livemode status is unknown or was previously unrecorded. Otherwise, this field indicates whether this record comes from Stripe test mode or live mode operation.",
+                        help_text=(
+                            "Null here indicates that the livemode status is unknown or"
+                            " was previously unrecorded. Otherwise, this field"
+                            " indicates whether this record comes from Stripe test mode"
+                            " or live mode operation."
+                        ),
                         null=True,
                     ),
                 ),
                 ("created", djstripe.fields.StripeDateTimeField(blank=True, null=True)),
                 ("metadata", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "description",
@@ -3224,15 +3751,17 @@
                     ),
                 ),
                 (
                     "country",
                     models.CharField(
                         blank=True,
                         default="",
-                        help_text="Two-letter ISO code representing the country of the card.",
+                        help_text=(
+                            "Two-letter ISO code representing the country of the card."
+                        ),
                         max_length=2,
                     ),
                 ),
                 (
                     "cvc_check",
                     djstripe.fields.StripeEnumField(
                         blank=True,
@@ -3242,15 +3771,18 @@
                     ),
                 ),
                 (
                     "dynamic_last4",
                     models.CharField(
                         blank=True,
                         default="",
-                        help_text="(For tokenized numbers only.) The last four digits of the device account number.",
+                        help_text=(
+                            "(For tokenized numbers only.) The last four digits of the"
+                            " device account number."
+                        ),
                         max_length=4,
                     ),
                 ),
                 ("exp_month", models.IntegerField(help_text="Card expiration month.")),
                 ("exp_year", models.IntegerField(help_text="Card expiration year.")),
                 (
                     "fingerprint",
@@ -3405,15 +3937,20 @@
                 ),
                 ("id", djstripe.fields.StripeIdField(max_length=255, unique=True)),
                 (
                     "livemode",
                     models.BooleanField(
                         blank=True,
                         default=None,
-                        help_text="Null here indicates that the livemode status is unknown or was previously unrecorded. Otherwise, this field indicates whether this record comes from Stripe test mode or live mode operation.",
+                        help_text=(
+                            "Null here indicates that the livemode status is unknown or"
+                            " was previously unrecorded. Otherwise, this field"
+                            " indicates whether this record comes from Stripe test mode"
+                            " or live mode operation."
+                        ),
                         null=True,
                     ),
                 ),
                 ("created", djstripe.fields.StripeDateTimeField(blank=True, null=True)),
                 ("metadata", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "description",
@@ -3444,15 +3981,18 @@
                     ),
                 ),
                 (
                     "receipt_number",
                     models.CharField(
                         blank=True,
                         default="",
-                        help_text="The transaction number that appears on email receipts sent for this charge.",
+                        help_text=(
+                            "The transaction number that appears on email receipts sent"
+                            " for this charge."
+                        ),
                         max_length=9,
                     ),
                 ),
                 (
                     "status",
                     djstripe.fields.StripeEnumField(
                         blank=True, enum=djstripe.enums.RefundStatus, max_length=9
@@ -3471,27 +4011,34 @@
                 (
                     "balance_transaction",
                     djstripe.fields.StripeForeignKey(
                         null=True,
                         on_delete=django.db.models.deletion.SET_NULL,
                         to="djstripe.balancetransaction",
                         to_field=settings.DJSTRIPE_FOREIGN_KEY_TO_FIELD,
-                        help_text="Balance transaction that describes the impact on your account balance.",
+                        help_text=(
+                            "Balance transaction that describes the impact on your"
+                            " account balance."
+                        ),
                     ),
                 ),
                 (
                     "failure_balance_transaction",
                     djstripe.fields.StripeForeignKey(
                         blank=True,
                         null=True,
                         on_delete=django.db.models.deletion.SET_NULL,
                         related_name="failure_refunds",
                         to="djstripe.balancetransaction",
                         to_field=settings.DJSTRIPE_FOREIGN_KEY_TO_FIELD,
-                        help_text="If the refund failed, this balance transaction describes the adjustment made on your account balance that reverses the initial balance transaction.",
+                        help_text=(
+                            "If the refund failed, this balance transaction describes"
+                            " the adjustment made on your account balance that reverses"
+                            " the initial balance transaction."
+                        ),
                     ),
                 ),
                 (
                     "djstripe_owner_account",
                     djstripe.fields.StripeForeignKey(
                         blank=True,
                         null=True,
@@ -3515,15 +4062,20 @@
                 ),
                 ("id", djstripe.fields.StripeIdField(max_length=255, unique=True)),
                 (
                     "livemode",
                     models.BooleanField(
                         blank=True,
                         default=None,
-                        help_text="Null here indicates that the livemode status is unknown or was previously unrecorded. Otherwise, this field indicates whether this record comes from Stripe test mode or live mode operation.",
+                        help_text=(
+                            "Null here indicates that the livemode status is unknown or"
+                            " was previously unrecorded. Otherwise, this field"
+                            " indicates whether this record comes from Stripe test mode"
+                            " or live mode operation."
+                        ),
                         null=True,
                     ),
                 ),
                 ("created", djstripe.fields.StripeDateTimeField(blank=True, null=True)),
                 ("metadata", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "description",
@@ -3554,15 +4106,17 @@
                     "file",
                     djstripe.fields.StripeForeignKey(
                         blank=True,
                         null=True,
                         on_delete=django.db.models.deletion.SET_NULL,
                         to="djstripe.fileupload",
                         to_field=settings.DJSTRIPE_FOREIGN_KEY_TO_FIELD,
-                        help_text="The file object representing the results of the query.",
+                        help_text=(
+                            "The file object representing the results of the query."
+                        ),
                     ),
                 ),
                 (
                     "djstripe_owner_account",
                     djstripe.fields.StripeForeignKey(
                         blank=True,
                         null=True,
@@ -3586,15 +4140,20 @@
                 ),
                 ("id", djstripe.fields.StripeIdField(max_length=255, unique=True)),
                 (
                     "livemode",
                     models.BooleanField(
                         blank=True,
                         default=None,
-                        help_text="Null here indicates that the livemode status is unknown or was previously unrecorded. Otherwise, this field indicates whether this record comes from Stripe test mode or live mode operation.",
+                        help_text=(
+                            "Null here indicates that the livemode status is unknown or"
+                            " was previously unrecorded. Otherwise, this field"
+                            " indicates whether this record comes from Stripe test mode"
+                            " or live mode operation."
+                        ),
                         null=True,
                     ),
                 ),
                 ("created", djstripe.fields.StripeDateTimeField(blank=True, null=True)),
                 ("metadata", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "description",
@@ -3612,55 +4171,71 @@
                         max_length=8,
                     ),
                 ),
                 (
                     "cancel_url",
                     models.TextField(
                         blank=True,
-                        help_text="The URL the customer will be directed to if theydecide to cancel payment and return to your website.",
+                        help_text=(
+                            "The URL the customer will be directed to if theydecide to"
+                            " cancel payment and return to your website."
+                        ),
                         max_length=5000,
                     ),
                 ),
                 (
                     "client_reference_id",
                     models.TextField(
                         blank=True,
-                        help_text="A unique string to reference the Checkout Session.This can be a customer ID, a cart ID, or similar, andcan be used to reconcile the session with your internal systems.",
+                        help_text=(
+                            "A unique string to reference the Checkout Session.This can"
+                            " be a customer ID, a cart ID, or similar, andcan be used"
+                            " to reconcile the session with your internal systems."
+                        ),
                         max_length=5000,
                     ),
                 ),
                 (
                     "customer_email",
                     models.CharField(
                         blank=True,
-                        help_text="If provided, this value will be used when the Customer object is created.",
+                        help_text=(
+                            "If provided, this value will be used when the Customer"
+                            " object is created."
+                        ),
                         max_length=255,
                     ),
                 ),
                 ("display_items", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "locale",
                     models.CharField(
                         blank=True,
-                        help_text="The IETF language tag of the locale Checkout is displayed in.If blank or auto, the browser's locale is used.",
+                        help_text=(
+                            "The IETF language tag of the locale Checkout is displayed"
+                            " in.If blank or auto, the browser's locale is used."
+                        ),
                         max_length=255,
                     ),
                 ),
                 ("payment_method_types", djstripe.fields.JSONField()),
                 (
                     "submit_type",
                     djstripe.fields.StripeEnumField(
                         blank=True, enum=djstripe.enums.SubmitTypeStatus, max_length=6
                     ),
                 ),
                 (
                     "success_url",
                     models.TextField(
                         blank=True,
-                        help_text="The URL the customer will be directed to after the payment or subscriptioncreation is successful.",
+                        help_text=(
+                            "The URL the customer will be directed to after the payment"
+                            " or subscriptioncreation is successful."
+                        ),
                         max_length=5000,
                     ),
                 ),
                 (
                     "customer",
                     djstripe.fields.StripeForeignKey(
                         null=True,
@@ -3673,25 +4248,29 @@
                 (
                     "payment_intent",
                     djstripe.fields.StripeForeignKey(
                         null=True,
                         on_delete=django.db.models.deletion.SET_NULL,
                         to="djstripe.paymentintent",
                         to_field=settings.DJSTRIPE_FOREIGN_KEY_TO_FIELD,
-                        help_text="PaymentIntent created if SKUs or line items were provided.",
+                        help_text=(
+                            "PaymentIntent created if SKUs or line items were provided."
+                        ),
                     ),
                 ),
                 (
                     "subscription",
                     djstripe.fields.StripeForeignKey(
                         null=True,
                         on_delete=django.db.models.deletion.SET_NULL,
                         to="djstripe.subscription",
                         to_field=settings.DJSTRIPE_FOREIGN_KEY_TO_FIELD,
-                        help_text="Subscription created if one or more plans were provided.",
+                        help_text=(
+                            "Subscription created if one or more plans were provided."
+                        ),
                     ),
                 ),
                 (
                     "mode",
                     djstripe.fields.StripeEnumField(
                         blank=True, enum=djstripe.enums.SessionMode, max_length=12
                     ),
@@ -3721,15 +4300,20 @@
                 ),
                 ("id", djstripe.fields.StripeIdField(max_length=255, unique=True)),
                 (
                     "livemode",
                     models.BooleanField(
                         blank=True,
                         default=None,
-                        help_text="Null here indicates that the livemode status is unknown or was previously unrecorded. Otherwise, this field indicates whether this record comes from Stripe test mode or live mode operation.",
+                        help_text=(
+                            "Null here indicates that the livemode status is unknown or"
+                            " was previously unrecorded. Otherwise, this field"
+                            " indicates whether this record comes from Stripe test mode"
+                            " or live mode operation."
+                        ),
                         null=True,
                     ),
                 ),
                 ("created", djstripe.fields.StripeDateTimeField(blank=True, null=True)),
                 ("metadata", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "description",
@@ -3744,15 +4328,18 @@
                     djstripe.fields.StripeDecimalCurrencyAmountField(
                         blank=True, decimal_places=2, max_digits=11, null=True
                     ),
                 ),
                 (
                     "client_secret",
                     models.CharField(
-                        help_text="The client secret of the source. Used for client-side retrieval using a publishable key.",
+                        help_text=(
+                            "The client secret of the source. Used for client-side"
+                            " retrieval using a publishable key."
+                        ),
                         max_length=255,
                     ),
                 ),
                 (
                     "currency",
                     djstripe.fields.StripeCurrencyCodeField(
                         blank=True, default="", max_length=3
@@ -3766,15 +4353,18 @@
                 ),
                 ("owner", djstripe.fields.JSONField()),
                 (
                     "statement_descriptor",
                     models.CharField(
                         blank=True,
                         default="",
-                        help_text="Extra information about a source. This will appear on your customer's statement every time you charge the source.",
+                        help_text=(
+                            "Extra information about a source. This will appear on your"
+                            " customer's statement every time you charge the source."
+                        ),
                         max_length=255,
                     ),
                 ),
                 (
                     "status",
                     djstripe.fields.StripeEnumField(
                         enum=djstripe.enums.SourceStatus, max_length=10
@@ -3844,15 +4434,20 @@
                 ),
                 ("id", djstripe.fields.StripeIdField(max_length=255, unique=True)),
                 (
                     "livemode",
                     models.BooleanField(
                         blank=True,
                         default=None,
-                        help_text="Null here indicates that the livemode status is unknown or was previously unrecorded. Otherwise, this field indicates whether this record comes from Stripe test mode or live mode operation.",
+                        help_text=(
+                            "Null here indicates that the livemode status is unknown or"
+                            " was previously unrecorded. Otherwise, this field"
+                            " indicates whether this record comes from Stripe test mode"
+                            " or live mode operation."
+                        ),
                         null=True,
                     ),
                 ),
                 ("created", djstripe.fields.StripeDateTimeField(blank=True, null=True)),
                 ("metadata", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "description",
@@ -3862,15 +4457,18 @@
                 ),
                 ("djstripe_created", models.DateTimeField(auto_now_add=True)),
                 ("djstripe_updated", models.DateTimeField(auto_now=True)),
                 (
                     "quantity",
                     models.PositiveIntegerField(
                         blank=True,
-                        help_text="The quantity of the plan to which the customer should be subscribed.",
+                        help_text=(
+                            "The quantity of the plan to which the customer should be"
+                            " subscribed."
+                        ),
                         null=True,
                     ),
                 ),
                 (
                     "plan",
                     models.ForeignKey(
                         help_text="The plan the customer is subscribed to.",
@@ -3890,15 +4488,19 @@
                     ),
                 ),
                 (
                     "tax_rates",
                     models.ManyToManyField(
                         blank=True,
                         db_table="djstripe_djstripesubscriptionitemtaxrate",
-                        help_text="The tax rates which apply to this subscription_item. When set, the default_tax_rates on the subscription do not apply to this subscription_item.",
+                        help_text=(
+                            "The tax rates which apply to this subscription_item. When"
+                            " set, the default_tax_rates on the subscription do not"
+                            " apply to this subscription_item."
+                        ),
                         related_name="+",
                         to="djstripe.TaxRate",
                     ),
                 ),
                 (
                     "djstripe_owner_account",
                     djstripe.fields.StripeForeignKey(
@@ -3940,15 +4542,20 @@
                 ),
                 ("id", djstripe.fields.StripeIdField(max_length=255, unique=True)),
                 (
                     "livemode",
                     models.BooleanField(
                         blank=True,
                         default=None,
-                        help_text="Null here indicates that the livemode status is unknown or was previously unrecorded. Otherwise, this field indicates whether this record comes from Stripe test mode or live mode operation.",
+                        help_text=(
+                            "Null here indicates that the livemode status is unknown or"
+                            " was previously unrecorded. Otherwise, this field"
+                            " indicates whether this record comes from Stripe test mode"
+                            " or live mode operation."
+                        ),
                         null=True,
                     ),
                 ),
                 ("created", djstripe.fields.StripeDateTimeField(blank=True, null=True)),
                 ("metadata", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "description",
@@ -3965,15 +4572,18 @@
                     djstripe.fields.StripeForeignKey(
                         blank=True,
                         null=True,
                         on_delete=django.db.models.deletion.SET_NULL,
                         related_name="transfer_reversals",
                         to="djstripe.balancetransaction",
                         to_field=settings.DJSTRIPE_FOREIGN_KEY_TO_FIELD,
-                        help_text="Balance transaction that describes the impact on your account balance.",
+                        help_text=(
+                            "Balance transaction that describes the impact on your"
+                            " account balance."
+                        ),
                     ),
                 ),
                 (
                     "transfer",
                     djstripe.fields.StripeForeignKey(
                         on_delete=django.db.models.deletion.CASCADE,
                         related_name="reversals",
@@ -4007,15 +4617,20 @@
                 ),
                 ("id", djstripe.fields.StripeIdField(max_length=255, unique=True)),
                 (
                     "livemode",
                     models.BooleanField(
                         blank=True,
                         default=None,
-                        help_text="Null here indicates that the livemode status is unknown or was previously unrecorded. Otherwise, this field indicates whether this record comes from Stripe test mode or live mode operation.",
+                        help_text=(
+                            "Null here indicates that the livemode status is unknown or"
+                            " was previously unrecorded. Otherwise, this field"
+                            " indicates whether this record comes from Stripe test mode"
+                            " or live mode operation."
+                        ),
                         null=True,
                     ),
                 ),
                 ("created", djstripe.fields.StripeDateTimeField(blank=True, null=True)),
                 ("metadata", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "description",
@@ -4024,25 +4639,30 @@
                     ),
                 ),
                 ("djstripe_created", models.DateTimeField(auto_now_add=True)),
                 ("djstripe_updated", models.DateTimeField(auto_now=True)),
                 (
                     "quantity",
                     models.PositiveIntegerField(
-                        help_text="The quantity of the plan to which the customer should be subscribed."
+                        help_text=(
+                            "The quantity of the plan to which the customer should be"
+                            " subscribed."
+                        )
                     ),
                 ),
                 (
                     "subscription_item",
                     djstripe.fields.StripeForeignKey(
                         on_delete=django.db.models.deletion.CASCADE,
                         related_name="usage_records",
                         to="djstripe.subscriptionitem",
                         to_field=settings.DJSTRIPE_FOREIGN_KEY_TO_FIELD,
-                        help_text="The subscription item this usage record contains data for.",
+                        help_text=(
+                            "The subscription item this usage record contains data for."
+                        ),
                     ),
                 ),
                 (
                     "djstripe_owner_account",
                     djstripe.fields.StripeForeignKey(
                         blank=True,
                         null=True,
@@ -4066,15 +4686,20 @@
                 ),
                 ("id", djstripe.fields.StripeIdField(max_length=255, unique=True)),
                 (
                     "livemode",
                     models.BooleanField(
                         blank=True,
                         default=None,
-                        help_text="Null here indicates that the livemode status is unknown or was previously unrecorded. Otherwise, this field indicates whether this record comes from Stripe test mode or live mode operation.",
+                        help_text=(
+                            "Null here indicates that the livemode status is unknown or"
+                            " was previously unrecorded. Otherwise, this field"
+                            " indicates whether this record comes from Stripe test mode"
+                            " or live mode operation."
+                        ),
                         null=True,
                     ),
                 ),
                 ("created", djstripe.fields.StripeDateTimeField(blank=True, null=True)),
                 ("metadata", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "description",
@@ -4091,15 +4716,17 @@
                     ),
                 ),
                 ("currency", djstripe.fields.StripeCurrencyCodeField(max_length=3)),
                 (
                     "nickname",
                     models.CharField(
                         blank=True,
-                        help_text="A brief description of the plan, hidden from customers.",
+                        help_text=(
+                            "A brief description of the plan, hidden from customers."
+                        ),
                         max_length=250,
                     ),
                 ),
                 (
                     "recurring",
                     djstripe.fields.JSONField(blank=True, default=None, null=True),
                 ),
@@ -4158,15 +4785,18 @@
                         help_text="The product this price is associated with.",
                     ),
                 ),
                 (
                     "lookup_key",
                     models.CharField(
                         blank=True,
-                        help_text="A lookup key used to retrieve prices dynamically from a static string.",
+                        help_text=(
+                            "A lookup key used to retrieve prices dynamically from a"
+                            " static string."
+                        ),
                         max_length=250,
                         null=True,
                     ),
                 ),
                 (
                     "transform_quantity",
                     djstripe.fields.JSONField(blank=True, null=True),
@@ -4197,25 +4827,33 @@
                 ),
                 ("id", djstripe.fields.StripeIdField(max_length=255, unique=True)),
                 (
                     "livemode",
                     models.BooleanField(
                         blank=True,
                         default=None,
-                        help_text="Null here indicates that the livemode status is unknown or was previously unrecorded. Otherwise, this field indicates whether this record comes from Stripe test mode or live mode operation.",
+                        help_text=(
+                            "Null here indicates that the livemode status is unknown or"
+                            " was previously unrecorded. Otherwise, this field"
+                            " indicates whether this record comes from Stripe test mode"
+                            " or live mode operation."
+                        ),
                         null=True,
                     ),
                 ),
                 ("created", djstripe.fields.StripeDateTimeField(blank=True, null=True)),
                 ("djstripe_created", models.DateTimeField(auto_now_add=True)),
                 ("djstripe_updated", models.DateTimeField(auto_now=True)),
                 (
                     "country",
                     models.CharField(
-                        help_text="Two-letter ISO code representing the country of the tax ID.",
+                        help_text=(
+                            "Two-letter ISO code representing the country of the"
+                            " tax ID."
+                        ),
                         max_length=2,
                     ),
                 ),
                 (
                     "type",
                     djstripe.fields.StripeEnumField(
                         enum=djstripe.enums.TaxIdType, max_length=7
@@ -4260,15 +4898,20 @@
                 ),
                 ("id", djstripe.fields.StripeIdField(max_length=255, unique=True)),
                 (
                     "livemode",
                     models.BooleanField(
                         blank=True,
                         default=None,
-                        help_text="Null here indicates that the livemode status is unknown or was previously unrecorded. Otherwise, this field indicates whether this record comes from Stripe test mode or live mode operation.",
+                        help_text=(
+                            "Null here indicates that the livemode status is unknown or"
+                            " was previously unrecorded. Otherwise, this field"
+                            " indicates whether this record comes from Stripe test mode"
+                            " or live mode operation."
+                        ),
                         null=True,
                     ),
                 ),
                 ("created", djstripe.fields.StripeDateTimeField(blank=True, null=True)),
                 ("metadata", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "description",
@@ -4286,32 +4929,42 @@
                 ),
                 ("currency", djstripe.fields.StripeCurrencyCodeField(max_length=3)),
                 ("date", djstripe.fields.StripeDateTimeField()),
                 (
                     "discountable",
                     models.BooleanField(
                         default=False,
-                        help_text="If True, discounts will apply to this invoice item. Always False for prorations.",
+                        help_text=(
+                            "If True, discounts will apply to this invoice item. Always"
+                            " False for prorations."
+                        ),
                     ),
                 ),
                 ("period", djstripe.fields.JSONField()),
                 ("period_end", djstripe.fields.StripeDateTimeField()),
                 ("period_start", djstripe.fields.StripeDateTimeField()),
                 (
                     "proration",
                     models.BooleanField(
                         default=False,
-                        help_text="Whether or not the invoice item was created automatically as a proration adjustment when the customer switched plans.",
+                        help_text=(
+                            "Whether or not the invoice item was created automatically"
+                            " as a proration adjustment when the customer switched"
+                            " plans."
+                        ),
                     ),
                 ),
                 (
                     "quantity",
                     models.IntegerField(
                         blank=True,
-                        help_text="If the invoice item is a proration, the quantity of the subscription for which the proration was computed.",
+                        help_text=(
+                            "If the invoice item is a proration, the quantity of the"
+                            " subscription for which the proration was computed."
+                        ),
                         null=True,
                     ),
                 ),
                 (
                     "customer",
                     djstripe.fields.StripeForeignKey(
                         on_delete=django.db.models.deletion.CASCADE,
@@ -4331,37 +4984,47 @@
                         to_field=settings.DJSTRIPE_FOREIGN_KEY_TO_FIELD,
                         help_text="The invoice to which this invoiceitem is attached.",
                     ),
                 ),
                 (
                     "plan",
                     models.ForeignKey(
-                        help_text="If the invoice item is a proration, the plan of the subscription for which the proration was computed.",
+                        help_text=(
+                            "If the invoice item is a proration, the plan of the"
+                            " subscription for which the proration was computed."
+                        ),
                         null=True,
                         on_delete=django.db.models.deletion.SET_NULL,
                         to="djstripe.plan",
                     ),
                 ),
                 (
                     "subscription",
                     djstripe.fields.StripeForeignKey(
                         null=True,
                         on_delete=django.db.models.deletion.SET_NULL,
                         related_name="invoiceitems",
                         to="djstripe.subscription",
                         to_field=settings.DJSTRIPE_FOREIGN_KEY_TO_FIELD,
-                        help_text="The subscription that this invoice item has been created for, if any.",
+                        help_text=(
+                            "The subscription that this invoice item has been created"
+                            " for, if any."
+                        ),
                     ),
                 ),
                 (
                     "tax_rates",
                     models.ManyToManyField(
                         blank=True,
                         db_table="djstripe_djstripeinvoiceitemtaxrate",
-                        help_text="The tax rates which apply to this invoice item. When set, the default_tax_rates on the invoice do not apply to this invoice item.",
+                        help_text=(
+                            "The tax rates which apply to this invoice item. When set,"
+                            " the default_tax_rates on the invoice do not apply to this"
+                            " invoice item."
+                        ),
                         related_name="+",
                         to="djstripe.TaxRate",
                     ),
                 ),
                 (
                     "djstripe_owner_account",
                     djstripe.fields.StripeForeignKey(
@@ -4384,15 +5047,18 @@
                     djstripe.fields.StripeDecimalCurrencyAmountField(
                         blank=True, decimal_places=12, max_digits=19, null=True
                     ),
                 ),
                 (
                     "price",
                     models.ForeignKey(
-                        help_text="If the invoice item is a proration, the price of the subscription for which the proration was computed.",
+                        help_text=(
+                            "If the invoice item is a proration, the price of the"
+                            " subscription for which the proration was computed."
+                        ),
                         null=True,
                         on_delete=django.db.models.deletion.SET_NULL,
                         related_name="invoiceitems",
                         to="djstripe.price",
                     ),
                 ),
             ],
@@ -4409,15 +5075,20 @@
                 ),
                 ("id", djstripe.fields.StripeIdField(max_length=255, unique=True)),
                 (
                     "livemode",
                     models.BooleanField(
                         blank=True,
                         default=None,
-                        help_text="Null here indicates that the livemode status is unknown or was previously unrecorded. Otherwise, this field indicates whether this record comes from Stripe test mode or live mode operation.",
+                        help_text=(
+                            "Null here indicates that the livemode status is unknown or"
+                            " was previously unrecorded. Otherwise, this field"
+                            " indicates whether this record comes from Stripe test mode"
+                            " or live mode operation."
+                        ),
                         null=True,
                     ),
                 ),
                 ("created", djstripe.fields.StripeDateTimeField(blank=True, null=True)),
                 ("metadata", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "description",
@@ -4475,15 +5146,18 @@
                         help_text="The Stripe Account this object belongs to.",
                     ),
                 ),
                 (
                     "released_subscription",
                     models.ForeignKey(
                         blank=True,
-                        help_text="The subscription once managed by this subscription schedule (if it is released).",
+                        help_text=(
+                            "The subscription once managed by this subscription"
+                            " schedule (if it is released)."
+                        ),
                         null=True,
                         on_delete=django.db.models.deletion.SET_NULL,
                         related_name="released_schedules",
                         to="djstripe.subscription",
                     ),
                 ),
                 (
@@ -4516,15 +5190,20 @@
                 ),
                 ("id", djstripe.fields.StripeIdField(max_length=255, unique=True)),
                 (
                     "livemode",
                     models.BooleanField(
                         blank=True,
                         default=None,
-                        help_text="Null here indicates that the livemode status is unknown or was previously unrecorded. Otherwise, this field indicates whether this record comes from Stripe test mode or live mode operation.",
+                        help_text=(
+                            "Null here indicates that the livemode status is unknown or"
+                            " was previously unrecorded. Otherwise, this field"
+                            " indicates whether this record comes from Stripe test mode"
+                            " or live mode operation."
+                        ),
                         null=True,
                     ),
                 ),
                 ("created", djstripe.fields.StripeDateTimeField(blank=True, null=True)),
                 ("metadata", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "description",
@@ -4552,29 +5231,35 @@
                     ),
                 ),
                 (
                     "failure_message",
                     models.TextField(
                         blank=True,
                         default="",
-                        help_text="Message to user further explaining reason for payout failure if available.",
+                        help_text=(
+                            "Message to user further explaining reason for payout"
+                            " failure if available."
+                        ),
                     ),
                 ),
                 (
                     "method",
                     djstripe.fields.StripeEnumField(
                         enum=djstripe.enums.PayoutMethod, max_length=8
                     ),
                 ),
                 (
                     "statement_descriptor",
                     models.CharField(
                         blank=True,
                         default="",
-                        help_text="Extra information about a payout to be displayed on the user's bank statement.",
+                        help_text=(
+                            "Extra information about a payout to be displayed on the"
+                            " user's bank statement."
+                        ),
                         max_length=255,
                     ),
                 ),
                 (
                     "status",
                     djstripe.fields.StripeEnumField(
                         enum=djstripe.enums.PayoutStatus, max_length=10
@@ -4599,27 +5284,35 @@
                 (
                     "balance_transaction",
                     djstripe.fields.StripeForeignKey(
                         null=True,
                         on_delete=django.db.models.deletion.SET_NULL,
                         to="djstripe.balancetransaction",
                         to_field=settings.DJSTRIPE_FOREIGN_KEY_TO_FIELD,
-                        help_text="Balance transaction that describes the impact on your account balance.",
+                        help_text=(
+                            "Balance transaction that describes the impact on your"
+                            " account balance."
+                        ),
                     ),
                 ),
                 (
                     "failure_balance_transaction",
                     djstripe.fields.StripeForeignKey(
                         blank=True,
                         null=True,
                         on_delete=django.db.models.deletion.SET_NULL,
                         related_name="failure_payouts",
                         to="djstripe.balancetransaction",
                         to_field=settings.DJSTRIPE_FOREIGN_KEY_TO_FIELD,
-                        help_text="If the payout failed or was canceled, this will be the balance transaction that reversed the initial balance transaction, and puts the funds from the failed payout back in your balance.",
+                        help_text=(
+                            "If the payout failed or was canceled, this will be the"
+                            " balance transaction that reversed the initial balance"
+                            " transaction, and puts the funds from the failed payout"
+                            " back in your balance."
+                        ),
                     ),
                 ),
                 (
                     "djstripe_owner_account",
                     djstripe.fields.StripeForeignKey(
                         blank=True,
                         null=True,
@@ -4628,15 +5321,18 @@
                         to_field=settings.DJSTRIPE_FOREIGN_KEY_TO_FIELD,
                         help_text="The Stripe Account this object belongs to.",
                     ),
                 ),
                 (
                     "automatic",
                     models.BooleanField(
-                        help_text="`true` if the payout was created by an automated payout schedule, and `false` if it was requested manually.",
+                        help_text=(
+                            "`true` if the payout was created by an automated payout"
+                            " schedule, and `false` if it was requested manually."
+                        ),
                     ),
                 ),
                 (
                     "source_type",
                     djstripe.fields.StripeEnumField(
                         enum=djstripe.enums.PayoutSourceType,
                         max_length=12,
@@ -4651,15 +5347,18 @@
             field=djstripe.fields.StripeForeignKey(
                 blank=True,
                 null=True,
                 on_delete=django.db.models.deletion.CASCADE,
                 related_name="+",
                 to="djstripe.transfer",
                 to_field=settings.DJSTRIPE_FOREIGN_KEY_TO_FIELD,
-                help_text="The transfer which created this charge. Only present if the charge came from another Stripe account.",
+                help_text=(
+                    "The transfer which created this charge. Only present if the charge"
+                    " came from another Stripe account."
+                ),
             ),
         ),
         migrations.AddField(
             model_name="charge",
             name="application_fee",
             field=djstripe.fields.StripeForeignKey(
                 blank=True,
```

### Comparing `dj_stripe-2.7.3/djstripe/migrations/0008_2_5.py` & `dj_stripe-2.8.0a0/djstripe/migrations/0008_2_5.py`

 * *Files 6% similar despite different names*

```diff
@@ -5,15 +5,14 @@
 from django.db import migrations, models
 
 import djstripe.enums
 import djstripe.fields
 
 
 class Migration(migrations.Migration):
-
     dependencies = [
         ("djstripe", "0001_initial"),
     ]
 
     operations = [
         migrations.RemoveField(
             model_name="subscription",
@@ -24,48 +23,60 @@
             name="djstripe_owner_account",
         ),
         migrations.AddField(
             model_name="card",
             name="account",
             field=djstripe.fields.StripeForeignKey(
                 blank=True,
-                help_text="The external account the charge was made on behalf of. Null here indicates that this value was never set.",
+                help_text=(
+                    "The external account the charge was made on behalf of. Null here"
+                    " indicates that this value was never set."
+                ),
                 null=True,
                 on_delete=django.db.models.deletion.PROTECT,
                 related_name="cards",
                 to="djstripe.account",
                 to_field=settings.DJSTRIPE_FOREIGN_KEY_TO_FIELD,
             ),
         ),
         migrations.AddField(
             model_name="card",
             name="default_for_currency",
             field=models.BooleanField(
-                help_text="Whether this external account (Card) is the default account for its currency.",
+                help_text=(
+                    "Whether this external account (Card) is the default account for"
+                    " its currency."
+                ),
                 null=True,
             ),
         ),
         migrations.AlterField(
             model_name="bankaccount",
             name="account",
             field=djstripe.fields.StripeForeignKey(
                 blank=True,
-                help_text="The external account the charge was made on behalf of. Null here indicates that this value was never set.",
+                help_text=(
+                    "The external account the charge was made on behalf of. Null here"
+                    " indicates that this value was never set."
+                ),
                 null=True,
                 on_delete=django.db.models.deletion.PROTECT,
                 related_name="bank_accounts",
                 to="djstripe.account",
                 to_field=settings.DJSTRIPE_FOREIGN_KEY_TO_FIELD,
             ),
         ),
         migrations.AlterField(
             model_name="bankaccount",
             name="default_for_currency",
             field=models.BooleanField(
-                help_text="Whether this external account (BankAccount) is the default account for its currency.",
+                help_text=(
+                    "Whether this external account (BankAccount) is the default account"
+                    " for its currency."
+                ),
                 null=True,
             ),
         ),
         migrations.RenameModel(
             old_name="FileUpload",
             new_name="File",
         ),
@@ -82,15 +93,20 @@
                 ),
                 ("id", djstripe.fields.StripeIdField(max_length=255, unique=True)),
                 (
                     "livemode",
                     models.BooleanField(
                         blank=True,
                         default=None,
-                        help_text="Null here indicates that the livemode status is unknown or was previously unrecorded. Otherwise, this field indicates whether this record comes from Stripe test mode or live mode operation.",
+                        help_text=(
+                            "Null here indicates that the livemode status is unknown or"
+                            " was previously unrecorded. Otherwise, this field"
+                            " indicates whether this record comes from Stripe test mode"
+                            " or live mode operation."
+                        ),
                         null=True,
                     ),
                 ),
                 (
                     "created",
                     djstripe.fields.StripeDateTimeField(
                         blank=True,
@@ -98,15 +114,19 @@
                         null=True,
                     ),
                 ),
                 (
                     "metadata",
                     djstripe.fields.JSONField(
                         blank=True,
-                        help_text="A set of key/value pairs that you can attach to an object. It can be useful for storing additional information about an object in a structured format.",
+                        help_text=(
+                            "A set of key/value pairs that you can attach to an object."
+                            " It can be useful for storing additional information about"
+                            " an object in a structured format."
+                        ),
                         null=True,
                     ),
                 ),
                 (
                     "description",
                     models.TextField(
                         blank=True, help_text="A description of this object.", null=True
@@ -164,15 +184,20 @@
                 ),
                 ("id", djstripe.fields.StripeIdField(max_length=255, unique=True)),
                 (
                     "livemode",
                     models.BooleanField(
                         blank=True,
                         default=None,
-                        help_text="Null here indicates that the livemode status is unknown or was previously unrecorded. Otherwise, this field indicates whether this record comes from Stripe test mode or live mode operation.",
+                        help_text=(
+                            "Null here indicates that the livemode status is unknown or"
+                            " was previously unrecorded. Otherwise, this field"
+                            " indicates whether this record comes from Stripe test mode"
+                            " or live mode operation."
+                        ),
                         null=True,
                     ),
                 ),
                 (
                     "created",
                     djstripe.fields.StripeDateTimeField(
                         blank=True,
@@ -180,65 +205,86 @@
                         null=True,
                     ),
                 ),
                 (
                     "metadata",
                     djstripe.fields.JSONField(
                         blank=True,
-                        help_text="A set of key/value pairs that you can attach to an object. It can be useful for storing additional information about an object in a structured format.",
+                        help_text=(
+                            "A set of key/value pairs that you can attach to an object."
+                            " It can be useful for storing additional information about"
+                            " an object in a structured format."
+                        ),
                         null=True,
                     ),
                 ),
                 (
                     "description",
                     models.TextField(
                         blank=True, help_text="A description of this object.", null=True
                     ),
                 ),
                 (
                     "customer_acceptance",
                     djstripe.fields.JSONField(
-                        help_text="Details about the customer's acceptance of the mandate."
+                        help_text=(
+                            "Details about the customer's acceptance of the mandate."
+                        )
                     ),
                 ),
                 (
                     "payment_method_details",
                     djstripe.fields.JSONField(
-                        help_text="Additional mandate information specific to the payment method type."
+                        help_text=(
+                            "Additional mandate information specific to the payment"
+                            " method type."
+                        )
                     ),
                 ),
                 (
                     "status",
                     djstripe.fields.StripeEnumField(
                         enum=djstripe.enums.MandateStatus,
-                        help_text="The status of the mandate, which indicates whether it can be used to initiate a payment.",
+                        help_text=(
+                            "The status of the mandate, which indicates whether it can"
+                            " be used to initiate a payment."
+                        ),
                         max_length=8,
                     ),
                 ),
                 (
                     "type",
                     djstripe.fields.StripeEnumField(
                         enum=djstripe.enums.MandateType,
-                        help_text="The status of the mandate, which indicates whether it can be used to initiate a payment.",
+                        help_text=(
+                            "The status of the mandate, which indicates whether it can"
+                            " be used to initiate a payment."
+                        ),
                         max_length=10,
                     ),
                 ),
                 (
                     "multi_use",
                     djstripe.fields.JSONField(
                         blank=True,
-                        help_text="If this is a `multi_use` mandate, this hash contains details about the mandate.",
+                        help_text=(
+                            "If this is a `multi_use` mandate, this hash contains"
+                            " details about the mandate."
+                        ),
                         null=True,
                     ),
                 ),
                 (
                     "single_use",
                     djstripe.fields.JSONField(
                         blank=True,
-                        help_text="If this is a `single_use` mandate, this hash contains details about the mandate.",
+                        help_text=(
+                            "If this is a `single_use` mandate, this hash contains"
+                            " details about the mandate."
+                        ),
                         null=True,
                     ),
                 ),
                 (
                     "djstripe_owner_account",
                     djstripe.fields.StripeForeignKey(
                         blank=True,
```

### Comparing `dj_stripe-2.7.3/djstripe/migrations/0009_2_6.py` & `dj_stripe-2.8.0a0/djstripe/migrations/0009_2_6.py`

 * *Files 3% similar despite different names*

```diff
@@ -8,15 +8,14 @@
 from django.db import migrations, models
 
 import djstripe.enums
 import djstripe.fields
 
 
 class Migration(migrations.Migration):
-
     dependencies = [
         ("djstripe", "0008_2_5"),
     ]
 
     operations = [
         migrations.CreateModel(
             name="WebhookEndpoint",
@@ -31,15 +30,20 @@
                 ),
                 ("id", djstripe.fields.StripeIdField(max_length=255, unique=True)),
                 (
                     "livemode",
                     models.BooleanField(
                         blank=True,
                         default=None,
-                        help_text="Null here indicates that the livemode status is unknown or was previously unrecorded. Otherwise, this field indicates whether this record comes from Stripe test mode or live mode operation.",
+                        help_text=(
+                            "Null here indicates that the livemode status is unknown or"
+                            " was previously unrecorded. Otherwise, this field"
+                            " indicates whether this record comes from Stripe test mode"
+                            " or live mode operation."
+                        ),
                         null=True,
                     ),
                 ),
                 (
                     "created",
                     djstripe.fields.StripeDateTimeField(blank=True, null=True),
                 ),
@@ -53,27 +57,33 @@
                         blank=True, help_text="A description of this object.", null=True
                     ),
                 ),
                 (
                     "api_version",
                     models.CharField(
                         blank=True,
-                        help_text="The API version events are rendered as for this webhook endpoint.",
+                        help_text=(
+                            "The API version events are rendered as for this webhook"
+                            " endpoint."
+                        ),
                         max_length=10,
                     ),
                 ),
                 (
                     "enabled_events",
                     djstripe.fields.JSONField(),
                 ),
                 (
                     "secret",
                     models.CharField(
                         blank=True,
-                        help_text="The endpoint's secret, used to generate webhook signatures.",
+                        help_text=(
+                            "The endpoint's secret, used to generate webhook"
+                            " signatures."
+                        ),
                         max_length=256,
                         editable=False,
                     ),
                 ),
                 (
                     "status",
                     djstripe.fields.StripeEnumField(
@@ -107,15 +117,17 @@
                 ),
                 (
                     "djstripe_uuid",
                     models.UUIDField(
                         null=True,
                         unique=True,
                         default=uuid.uuid4,
-                        help_text="A UUID specific to dj-stripe generated for the endpoint",
+                        help_text=(
+                            "A UUID specific to dj-stripe generated for the endpoint"
+                        ),
                     ),
                 ),
             ],
             options={"get_latest_by": "created", "abstract": False},
         ),
         migrations.CreateModel(
             name="UsageRecordSummary",
@@ -130,15 +142,20 @@
                 ),
                 ("id", djstripe.fields.StripeIdField(max_length=255, unique=True)),
                 (
                     "livemode",
                     models.BooleanField(
                         blank=True,
                         default=None,
-                        help_text="Null here indicates that the livemode status is unknown or was previously unrecorded. Otherwise, this field indicates whether this record comes from Stripe test mode or live mode operation.",
+                        help_text=(
+                            "Null here indicates that the livemode status is unknown or"
+                            " was previously unrecorded. Otherwise, this field"
+                            " indicates whether this record comes from Stripe test mode"
+                            " or live mode operation."
+                        ),
                         null=True,
                     ),
                 ),
                 (
                     "created",
                     djstripe.fields.StripeDateTimeField(blank=True, null=True),
                 ),
@@ -153,15 +170,18 @@
                 (
                     "period_start",
                     djstripe.fields.StripeDateTimeField(blank=True, null=True),
                 ),
                 (
                     "total_usage",
                     models.PositiveIntegerField(
-                        help_text="The quantity of the plan to which the customer should be subscribed."
+                        help_text=(
+                            "The quantity of the plan to which the customer should be"
+                            " subscribed."
+                        )
                     ),
                 ),
                 (
                     "djstripe_owner_account",
                     djstripe.fields.StripeForeignKey(
                         blank=True,
                         null=True,
@@ -185,15 +205,17 @@
                 (
                     "subscription_item",
                     djstripe.fields.StripeForeignKey(
                         on_delete=django.db.models.deletion.CASCADE,
                         related_name="usage_record_summaries",
                         to="djstripe.subscriptionitem",
                         to_field=settings.DJSTRIPE_FOREIGN_KEY_TO_FIELD,
-                        help_text="The subscription item this usage record contains data for.",
+                        help_text=(
+                            "The subscription item this usage record contains data for."
+                        ),
                     ),
                 ),
             ],
             options={"get_latest_by": "created", "abstract": False},
         ),
         migrations.AddField(
             model_name="applicationfee",
@@ -210,28 +232,34 @@
         ),
         migrations.AddField(
             model_name="customer",
             name="deleted",
             field=models.BooleanField(
                 blank=True,
                 default=False,
-                help_text="Whether the Customer instance has been deleted upstream in Stripe or not.",
+                help_text=(
+                    "Whether the Customer instance has been deleted upstream in Stripe"
+                    " or not."
+                ),
                 null=True,
             ),
         ),
         migrations.AddField(
             model_name="dispute",
             name="balance_transaction",
             field=djstripe.fields.StripeForeignKey(
                 null=True,
                 on_delete=django.db.models.deletion.CASCADE,
                 related_name="disputes",
                 to="djstripe.balancetransaction",
                 to_field=settings.DJSTRIPE_FOREIGN_KEY_TO_FIELD,
-                help_text="Balance transaction that describes the impact on your account balance.",
+                help_text=(
+                    "Balance transaction that describes the impact on your account"
+                    " balance."
+                ),
             ),
         ),
         migrations.AddField(
             model_name="dispute",
             name="charge",
             field=djstripe.fields.StripeForeignKey(
                 null=True,
@@ -359,12 +387,15 @@
         ),
         migrations.AlterField(
             model_name="customer",
             name="delinquent",
             field=models.BooleanField(
                 blank=True,
                 default=False,
-                help_text="Whether or not the latest charge for the customer's latest invoice has failed.",
+                help_text=(
+                    "Whether or not the latest charge for the customer's latest invoice"
+                    " has failed."
+                ),
                 null=True,
             ),
         ),
     ]
```

### Comparing `dj_stripe-2.7.3/djstripe/migrations/0011_2_7.py` & `dj_stripe-2.8.0a0/djstripe/migrations/0011_2_7.py`

 * *Files 13% similar despite different names*

```diff
@@ -5,15 +5,14 @@
 from django.db import migrations, models
 
 import djstripe.enums
 import djstripe.fields
 
 
 class Migration(migrations.Migration):
-
     dependencies = [
         ("djstripe", "0010_alter_customer_balance"),
     ]
 
     operations = [
         migrations.RemoveField(
             model_name="subscriptionschedule",
@@ -44,38 +43,46 @@
             ),
         ),
         migrations.AlterField(
             model_name="event",
             name="api_version",
             field=models.CharField(
                 blank=True,
-                help_text="the API version at which the event data was rendered. Blank for old entries only, all new entries will have this value",
+                help_text=(
+                    "the API version at which the event data was rendered. Blank for"
+                    " old entries only, all new entries will have this value"
+                ),
                 max_length=64,
             ),
         ),
         migrations.AlterField(
             model_name="webhookendpoint",
             name="api_version",
             field=models.CharField(
                 max_length=64,
                 blank=True,
-                help_text="The API version events are rendered as for this webhook endpoint. Defaults to the configured Stripe API Version.",
+                help_text=(
+                    "The API version events are rendered as for this webhook endpoint."
+                    " Defaults to the configured Stripe API Version."
+                ),
             ),
         ),
         migrations.AddField(
             model_name="coupon",
             name="applies_to",
             field=djstripe.fields.JSONField(blank=True, null=True),
         ),
         migrations.AddField(
             model_name="subscriptionschedule",
             name="subscription",
             field=models.ForeignKey(
                 blank=True,
-                help_text="ID of the subscription managed by the subscription schedule.",
+                help_text=(
+                    "ID of the subscription managed by the subscription schedule."
+                ),
                 null=True,
                 on_delete=django.db.models.deletion.SET_NULL,
                 related_name="subscriptions",
                 to="djstripe.subscription",
             ),
         ),
         migrations.AddField(
@@ -100,15 +107,17 @@
         ),
         migrations.AddField(
             model_name="taxrate",
             name="tax_type",
             field=models.CharField(
                 blank=True,
                 default="",
-                help_text="The high-level tax type, such as vat, gst, sales_tax or custom.",
+                help_text=(
+                    "The high-level tax type, such as vat, gst, sales_tax or custom."
+                ),
                 max_length=50,
             ),
         ),
         migrations.AlterField(
             model_name="payout",
             name="failure_code",
             field=djstripe.fields.StripeEnumField(
@@ -141,44 +150,68 @@
         migrations.AddField(
             model_name="subscriptionitem",
             name="proration_behavior",
             field=djstripe.fields.StripeEnumField(
                 blank=True,
                 default="create_prorations",
                 enum=djstripe.enums.SubscriptionProrationBehavior,
-                help_text="Determines how to handle prorations when the billing cycle changes (e.g., when switching plans, resetting billing_cycle_anchor=now, or starting a trial), or if an items quantity changes",
+                help_text=(
+                    "Determines how to handle prorations when the billing cycle changes"
+                    " (e.g., when switching plans, resetting billing_cycle_anchor=now,"
+                    " or starting a trial), or if an items quantity changes"
+                ),
                 max_length=17,
             ),
         ),
         migrations.AddField(
             model_name="subscriptionitem",
             name="proration_date",
             field=djstripe.fields.StripeDateTimeField(
                 blank=True,
-                help_text="If set, the proration will be calculated as though the subscription was updated at the given time. This can be used to apply exactly the same proration that was previewed with upcoming invoice endpoint. It can also be used to implement custom proration logic, such as prorating by day instead of by second, by providing the time that you wish to use for proration calculations",
+                help_text=(
+                    "If set, the proration will be calculated as though the"
+                    " subscription was updated at the given time. This can be used to"
+                    " apply exactly the same proration that was previewed with upcoming"
+                    " invoice endpoint. It can also be used to implement custom"
+                    " proration logic, such as prorating by day instead of by second,"
+                    " by providing the time that you wish to use for proration"
+                    " calculations"
+                ),
                 null=True,
             ),
         ),
         migrations.AddField(
             model_name="subscription",
             name="proration_behavior",
             field=djstripe.fields.StripeEnumField(
                 blank=True,
                 default="create_prorations",
                 enum=djstripe.enums.SubscriptionProrationBehavior,
-                help_text="Determines how to handle prorations when the billing cycle changes (e.g., when switching plans, resetting billing_cycle_anchor=now, or starting a trial), or if an items quantity changes",
+                help_text=(
+                    "Determines how to handle prorations when the billing cycle changes"
+                    " (e.g., when switching plans, resetting billing_cycle_anchor=now,"
+                    " or starting a trial), or if an items quantity changes"
+                ),
                 max_length=17,
             ),
         ),
         migrations.AddField(
             model_name="subscription",
             name="proration_date",
             field=djstripe.fields.StripeDateTimeField(
                 blank=True,
-                help_text="If set, the proration will be calculated as though the subscription was updated at the given time. This can be used to apply exactly the same proration that was previewed with upcoming invoice endpoint. It can also be used to implement custom proration logic, such as prorating by day instead of by second, by providing the time that you wish to use for proration calculations",
+                help_text=(
+                    "If set, the proration will be calculated as though the"
+                    " subscription was updated at the given time. This can be used to"
+                    " apply exactly the same proration that was previewed with upcoming"
+                    " invoice endpoint. It can also be used to implement custom"
+                    " proration logic, such as prorating by day instead of by second,"
+                    " by providing the time that you wish to use for proration"
+                    " calculations"
+                ),
                 null=True,
             ),
         ),
         migrations.AddField(
             model_name="subscription",
             name="pause_collection",
             field=djstripe.fields.JSONField(blank=True, null=True),
@@ -196,15 +229,20 @@
                 ),
                 ("id", djstripe.fields.StripeIdField(max_length=255, unique=True)),
                 (
                     "livemode",
                     models.BooleanField(
                         blank=True,
                         default=None,
-                        help_text="Null here indicates that the livemode status is unknown or was previously unrecorded. Otherwise, this field indicates whether this record comes from Stripe test mode or live mode operation.",
+                        help_text=(
+                            "Null here indicates that the livemode status is unknown or"
+                            " was previously unrecorded. Otherwise, this field"
+                            " indicates whether this record comes from Stripe test mode"
+                            " or live mode operation."
+                        ),
                         null=True,
                     ),
                 ),
                 ("created", djstripe.fields.StripeDateTimeField(blank=True, null=True)),
                 (
                     "description",
                     models.TextField(
@@ -247,15 +285,20 @@
                 ),
                 ("id", djstripe.fields.StripeIdField(max_length=255, unique=True)),
                 (
                     "livemode",
                     models.BooleanField(
                         blank=True,
                         default=None,
-                        help_text="Null here indicates that the livemode status is unknown or was previously unrecorded. Otherwise, this field indicates whether this record comes from Stripe test mode or live mode operation.",
+                        help_text=(
+                            "Null here indicates that the livemode status is unknown or"
+                            " was previously unrecorded. Otherwise, this field"
+                            " indicates whether this record comes from Stripe test mode"
+                            " or live mode operation."
+                        ),
                         null=True,
                     ),
                 ),
                 ("created", djstripe.fields.StripeDateTimeField(blank=True, null=True)),
                 ("metadata", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "description",
@@ -265,34 +308,43 @@
                 ),
                 ("amount_subtotal", djstripe.fields.StripeQuantumCurrencyAmountField()),
                 ("amount_total", djstripe.fields.StripeQuantumCurrencyAmountField()),
                 (
                     "application",
                     models.CharField(
                         blank=True,
-                        help_text="ID of the Connect application that created the Order, if any.",
+                        help_text=(
+                            "ID of the Connect application that created the Order, if"
+                            " any."
+                        ),
                         max_length=255,
                     ),
                 ),
                 ("automatic_tax", djstripe.fields.JSONField()),
                 ("billing_details", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "client_secret",
                     models.TextField(
-                        help_text="The client secret of this PaymentIntent. Used for client-side retrieval using a publishable key.",
+                        help_text=(
+                            "The client secret of this PaymentIntent. Used for"
+                            " client-side retrieval using a publishable key."
+                        ),
                         max_length=5000,
                     ),
                 ),
                 ("currency", djstripe.fields.StripeCurrencyCodeField(max_length=3)),
                 ("discounts", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "ip_address",
                     models.GenericIPAddressField(
                         blank=True,
-                        help_text="A recent IP address of the purchaser used for tax reporting and tax location inference.",
+                        help_text=(
+                            "A recent IP address of the purchaser used for tax"
+                            " reporting and tax location inference."
+                        ),
                         null=True,
                     ),
                 ),
                 ("line_items", djstripe.fields.JSONField()),
                 ("payment", djstripe.fields.JSONField()),
                 ("shipping_cost", djstripe.fields.JSONField(blank=True, null=True)),
                 ("shipping_details", djstripe.fields.JSONField(blank=True, null=True)),
@@ -330,15 +382,18 @@
                     "payment_intent",
                     djstripe.fields.StripeForeignKey(
                         blank=True,
                         null=True,
                         on_delete=django.db.models.deletion.SET_NULL,
                         to="djstripe.paymentintent",
                         to_field=settings.DJSTRIPE_FOREIGN_KEY_TO_FIELD,
-                        help_text="ID of the payment intent associated with this order. Null when the order is open.",
+                        help_text=(
+                            "ID of the payment intent associated with this order. Null"
+                            " when the order is open."
+                        ),
                     ),
                 ),
             ],
             options={
                 "get_latest_by": "created",
                 "abstract": False,
             },
@@ -356,33 +411,44 @@
                 ),
                 ("id", djstripe.fields.StripeIdField(max_length=255, unique=True)),
                 (
                     "livemode",
                     models.BooleanField(
                         blank=True,
                         default=None,
-                        help_text="Null here indicates that the livemode status is unknown or was previously unrecorded. Otherwise, this field indicates whether this record comes from Stripe test mode or live mode operation.",
+                        help_text=(
+                            "Null here indicates that the livemode status is unknown or"
+                            " was previously unrecorded. Otherwise, this field"
+                            " indicates whether this record comes from Stripe test mode"
+                            " or live mode operation."
+                        ),
                         null=True,
                     ),
                 ),
                 ("created", djstripe.fields.StripeDateTimeField(blank=True, null=True)),
                 ("metadata", djstripe.fields.JSONField(blank=True, null=True)),
                 (
                     "active",
                     models.BooleanField(
                         default=True,
-                        help_text="Whether the shipping rate can be used for new purchases. Defaults to true",
+                        help_text=(
+                            "Whether the shipping rate can be used for new purchases."
+                            " Defaults to true"
+                        ),
                     ),
                 ),
                 (
                     "display_name",
                     models.CharField(
                         blank=True,
                         default="",
-                        help_text="The name of the shipping rate, meant to be displayable to the customer. This will appear on CheckoutSessions.",
+                        help_text=(
+                            "The name of the shipping rate, meant to be displayable to"
+                            " the customer. This will appear on CheckoutSessions."
+                        ),
                         max_length=50,
                     ),
                 ),
                 ("fixed_amount", djstripe.fields.JSONField()),
                 (
                     "type",
                     djstripe.fields.StripeEnumField(
```

### Comparing `dj_stripe-2.7.3/djstripe/mixins.py` & `dj_stripe-2.8.0a0/djstripe/mixins.py`

 * *Files identical despite different names*

### Comparing `dj_stripe-2.7.3/djstripe/models/__init__.py` & `dj_stripe-2.8.0a0/djstripe/models/__init__.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,14 +1,17 @@
 from .account import Account
 from .api import APIKey
 from .base import IdempotencyKey, StripeModel
 from .billing import (
     Coupon,
+    Discount,
     Invoice,
     InvoiceItem,
+    InvoiceOrLineItem,
+    LineItem,
     Plan,
     ShippingRate,
     Subscription,
     SubscriptionItem,
     SubscriptionSchedule,
     TaxCode,
     TaxId,
@@ -38,21 +41,23 @@
     PaymentIntent,
     Payout,
     Price,
     Product,
     Refund,
     SetupIntent,
 )
+from .identity import VerificationReport, VerificationSession
 from .orders import Order
 from .payment_methods import (
     BankAccount,
     Card,
     DjstripePaymentMethod,
     PaymentMethod,
     Source,
+    SourceTransaction,
 )
 from .sigma import ScheduledQueryRun
 from .webhooks import WebhookEndpoint, WebhookEventTrigger
 
 __all__ = [
     "Account",
     "APIKey",
@@ -61,45 +66,51 @@
     "BalanceTransaction",
     "BankAccount",
     "Card",
     "Charge",
     "CountrySpec",
     "Coupon",
     "Customer",
+    "Discount",
     "Dispute",
     "DjstripePaymentMethod",
     "Event",
     "File",
     "FileLink",
     "FileUpload",
     "IdempotencyKey",
     "Invoice",
     "InvoiceItem",
+    "LineItem",
+    "InvoiceOrLineItem",
     "Mandate",
     "Order",
     "PaymentIntent",
     "PaymentMethod",
     "Payout",
     "Plan",
     "Price",
     "Product",
     "Refund",
     "ShippingRate",
     "ScheduledQueryRun",
     "SetupIntent",
     "Session",
     "Source",
+    "SourceTransaction",
     "StripeModel",
     "Subscription",
     "SubscriptionItem",
     "SubscriptionSchedule",
     "TaxCode",
     "TaxId",
     "TaxRate",
     "Transfer",
     "TransferReversal",
     "UpcomingInvoice",
     "UsageRecord",
     "UsageRecordSummary",
+    "VerificationReport",
+    "VerificationSession",
     "WebhookEndpoint",
     "WebhookEventTrigger",
 ]
```

### Comparing `dj_stripe-2.7.3/djstripe/models/account.py` & `dj_stripe-2.8.0a0/djstripe/models/account.py`

 * *Files 4% similar despite different names*

```diff
@@ -62,22 +62,26 @@
     payouts_enabled = models.BooleanField(
         null=True, help_text="Whether Stripe can send payouts to this account"
     )
     product_description = models.CharField(
         max_length=255,
         default="",
         blank=True,
-        help_text="Internal-only description of the product sold or service provided "
-        "by the business. It's used by Stripe for risk and underwriting purposes.",
+        help_text=(
+            "Internal-only description of the product sold or service provided "
+            "by the business. It's used by Stripe for risk and underwriting purposes."
+        ),
     )
     requirements = JSONField(
         null=True,
         blank=True,
-        help_text="Information about the requirements for the account, "
-        "including what information needs to be collected, and by when.",
+        help_text=(
+            "Information about the requirements for the account, "
+            "including what information needs to be collected, and by when."
+        ),
     )
     settings = JSONField(
         null=True,
         blank=True,
         help_text=(
             "Account options for customizing how the account functions within Stripe."
         ),
@@ -127,15 +131,17 @@
     @classmethod
     def get_default_account(cls, api_key=djstripe_settings.STRIPE_SECRET_KEY):
         # As of API version 2020-03-02, there is no permission that can allow
         # restricted keys to call GET /v1/account
         if djstripe_settings.STRIPE_SECRET_KEY.startswith("rk_"):
             return None
 
-        account_data = cls.stripe_class.retrieve(api_key=api_key)
+        account_data = cls.stripe_class.retrieve(
+            api_key=api_key, stripe_version=djstripe_settings.STRIPE_API_VERSION
+        )
 
         return cls._get_or_create_from_stripe_object(account_data, api_key=api_key)[0]
 
     @classmethod
     def get_or_retrieve_for_api_key(cls, api_key: str):
         with transaction.atomic():
             apikey_instance, _ = APIKey.objects.get_or_create_by_api_key(api_key)
@@ -166,15 +172,19 @@
         """
         api_key = api_key or self.default_api_key
         # Prefer passed in stripe_account if set.
         if not stripe_account:
             stripe_account = self._get_stripe_account_id(api_key)
 
         return self.stripe_class.reject(
-            self.id, api_key=api_key, stripe_account=stripe_account, **kwargs
+            self.id,
+            api_key=api_key,
+            stripe_account=stripe_account,
+            stripe_version=djstripe_settings.STRIPE_API_VERSION,
+            **kwargs,
         )
 
     @classmethod
     def _create_from_stripe_object(
         cls,
         data,
         current_ids=None,
@@ -227,15 +237,14 @@
 
         super()._attach_objects_post_save_hook(
             cls, data, pending_relations=pending_relations, api_key=api_key
         )
 
         # set the livemode if not returned by data
         if "livemode" not in data.keys() and self.djstripe_owner_account is not None:
-
             # Platform Account
             if self == self.djstripe_owner_account:
                 self.livemode = None
             else:
                 # Connected Account
                 _, self.livemode = get_api_key_details_by_prefix(api_key)
 
@@ -254,15 +263,16 @@
                             stripe_account=self.id, api_key=api_key
                         ),
                         api_key=api_key,
                     )
                 except stripe.error.PermissionError:
                     # No permission to retrieve the data with the key
                     logger.warning(
-                        f"Cannot retrieve business branding {field} for acct {self.id} with the key."
+                        f"Cannot retrieve business branding {field} for acct"
+                        f" {self.id} with the key."
                     )
                 except stripe.error.InvalidRequestError as e:
                     if "a similar object exists in" in str(e):
                         # HACK around a Stripe bug.
                         # See #830 and commit c09d25f52bfdcf883e9eec0bf6c25af1771a644a
                         pass
                     else:
```

### Comparing `dj_stripe-2.7.3/djstripe/models/api.py` & `dj_stripe-2.8.0a0/djstripe/models/api.py`

 * *Files 7% similar despite different names*

```diff
@@ -5,14 +5,15 @@
 from django.core.validators import RegexValidator
 from django.db import IntegrityError, models, transaction
 from django.forms import ValidationError
 
 from ..enums import APIKeyType
 from ..exceptions import InvalidStripeAPIKey
 from ..fields import StripeEnumField
+from ..settings import djstripe_settings
 from .base import StripeModel
 
 # A regex to validate API key format
 API_KEY_REGEX = r"^(pk|sk|rk)_(test|live)_([a-zA-Z0-9]{24,99})"
 
 
 def generate_api_key_id() -> str:
@@ -81,18 +82,24 @@
                 self.type, self.livemode = get_api_key_details_by_prefix(self.secret)
             except InvalidStripeAPIKey as e:
                 raise ValidationError(str(e))
 
     def refresh_account(self, commit=True):
         from .account import Account
 
-        if self.type != APIKeyType.secret:
+        if self.type not in (
+            APIKeyType.secret,
+            APIKeyType.restricted,
+        ):
             return
 
-        account_data = Account.stripe_class.retrieve(api_key=self.secret)
+        account_data = Account.stripe_class.retrieve(
+            api_key=self.secret,
+            stripe_version=djstripe_settings.STRIPE_API_VERSION,
+        )
         # NOTE: Do not immediately use _get_or_create_from_stripe_object() here.
         # Account needs to exist for things to work. Make a stub if necessary.
         account, created = Account.objects.get_or_create(
             id=account_data["id"],
             defaults={"charges_enabled": False, "details_submitted": False},
         )
         if created:
```

### Comparing `dj_stripe-2.7.3/djstripe/models/base.py` & `dj_stripe-2.8.0a0/djstripe/models/base.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,13 +1,12 @@
 import logging
 import uuid
 from datetime import timedelta
 from typing import Dict, List, Optional, Type
 
-from django.apps import apps
 from django.db import IntegrityError, models, transaction
 from django.utils import dateformat, timezone
 from stripe.api_resources.abstract.api_resource import APIResource
 from stripe.error import InvalidRequestError
 from stripe.util import convert_to_stripe_object
 
 from ..exceptions import ImpossibleAPIRequest
@@ -16,15 +15,15 @@
     StripeDateTimeField,
     StripeForeignKey,
     StripeIdField,
     StripePercentField,
 )
 from ..managers import StripeModelManager
 from ..settings import djstripe_settings
-from ..utils import get_friendly_currency_amount, get_id_from_stripe_data
+from ..utils import get_id_from_stripe_data
 
 logger = logging.getLogger(__name__)
 
 
 class StripeBaseModel(models.Model):
     stripe_class: Type[APIResource] = APIResource
 
@@ -44,15 +43,19 @@
         :type api_key: string
 
         See Stripe documentation for accepted kwargs for each object.
 
         :returns: an iterator over all items in the query
         """
 
-        return cls.stripe_class.list(api_key=api_key, **kwargs).auto_paging_iter()
+        return cls.stripe_class.list(
+            api_key=api_key,
+            stripe_version=djstripe_settings.STRIPE_API_VERSION,
+            **kwargs,
+        ).auto_paging_iter()
 
 
 class StripeModel(StripeBaseModel):
     # This must be defined in descendants of this model/mixin
     # e.g. Event, Charge, Customer, etc.
     expand_fields: List[str] = []
     stripe_dashboard_item_name = ""
@@ -74,29 +77,33 @@
         help_text="The Stripe Account this object belongs to.",
     )
 
     livemode = models.BooleanField(
         null=True,
         default=None,
         blank=True,
-        help_text="Null here indicates that the livemode status is unknown or was "
-        "previously unrecorded. Otherwise, this field indicates whether this record "
-        "comes from Stripe test mode or live mode operation.",
+        help_text=(
+            "Null here indicates that the livemode status is unknown or was previously"
+            " unrecorded. Otherwise, this field indicates whether this record comes"
+            " from Stripe test mode or live mode operation."
+        ),
     )
     created = StripeDateTimeField(
         null=True,
         blank=True,
         help_text="The datetime this object was created in stripe.",
     )
     metadata = JSONField(
         null=True,
         blank=True,
-        help_text="A set of key/value pairs that you can attach to an object. "
-        "It can be useful for storing additional information about an object in "
-        "a structured format.",
+        help_text=(
+            "A set of key/value pairs that you can attach to an object. "
+            "It can be useful for storing additional information about an object in "
+            "a structured format."
+        ),
     )
     description = models.TextField(
         null=True, blank=True, help_text="A description of this object."
     )
 
     class Meta(StripeBaseModel.Meta):
         abstract = True
@@ -104,28 +111,25 @@
 
     def _get_base_stripe_dashboard_url(self):
         owner_path_prefix = (
             (self.djstripe_owner_account.id + "/")
             if self.djstripe_owner_account
             else ""
         )
-        return "https://dashboard.stripe.com/{}{}".format(
-            owner_path_prefix, "test/" if not self.livemode else ""
-        )
+        suffix = "test/" if not self.livemode else ""
+        return f"https://dashboard.stripe.com/{owner_path_prefix}{suffix}"
 
     def get_stripe_dashboard_url(self) -> str:
         """Get the stripe dashboard url for this object."""
         if not self.stripe_dashboard_item_name or not self.id:
             return ""
         else:
-            return "{base_url}{item}/{id}".format(
-                base_url=self._get_base_stripe_dashboard_url(),
-                item=self.stripe_dashboard_item_name,
-                id=self.id,
-            )
+            base_url = self._get_base_stripe_dashboard_url()
+            item = self.stripe_dashboard_item_name
+            return f"{base_url}{item}/{self.id}"
 
     @property
     def default_api_key(self) -> str:
         # If the class is abstract (StripeModel), fall back to default key.
         if not self._meta.abstract:
             if self.djstripe_owner_account:
                 return self.djstripe_owner_account.get_default_api_key(self.livemode)
@@ -138,44 +142,49 @@
         :param api_key: The api key to use for this request. \
             Defaults to djstripe_settings.STRIPE_SECRET_KEY.
         :type api_key: string
         :param stripe_account: The optional connected account \
             for which this request is being made.
         :type stripe_account: string
         """
+        from djstripe.models import Account
+
         api_key = api_key or self.default_api_key
 
         try:
             djstripe_owner_account = self.djstripe_owner_account
             if djstripe_owner_account is not None:
                 return djstripe_owner_account.id
         except (AttributeError, KeyError, ValueError):
             pass
 
         # Get reverse foreign key relations to Account in case we need to
         # retrieve ourselves using that Account ID.
         reverse_account_relations = (
             field
             for field in self._meta.get_fields(include_parents=True)
-            if field.is_relation and field.one_to_many
-            # Avoid circular import problems by using the app registry to
-            # get the model class rather than a direct import.
-            and field.related_model
-            is apps.get_model(app_label="djstripe", model_name="account")
+            if field.is_relation
+            and field.one_to_many
+            and field.related_model is Account
         )
 
         # Handle case where we have a reverse relation to Account and should pass
         # that account ID to the retrieve call.
         for field in reverse_account_relations:
             # Grab the related object, using the first one we find.
             reverse_lookup_attr = field.get_accessor_name()
-            account = getattr(self, reverse_lookup_attr).first()
-
-            if account is not None:
-                return account.id
+            try:
+                account = getattr(self, reverse_lookup_attr).first()
+            except ValueError:
+                if isinstance(self, Account):
+                    # return the id if self is the Account model itself.
+                    return self.id
+            else:
+                if account is not None:
+                    return account.id
 
         return None
 
     def api_retrieve(self, api_key=None, stripe_account=None):
         """
         Call the stripe API's retrieve operation for this model.
 
@@ -189,29 +198,34 @@
         # Prefer passed in stripe_account if set.
         if not stripe_account:
             stripe_account = self._get_stripe_account_id(api_key)
 
         return self.stripe_class.retrieve(
             id=self.id,
             api_key=api_key or self.default_api_key,
+            stripe_version=djstripe_settings.STRIPE_API_VERSION,
             expand=self.expand_fields,
             stripe_account=stripe_account,
         )
 
     @classmethod
     def _api_create(cls, api_key=djstripe_settings.STRIPE_SECRET_KEY, **kwargs):
         """
         Call the stripe API's create operation for this model.
 
         :param api_key: The api key to use for this request. \
             Defaults to djstripe_settings.STRIPE_SECRET_KEY.
         :type api_key: string
         """
 
-        return cls.stripe_class.create(api_key=api_key, **kwargs)
+        return cls.stripe_class.create(
+            api_key=api_key,
+            stripe_version=djstripe_settings.STRIPE_API_VERSION,
+            **kwargs,
+        )
 
     def _api_delete(self, api_key=None, stripe_account=None, **kwargs):
         """
         Call the stripe API's delete operation for this model
 
         :param api_key: The api key to use for this request. \
             Defaults to djstripe_settings.STRIPE_SECRET_KEY.
@@ -222,15 +236,19 @@
         """
         api_key = api_key or self.default_api_key
         # Prefer passed in stripe_account if set.
         if not stripe_account:
             stripe_account = self._get_stripe_account_id(api_key)
 
         return self.stripe_class.delete(
-            self.id, api_key=api_key, stripe_account=stripe_account, **kwargs
+            self.id,
+            api_key=api_key,
+            stripe_account=stripe_account,
+            stripe_version=djstripe_settings.STRIPE_API_VERSION,
+            **kwargs,
         )
 
     def _api_update(self, api_key=None, stripe_account=None, **kwargs):
         """
         Call the stripe API's modify operation for this model
 
         :param api_key: The api key to use for this request.
@@ -242,15 +260,19 @@
         """
         api_key = api_key or self.default_api_key
         # Prefer passed in stripe_account if set.
         if not stripe_account:
             stripe_account = self._get_stripe_account_id(api_key)
 
         return self.stripe_class.modify(
-            self.id, api_key=api_key, stripe_account=stripe_account, **kwargs
+            self.id,
+            api_key=api_key,
+            stripe_account=stripe_account,
+            stripe_version=djstripe_settings.STRIPE_API_VERSION,
+            **kwargs,
         )
 
     @classmethod
     def _manipulate_stripe_object_hook(cls, data):
         """
         Gets called by this object's stripe object conversion method just before
         conversion.
@@ -417,30 +439,29 @@
         :param pending_relations: list of tuples of relations to be attached post-save
         :type pending_relations: list
         :param stripe_account: The optional connected account \
             for which this request is being made.
         :type stripe_account: string
         :return:
         """
-        from djstripe.models import DjstripePaymentMethod
+        from djstripe.models import DjstripePaymentMethod, InvoiceOrLineItem
 
         field_data = None
         field_name = field.name
         refetch = False
         skip = False
         # a flag to indicate if the given field is null upstream on Stripe
         is_nulled = False
 
         if current_ids is None:
             current_ids = set()
 
-        if issubclass(field.related_model, StripeModel) or issubclass(
-            field.related_model, DjstripePaymentMethod
+        if issubclass(
+            field.related_model, (StripeModel, DjstripePaymentMethod, InvoiceOrLineItem)
         ):
-
             if field_name in manipulated_data:
                 raw_field_data = manipulated_data.get(field_name)
 
                 # field's value is None. Skip syncing but set as None.
                 # Otherwise nulled FKs sync gets skipped.
                 if not raw_field_data:
                     is_nulled = True
@@ -675,15 +696,16 @@
 
         id_ = get_id_from_stripe_data(field)
 
         if not field:
             # An empty field - We need to return nothing here because there is
             # no way of knowing what needs to be fetched!
             raise RuntimeError(
-                f"dj-stripe encountered an empty field {cls.__name__}.{field_name} = {field}"
+                f"dj-stripe encountered an empty field {cls.__name__}.{field_name} ="
+                f" {field}"
             )
         elif id_ == field:
             # A field like {"subscription": "sub_6lsC8pt7IcFpjA", ...}
             # We'll have to expand if the field is not "id" (= is nested)
             should_expand = is_nested_data
         else:
             # A field like {"subscription": {"id": sub_6lsC8pt7IcFpjA", ...}}
@@ -855,66 +877,55 @@
             )
 
             pks.append(tax_amount.pk)
 
         instance.total_tax_amounts.exclude(pk__in=pks).delete()
 
     @classmethod
-    def _stripe_object_to_invoice_items(
+    def _stripe_object_to_line_items(
         cls, target_cls, data, invoice, api_key=djstripe_settings.STRIPE_SECRET_KEY
     ):
         """
-        Retrieves InvoiceItems for an invoice.
+        Retrieves LineItems for an invoice.
 
-        If the invoice item doesn't exist already then it is created.
+        If the line item doesn't exist already then it is created.
 
         If the invoice is an upcoming invoice that doesn't persist to the
-        database (i.e. ephemeral) then the invoice items are also not saved.
+        database (i.e. ephemeral) then the line items are also not saved.
 
-        :param target_cls: The target class to instantiate per invoice item.
-        :type target_cls:  Type[djstripe.models.InvoiceItem]
+        :param target_cls: The target class to instantiate per line item.
+        :type target_cls:  Type[djstripe.models.LineItem]
         :param data: The data dictionary received from the Stripe API.
         :type data: dict
-        :param invoice: The invoice object that should hold the invoice items.
+        :param invoice: The invoice object that should hold the line items.
         :type invoice: ``djstripe.models.Invoice``
         """
-
         lines = data.get("lines")
         if not lines:
             return []
 
-        invoiceitems = []
+        lineitems = []
         for line in lines.auto_paging_iter():
             if invoice.id:
                 save = True
                 line.setdefault("invoice", invoice.id)
 
-                if line.get("type") == "subscription":
-                    # Lines for subscriptions need to be keyed based on invoice and
-                    # subscription, because their id is *just* the subscription
-                    # when received from Stripe. This means that future updates to
-                    # a subscription will change previously saved invoices - Doing
-                    # the composite key avoids this.
-                    if not line["id"].startswith(invoice.id):
-                        line["id"] = "{invoice_id}-{subscription_id}".format(
-                            invoice_id=invoice.id, subscription_id=line["id"]
-                        )
             else:
                 # Don't save invoice items for ephemeral invoices
                 save = False
 
             line.setdefault("customer", invoice.customer.id)
             line.setdefault("date", int(dateformat.format(invoice.created, "U")))
 
             item, _ = target_cls._get_or_create_from_stripe_object(
                 line, refetch=False, save=save, api_key=api_key
             )
-            invoiceitems.append(item)
+            lineitems.append(item)
 
-        return invoiceitems
+        return lineitems
 
     @classmethod
     def _stripe_object_to_subscription_items(
         cls, target_cls, data, subscription, api_key=djstripe_settings.STRIPE_SECRET_KEY
     ):
         """
         Retrieves SubscriptionItems for a subscription.
@@ -978,15 +989,20 @@
                 api_key=api_key,
             )
             refund_objs.append(item)
 
         return refund_objs
 
     @classmethod
-    def sync_from_stripe_data(cls, data, api_key=djstripe_settings.STRIPE_SECRET_KEY):
+    def sync_from_stripe_data(
+        cls,
+        data,
+        api_key=djstripe_settings.STRIPE_SECRET_KEY,
+        stripe_version=djstripe_settings.STRIPE_API_VERSION,
+    ):
         """
         Syncs this object from the stripe data provided.
 
         Foreign keys will also be retrieved and synced recursively.
 
         :param data: stripe object
         :type data: dict
@@ -1043,15 +1059,17 @@
 
         # If no API key is specified, use the default one for the specified livemode
         # (or if no livemode is specified, the default one altogether)
         kwargs.setdefault(
             "api_key",
             djstripe_settings.get_default_api_key(livemode=kwargs.get("livemode")),
         )
-        data = cls.stripe_class.retrieve(id=id, **kwargs)
+        data = cls.stripe_class.retrieve(
+            id=id, stripe_version=djstripe_settings.STRIPE_API_VERSION, **kwargs
+        )
         instance = cls.sync_from_stripe_data(data, api_key=kwargs.get("api_key"))
         return instance
 
     def __str__(self):
         return f"<id={self.id}>"
```

### Comparing `dj_stripe-2.7.3/djstripe/models/billing.py` & `dj_stripe-2.8.0a0/djstripe/models/billing.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,36 +1,40 @@
+import logging
 import warnings
 from typing import Optional, Union
 
 import stripe
 from django.db import models
 from django.utils import timezone
 from django.utils.text import format_lazy
 from django.utils.translation import gettext_lazy as _
 from stripe.error import InvalidRequestError
 
 from .. import enums
 from ..fields import (
+    InvoiceOrLineItemForeignKey,
     JSONField,
     PaymentMethodForeignKey,
     StripeCurrencyCodeField,
     StripeDateTimeField,
     StripeDecimalCurrencyAmountField,
     StripeEnumField,
     StripeForeignKey,
     StripeIdField,
     StripePercentField,
     StripeQuantumCurrencyAmountField,
 )
 from ..managers import SubscriptionManager
 from ..settings import djstripe_settings
-from ..utils import QuerySetMock, get_friendly_currency_amount
+from ..utils import QuerySetMock, get_friendly_currency_amount, get_id_from_stripe_data
 from .base import StripeModel
 from .core import Customer
 
+logger = logging.getLogger(__name__)
+
 
 # TODO Mimic stripe-python decorator pattern to easily add and expose CRUD operations like create, update, delete etc on models
 # TODO Add Tests
 class DjstripeInvoiceTotalTaxAmount(models.Model):
     """
     An internal model that holds the value of elements of Invoice.total_tax_amounts
 
@@ -105,37 +109,42 @@
         null=True,
         blank=True,
         help_text="Contains information about what this coupon applies to.",
     )
     amount_off = StripeDecimalCurrencyAmountField(
         null=True,
         blank=True,
-        help_text="Amount (as decimal) that will be taken off the subtotal of any "
-        "invoices for this customer.",
+        help_text=(
+            "Amount (as decimal) that will be taken off the subtotal of any "
+            "invoices for this customer."
+        ),
     )
     currency = StripeCurrencyCodeField(null=True, blank=True)
     duration = StripeEnumField(
         enum=enums.CouponDuration,
         help_text=(
             "Describes how long a customer who applies this coupon "
             "will get the discount."
         ),
         default=enums.CouponDuration.once,
     )
     duration_in_months = models.PositiveIntegerField(
         null=True,
         blank=True,
-        help_text="If `duration` is `repeating`, the number of months "
-        "the coupon applies.",
+        help_text=(
+            "If `duration` is `repeating`, the number of months the coupon applies."
+        ),
     )
     max_redemptions = models.PositiveIntegerField(
         null=True,
         blank=True,
-        help_text="Maximum number of times this coupon can be redeemed, in total, "
-        "before it is no longer valid.",
+        help_text=(
+            "Maximum number of times this coupon can be redeemed, in total, "
+            "before it is no longer valid."
+        ),
     )
     name = models.TextField(
         max_length=5000,
         default="",
         blank=True,
         help_text=(
             "Name of the coupon displayed to customers on for instance invoices "
@@ -151,16 +160,18 @@
             "For example, a coupon with percent_off of 50 will make a "
             "$100 invoice $50 instead."
         ),
     )
     redeem_by = StripeDateTimeField(
         null=True,
         blank=True,
-        help_text="Date after which the coupon can no longer be redeemed. "
-        "Max 5 years in the future.",
+        help_text=(
+            "Date after which the coupon can no longer be redeemed. "
+            "Max 5 years in the future."
+        ),
     )
     times_redeemed = models.PositiveIntegerField(
         editable=False,
         default=0,
         help_text="Number of times this coupon has been applied to a customer.",
     )
     # valid = models.BooleanField(editable=False)
@@ -183,108 +194,219 @@
             amount = "(invalid amount)"
         return f"{amount} off"
 
     @property
     def human_readable(self):
         if self.duration == enums.CouponDuration.repeating:
             if self.duration_in_months == 1:
-                duration = "for {duration_in_months} month"
+                duration = "for 1 month"
             else:
-                duration = "for {duration_in_months} months"
-            duration = duration.format(duration_in_months=self.duration_in_months)
+                duration = f"for {self.duration_in_months} months"
         else:
             duration = self.duration
         return f"{self.human_readable_amount} {duration}"
 
 
+class Discount(StripeModel):
+    """
+    A discount represents the actual application of a coupon or promotion code.
+    It contains information about when the discount began,
+    when it will end, and what it is applied to.
+
+    Stripe documentation: https://stripe.com/docs/api/discounts
+    """
+
+    expand_fields = ["customer"]
+    stripe_class = None
+
+    checkout_session = StripeForeignKey(
+        "Session",
+        null=True,
+        blank=True,
+        on_delete=models.CASCADE,
+        help_text=(
+            "The Checkout session that this coupon is applied to, if it is applied to a"
+            " particular session in payment mode. Will not be present for subscription"
+            " mode."
+        ),
+    )
+    coupon = JSONField(
+        null=True,
+        blank=True,
+        help_text="Hash describing the coupon applied to create this discount.",
+    )
+    customer = StripeForeignKey(
+        "Customer",
+        null=True,
+        blank=True,
+        on_delete=models.CASCADE,
+        help_text="The ID of the customer associated with this discount.",
+        related_name="customer_discounts",
+    )
+    end = StripeDateTimeField(
+        null=True,
+        blank=True,
+        help_text=(
+            "If the coupon has a duration of repeating, the date that this discount"
+            " will end. If the coupon has a duration of once or forever, this attribute"
+            " will be null."
+        ),
+    )
+    invoice = StripeForeignKey(
+        "Invoice",
+        null=True,
+        blank=True,
+        on_delete=models.CASCADE,
+        help_text=(
+            "The invoice that the discounts coupon was applied to, if it was applied"
+            " directly to a particular invoice."
+        ),
+        related_name="invoice_discounts",
+    )
+    invoice_item = InvoiceOrLineItemForeignKey(
+        null=True,
+        blank=True,
+        on_delete=models.CASCADE,
+        help_text=(
+            "The invoice item id (or invoice line item id for invoice line items of"
+            " type=subscription) that the discounts coupon was applied to, if it was"
+            " applied directly to a particular invoice item or invoice line item."
+        ),
+    )
+    promotion_code = models.CharField(
+        max_length=255,
+        blank=True,
+        help_text="The promotion code applied to create this discount.",
+    )
+    start = StripeDateTimeField(
+        null=True,
+        blank=True,
+        help_text="Date that the coupon was applied.",
+    )
+    subscription = StripeForeignKey(
+        "subscription",
+        null=True,
+        blank=True,
+        on_delete=models.CASCADE,
+        help_text=(
+            "The subscription that this coupon is applied to, if it is applied to a"
+            " particular subscription."
+        ),
+        related_name="subscription_discounts",
+    )
+
+    @classmethod
+    def is_valid_object(cls, data):
+        """
+        Returns whether the data is a valid object for the class
+        """
+        return "object" in data and data["object"] == "discount"
+
+
 class BaseInvoice(StripeModel):
     """
     The abstract base model shared by Invoice and UpcomingInvoice
 
     Note:
     Most fields are defined on BaseInvoice so they're available to both models.
     ManyToManyFields are an exception, since UpcomingInvoice doesn't exist in the db.
     """
 
     stripe_class = stripe.Invoice
     stripe_dashboard_item_name = "invoices"
+    expand_fields = ["discounts"]
 
     account_country = models.CharField(
         max_length=2,
         default="",
         blank=True,
-        help_text="The country of the business associated with this invoice, "
-        "most often the business creating the invoice.",
+        help_text=(
+            "The country of the business associated with this invoice, "
+            "most often the business creating the invoice."
+        ),
     )
     account_name = models.TextField(
         max_length=5000,
         blank=True,
-        help_text="The public name of the business associated with this invoice, "
-        "most often the business creating the invoice.",
+        help_text=(
+            "The public name of the business associated with this invoice, "
+            "most often the business creating the invoice."
+        ),
     )
     amount_due = StripeDecimalCurrencyAmountField(
-        help_text="Final amount due (as decimal) at this time for this invoice. "
-        "If the invoice's total is smaller than the minimum charge amount, "
-        "for example, or if there is account credit that can be applied to the "
-        "invoice, the amount_due may be 0. If there is a positive starting_balance "
-        "for the invoice (the customer owes money), the amount_due will also take that "
-        "into account. The charge that gets generated for the invoice will be for "
-        "the amount specified in amount_due."
+        help_text=(
+            "Final amount due (as decimal) at this time for this invoice. If the"
+            " invoice's total is smaller than the minimum charge amount, for example,"
+            " or if there is account credit that can be applied to the invoice, the"
+            " amount_due may be 0. If there is a positive starting_balance for the"
+            " invoice (the customer owes money), the amount_due will also take that"
+            " into account. The charge that gets generated for the invoice will be for"
+            " the amount specified in amount_due."
+        )
     )
     amount_paid = StripeDecimalCurrencyAmountField(
         null=True,  # XXX: This is not nullable, but it's a new field
         help_text="The amount, (as decimal), that was paid.",
     )
     amount_remaining = StripeDecimalCurrencyAmountField(
         null=True,  # XXX: This is not nullable, but it's a new field
         help_text="The amount remaining, (as decimal), that is due.",
     )
     application_fee_amount = StripeDecimalCurrencyAmountField(
         null=True,
         blank=True,
-        help_text="The fee (as decimal) that will be applied to the invoice and "
-        "transferred to the application owner's "
-        "Stripe account when the invoice is paid.",
+        help_text=(
+            "The fee (as decimal) that will be applied to the invoice and "
+            "transferred to the application owner's "
+            "Stripe account when the invoice is paid."
+        ),
     )
     attempt_count = models.IntegerField(
-        help_text="Number of payment attempts made for this invoice, "
-        "from the perspective of the payment retry schedule. "
-        "Any payment attempt counts as the first attempt, and subsequently "
-        "only automatic retries increment the attempt count. "
-        "In other words, manual payment attempts after the first attempt do not affect "
-        "the retry schedule."
+        help_text=(
+            "Number of payment attempts made for this invoice, from the perspective of"
+            " the payment retry schedule. Any payment attempt counts as the first"
+            " attempt, and subsequently only automatic retries increment the attempt"
+            " count. In other words, manual payment attempts after the first attempt do"
+            " not affect the retry schedule."
+        )
     )
     attempted = models.BooleanField(
         default=False,
-        help_text="Whether or not an attempt has been made to pay the invoice. "
-        "An invoice is not attempted until 1 hour after the ``invoice.created`` "
-        "webhook, for example, so you might not want to display that invoice as "
-        "unpaid to your users.",
+        help_text=(
+            "Whether or not an attempt has been made to pay the invoice. "
+            "An invoice is not attempted until 1 hour after the ``invoice.created`` "
+            "webhook, for example, so you might not want to display that invoice as "
+            "unpaid to your users."
+        ),
     )
     auto_advance = models.BooleanField(
         null=True,
-        help_text="Controls whether Stripe will perform automatic collection of the "
-        "invoice. When false, the invoice's state will not automatically "
-        "advance without an explicit action.",
+        help_text=(
+            "Controls whether Stripe will perform automatic collection of the "
+            "invoice. When false, the invoice's state will not automatically "
+            "advance without an explicit action."
+        ),
     )
     billing_reason = StripeEnumField(
         default="",
         blank=True,
         enum=enums.InvoiceBillingReason,
-        help_text="Indicates the reason why the invoice was created. "
-        "subscription_cycle indicates an invoice created by a subscription advancing "
-        "into a new period. subscription_create indicates an invoice created due to "
-        "creating a subscription. subscription_update indicates an invoice created due "
-        "to updating a subscription. subscription is set for all old invoices to "
-        "indicate either a change to a subscription or a period advancement. "
-        "manual is set for all invoices unrelated to a subscription "
-        "(for example: created via the invoice editor). The upcoming value is "
-        "reserved for simulated invoices per the upcoming invoice endpoint. "
-        "subscription_threshold indicates an invoice created due to a billing "
-        "threshold being reached.",
+        help_text=(
+            "Indicates the reason why the invoice was created. subscription_cycle"
+            " indicates an invoice created by a subscription advancing into a new"
+            " period. subscription_create indicates an invoice created due to creating"
+            " a subscription. subscription_update indicates an invoice created due to"
+            " updating a subscription. subscription is set for all old invoices to"
+            " indicate either a change to a subscription or a period advancement."
+            " manual is set for all invoices unrelated to a subscription (for example:"
+            " created via the invoice editor). The upcoming value is reserved for"
+            " simulated invoices per the upcoming invoice endpoint."
+            " subscription_threshold indicates an invoice created due to a billing"
+            " threshold being reached."
+        ),
     )
     charge = models.OneToOneField(
         "Charge",
         on_delete=models.CASCADE,
         null=True,
         # we need to use the %(class)s placeholder to avoid related name
         # clashes between Invoice and UpcomingInvoice
@@ -309,96 +431,125 @@
         # clashes between Invoice and UpcomingInvoice
         related_name="%(class)ss",
         help_text="The customer associated with this invoice.",
     )
     customer_address = JSONField(
         null=True,
         blank=True,
-        help_text="The customer's address. Until the invoice is finalized, this "
-        "field will equal customer.address. Once the invoice is finalized, this field "
-        "will no longer be updated.",
+        help_text=(
+            "The customer's address. Until the invoice is finalized, this field will"
+            " equal customer.address. Once the invoice is finalized, this field will no"
+            " longer be updated."
+        ),
     )
     customer_email = models.TextField(
         max_length=5000,
         blank=True,
-        help_text="The customer's email. Until the invoice is finalized, this field "
-        "will equal customer.email. Once the invoice is finalized, this field will no "
-        "longer be updated.",
+        help_text=(
+            "The customer's email. Until the invoice is finalized, this field will"
+            " equal customer.email. Once the invoice is finalized, this field will no"
+            " longer be updated."
+        ),
     )
     customer_name = models.TextField(
         max_length=5000,
         blank=True,
-        help_text="The customer's name. Until the invoice is finalized, this field "
-        "will equal customer.name. Once the invoice is finalized, this field will no "
-        "longer be updated.",
+        help_text=(
+            "The customer's name. Until the invoice is finalized, this field will equal"
+            " customer.name. Once the invoice is finalized, this field will no longer"
+            " be updated."
+        ),
     )
     customer_phone = models.TextField(
         max_length=5000,
         blank=True,
-        help_text="The customer's phone number. Until the invoice is finalized, "
-        "this field will equal customer.phone. Once the invoice is finalized, "
-        "this field will no longer be updated.",
+        help_text=(
+            "The customer's phone number. Until the invoice is finalized, "
+            "this field will equal customer.phone. Once the invoice is finalized, "
+            "this field will no longer be updated."
+        ),
     )
     customer_shipping = JSONField(
         null=True,
         blank=True,
-        help_text="The customer's shipping information. Until the invoice is "
-        "finalized, this field will equal customer.shipping. Once the invoice is "
-        "finalized, this field will no longer be updated.",
+        help_text=(
+            "The customer's shipping information. Until the invoice is "
+            "finalized, this field will equal customer.shipping. Once the invoice is "
+            "finalized, this field will no longer be updated."
+        ),
     )
     customer_tax_exempt = StripeEnumField(
         enum=enums.CustomerTaxExempt,
         default="",
-        help_text="The customer's tax exempt status. Until the invoice is finalized, "
-        "this field will equal customer.tax_exempt. Once the invoice is "
-        "finalized, this field will no longer be updated.",
+        help_text=(
+            "The customer's tax exempt status. Until the invoice is finalized, "
+            "this field will equal customer.tax_exempt. Once the invoice is "
+            "finalized, this field will no longer be updated."
+        ),
     )
     default_payment_method = StripeForeignKey(
         "PaymentMethod",
         null=True,
         blank=True,
         on_delete=models.SET_NULL,
         related_name="+",
-        help_text="Default payment method for the invoice. It must belong to the "
-        "customer associated with the invoice. If not set, defaults to the "
-        "subscription's default payment method, if any, or to the default payment "
-        "method in the customer's invoice settings.",
+        help_text=(
+            "Default payment method for the invoice. It must belong to the "
+            "customer associated with the invoice. If not set, defaults to the "
+            "subscription's default payment method, if any, or to the default payment "
+            "method in the customer's invoice settings."
+        ),
     )
     # Note: default_tax_rates is handled in the subclasses since it's a
     # ManyToManyField, otherwise reverse accessors clash
     discount = JSONField(
         null=True,
         blank=True,
-        help_text="Describes the current discount applied to this "
-        "subscription, if there is one. When billing, a discount applied to a "
-        "subscription overrides a discount applied on a customer-wide basis.",
+        help_text=(
+            "Deprecated! Please use discounts instead. Describes the current discount"
+            " applied to this subscription, if there is one. When billing, a discount"
+            " applied to a subscription overrides a discount applied on a customer-wide"
+            " basis."
+        ),
+    )
+    discounts = JSONField(
+        null=True,
+        blank=True,
+        help_text=(
+            "The discounts applied to the invoice. Line item discounts are applied"
+            " before invoice discounts."
+        ),
     )
     due_date = StripeDateTimeField(
         null=True,
         blank=True,
         help_text=(
             "The date on which payment for this invoice is due. "
             "This value will be null for invoices where billing=charge_automatically."
         ),
     )
     ending_balance = StripeQuantumCurrencyAmountField(
         null=True,
-        help_text="Ending customer balance (in cents) after attempting to pay invoice. "
-        "If the invoice has not been attempted yet, this will be null.",
+        help_text=(
+            "Ending customer balance (in cents) after attempting to pay invoice. "
+            "If the invoice has not been attempted yet, this will be null."
+        ),
     )
     footer = models.TextField(
         max_length=5000, blank=True, help_text="Footer displayed on the invoice."
     )
     hosted_invoice_url = models.TextField(
         max_length=799,
         default="",
         blank=True,
-        help_text="The URL for the hosted invoice page, which allows customers to view "
-        "and pay an invoice. If the invoice has not been frozen yet, "
-        "this will be null.",
+        help_text=(
+            "The URL for the hosted invoice page, which allows customers to view "
+            "and pay an invoice. If the invoice has not been frozen yet, "
+            "this will be null."
+        ),
     )
     invoice_pdf = models.TextField(
         max_length=799,
         default="",
         blank=True,
         help_text=(
             "The link to download the PDF for the invoice. "
@@ -437,107 +588,131 @@
             "The PaymentIntent associated with this invoice. "
             "The PaymentIntent is generated when the invoice is finalized, "
             "and can then be used to pay the invoice."
             "Note that voiding an invoice will cancel the PaymentIntent"
         ),
     )
     period_end = StripeDateTimeField(
-        help_text="End of the usage period during which invoice items were "
-        "added to this invoice."
+        help_text=(
+            "End of the usage period during which invoice items were "
+            "added to this invoice."
+        )
     )
     period_start = StripeDateTimeField(
-        help_text="Start of the usage period during which invoice items were "
-        "added to this invoice."
+        help_text=(
+            "Start of the usage period during which invoice items were "
+            "added to this invoice."
+        )
     )
     post_payment_credit_notes_amount = StripeQuantumCurrencyAmountField(
         # This is not nullable, but it's a new field
         null=True,
         blank=True,
-        help_text="Total amount (in cents) of all post-payment credit notes issued "
-        "for this invoice.",
+        help_text=(
+            "Total amount (in cents) of all post-payment credit notes issued "
+            "for this invoice."
+        ),
     )
     pre_payment_credit_notes_amount = StripeQuantumCurrencyAmountField(
         # This is not nullable, but it's a new field
         null=True,
         blank=True,
-        help_text="Total amount (in cents) of all pre-payment credit notes issued "
-        "for this invoice.",
+        help_text=(
+            "Total amount (in cents) of all pre-payment credit notes issued "
+            "for this invoice."
+        ),
     )
     receipt_number = models.CharField(
         max_length=64,
         null=True,
         blank=True,
         help_text=(
             "This is the transaction number that appears on email receipts "
             "sent for this invoice."
         ),
     )
     starting_balance = StripeQuantumCurrencyAmountField(
-        help_text="Starting customer balance (in cents) before attempting to pay "
-        "invoice. If the invoice has not been attempted yet, this will be the "
-        "current customer balance."
+        help_text=(
+            "Starting customer balance (in cents) before attempting to pay "
+            "invoice. If the invoice has not been attempted yet, this will be the "
+            "current customer balance."
+        )
     )
     statement_descriptor = models.CharField(
         max_length=22,
         default="",
         blank=True,
-        help_text="An arbitrary string to be displayed on your customer's "
-        "credit card statement. The statement description may not include <>\"' "
-        "characters, and will appear on your customer's statement in capital letters. "
-        "Non-ASCII characters are automatically stripped. "
-        "While most banks display this information consistently, "
-        "some may display it incorrectly or not at all.",
+        help_text=(
+            "An arbitrary string to be displayed on your customer's credit card"
+            " statement. The statement description may not include <>\"' characters,"
+            " and will appear on your customer's statement in capital letters."
+            " Non-ASCII characters are automatically stripped. While most banks display"
+            " this information consistently, some may display it incorrectly or not at"
+            " all."
+        ),
     )
     status = StripeEnumField(
         default="",
         blank=True,
         enum=enums.InvoiceStatus,
-        help_text="The status of the invoice, one of draft, open, paid, "
-        "uncollectible, or void.",
+        help_text=(
+            "The status of the invoice, one of draft, open, paid, "
+            "uncollectible, or void."
+        ),
     )
     status_transitions = JSONField(null=True, blank=True)
     subscription = StripeForeignKey(
         "Subscription",
         null=True,
         # we need to use the %(class)s placeholder to avoid related name
         # clashes between Invoice and UpcomingInvoice
         related_name="%(class)ss",
         on_delete=models.SET_NULL,
         help_text="The subscription that this invoice was prepared for, if any.",
     )
     subscription_proration_date = StripeDateTimeField(
         null=True,
         blank=True,
-        help_text="Only set for upcoming invoices that preview prorations. "
-        "The time used to calculate prorations.",
+        help_text=(
+            "Only set for upcoming invoices that preview prorations. "
+            "The time used to calculate prorations."
+        ),
     )
     subtotal = StripeDecimalCurrencyAmountField(
-        help_text="Total (as decimal) of all subscriptions, invoice items, "
-        "and prorations on the invoice before any discount or tax is applied."
+        help_text=(
+            "Total (as decimal) of all subscriptions, invoice items, "
+            "and prorations on the invoice before any discount or tax is applied."
+        )
     )
     tax = StripeDecimalCurrencyAmountField(
         null=True,
         blank=True,
-        help_text="The amount (as decimal) of tax included in the total, calculated "
-        "from ``tax_percent`` and the subtotal. If no "
-        "``tax_percent`` is defined, this value will be null.",
+        help_text=(
+            "The amount (as decimal) of tax included in the total, calculated "
+            "from ``tax_percent`` and the subtotal. If no "
+            "``tax_percent`` is defined, this value will be null."
+        ),
     )
     tax_percent = StripePercentField(
         null=True,
         blank=True,
-        help_text="This percentage of the subtotal has been added to the total amount "
-        "of the invoice, including invoice line items and discounts. "
-        "This field is inherited from the subscription's ``tax_percent`` field, "
-        "but can be changed before the invoice is paid. This field defaults to null.",
+        help_text=(
+            "This percentage of the subtotal has been added to the total amount of the"
+            " invoice, including invoice line items and discounts. This field is"
+            " inherited from the subscription's ``tax_percent`` field, but can be"
+            " changed before the invoice is paid. This field defaults to null."
+        ),
     )
     threshold_reason = JSONField(
         null=True,
         blank=True,
-        help_text="If billing_reason is set to subscription_threshold this returns "
-        "more information on which threshold rules triggered the invoice.",
+        help_text=(
+            "If billing_reason is set to subscription_threshold this returns "
+            "more information on which threshold rules triggered the invoice."
+        ),
     )
     total = StripeDecimalCurrencyAmountField("Total (as decimal) after discount.")
     webhooks_delivered_at = StripeDateTimeField(
         null=True,
         help_text=(
             "The time at which webhooks for this invoice were successfully delivered "
             "(if the invoice had no webhooks to deliver, this will match `date`). "
@@ -556,21 +731,16 @@
         return f"Invoice #{invoice_number} for {amount} ({self.status})"
 
     @classmethod
     def upcoming(
         cls,
         api_key=djstripe_settings.STRIPE_SECRET_KEY,
         customer=None,
-        coupon=None,
         subscription=None,
         subscription_plan=None,
-        subscription_prorate=None,
-        subscription_proration_date=None,
-        subscription_quantity=None,
-        subscription_trial_end=None,
         **kwargs,
     ) -> Optional["UpcomingInvoice"]:
         """
         Gets the upcoming preview invoice (singular) for a customer.
 
         At any time, you can preview the upcoming
         invoice for a customer. This will show you all the charges that are
@@ -589,30 +759,14 @@
         :param subscription: The identifier of the subscription to retrieve an \
         invoice for.
         :type subscription: Subscription or string (subscription ID)
         :param subscription_plan: If set, the invoice returned will preview \
         updating the subscription given to this plan, or creating a new \
         subscription to this plan if no subscription is given.
         :type subscription_plan: Plan or string (plan ID)
-        :param subscription_prorate: If previewing an update to a subscription, \
-        this decides whether the preview will show the result of applying \
-        prorations or not.
-        :type subscription_prorate: bool
-        :param subscription_proration_date: If previewing an update to a \
-        subscription, and doing proration, subscription_proration_date forces \
-        the proration to be calculated as though the update was done at the \
-        specified time.
-        :type subscription_proration_date: datetime
-        :param subscription_quantity: If provided, the invoice returned will \
-        preview updating or creating a subscription with that quantity.
-        :type subscription_quantity: int
-        :param subscription_trial_end: If provided, the invoice returned will \
-        preview updating or creating a subscription with that trial end.
-        :type subscription_trial_end: datetime
-        :returns: The upcoming preview invoice.
         """
 
         # Convert Customer to id
         if customer is not None and isinstance(customer, StripeModel):
             customer = customer.id
 
         # Convert Subscription to id
@@ -623,21 +777,17 @@
         if subscription_plan is not None and isinstance(subscription_plan, StripeModel):
             subscription_plan = subscription_plan.id
 
         try:
             upcoming_stripe_invoice = cls.stripe_class.upcoming(
                 api_key=api_key,
                 customer=customer,
-                coupon=coupon,
                 subscription=subscription,
                 subscription_plan=subscription_plan,
-                subscription_prorate=subscription_prorate,
-                subscription_proration_date=subscription_proration_date,
-                subscription_quantity=subscription_quantity,
-                subscription_trial_end=subscription_trial_end,
+                stripe_version=djstripe_settings.STRIPE_API_VERSION,
                 **kwargs,
             )
         except InvalidRequestError as exc:
             if str(exc) != "Nothing to invoice for customer":
                 raise
             return None
 
@@ -647,21 +797,17 @@
         return UpcomingInvoice._create_from_stripe_object(
             upcoming_stripe_invoice,
             save=False,
             api_key=api_key,
         )
 
     def retry(self):
-        """Retry payment on this invoice if it isn't paid or uncollectible."""
+        """Retry payment on this invoice if it isn't paid."""
 
-        if (
-            self.status != enums.InvoiceStatus.paid
-            and self.status != enums.InvoiceStatus.uncollectible
-            and self.auto_advance
-        ):
+        if self.status != enums.InvoiceStatus.paid and self.auto_advance:
             stripe_invoice = self.api_retrieve()
             updated_stripe_invoice = (
                 stripe_invoice.pay()
             )  # pay() throws an exception if the charge is not successful.
             type(self).sync_from_stripe_data(
                 updated_stripe_invoice, api_key=self.default_api_key
             )
@@ -675,19 +821,22 @@
         api_key=djstripe_settings.STRIPE_SECRET_KEY,
         pending_relations=None,
     ):
         super()._attach_objects_post_save_hook(
             cls, data, api_key=api_key, pending_relations=pending_relations
         )
 
-        # InvoiceItems need a saved invoice because they're associated via a
+        # LineItems need a saved invoice because they're associated via a
         # RelatedManager, so this must be done as part of the post save hook.
-        cls._stripe_object_to_invoice_items(
-            target_cls=InvoiceItem, data=data, invoice=self, api_key=api_key
+        cls._stripe_object_to_line_items(
+            target_cls=LineItem, data=data, invoice=self, api_key=api_key
         )
+        # sync every discount
+        for discount in self.discounts:
+            Discount.sync_from_stripe_data(discount, api_key=api_key)
 
     @property
     def plan(self) -> Optional["Plan"]:
         """Gets the associated plan for this invoice.
 
         In order to provide a consistent view of invoices, the plan object
         should be taken from the first invoice item that has one, rather than
@@ -739,18 +888,20 @@
     """
 
     default_source = PaymentMethodForeignKey(
         on_delete=models.SET_NULL,
         null=True,
         blank=True,
         related_name="invoices",
-        help_text="The default payment source for the invoice. "
-        "It must belong to the customer associated with the invoice and be "
-        "in a chargeable state. If not set, defaults to the subscription's "
-        "default source, if any, or to the customer's default source.",
+        help_text=(
+            "The default payment source for the invoice. "
+            "It must belong to the customer associated with the invoice and be "
+            "in a chargeable state. If not set, defaults to the subscription's "
+            "default source, if any, or to the customer's default source."
+        ),
     )
 
     # Note:
     # Most fields are defined on BaseInvoice so they're shared with UpcomingInvoice.
     # ManyToManyFields are an exception, since UpcomingInvoice doesn't exist in the db.
     default_tax_rates = models.ManyToManyField(
         "TaxRate",
@@ -797,37 +948,41 @@
     do actually want to instantiate the model and use relations.
     """
 
     default_source = PaymentMethodForeignKey(
         on_delete=models.SET_NULL,
         null=True,
         related_name="upcoming_invoices",
-        help_text="The default payment source for the invoice. "
-        "It must belong to the customer associated with the invoice and be "
-        "in a chargeable state. If not set, defaults to the subscription's "
-        "default source, if any, or to the customer's default source.",
+        help_text=(
+            "The default payment source for the invoice. "
+            "It must belong to the customer associated with the invoice and be "
+            "in a chargeable state. If not set, defaults to the subscription's "
+            "default source, if any, or to the customer's default source."
+        ),
     )
 
     def __init__(self, *args, **kwargs):
         super().__init__(*args, **kwargs)
-        self._invoiceitems = []
+
+        self._lineitems = []
         self._default_tax_rates = []
         self._total_tax_amounts = []
 
     def get_stripe_dashboard_url(self):
         return ""
 
     def _attach_objects_hook(
         self, cls, data, api_key=djstripe_settings.STRIPE_SECRET_KEY, current_ids=None
     ):
         super()._attach_objects_hook(
             cls, data, api_key=api_key, current_ids=current_ids
         )
-        self._invoiceitems = cls._stripe_object_to_invoice_items(
-            target_cls=InvoiceItem, data=data, invoice=self, api_key=api_key
+
+        self._lineitems = cls._stripe_object_to_line_items(
+            target_cls=LineItem, data=data, invoice=self, api_key=api_key
         )
 
     def _attach_objects_post_save_hook(
         self,
         cls,
         data,
         api_key=djstripe_settings.STRIPE_SECRET_KEY,
@@ -870,16 +1025,36 @@
         invoices are in-memory and do not persist to the database. Therefore,
         all of the data comes from the Stripe API itself.
 
         Instead of returning a normal queryset for the invoiceitems, this will
         return a mock of a queryset, but with the data fetched from Stripe - It
         will act like a normal queryset, but mutation will silently fail.
         """
+        # filter lineitems with type="invoice_item" and fetch all the actual InvoiceItem objects
+        items = []
+        for item in self._lineitems:
+            if item.type == "invoice_item":
+                items.append(item.invoice_item)
+
+        return QuerySetMock.from_iterable(InvoiceItem, items)
+
+    @property
+    def lineitems(self):
+        """
+        Gets the line items associated with this upcoming invoice.
+
+        This differs from normal (non-upcoming) invoices, in that upcoming
+        invoices are in-memory and do not persist to the database. Therefore,
+        all of the data comes from the Stripe API itself.
 
-        return QuerySetMock.from_iterable(InvoiceItem, self._invoiceitems)
+        Instead of returning a normal queryset for the lineitems, this will
+        return a mock of a queryset, but with the data fetched from Stripe - It
+        will act like a normal queryset, but mutation will silently fail.
+        """
+        return QuerySetMock.from_iterable(LineItem, self._lineitems)
 
     @property
     def default_tax_rates(self):
         """
         Gets the default tax rates associated with this upcoming invoice.
         :return:
         """
@@ -914,30 +1089,40 @@
     This is useful for combining several charges to minimize per-transaction fees
     or having Stripe tabulate your usage-based billing totals.
 
     Stripe documentation: https://stripe.com/docs/api?lang=python#invoiceitems
     """
 
     stripe_class = stripe.InvoiceItem
+    expand_fields = ["discounts"]
 
     amount = StripeDecimalCurrencyAmountField(help_text="Amount invoiced (as decimal).")
     currency = StripeCurrencyCodeField()
     customer = StripeForeignKey(
         "Customer",
         on_delete=models.CASCADE,
         related_name="invoiceitems",
         help_text="The customer associated with this invoiceitem.",
     )
     date = StripeDateTimeField(help_text="The date on the invoiceitem.")
     discountable = models.BooleanField(
         default=False,
-        help_text="If True, discounts will apply to this invoice item. "
-        "Always False for prorations.",
+        help_text=(
+            "If True, discounts will apply to this invoice item. "
+            "Always False for prorations."
+        ),
+    )
+    discounts = JSONField(
+        null=True,
+        blank=True,
+        help_text=(
+            "The discounts which apply to the invoice item. Item discounts are applied"
+            " before invoice discounts."
+        ),
     )
-    # TODO: discounts
     invoice = StripeForeignKey(
         "Invoice",
         on_delete=models.CASCADE,
         null=True,
         related_name="invoiceitems",
         help_text="The invoice to which this invoiceitem is attached.",
     )
@@ -948,55 +1133,66 @@
     period_start = StripeDateTimeField(
         help_text="Might be the date when this invoiceitem was added to the invoice"
     )
     plan = models.ForeignKey(
         "Plan",
         null=True,
         on_delete=models.SET_NULL,
-        help_text="If the invoice item is a proration, the plan of the subscription "
-        "for which the proration was computed.",
+        help_text=(
+            "If the invoice item is a proration, the plan of the subscription "
+            "for which the proration was computed."
+        ),
     )
     price = models.ForeignKey(
         "Price",
         null=True,
         related_name="invoiceitems",
         on_delete=models.SET_NULL,
-        help_text="If the invoice item is a proration, the price of the subscription "
-        "for which the proration was computed.",
+        help_text=(
+            "If the invoice item is a proration, the price of the subscription "
+            "for which the proration was computed."
+        ),
     )
     proration = models.BooleanField(
         default=False,
-        help_text="Whether or not the invoice item was created automatically as a "
-        "proration adjustment when the customer switched plans.",
+        help_text=(
+            "Whether or not the invoice item was created automatically as a "
+            "proration adjustment when the customer switched plans."
+        ),
     )
     quantity = models.IntegerField(
         null=True,
         blank=True,
-        help_text="If the invoice item is a proration, the quantity of the "
-        "subscription for which the proration was computed.",
+        help_text=(
+            "If the invoice item is a proration, the quantity of the "
+            "subscription for which the proration was computed."
+        ),
     )
     subscription = StripeForeignKey(
         "Subscription",
         null=True,
         related_name="invoiceitems",
         on_delete=models.SET_NULL,
-        help_text="The subscription that this invoice item has been created for, "
-        "if any.",
+        help_text=(
+            "The subscription that this invoice item has been created for, if any."
+        ),
     )
     # XXX: subscription_item
     tax_rates = models.ManyToManyField(
         "TaxRate",
         # explicitly specify the joining table name as though the joining model
         # was defined with through="DjstripeInvoiceItemTaxRate"
         db_table="djstripe_djstripeinvoiceitemtaxrate",
         related_name="+",
         blank=True,
-        help_text="The tax rates which apply to this invoice item. When set, "
-        "the default_tax_rates on the invoice do not apply to this "
-        "invoice item.",
+        help_text=(
+            "The tax rates which apply to this invoice item. When set, "
+            "the default_tax_rates on the invoice do not apply to this "
+            "invoice item."
+        ),
     )
     unit_amount = StripeQuantumCurrencyAmountField(
         null=True,
         blank=True,
         help_text="Unit amount (in the `currency` specified) of the invoice item.",
     )
     unit_amount_decimal = StripeDecimalCurrencyAmountField(
@@ -1032,35 +1228,269 @@
             # only call .set() on saved instance (ie don't on items of UpcomingInvoice)
             self.tax_rates.set(
                 cls._stripe_object_to_tax_rates(
                     target_cls=TaxRate, data=data, api_key=api_key
                 )
             )
 
+        # sync every discount
+        for discount in self.discounts:
+            Discount.sync_from_stripe_data(discount, api_key=api_key)
+
     def __str__(self):
         return self.description
 
-    @classmethod
-    def is_valid_object(cls, data):
-        return data and data.get("object") in ("invoiceitem", "line_item")
-
     def get_stripe_dashboard_url(self):
         return self.invoice.get_stripe_dashboard_url()
 
     def api_retrieve(self, *args, **kwargs):
         if "-il_" in self.id:
             warnings.warn(
                 f"Attempting to retrieve InvoiceItem with id={self.id!r}"
                 " will most likely fail. "
                 "Run manage.py djstripe_update_invoiceitem_ids if this is a problem."
             )
 
         return super().api_retrieve(*args, **kwargs)
 
 
+class LineItem(StripeModel):
+    """
+    The individual line items that make up the invoice.
+
+    Stripe documentation: https://stripe.com/docs/api/invoices/line_item
+    """
+
+    stripe_class = stripe.InvoiceLineItem
+    expand_fields = ["discounts"]
+
+    amount = StripeQuantumCurrencyAmountField(help_text="The amount, in cents.")
+    amount_excluding_tax = StripeQuantumCurrencyAmountField(
+        help_text=(
+            "The integer amount in cents representing the amount for this line item,"
+            " excluding all tax and discounts."
+        )
+    )
+    currency = StripeCurrencyCodeField()
+    discount_amounts = JSONField(
+        null=True,
+        blank=True,
+        help_text="The amount of discount calculated per discount for this line item.",
+    )
+    discountable = models.BooleanField(
+        default=False,
+        help_text=(
+            "If True, discounts will apply to this line item. "
+            "Always False for prorations."
+        ),
+    )
+    discounts = JSONField(
+        null=True,
+        blank=True,
+        help_text=(
+            "The discounts applied to the invoice line item. Line item discounts are"
+            " applied before invoice discounts."
+        ),
+    )
+    invoice_item = StripeForeignKey(
+        "InvoiceItem",
+        null=True,
+        blank=True,
+        on_delete=models.CASCADE,
+        help_text="The ID of the invoice item associated with this line item if any.",
+    )
+    period = JSONField(
+        help_text=(
+            "The period this line_item covers. For subscription line items, this is the"
+            " subscription period. For prorations, this starts when the proration was"
+            " calculated, and ends at the period end of the subscription. For invoice"
+            " items, this is the time at which the invoice item was created or the"
+            " period of the item."
+        )
+    )
+    period_end = StripeDateTimeField(
+        help_text=(
+            "The end of the period, which must be greater than or equal to the start."
+        )
+    )
+    period_start = StripeDateTimeField(help_text="The start of the period.")
+    price = JSONField(
+        help_text="The price of the line item.",
+    )
+    proration = models.BooleanField(
+        default=False,
+        help_text=(
+            "Whether or not the invoice item was created automatically as a "
+            "proration adjustment when the customer switched plans."
+        ),
+    )
+    proration_details = JSONField(
+        help_text="Additional details for proration line items"
+    )
+    subscription = StripeForeignKey(
+        "Subscription",
+        null=True,
+        blank=True,
+        on_delete=models.CASCADE,
+        help_text="The subscription that the invoice item pertains to, if any.",
+    )
+    subscription_item = StripeForeignKey(
+        "SubscriptionItem",
+        null=True,
+        blank=True,
+        on_delete=models.CASCADE,
+        help_text=(
+            "The subscription item that generated this invoice item. Left empty if the"
+            " line item is not an explicit result of a subscription."
+        ),
+    )
+    tax_amounts = JSONField(
+        null=True,
+        blank=True,
+        help_text="The amount of tax calculated per tax rate for this line item",
+    )
+    tax_rates = JSONField(
+        null=True, blank=True, help_text="The tax rates which apply to the line item."
+    )
+    type = StripeEnumField(enum=enums.LineItem)
+    unit_amount_excluding_tax = StripeDecimalCurrencyAmountField(
+        null=True,
+        blank=True,
+        help_text=(
+            "The amount in cents representing the unit amount for this line item,"
+            " excluding all tax and discounts."
+        ),
+    )
+    quantity = models.IntegerField(
+        null=True,
+        blank=True,
+        help_text=(
+            "The quantity of the subscription, if the line item is a subscription or a"
+            " proration."
+        ),
+    )
+
+    @classmethod
+    def _manipulate_stripe_object_hook(cls, data):
+        data["period_start"] = data["period"]["start"]
+        data["period_end"] = data["period"]["end"]
+
+        return data
+
+    def _attach_objects_post_save_hook(
+        self,
+        cls,
+        data,
+        api_key=djstripe_settings.STRIPE_SECRET_KEY,
+        pending_relations=None,
+    ):
+        super()._attach_objects_post_save_hook(
+            cls, data, api_key=api_key, pending_relations=pending_relations
+        )
+
+        # sync every discount
+        for discount in self.discounts:
+            Discount.sync_from_stripe_data(discount, api_key=api_key)
+
+    @classmethod
+    def api_list(cls, api_key=djstripe_settings.STRIPE_SECRET_KEY, **kwargs):
+        """
+        Call the stripe API's list operation for this model.
+        Note that we only iterate and sync the LineItem associated with the
+        passed in Invoice.
+
+        Upcoming invoices are virtual and are not saved and hence their
+        line items are also not retrieved and synced
+
+        :param api_key: The api key to use for this request. \
+            Defaults to djstripe_settings.STRIPE_SECRET_KEY.
+        :type api_key: string
+
+        See Stripe documentation for accepted kwargs for each object.
+
+        :returns: an iterator over all items in the query
+        """
+        # get current invoice if any
+        invoice_id = kwargs.pop("id")
+
+        # get expand parameter that needs to be passed to invoice.lines.list call
+        expand_fields = kwargs.pop("expand")
+
+        invoice = Invoice.stripe_class.retrieve(invoice_id, api_key=api_key, **kwargs)
+
+        # iterate over all the line items on the current invoice
+        return invoice.lines.list(
+            api_key=api_key, expand=expand_fields, **kwargs
+        ).auto_paging_iter()
+
+
+class InvoiceOrLineItem(models.Model):
+    """An Internal Model that abstracts InvoiceItem and lineItem
+    objects
+
+    Contains two fields: `id` and `type`:
+    - `id` is the id of the Stripe object.
+    - `type` can be `line_item`, `invoice_item` or `unsupported`
+    """
+
+    id = models.CharField(max_length=255, primary_key=True)
+    type = StripeEnumField(
+        enum=enums.InvoiceorLineItemType,
+        help_text=(
+            "Indicates whether the underlying model is LineItem or InvoiceItem. Can be"
+            " one of: 'invoice_item', 'line_item' or 'unsupported'"
+        ),
+    )
+
+    @classmethod
+    def _model_type(cls, id_):
+        if id_.startswith("ii"):
+            return InvoiceItem, "invoice_item"
+        elif id_.startswith("il"):
+            return LineItem, "line_item"
+        raise ValueError(f"Unknown object type with id: {id_}")
+
+    @classmethod
+    def _get_or_create_from_stripe_object(
+        cls,
+        data,
+        field_name="id",
+        refetch=True,
+        current_ids=None,
+        pending_relations=None,
+        save=True,
+        stripe_account=None,
+        api_key=djstripe_settings.STRIPE_SECRET_KEY,
+    ):
+        raw_field_data = data.get(field_name)
+        id_ = get_id_from_stripe_data(raw_field_data)
+
+        try:
+            object_cls, object_type = cls._model_type(id_)
+        except ValueError:
+            # This may happen if we have object types we don't know about.
+            # Let's not make dj-stripe entirely unusable if that happens.
+            logger.warning(f"Unknown Object. Could not sync object with id: {id_}")
+            return cls.objects.get_or_create(id=id_, defaults={"type": "unsupported"})
+
+        # call model's _get_or_create_from_stripe_object to ensure
+        # that object exists before getting or creating its InvoiceorLineItem mapping
+        object_cls._get_or_create_from_stripe_object(
+            data,
+            field_name,
+            refetch=refetch,
+            current_ids=current_ids,
+            pending_relations=pending_relations,
+            stripe_account=stripe_account,
+            api_key=api_key,
+        )
+
+        return cls.objects.get_or_create(id=id_, defaults={"type": object_type})
+
+
 class Plan(StripeModel):
     """
     A subscription plan contains the pricing information for different
     products and feature levels on your site.
 
     Stripe documentation: https://stripe.com/docs/api/plans?lang=python
 
@@ -1195,16 +1625,16 @@
         ordering = ["amount"]
 
     @classmethod
     def get_or_create(cls, **kwargs):
         """Get or create a Plan."""
 
         try:
-            return Plan.objects.get(id=kwargs["id"]), False
-        except Plan.DoesNotExist:
+            return cls.objects.get(id=kwargs["id"]), False
+        except cls.DoesNotExist:
             return cls.create(**kwargs), True
 
     @classmethod
     def create(cls, **kwargs):
         # A few minor things are changed in the api-version of the create call
         api_kwargs = dict(kwargs)
         api_kwargs["amount"] = int(api_kwargs["amount"] * 100)
@@ -1300,212 +1730,268 @@
 
     stripe_class = stripe.Subscription
     stripe_dashboard_item_name = "subscriptions"
 
     application_fee_percent = StripePercentField(
         null=True,
         blank=True,
-        help_text="A positive decimal that represents the fee percentage of the "
-        "subscription invoice amount that will be transferred to the application "
-        "owner's Stripe account each billing period.",
+        help_text=(
+            "A positive decimal that represents the fee percentage of the "
+            "subscription invoice amount that will be transferred to the application "
+            "owner's Stripe account each billing period."
+        ),
     )
     billing_cycle_anchor = StripeDateTimeField(
         null=True,
         blank=True,
         help_text=(
             "Determines the date of the first full invoice, and, for plans "
             "with `month` or `year` intervals, the day of the month for subsequent "
             "invoices."
         ),
     )
     billing_thresholds = JSONField(
         null=True,
         blank=True,
-        help_text="Define thresholds at which an invoice will be sent, and the "
-        "subscription advanced to a new billing period.",
+        help_text=(
+            "Define thresholds at which an invoice will be sent, and the "
+            "subscription advanced to a new billing period."
+        ),
     )
     cancel_at = StripeDateTimeField(
         null=True,
         blank=True,
-        help_text="A date in the future at which the subscription will automatically "
-        "get canceled.",
+        help_text=(
+            "A date in the future at which the subscription will automatically "
+            "get canceled."
+        ),
     )
     cancel_at_period_end = models.BooleanField(
         default=False,
-        help_text="If the subscription has been canceled with the ``at_period_end`` "
-        "flag set to true, ``cancel_at_period_end`` on the subscription will be true. "
-        "You can use this attribute to determine whether a subscription that has a "
-        "status of active is scheduled to be canceled at the end of the "
-        "current period.",
+        help_text=(
+            "If the subscription has been canceled with the ``at_period_end`` flag set"
+            " to true, ``cancel_at_period_end`` on the subscription will be true. You"
+            " can use this attribute to determine whether a subscription that has a"
+            " status of active is scheduled to be canceled at the end of the current"
+            " period."
+        ),
     )
     canceled_at = StripeDateTimeField(
         null=True,
         blank=True,
-        help_text="If the subscription has been canceled, the date of that "
-        "cancellation. If the subscription was canceled with ``cancel_at_period_end``, "
-        "canceled_at will still reflect the date of the initial cancellation request, "
-        "not the end of the subscription period when the subscription is automatically "
-        "moved to a canceled state.",
+        help_text=(
+            "If the subscription has been canceled, the date of that cancellation. If"
+            " the subscription was canceled with ``cancel_at_period_end``, canceled_at"
+            " will still reflect the date of the initial cancellation request, not the"
+            " end of the subscription period when the subscription is automatically"
+            " moved to a canceled state."
+        ),
     )
     collection_method = StripeEnumField(
         enum=enums.InvoiceCollectionMethod,
-        help_text="Either `charge_automatically`, or `send_invoice`. When charging "
-        "automatically, Stripe will attempt to pay this subscription at the end of the "
-        "cycle using the default source attached to the customer. "
-        "When sending an invoice, Stripe will email your customer an invoice with "
-        "payment instructions.",
+        help_text=(
+            "Either `charge_automatically`, or `send_invoice`. When charging"
+            " automatically, Stripe will attempt to pay this subscription at the end of"
+            " the cycle using the default source attached to the customer. When sending"
+            " an invoice, Stripe will email your customer an invoice with payment"
+            " instructions."
+        ),
     )
     current_period_end = StripeDateTimeField(
-        help_text="End of the current period for which the subscription has been "
-        "invoiced. At the end of this period, a new invoice will be created."
+        help_text=(
+            "End of the current period for which the subscription has been "
+            "invoiced. At the end of this period, a new invoice will be created."
+        )
     )
     current_period_start = StripeDateTimeField(
-        help_text="Start of the current period for which the subscription has "
-        "been invoiced."
+        help_text=(
+            "Start of the current period for which the subscription has been invoiced."
+        )
     )
     customer = StripeForeignKey(
         "Customer",
         on_delete=models.CASCADE,
         related_name="subscriptions",
         help_text="The customer associated with this subscription.",
     )
     days_until_due = models.IntegerField(
         null=True,
         blank=True,
-        help_text="Number of days a customer has to pay invoices generated by this "
-        "subscription. This value will be `null` for subscriptions where "
-        "`billing=charge_automatically`.",
+        help_text=(
+            "Number of days a customer has to pay invoices generated by this "
+            "subscription. This value will be `null` for subscriptions where "
+            "`billing=charge_automatically`."
+        ),
     )
     default_payment_method = StripeForeignKey(
         "PaymentMethod",
         null=True,
         blank=True,
         on_delete=models.SET_NULL,
         related_name="+",
-        help_text="The default payment method for the subscription. "
-        "It must belong to the customer associated with the subscription. "
-        "If not set, invoices will use the default payment method in the "
-        "customer's invoice settings.",
+        help_text=(
+            "The default payment method for the subscription. "
+            "It must belong to the customer associated with the subscription. "
+            "If not set, invoices will use the default payment method in the "
+            "customer's invoice settings."
+        ),
     )
     default_source = PaymentMethodForeignKey(
         on_delete=models.SET_NULL,
         null=True,
         blank=True,
         related_name="subscriptions",
-        help_text="The default payment source for the subscription. "
-        "It must belong to the customer associated with the subscription "
-        "and be in a chargeable state. If not set, defaults to the customer's "
-        "default source.",
+        help_text=(
+            "The default payment source for the subscription. "
+            "It must belong to the customer associated with the subscription "
+            "and be in a chargeable state. If not set, defaults to the customer's "
+            "default source."
+        ),
     )
     default_tax_rates = models.ManyToManyField(
         "TaxRate",
         # explicitly specify the joining table name as though the joining model
         # was defined with through="DjstripeSubscriptionDefaultTaxRate"
         db_table="djstripe_djstripesubscriptiondefaulttaxrate",
         related_name="+",
         blank=True,
-        help_text="The tax rates that will apply to any subscription item "
-        "that does not have tax_rates set. Invoices created will have their "
-        "default_tax_rates populated from the subscription.",
+        help_text=(
+            "The tax rates that will apply to any subscription item "
+            "that does not have tax_rates set. Invoices created will have their "
+            "default_tax_rates populated from the subscription."
+        ),
     )
     discount = JSONField(
         null=True,
         blank=True,
-        help_text="Describes the current discount applied to this subscription, if there is one. When billing, a discount applied to a subscription overrides a discount applied on a customer-wide basis.",
+        help_text=(
+            "Describes the current discount applied to this subscription, if there is"
+            " one. When billing, a discount applied to a subscription overrides a"
+            " discount applied on a customer-wide basis."
+        ),
     )
     ended_at = StripeDateTimeField(
         null=True,
         blank=True,
-        help_text="If the subscription has ended (either because it was canceled or "
-        "because the customer was switched to a subscription to a new plan), "
-        "the date the subscription ended.",
+        help_text=(
+            "If the subscription has ended (either because it was canceled or "
+            "because the customer was switched to a subscription to a new plan), "
+            "the date the subscription ended."
+        ),
     )
     latest_invoice = StripeForeignKey(
         "Invoice",
         null=True,
         blank=True,
         related_name="+",
         on_delete=models.SET_NULL,
         help_text="The most recent invoice this subscription has generated.",
     )
     next_pending_invoice_item_invoice = StripeDateTimeField(
         null=True,
         blank=True,
-        help_text="Specifies the approximate timestamp on which any pending "
-        "invoice items will be billed according to the schedule provided at "
-        "pending_invoice_item_interval.",
+        help_text=(
+            "Specifies the approximate timestamp on which any pending "
+            "invoice items will be billed according to the schedule provided at "
+            "pending_invoice_item_interval."
+        ),
     )
     pause_collection = JSONField(
         null=True,
         blank=True,
-        help_text="If specified, payment collection for this subscription will be paused.",
+        help_text=(
+            "If specified, payment collection for this subscription will be paused."
+        ),
     )
     pending_invoice_item_interval = JSONField(
         null=True,
         blank=True,
-        help_text="Specifies an interval for how often to bill for any "
-        "pending invoice items. It is analogous to calling Create an invoice "
-        "for the given subscription at the specified interval.",
+        help_text=(
+            "Specifies an interval for how often to bill for any "
+            "pending invoice items. It is analogous to calling Create an invoice "
+            "for the given subscription at the specified interval."
+        ),
     )
     pending_setup_intent = StripeForeignKey(
         "SetupIntent",
         null=True,
         blank=True,
         on_delete=models.CASCADE,
         related_name="setup_intents",
-        help_text="We can use this SetupIntent to collect user authentication "
-        "when creating a subscription without immediate payment or updating a "
-        "subscription's payment method, allowing you to "
-        "optimize for off-session payments.",
+        help_text=(
+            "We can use this SetupIntent to collect user authentication "
+            "when creating a subscription without immediate payment or updating a "
+            "subscription's payment method, allowing you to "
+            "optimize for off-session payments."
+        ),
     )
     pending_update = JSONField(
         null=True,
         blank=True,
-        help_text="If specified, pending updates that will be applied to the "
-        "subscription once the latest_invoice has been paid.",
+        help_text=(
+            "If specified, pending updates that will be applied to the "
+            "subscription once the latest_invoice has been paid."
+        ),
     )
     plan = models.ForeignKey(
         "Plan",
         null=True,
         blank=True,
         on_delete=models.CASCADE,
         related_name="subscriptions",
-        help_text="The plan associated with this subscription. This value will be "
-        "`null` for multi-plan subscriptions",
+        help_text=(
+            "The plan associated with this subscription. This value will be "
+            "`null` for multi-plan subscriptions"
+        ),
     )
     proration_behavior = StripeEnumField(
         enum=enums.SubscriptionProrationBehavior,
-        help_text="Determines how to handle prorations when the billing cycle changes (e.g., when switching plans, resetting billing_cycle_anchor=now, or starting a trial), or if an items quantity changes",
+        help_text=(
+            "Determines how to handle prorations when the billing cycle changes (e.g.,"
+            " when switching plans, resetting billing_cycle_anchor=now, or starting a"
+            " trial), or if an items quantity changes"
+        ),
         default=enums.SubscriptionProrationBehavior.create_prorations,
         blank=True,
     )
     proration_date = StripeDateTimeField(
         null=True,
         blank=True,
-        help_text="If set, the proration will be calculated as though the subscription was updated at the given time. This can be used to apply exactly the same proration that was previewed with upcoming invoice endpoint. It can also be used to implement custom proration logic, such as prorating by day instead of by second, by providing the time that you wish to use for proration calculations",
+        help_text=(
+            "If set, the proration will be calculated as though the subscription was"
+            " updated at the given time. This can be used to apply exactly the same"
+            " proration that was previewed with upcoming invoice endpoint. It can also"
+            " be used to implement custom proration logic, such as prorating by day"
+            " instead of by second, by providing the time that you wish to use for"
+            " proration calculations"
+        ),
     )
     quantity = models.IntegerField(
         null=True,
         blank=True,
-        help_text="The quantity applied to this subscription. This value will be "
-        "`null` for multi-plan subscriptions",
+        help_text=(
+            "The quantity applied to this subscription. This value will be "
+            "`null` for multi-plan subscriptions"
+        ),
     )
     schedule = models.ForeignKey(
         "SubscriptionSchedule",
         null=True,
         blank=True,
         on_delete=models.CASCADE,
         related_name="subscriptions",
         help_text="The schedule associated with this subscription.",
     )
     start_date = StripeDateTimeField(
         null=True,
         blank=True,
-        help_text="Date when the subscription was first created. The date "
-        "might differ from the created date due to backdating.",
+        help_text=(
+            "Date when the subscription was first created. The date "
+            "might differ from the created date due to backdating."
+        ),
     )
     status = StripeEnumField(
         enum=enums.SubscriptionStatus, help_text="The status of this subscription."
     )
     trial_end = StripeDateTimeField(
         null=True,
         blank=True,
@@ -1515,48 +2001,31 @@
         null=True,
         blank=True,
         help_text="If the subscription has a trial, the beginning of that trial.",
     )
 
     objects = SubscriptionManager()
 
-    def __str__(self):
-
-        subscriptions_lst = self.customer._get_valid_subscriptions()
-        products_lst = [
-            subscription.plan.product.name
-            for subscription in subscriptions_lst
-            if subscription and subscription.plan and subscription.plan.product
-        ]
-
-        return f"{self.customer} on {' and '.join(products_lst)}"
-
     @classmethod
     def api_list(cls, api_key=djstripe_settings.STRIPE_SECRET_KEY, **kwargs):
         """
         Call the stripe API's list operation for this model.
         :param api_key: The api key to use for this request. \
             Defaults to djstripe_settings.STRIPE_SECRET_KEY.
         :type api_key: string
         See Stripe documentation for accepted kwargs for each object.
         :returns: an iterator over all items in the query
         """
         if not kwargs.get("status"):
             # special case: https://stripe.com/docs/api/subscriptions/list#list_subscriptions-status
             # See Issue: https://github.com/dj-stripe/dj-stripe/issues/1763
             kwargs["status"] = "all"
-
         return super().api_list(api_key=api_key, **kwargs)
 
-    def update(
-        self,
-        plan: Union[StripeModel, str] = None,
-        prorate: bool = None,
-        **kwargs,
-    ):
+    def update(self, plan: Union[StripeModel, str] = None, **kwargs):
         """
         See `Customer.subscribe() <#djstripe.models.Customer.subscribe>`__
 
         :param plan: The plan to which to subscribe the customer.
         :type plan: Plan or string (plan ID)
 
         .. important:: Updating a subscription by changing the plan or quantity \
@@ -1564,61 +2033,14 @@
             Stripe (and dj-stripe).
         """
 
         # Convert Plan to id
         if plan is not None and isinstance(plan, StripeModel):
             plan = plan.id
 
-        # In short: We used to have a `prorate` argument which defaulted to
-        # a DJSTRIPE_PRORATION_POLICY setting.
-        # This is overly complex and specific, so we are dropping support for this.
-        # To override it, you can pass `proration_behavior`.
-        # If instead you pass `prorate`, we will transform it until dj-stripe 2.8.
-        # If you have DJSTRIPE_PRORATION_POLICY set, we will default to it for now.
-        # In 2.8, we will ignore both of those and let Stripe figure it out.
-        # Stripe's default proration policy is specified here:
-        # https://stripe.com/docs/billing/subscriptions/prorations
-        if "proration_behavior" not in kwargs:
-            if prorate is not None:
-                warnings.warn(
-                    "The `prorate` parameter to Subscription.update() is deprecated "
-                    "by Stripe. Use `proration_behavior` instead.\n"
-                    "Read more: "
-                    "https://stripe.com/docs/billing/subscriptions/prorations",
-                    DeprecationWarning,
-                )
-            elif kwargs.get("subscription_prorate") is not None:
-                warnings.warn(
-                    "The `subscription_prorate` parameter to Subscription.update() is deprecated "
-                    "by Stripe. Use `proration_behavior` instead.\n"
-                    "Read more: "
-                    "https://stripe.com/docs/billing/subscriptions/prorations",
-                    DeprecationWarning,
-                )
-
-            else:
-                prorate = djstripe_settings.PRORATION_POLICY
-                if prorate is not None:
-                    warnings.warn(
-                        "The `DJSTRIPE_PRORATION_POLICY` setting is deprecated and will "
-                        "be ignored in dj-stripe 2.8. "
-                        "Specify `proration_behavior` instead."
-                    )
-                else:
-                    prorate = False
-
-            if prorate:
-                kwargs.setdefault("proration_behavior", "create_prorations")
-            else:
-                kwargs.setdefault("proration_behavior", "none")
-        elif prorate is not None:
-            raise TypeError(
-                "`prorate` argument must not be set when `proration_behavior` is specified"
-            )
-
         stripe_subscription = self._api_update(plan=plan, **kwargs)
 
         api_key = kwargs.get("api_key") or self.default_api_key
         return Subscription.sync_from_stripe_data(stripe_subscription, api_key=api_key)
 
     def extend(self, delta):
         """
@@ -1799,16 +2221,18 @@
     """
 
     stripe_class = stripe.SubscriptionItem
 
     billing_thresholds = JSONField(
         null=True,
         blank=True,
-        help_text="Define thresholds at which an invoice will be sent, and the "
-        "related subscription advanced to a new billing period.",
+        help_text=(
+            "Define thresholds at which an invoice will be sent, and the "
+            "related subscription advanced to a new billing period."
+        ),
     )
     plan = models.ForeignKey(
         "Plan",
         on_delete=models.CASCADE,
         related_name="subscription_items",
         help_text="The plan the customer is subscribed to.",
     )
@@ -1818,22 +2242,33 @@
         blank=True,
         on_delete=models.CASCADE,
         related_name="subscription_items",
         help_text="The price the customer is subscribed to.",
     )
     proration_behavior = StripeEnumField(
         enum=enums.SubscriptionProrationBehavior,
-        help_text="Determines how to handle prorations when the billing cycle changes (e.g., when switching plans, resetting billing_cycle_anchor=now, or starting a trial), or if an items quantity changes",
+        help_text=(
+            "Determines how to handle prorations when the billing cycle changes (e.g.,"
+            " when switching plans, resetting billing_cycle_anchor=now, or starting a"
+            " trial), or if an items quantity changes"
+        ),
         default=enums.SubscriptionProrationBehavior.create_prorations,
         blank=True,
     )
     proration_date = StripeDateTimeField(
         null=True,
         blank=True,
-        help_text="If set, the proration will be calculated as though the subscription was updated at the given time. This can be used to apply exactly the same proration that was previewed with upcoming invoice endpoint. It can also be used to implement custom proration logic, such as prorating by day instead of by second, by providing the time that you wish to use for proration calculations",
+        help_text=(
+            "If set, the proration will be calculated as though the subscription was"
+            " updated at the given time. This can be used to apply exactly the same"
+            " proration that was previewed with upcoming invoice endpoint. It can also"
+            " be used to implement custom proration logic, such as prorating by day"
+            " instead of by second, by providing the time that you wish to use for"
+            " proration calculations"
+        ),
     )
     quantity = models.PositiveIntegerField(
         null=True,
         blank=True,
         help_text=(
             "The quantity of the plan to which the customer should be subscribed."
         ),
@@ -1847,17 +2282,19 @@
     tax_rates = models.ManyToManyField(
         "TaxRate",
         # explicitly specify the joining table name as though the joining model
         # was defined with through="DjstripeSubscriptionItemTaxRate"
         db_table="djstripe_djstripesubscriptionitemtaxrate",
         related_name="+",
         blank=True,
-        help_text="The tax rates which apply to this subscription_item. When set, "
-        "the default_tax_rates on the subscription do not apply to this "
-        "subscription_item.",
+        help_text=(
+            "The tax rates which apply to this subscription_item. When set, "
+            "the default_tax_rates on the subscription do not apply to this "
+            "subscription_item."
+        ),
     )
 
     def _attach_objects_post_save_hook(
         self,
         cls,
         data,
         api_key=djstripe_settings.STRIPE_SECRET_KEY,
@@ -1894,32 +2331,36 @@
         null=True,
         blank=True,
         help_text="Time at which the subscription schedule was completed.",
     )
     current_phase = JSONField(
         null=True,
         blank=True,
-        help_text="Object representing the start and end dates for the "
-        "current phase of the subscription schedule, if it is `active`.",
+        help_text=(
+            "Object representing the start and end dates for the "
+            "current phase of the subscription schedule, if it is `active`."
+        ),
     )
     customer = models.ForeignKey(
         "Customer",
         on_delete=models.CASCADE,
         related_name="schedules",
         help_text="The customer who owns the subscription schedule.",
     )
     default_settings = JSONField(
         null=True,
         blank=True,
         help_text="Object representing the subscription schedule's default settings.",
     )
     end_behavior = StripeEnumField(
         enum=enums.SubscriptionScheduleEndBehavior,
-        help_text="Behavior of the subscription schedule and underlying "
-        "subscription when it ends.",
+        help_text=(
+            "Behavior of the subscription schedule and underlying "
+            "subscription when it ends."
+        ),
     )
     phases = JSONField(
         null=True,
         blank=True,
         help_text="Configuration for the subscription schedule's phases.",
     )
     released_at = StripeDateTimeField(
@@ -1929,22 +2370,26 @@
     )
     released_subscription = models.ForeignKey(
         "Subscription",
         null=True,
         blank=True,
         on_delete=models.SET_NULL,
         related_name="released_schedules",
-        help_text="The subscription once managed by this subscription schedule "
-        "(if it is released).",
+        help_text=(
+            "The subscription once managed by this subscription schedule "
+            "(if it is released)."
+        ),
     )
     status = StripeEnumField(
         enum=enums.SubscriptionScheduleStatus,
-        help_text="The present status of the subscription schedule. Possible "
-        "values are `not_started`, `active`, `completed`, `released`, and "
-        "`canceled`.",
+        help_text=(
+            "The present status of the subscription schedule. Possible "
+            "values are `not_started`, `active`, `completed`, `released`, and "
+            "`canceled`."
+        ),
     )
     subscription = models.ForeignKey(
         "Subscription",
         null=True,
         blank=True,
         on_delete=models.SET_NULL,
         related_name="subscriptions",
@@ -1970,15 +2415,19 @@
 
         api_key = api_key or self.default_api_key
         # Prefer passed in stripe_account if set.
         if not stripe_account:
             stripe_account = self._get_stripe_account_id(api_key)
 
         stripe_subscription_schedule = self.stripe_class.release(
-            self.id, api_key=api_key, stripe_account=stripe_account, **kwargs
+            self.id,
+            api_key=api_key,
+            stripe_account=stripe_account,
+            stripe_version=djstripe_settings.STRIPE_API_VERSION,
+            **kwargs,
         )
 
         return SubscriptionSchedule.sync_from_stripe_data(stripe_subscription_schedule)
 
     def cancel(self, api_key=None, stripe_account=None, **kwargs):
         """
         Cancels a subscription schedule and its associated subscription immediately
@@ -1994,15 +2443,19 @@
 
         api_key = api_key or self.default_api_key
         # Prefer passed in stripe_account if set.
         if not stripe_account:
             stripe_account = self._get_stripe_account_id(api_key)
 
         stripe_subscription_schedule = self.stripe_class.cancel(
-            self.id, api_key=api_key, stripe_account=stripe_account, **kwargs
+            self.id,
+            api_key=api_key,
+            stripe_account=stripe_account,
+            stripe_version=djstripe_settings.STRIPE_API_VERSION,
+            **kwargs,
         )
 
         return SubscriptionSchedule.sync_from_stripe_data(stripe_subscription_schedule)
 
     def update(self, api_key=None, stripe_account=None, **kwargs):
         """
         Updates an existing subscription schedule
@@ -2031,41 +2484,54 @@
 
     stripe_class = stripe.ShippingRate
     stripe_dashboard_item_name = "shipping-rates"
     description = None
 
     active = models.BooleanField(
         default=True,
-        help_text="Whether the shipping rate can be used for new purchases. Defaults to true",
+        help_text=(
+            "Whether the shipping rate can be used for new purchases. Defaults to true"
+        ),
     )
     display_name = models.CharField(
         max_length=50,
         default="",
         blank=True,
-        help_text="The name of the shipping rate, meant to be displayable to the customer. This will appear on CheckoutSessions.",
+        help_text=(
+            "The name of the shipping rate, meant to be displayable to the customer."
+            " This will appear on CheckoutSessions."
+        ),
     )
     fixed_amount = JSONField(
-        help_text="Describes a fixed amount to charge for shipping. Must be present if type is fixed_amount",
+        help_text=(
+            "Describes a fixed amount to charge for shipping. Must be present if type"
+            " is fixed_amount"
+        ),
     )
     type = StripeEnumField(
         enum=enums.ShippingRateType,
         default=enums.ShippingRateType.fixed_amount,
         help_text=_(
-            "The type of calculation to use on the shipping rate. Can only be fixed_amount for now."
+            "The type of calculation to use on the shipping rate. Can only be"
+            " fixed_amount for now."
         ),
     )
     delivery_estimate = JSONField(
         null=True,
         blank=True,
-        help_text="The estimated range for how long shipping will take, meant to be displayable to the customer. This will appear on CheckoutSessions.",
+        help_text=(
+            "The estimated range for how long shipping will take, meant to be"
+            " displayable to the customer. This will appear on CheckoutSessions."
+        ),
     )
     tax_behavior = StripeEnumField(
         enum=enums.ShippingRateTaxBehavior,
         help_text=_(
-            "Specifies whether the rate is considered inclusive of taxes or exclusive of taxes."
+            "Specifies whether the rate is considered inclusive of taxes or exclusive"
+            " of taxes."
         ),
     )
     tax_code = StripeForeignKey(
         "TaxCode",
         null=True,
         blank=True,
         on_delete=models.CASCADE,
@@ -2183,28 +2649,31 @@
 
         return stripe.Customer.retrieve_tax_id(
             id=id,
             nested_id=nested_id,
             api_key=api_key or self.default_api_key,
             expand=self.expand_fields,
             stripe_account=stripe_account,
+            stripe_version=djstripe_settings.STRIPE_API_VERSION,
         )
 
     @classmethod
     def api_list(cls, api_key=djstripe_settings.STRIPE_SECRET_KEY, **kwargs):
         """
         Call the stripe API's list operation for this model.
         :param api_key: The api key to use for this request. \
             Defaults to djstripe_settings.STRIPE_SECRET_KEY.
         :type api_key: string
         See Stripe documentation for accepted kwargs for each object.
         :returns: an iterator over all items in the query
         """
         return stripe.Customer.list_tax_ids(
-            api_key=api_key, **kwargs
+            api_key=api_key,
+            stripe_version=djstripe_settings.STRIPE_API_VERSION,
+            **kwargs,
         ).auto_paging_iter()
 
 
 class TaxRate(StripeModel):
     """
     Tax rates can be applied to invoices and subscriptions to collect tax.
 
@@ -2212,30 +2681,34 @@
     """
 
     stripe_class = stripe.TaxRate
     stripe_dashboard_item_name = "tax-rates"
 
     active = models.BooleanField(
         default=True,
-        help_text="Defaults to true. When set to false, this tax rate cannot be "
-        "applied to objects in the API, but will still be applied to subscriptions "
-        "and invoices that already have it set.",
+        help_text=(
+            "Defaults to true. When set to false, this tax rate cannot be "
+            "applied to objects in the API, but will still be applied to subscriptions "
+            "and invoices that already have it set."
+        ),
     )
     country = models.CharField(
         max_length=2,
         default="",
         blank=True,
         help_text="Two-letter country code.",
     )
     display_name = models.CharField(
         max_length=50,
         default="",
         blank=True,
-        help_text="The display name of the tax rates as it will appear to your "
-        "customer on their receipt email, PDF, and the hosted invoice page.",
+        help_text=(
+            "The display name of the tax rates as it will appear to your "
+            "customer on their receipt email, PDF, and the hosted invoice page."
+        ),
     )
     inclusive = models.BooleanField(
         help_text="This specifies if the tax rate is inclusive or exclusive."
     )
     jurisdiction = models.CharField(
         max_length=50,
         default="",
@@ -2277,35 +2750,42 @@
 
     description = None
     metadata = None
 
     stripe_class = stripe.UsageRecord
 
     quantity = models.PositiveIntegerField(
-        help_text=(
-            "The quantity of the plan to which the customer should be subscribed."
-        )
+        help_text="The quantity of the plan to which the customer should be subscribed."
     )
     subscription_item = StripeForeignKey(
         "SubscriptionItem",
         on_delete=models.CASCADE,
         related_name="usage_records",
         help_text="The subscription item this usage record contains data for.",
     )
 
     timestamp = StripeDateTimeField(
         null=True,
         blank=True,
-        help_text="The timestamp for the usage event. This timestamp must be within the current billing period of the subscription of the provided subscription_item.",
+        help_text=(
+            "The timestamp for the usage event. This timestamp must be within the"
+            " current billing period of the subscription of the provided"
+            " subscription_item."
+        ),
     )
 
     action = StripeEnumField(
         enum=enums.UsageAction,
         default=enums.UsageAction.increment,
-        help_text="When using increment the specified quantity will be added to the usage at the specified timestamp. The set action will overwrite the usage quantity at that timestamp. If the subscription has billing thresholds, increment is the only allowed value.",
+        help_text=(
+            "When using increment the specified quantity will be added to the usage at"
+            " the specified timestamp. The set action will overwrite the usage quantity"
+            " at that timestamp. If the subscription has billing thresholds, increment"
+            " is the only allowed value."
+        ),
     )
 
     def __str__(self):
         return f"Usage for {self.subscription_item} ({self.action}) is {self.quantity}"
 
     @classmethod
     def _api_create(cls, api_key=djstripe_settings.STRIPE_SECRET_KEY, **kwargs):
@@ -2378,27 +2858,28 @@
     )
     period_start = StripeDateTimeField(
         null=True,
         blank=True,
         help_text="Start of the Subscription Billing period for the SubscriptionItem",
     )
     total_usage = models.PositiveIntegerField(
-        help_text=(
-            "The quantity of the plan to which the customer should be subscribed."
-        )
+        help_text="The quantity of the plan to which the customer should be subscribed."
     )
     subscription_item = StripeForeignKey(
         "SubscriptionItem",
         on_delete=models.CASCADE,
         related_name="usage_record_summaries",
         help_text="The subscription item this usage record contains data for.",
     )
 
     def __str__(self):
-        return f"Usage Summary for {self.subscription_item} ({self.invoice}) is {self.total_usage}"
+        return (
+            f"Usage Summary for {self.subscription_item} ({self.invoice}) is"
+            f" {self.total_usage}"
+        )
 
     @classmethod
     def _manipulate_stripe_object_hook(cls, data):
         data["period_start"] = data["period"]["start"]
         data["period_end"] = data["period"]["end"]
 
         return data
@@ -2421,9 +2902,11 @@
 
         try:
             SubscriptionItem.objects.get(id=kwargs["id"])
         except SubscriptionItem.DoesNotExist:
             raise
 
         return stripe.SubscriptionItem.list_usage_record_summaries(
-            api_key=api_key, **kwargs
+            api_key=api_key,
+            stripe_version=djstripe_settings.STRIPE_API_VERSION,
+            **kwargs,
         ).auto_paging_iter()
```

### Comparing `dj_stripe-2.7.3/djstripe/models/connect.py` & `dj_stripe-2.8.0a0/djstripe/models/connect.py`

 * *Files 4% similar despite different names*

```diff
@@ -35,24 +35,27 @@
         "Account",
         on_delete=models.PROTECT,
         related_name="application_fees",
         help_text="ID of the Stripe account this fee was taken from.",
     )
     amount = StripeQuantumCurrencyAmountField(help_text="Amount earned, in cents.")
     amount_refunded = StripeQuantumCurrencyAmountField(
-        help_text="Amount in cents refunded (can be less than the amount attribute "
-        "on the fee if a partial refund was issued)"
+        help_text=(
+            "Amount in cents refunded (can be less than the amount attribute "
+            "on the fee if a partial refund was issued)"
+        )
     )
     # TODO application = ...
     # balance_transaction exists on the platform account
     balance_transaction = StripeForeignKey(
         "BalanceTransaction",
         on_delete=models.CASCADE,
-        help_text="Balance transaction that describes the impact on your account"
-        " balance.",
+        help_text=(
+            "Balance transaction that describes the impact on your account balance."
+        ),
     )
     # charge exists on the Stripe Connected Account and not the Platform Account
     charge = StripeForeignKey(
         "Charge",
         on_delete=models.CASCADE,
         help_text="The charge that the application fee was taken from.",
     )
@@ -80,16 +83,17 @@
     description = None
     stripe_class = stripe.ApplicationFeeRefund
 
     amount = StripeQuantumCurrencyAmountField(help_text="Amount refunded, in cents.")
     balance_transaction = StripeForeignKey(
         "BalanceTransaction",
         on_delete=models.CASCADE,
-        help_text="Balance transaction that describes the impact on your account "
-        "balance.",
+        help_text=(
+            "Balance transaction that describes the impact on your account balance."
+        ),
     )
     currency = StripeCurrencyCodeField()
     fee = StripeForeignKey(
         "ApplicationFee",
         on_delete=models.CASCADE,
         related_name="refunds",
         help_text="The application fee that was refunded",
@@ -108,20 +112,22 @@
     default_currency = StripeCurrencyCodeField(
         help_text=(
             "The default currency for this country. "
             "This applies to both payment methods and bank accounts."
         )
     )
     supported_bank_account_currencies = JSONField(
-        help_text="Currencies that can be accepted in the specific country"
-        " (for transfers)."
+        help_text=(
+            "Currencies that can be accepted in the specific country (for transfers)."
+        )
     )
     supported_payment_currencies = JSONField(
-        help_text="Currencies that can be accepted in the specified country"
-        " (for payments)."
+        help_text=(
+            "Currencies that can be accepted in the specified country (for payments)."
+        )
     )
     supported_payment_methods = JSONField(
         help_text="Payment methods available in the specified country."
     )
     supported_transfer_countries = JSONField(
         help_text="Countries that can accept transfers from the specified country."
     )
@@ -163,14 +169,15 @@
     def api_retrieve(self, api_key: str = None, stripe_account=None):
         if api_key is None:
             api_key = djstripe_settings.get_default_api_key(livemode=None)
 
         return self.stripe_class.retrieve(
             id=self.id,
             api_key=api_key,
+            stripe_version=djstripe_settings.STRIPE_API_VERSION,
             stripe_account=stripe_account,
         )
 
 
 class Transfer(StripeModel):
     """
     When Stripe sends you money or you initiate a transfer to a bank account,
@@ -185,50 +192,61 @@
 
     objects = TransferManager()
 
     amount = StripeDecimalCurrencyAmountField(help_text="The amount transferred")
     amount_reversed = StripeDecimalCurrencyAmountField(
         null=True,
         blank=True,
-        help_text="The amount (as decimal) reversed (can be less than the amount "
-        "attribute on the transfer if a partial reversal was issued).",
+        help_text=(
+            "The amount (as decimal) reversed (can be less than the amount "
+            "attribute on the transfer if a partial reversal was issued)."
+        ),
     )
     balance_transaction = StripeForeignKey(
         "BalanceTransaction",
         on_delete=models.SET_NULL,
         null=True,
         blank=True,
-        help_text="Balance transaction that describes the impact on your account"
-        " balance.",
+        help_text=(
+            "Balance transaction that describes the impact on your account balance."
+        ),
     )
     currency = StripeCurrencyCodeField()
 
     destination = StripeIdField(
         max_length=255,
         null=True,
-        help_text="ID of the bank account, card, or Stripe account the transfer was sent to.",
+        help_text=(
+            "ID of the bank account, card, or Stripe account the transfer was sent to."
+        ),
     )
 
     # todo implement payment model (for some reason py ids are showing up in the charge model)
     destination_payment = StripeIdField(
         null=True,
         blank=True,
-        help_text="If the destination is a Stripe account, this will be the ID of the "
-        "payment that the destination account received for the transfer.",
+        help_text=(
+            "If the destination is a Stripe account, this will be the ID of the "
+            "payment that the destination account received for the transfer."
+        ),
     )
     reversed = models.BooleanField(
         default=False,
-        help_text="Whether or not the transfer has been fully reversed. "
-        "If the transfer is only partially reversed, this attribute will still "
-        "be false.",
+        help_text=(
+            "Whether or not the transfer has been fully reversed. "
+            "If the transfer is only partially reversed, this attribute will still "
+            "be false."
+        ),
     )
     source_transaction = StripeIdField(
         null=True,
-        help_text="ID of the charge (or other transaction) that was used to fund "
-        "the transfer. If null, the transfer was funded from the available balance.",
+        help_text=(
+            "ID of the charge (or other transaction) that was used to fund "
+            "the transfer. If null, the transfer was funded from the available balance."
+        ),
     )
     source_type = StripeEnumField(
         enum=enums.LegacySourceType,
         help_text="The source balance from which this transfer came.",
     )
     transfer_group = models.CharField(
         max_length=255,
@@ -296,16 +314,17 @@
     amount = StripeQuantumCurrencyAmountField(help_text="Amount, in cents.")
     balance_transaction = StripeForeignKey(
         "BalanceTransaction",
         on_delete=models.SET_NULL,
         null=True,
         blank=True,
         related_name="transfer_reversals",
-        help_text="Balance transaction that describes the impact on your account "
-        "balance.",
+        help_text=(
+            "Balance transaction that describes the impact on your account balance."
+        ),
     )
     currency = StripeCurrencyCodeField()
     transfer = StripeForeignKey(
         "Transfer",
         on_delete=models.CASCADE,
         help_text="The transfer that was reversed.",
         related_name="reversals",
@@ -327,15 +346,19 @@
             raise KeyError("Transfer Object ID is missing")
 
         try:
             Transfer.objects.get(id=kwargs["id"])
         except Transfer.DoesNotExist:
             raise
 
-        return stripe.Transfer.create_reversal(api_key=api_key, **kwargs)
+        return stripe.Transfer.create_reversal(
+            api_key=api_key,
+            stripe_version=djstripe_settings.STRIPE_API_VERSION,
+            **kwargs,
+        )
 
     def api_retrieve(self, api_key=None, stripe_account=None):
         """
         Call the stripe API's retrieve operation for this model.
         :param api_key: The api key to use for this request. \
             Defaults to djstripe_settings.STRIPE_SECRET_KEY.
         :type api_key: string
@@ -350,14 +373,15 @@
         if not stripe_account:
             stripe_account = self._get_stripe_account_id(api_key)
 
         return stripe.Transfer.retrieve_reversal(
             id=id,
             nested_id=nested_id,
             api_key=api_key or self.default_api_key,
+            stripe_version=djstripe_settings.STRIPE_API_VERSION,
             expand=self.expand_fields,
             stripe_account=stripe_account,
         )
 
     @classmethod
     def api_list(cls, api_key=djstripe_settings.STRIPE_SECRET_KEY, **kwargs):
         """
@@ -365,15 +389,17 @@
         :param api_key: The api key to use for this request. \
             Defaults to djstripe_settings.STRIPE_SECRET_KEY.
         :type api_key: string
         See Stripe documentation for accepted kwargs for each object.
         :returns: an iterator over all items in the query
         """
         return stripe.Transfer.list_reversals(
-            api_key=api_key, **kwargs
+            api_key=api_key,
+            stripe_version=djstripe_settings.STRIPE_API_VERSION,
+            **kwargs,
         ).auto_paging_iter()
 
     @classmethod
     def is_valid_object(cls, data):
         """
         Returns whether the data is a valid object for the class
         """
```

### Comparing `dj_stripe-2.7.3/djstripe/models/core.py` & `dj_stripe-2.8.0a0/djstripe/models/core.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,5407 +1,5488 @@
-00000000: 696d 706f 7274 2077 6172 6e69 6e67 730a  import warnings.
-00000010: 6672 6f6d 2064 6563 696d 616c 2069 6d70  from decimal imp
-00000020: 6f72 7420 4465 6369 6d61 6c0a 6672 6f6d  ort Decimal.from
-00000030: 2074 7970 696e 6720 696d 706f 7274 204f   typing import O
-00000040: 7074 696f 6e61 6c2c 2055 6e69 6f6e 0a0a  ptional, Union..
-00000050: 696d 706f 7274 2073 7472 6970 650a 6672  import stripe.fr
-00000060: 6f6d 2064 6a61 6e67 6f2e 6170 7073 2069  om django.apps i
-00000070: 6d70 6f72 7420 6170 7073 0a66 726f 6d20  mport apps.from 
-00000080: 646a 616e 676f 2e64 6220 696d 706f 7274  django.db import
-00000090: 206d 6f64 656c 732c 2074 7261 6e73 6163   models, transac
-000000a0: 7469 6f6e 0a66 726f 6d20 646a 616e 676f  tion.from django
-000000b0: 2e75 7469 6c73 2069 6d70 6f72 7420 7469  .utils import ti
-000000c0: 6d65 7a6f 6e65 0a66 726f 6d20 646a 616e  mezone.from djan
-000000d0: 676f 2e75 7469 6c73 2e66 756e 6374 696f  go.utils.functio
-000000e0: 6e61 6c20 696d 706f 7274 2063 6163 6865  nal import cache
-000000f0: 645f 7072 6f70 6572 7479 0a66 726f 6d20  d_property.from 
-00000100: 646a 616e 676f 2e75 7469 6c73 2e74 6578  django.utils.tex
-00000110: 7420 696d 706f 7274 2066 6f72 6d61 745f  t import format_
-00000120: 6c61 7a79 0a66 726f 6d20 646a 616e 676f  lazy.from django
-00000130: 2e75 7469 6c73 2e74 7261 6e73 6c61 7469  .utils.translati
-00000140: 6f6e 2069 6d70 6f72 7420 6765 7474 6578  on import gettex
-00000150: 745f 6c61 7a79 2061 7320 5f0a 6672 6f6d  t_lazy as _.from
-00000160: 2073 7472 6970 652e 6572 726f 7220 696d   stripe.error im
-00000170: 706f 7274 2049 6e76 616c 6964 5265 7175  port InvalidRequ
-00000180: 6573 7445 7272 6f72 0a0a 6672 6f6d 202e  estError..from .
-00000190: 2e20 696d 706f 7274 2065 6e75 6d73 2c20  . import enums, 
-000001a0: 7765 6268 6f6f 6b73 0a66 726f 6d20 2e2e  webhooks.from ..
-000001b0: 6578 6365 7074 696f 6e73 2069 6d70 6f72  exceptions impor
-000001c0: 7420 4d75 6c74 6970 6c65 5375 6273 6372  t MultipleSubscr
-000001d0: 6970 7469 6f6e 4578 6365 7074 696f 6e0a  iptionException.
-000001e0: 6672 6f6d 202e 2e66 6965 6c64 7320 696d  from ..fields im
-000001f0: 706f 7274 2028 0a20 2020 204a 534f 4e46  port (.    JSONF
-00000200: 6965 6c64 2c0a 2020 2020 5061 796d 656e  ield,.    Paymen
-00000210: 744d 6574 686f 6446 6f72 6569 676e 4b65  tMethodForeignKe
-00000220: 792c 0a20 2020 2053 7472 6970 6543 7572  y,.    StripeCur
-00000230: 7265 6e63 7943 6f64 6546 6965 6c64 2c0a  rencyCodeField,.
-00000240: 2020 2020 5374 7269 7065 4461 7465 5469      StripeDateTi
-00000250: 6d65 4669 656c 642c 0a20 2020 2053 7472  meField,.    Str
-00000260: 6970 6544 6563 696d 616c 4375 7272 656e  ipeDecimalCurren
-00000270: 6379 416d 6f75 6e74 4669 656c 642c 0a20  cyAmountField,. 
-00000280: 2020 2053 7472 6970 6545 6e75 6d46 6965     StripeEnumFie
-00000290: 6c64 2c0a 2020 2020 5374 7269 7065 466f  ld,.    StripeFo
-000002a0: 7265 6967 6e4b 6579 2c0a 2020 2020 5374  reignKey,.    St
-000002b0: 7269 7065 4964 4669 656c 642c 0a20 2020  ripeIdField,.   
-000002c0: 2053 7472 6970 6551 7561 6e74 756d 4375   StripeQuantumCu
-000002d0: 7272 656e 6379 416d 6f75 6e74 4669 656c  rrencyAmountFiel
-000002e0: 642c 0a29 0a66 726f 6d20 2e2e 6d61 6e61  d,.).from ..mana
-000002f0: 6765 7273 2069 6d70 6f72 7420 4368 6172  gers import Char
-00000300: 6765 4d61 6e61 6765 720a 6672 6f6d 202e  geManager.from .
-00000310: 2e73 6574 7469 6e67 7320 696d 706f 7274  .settings import
-00000320: 2064 6a73 7472 6970 655f 7365 7474 696e   djstripe_settin
-00000330: 6773 0a66 726f 6d20 2e2e 7369 676e 616c  gs.from ..signal
-00000340: 7320 696d 706f 7274 2057 4542 484f 4f4b  s import WEBHOOK
-00000350: 5f53 4947 4e41 4c53 0a66 726f 6d20 2e2e  _SIGNALS.from ..
-00000360: 7574 696c 7320 696d 706f 7274 2067 6574  utils import get
-00000370: 5f66 7269 656e 646c 795f 6375 7272 656e  _friendly_curren
-00000380: 6379 5f61 6d6f 756e 740a 6672 6f6d 202e  cy_amount.from .
-00000390: 6261 7365 2069 6d70 6f72 7420 4964 656d  base import Idem
-000003a0: 706f 7465 6e63 794b 6579 2c20 5374 7269  potencyKey, Stri
-000003b0: 7065 4d6f 6465 6c2c 206c 6f67 6765 720a  peModel, logger.
-000003c0: 0a23 204f 7665 7272 6964 6520 7468 6520  .# Override the 
-000003d0: 6465 6661 756c 7420 4150 4920 7665 7273  default API vers
-000003e0: 696f 6e20 7573 6564 2062 7920 7468 6520  ion used by the 
-000003f0: 5374 7269 7065 206c 6962 7261 7279 2e0a  Stripe library..
-00000400: 646a 7374 7269 7065 5f73 6574 7469 6e67  djstripe_setting
-00000410: 732e 7365 745f 7374 7269 7065 5f61 7069  s.set_stripe_api
-00000420: 5f76 6572 7369 6f6e 2829 0a0a 0a64 6566  _version()...def
-00000430: 205f 7361 6e69 7469 7365 5f70 7269 6365   _sanitise_price
-00000440: 2870 7269 6365 3d4e 6f6e 652c 2070 6c61  (price=None, pla
-00000450: 6e3d 4e6f 6e65 2c20 2a2a 6b77 6172 6773  n=None, **kwargs
-00000460: 293a 0a20 2020 2022 2222 0a20 2020 2048  ):.    """.    H
-00000470: 656c 7065 7220 666f 7220 4375 7374 6f6d  elper for Custom
-00000480: 6572 2e73 7562 7363 7269 6265 2829 0a20  er.subscribe(). 
-00000490: 2020 2022 2222 0a0a 2020 2020 6966 2070     """..    if p
-000004a0: 7269 6365 2061 6e64 2070 6c61 6e3a 0a20  rice and plan:. 
-000004b0: 2020 2020 2020 2072 6169 7365 2054 7970         raise Typ
-000004c0: 6545 7272 6f72 2822 7072 6963 6520 616e  eError("price an
-000004d0: 6420 706c 616e 2061 7267 756d 656e 7473  d plan arguments
-000004e0: 2063 616e 6e6f 7420 626f 7468 2062 6520   cannot both be 
-000004f0: 6465 6669 6e65 642e 2229 0a0a 2020 2020  defined.")..    
-00000500: 7072 6963 6520 3d20 7072 6963 6520 6f72  price = price or
-00000510: 2070 6c61 6e0a 0a20 2020 2069 6620 6e6f   plan..    if no
-00000520: 7420 7072 6963 653a 0a20 2020 2020 2020  t price:.       
-00000530: 2072 6169 7365 2054 7970 6545 7272 6f72   raise TypeError
-00000540: 2822 796f 7520 6e65 6564 2074 6f20 7365  ("you need to se
-00000550: 7420 6569 7468 6572 2070 7269 6365 206f  t either price o
-00000560: 7220 706c 616e 2229 0a0a 2020 2020 2320  r plan")..    # 
-00000570: 436f 6e76 6572 7420 5072 6963 6520 746f  Convert Price to
-00000580: 2069 640a 2020 2020 6966 2069 7369 6e73   id.    if isins
-00000590: 7461 6e63 6528 7072 6963 652c 2053 7472  tance(price, Str
-000005a0: 6970 654d 6f64 656c 293a 0a20 2020 2020  ipeModel):.     
-000005b0: 2020 2070 7269 6365 203d 2070 7269 6365     price = price
-000005c0: 2e69 640a 0a20 2020 2072 6574 7572 6e20  .id..    return 
-000005d0: 7072 6963 652c 206b 7761 7267 730a 0a0a  price, kwargs...
-000005e0: 636c 6173 7320 4261 6c61 6e63 6554 7261  class BalanceTra
-000005f0: 6e73 6163 7469 6f6e 2853 7472 6970 654d  nsaction(StripeM
-00000600: 6f64 656c 293a 0a20 2020 2022 2222 0a20  odel):.    """. 
-00000610: 2020 2041 2073 696e 676c 6520 7472 616e     A single tran
-00000620: 7361 6374 696f 6e20 7468 6174 2075 7064  saction that upd
-00000630: 6174 6573 2074 6865 2053 7472 6970 6520  ates the Stripe 
-00000640: 6261 6c61 6e63 652e 0a0a 2020 2020 5374  balance...    St
-00000650: 7269 7065 2064 6f63 756d 656e 7461 7469  ripe documentati
-00000660: 6f6e 3a20 6874 7470 733a 2f2f 7374 7269  on: https://stri
-00000670: 7065 2e63 6f6d 2f64 6f63 732f 6170 693f  pe.com/docs/api?
-00000680: 6c61 6e67 3d70 7974 686f 6e23 6261 6c61  lang=python#bala
-00000690: 6e63 655f 7472 616e 7361 6374 696f 6e5f  nce_transaction_
-000006a0: 6f62 6a65 6374 0a20 2020 2022 2222 0a0a  object.    """..
-000006b0: 2020 2020 7374 7269 7065 5f63 6c61 7373      stripe_class
-000006c0: 203d 2073 7472 6970 652e 4261 6c61 6e63   = stripe.Balanc
-000006d0: 6554 7261 6e73 6163 7469 6f6e 0a0a 2020  eTransaction..  
-000006e0: 2020 616d 6f75 6e74 203d 2053 7472 6970    amount = Strip
-000006f0: 6551 7561 6e74 756d 4375 7272 656e 6379  eQuantumCurrency
-00000700: 416d 6f75 6e74 4669 656c 6428 0a20 2020  AmountField(.   
-00000710: 2020 2020 2068 656c 705f 7465 7874 3d22       help_text="
-00000720: 4772 6f73 7320 616d 6f75 6e74 206f 6620  Gross amount of 
-00000730: 7468 6520 7472 616e 7361 6374 696f 6e2c  the transaction,
-00000740: 2069 6e20 6365 6e74 732e 220a 2020 2020   in cents.".    
-00000750: 290a 2020 2020 6176 6169 6c61 626c 655f  ).    available_
-00000760: 6f6e 203d 2053 7472 6970 6544 6174 6554  on = StripeDateT
-00000770: 696d 6546 6965 6c64 280a 2020 2020 2020  imeField(.      
-00000780: 2020 6865 6c70 5f74 6578 743d 280a 2020    help_text=(.  
-00000790: 2020 2020 2020 2020 2020 2254 6865 2064            "The d
-000007a0: 6174 6520 7468 6520 7472 616e 7361 6374  ate the transact
-000007b0: 696f 6e27 7320 6e65 7420 6675 6e64 7320  ion's net funds 
-000007c0: 220a 2020 2020 2020 2020 2020 2020 2277  ".            "w
-000007d0: 696c 6c20 6265 636f 6d65 2061 7661 696c  ill become avail
-000007e0: 6162 6c65 2069 6e20 7468 6520 5374 7269  able in the Stri
-000007f0: 7065 2062 616c 616e 6365 2e22 0a20 2020  pe balance.".   
-00000800: 2020 2020 2029 0a20 2020 2029 0a20 2020       ).    ).   
-00000810: 2063 7572 7265 6e63 7920 3d20 5374 7269   currency = Stri
-00000820: 7065 4375 7272 656e 6379 436f 6465 4669  peCurrencyCodeFi
-00000830: 656c 6428 290a 2020 2020 6578 6368 616e  eld().    exchan
-00000840: 6765 5f72 6174 6520 3d20 6d6f 6465 6c73  ge_rate = models
-00000850: 2e44 6563 696d 616c 4669 656c 6428 6e75  .DecimalField(nu
-00000860: 6c6c 3d54 7275 652c 2064 6563 696d 616c  ll=True, decimal
-00000870: 5f70 6c61 6365 733d 362c 206d 6178 5f64  _places=6, max_d
-00000880: 6967 6974 733d 3829 0a20 2020 2066 6565  igits=8).    fee
-00000890: 203d 2053 7472 6970 6551 7561 6e74 756d   = StripeQuantum
-000008a0: 4375 7272 656e 6379 416d 6f75 6e74 4669  CurrencyAmountFi
-000008b0: 656c 6428 0a20 2020 2020 2020 2068 656c  eld(.        hel
-000008c0: 705f 7465 7874 3d22 4665 6520 2869 6e20  p_text="Fee (in 
-000008d0: 6365 6e74 7329 2070 6169 6420 666f 7220  cents) paid for 
-000008e0: 7468 6973 2074 7261 6e73 6163 7469 6f6e  this transaction
-000008f0: 2e22 0a20 2020 2029 0a20 2020 2066 6565  .".    ).    fee
-00000900: 5f64 6574 6169 6c73 203d 204a 534f 4e46  _details = JSONF
-00000910: 6965 6c64 2829 0a20 2020 206e 6574 203d  ield().    net =
-00000920: 2053 7472 6970 6551 7561 6e74 756d 4375   StripeQuantumCu
-00000930: 7272 656e 6379 416d 6f75 6e74 4669 656c  rrencyAmountFiel
-00000940: 6428 0a20 2020 2020 2020 2068 656c 705f  d(.        help_
-00000950: 7465 7874 3d22 4e65 7420 616d 6f75 6e74  text="Net amount
-00000960: 206f 6620 7468 6520 7472 616e 7361 6374   of the transact
-00000970: 696f 6e2c 2069 6e20 6365 6e74 732e 220a  ion, in cents.".
-00000980: 2020 2020 290a 2020 2020 736f 7572 6365      ).    source
-00000990: 203d 2053 7472 6970 6549 6446 6965 6c64   = StripeIdField
-000009a0: 2829 0a20 2020 2072 6570 6f72 7469 6e67  ().    reporting
-000009b0: 5f63 6174 6567 6f72 7920 3d20 5374 7269  _category = Stri
-000009c0: 7065 456e 756d 4669 656c 6428 0a20 2020  peEnumField(.   
-000009d0: 2020 2020 2065 6e75 6d3d 656e 756d 732e       enum=enums.
-000009e0: 4261 6c61 6e63 6554 7261 6e73 6163 7469  BalanceTransacti
-000009f0: 6f6e 5265 706f 7274 696e 6743 6174 6567  onReportingCateg
-00000a00: 6f72 792c 0a20 2020 2020 2020 2068 656c  ory,.        hel
-00000a10: 705f 7465 7874 3d28 0a20 2020 2020 2020  p_text=(.       
-00000a20: 2020 2020 2022 4d6f 7265 2069 6e66 6f72       "More infor
-00000a30: 6d61 7469 6f6e 3a20 6874 7470 733a 2f2f  mation: https://
-00000a40: 7374 7269 7065 2e63 6f6d 2f64 6f63 732f  stripe.com/docs/
-00000a50: 7265 706f 7274 732f 7265 706f 7274 696e  reports/reportin
-00000a60: 672d 6361 7465 676f 7269 6573 220a 2020  g-categories".  
-00000a70: 2020 2020 2020 292c 0a20 2020 2029 0a20        ),.    ). 
-00000a80: 2020 2073 7461 7475 7320 3d20 5374 7269     status = Stri
-00000a90: 7065 456e 756d 4669 656c 6428 656e 756d  peEnumField(enum
-00000aa0: 3d65 6e75 6d73 2e42 616c 616e 6365 5472  =enums.BalanceTr
-00000ab0: 616e 7361 6374 696f 6e53 7461 7475 7329  ansactionStatus)
-00000ac0: 0a20 2020 2074 7970 6520 3d20 5374 7269  .    type = Stri
-00000ad0: 7065 456e 756d 4669 656c 6428 656e 756d  peEnumField(enum
-00000ae0: 3d65 6e75 6d73 2e42 616c 616e 6365 5472  =enums.BalanceTr
-00000af0: 616e 7361 6374 696f 6e54 7970 6529 0a0a  ansactionType)..
-00000b00: 2020 2020 6465 6620 5f5f 7374 725f 5f28      def __str__(
-00000b10: 7365 6c66 293a 0a20 2020 2020 2020 2061  self):.        a
-00000b20: 6d6f 756e 7420 3d20 6765 745f 6672 6965  mount = get_frie
-00000b30: 6e64 6c79 5f63 7572 7265 6e63 795f 616d  ndly_currency_am
-00000b40: 6f75 6e74 2873 656c 662e 616d 6f75 6e74  ount(self.amount
-00000b50: 202f 2031 3030 2c20 7365 6c66 2e63 7572   / 100, self.cur
-00000b60: 7265 6e63 7929 0a20 2020 2020 2020 2073  rency).        s
-00000b70: 7461 7475 7320 3d20 656e 756d 732e 4261  tatus = enums.Ba
-00000b80: 6c61 6e63 6554 7261 6e73 6163 7469 6f6e  lanceTransaction
-00000b90: 5374 6174 7573 2e68 756d 616e 697a 6528  Status.humanize(
-00000ba0: 7365 6c66 2e73 7461 7475 7329 0a20 2020  self.status).   
-00000bb0: 2020 2020 2072 6574 7572 6e20 6622 7b61       return f"{a
-00000bc0: 6d6f 756e 747d 2028 7b73 7461 7475 737d  mount} ({status}
-00000bd0: 2922 0a0a 2020 2020 6465 6620 6765 745f  )"..    def get_
-00000be0: 736f 7572 6365 5f63 6c61 7373 2873 656c  source_class(sel
-00000bf0: 6629 3a0a 2020 2020 2020 2020 7472 793a  f):.        try:
-00000c00: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00000c10: 7572 6e20 6170 7073 2e67 6574 5f6d 6f64  urn apps.get_mod
-00000c20: 656c 2822 646a 7374 7269 7065 222c 2073  el("djstripe", s
-00000c30: 656c 662e 7479 7065 290a 2020 2020 2020  elf.type).      
-00000c40: 2020 6578 6365 7074 204c 6f6f 6b75 7045    except LookupE
-00000c50: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
-00000c60: 2020 7261 6973 650a 0a20 2020 2064 6566    raise..    def
-00000c70: 2067 6574 5f73 6f75 7263 655f 696e 7374   get_source_inst
-00000c80: 616e 6365 2873 656c 6629 3a0a 2020 2020  ance(self):.    
-00000c90: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00000ca0: 6765 745f 736f 7572 6365 5f63 6c61 7373  get_source_class
-00000cb0: 2829 2e6f 626a 6563 7473 2e67 6574 2869  ().objects.get(i
-00000cc0: 643d 7365 6c66 2e73 6f75 7263 6529 0a0a  d=self.source)..
-00000cd0: 2020 2020 6465 6620 6765 745f 7374 7269      def get_stri
-00000ce0: 7065 5f64 6173 6862 6f61 7264 5f75 726c  pe_dashboard_url
-00000cf0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00000d00: 7265 7475 726e 2073 656c 662e 6765 745f  return self.get_
-00000d10: 736f 7572 6365 5f69 6e73 7461 6e63 6528  source_instance(
-00000d20: 292e 6765 745f 7374 7269 7065 5f64 6173  ).get_stripe_das
-00000d30: 6862 6f61 7264 5f75 726c 2829 0a0a 0a63  hboard_url()...c
-00000d40: 6c61 7373 2043 6861 7267 6528 5374 7269  lass Charge(Stri
-00000d50: 7065 4d6f 6465 6c29 3a0a 2020 2020 2222  peModel):.    ""
-00000d60: 220a 2020 2020 546f 2063 6861 7267 6520  ".    To charge 
-00000d70: 6120 6372 6564 6974 206f 7220 6120 6465  a credit or a de
-00000d80: 6269 7420 6361 7264 2c20 796f 7520 6372  bit card, you cr
-00000d90: 6561 7465 2061 2063 6861 7267 6520 6f62  eate a charge ob
-00000da0: 6a65 6374 2e20 596f 7520 6361 6e0a 2020  ject. You can.  
-00000db0: 2020 7265 7472 6965 7665 2061 6e64 2072    retrieve and r
-00000dc0: 6566 756e 6420 696e 6469 7669 6475 616c  efund individual
-00000dd0: 2063 6861 7267 6573 2061 7320 7765 6c6c   charges as well
-00000de0: 2061 7320 6c69 7374 2061 6c6c 2063 6861   as list all cha
-00000df0: 7267 6573 2e20 4368 6172 6765 730a 2020  rges. Charges.  
-00000e00: 2020 6172 6520 6964 656e 7469 6669 6564    are identified
-00000e10: 2062 7920 6120 756e 6971 7565 2072 616e   by a unique ran
-00000e20: 646f 6d20 4944 2e0a 0a20 2020 2053 7472  dom ID...    Str
-00000e30: 6970 6520 646f 6375 6d65 6e74 6174 696f  ipe documentatio
-00000e40: 6e3a 2068 7474 7073 3a2f 2f73 7472 6970  n: https://strip
-00000e50: 652e 636f 6d2f 646f 6373 2f61 7069 3f6c  e.com/docs/api?l
-00000e60: 616e 673d 7079 7468 6f6e 2363 6861 7267  ang=python#charg
-00000e70: 6573 0a20 2020 2022 2222 0a0a 2020 2020  es.    """..    
-00000e80: 7374 7269 7065 5f63 6c61 7373 203d 2073  stripe_class = s
-00000e90: 7472 6970 652e 4368 6172 6765 0a20 2020  tripe.Charge.   
-00000ea0: 2065 7870 616e 645f 6669 656c 6473 203d   expand_fields =
-00000eb0: 205b 2262 616c 616e 6365 5f74 7261 6e73   ["balance_trans
-00000ec0: 6163 7469 6f6e 225d 0a20 2020 2073 7472  action"].    str
-00000ed0: 6970 655f 6461 7368 626f 6172 645f 6974  ipe_dashboard_it
-00000ee0: 656d 5f6e 616d 6520 3d20 2270 6179 6d65  em_name = "payme
-00000ef0: 6e74 7322 0a0a 2020 2020 616d 6f75 6e74  nts"..    amount
-00000f00: 203d 2053 7472 6970 6544 6563 696d 616c   = StripeDecimal
-00000f10: 4375 7272 656e 6379 416d 6f75 6e74 4669  CurrencyAmountFi
-00000f20: 656c 6428 6865 6c70 5f74 6578 743d 2241  eld(help_text="A
-00000f30: 6d6f 756e 7420 6368 6172 6765 6420 2861  mount charged (a
-00000f40: 7320 6465 6369 6d61 6c29 2e22 290a 2020  s decimal).").  
-00000f50: 2020 616d 6f75 6e74 5f63 6170 7475 7265    amount_capture
-00000f60: 6420 3d20 5374 7269 7065 4465 6369 6d61  d = StripeDecima
-00000f70: 6c43 7572 7265 6e63 7941 6d6f 756e 7446  lCurrencyAmountF
-00000f80: 6965 6c64 280a 2020 2020 2020 2020 6e75  ield(.        nu
-00000f90: 6c6c 3d54 7275 652c 0a20 2020 2020 2020  ll=True,.       
-00000fa0: 2068 656c 705f 7465 7874 3d28 0a20 2020   help_text=(.   
-00000fb0: 2020 2020 2020 2020 2022 416d 6f75 6e74           "Amount
-00000fc0: 2028 6173 2064 6563 696d 616c 2920 6361   (as decimal) ca
-00000fd0: 7074 7572 6564 2028 6361 6e20 6265 206c  ptured (can be l
-00000fe0: 6573 7320 7468 616e 2074 6865 2061 6d6f  ess than the amo
-00000ff0: 756e 7420 6174 7472 6962 7574 6520 220a  unt attribute ".
-00001000: 2020 2020 2020 2020 2020 2020 226f 6e20              "on 
-00001010: 7468 6520 6368 6172 6765 2069 6620 6120  the charge if a 
-00001020: 7061 7274 6961 6c20 6361 7074 7572 6520  partial capture 
-00001030: 7761 7320 6973 7375 6564 292e 220a 2020  was issued).".  
-00001040: 2020 2020 2020 292c 0a20 2020 2029 0a20        ),.    ). 
-00001050: 2020 2061 6d6f 756e 745f 7265 6675 6e64     amount_refund
-00001060: 6564 203d 2053 7472 6970 6544 6563 696d  ed = StripeDecim
-00001070: 616c 4375 7272 656e 6379 416d 6f75 6e74  alCurrencyAmount
-00001080: 4669 656c 6428 0a20 2020 2020 2020 2068  Field(.        h
-00001090: 656c 705f 7465 7874 3d28 0a20 2020 2020  elp_text=(.     
-000010a0: 2020 2020 2020 2022 416d 6f75 6e74 2028         "Amount (
-000010b0: 6173 2064 6563 696d 616c 2920 7265 6675  as decimal) refu
-000010c0: 6e64 6564 2028 6361 6e20 6265 206c 6573  nded (can be les
-000010d0: 7320 7468 616e 2074 6865 2061 6d6f 756e  s than the amoun
-000010e0: 7420 6174 7472 6962 7574 6520 6f6e 2022  t attribute on "
-000010f0: 0a20 2020 2020 2020 2020 2020 2022 7468  .            "th
-00001100: 6520 6368 6172 6765 2069 6620 6120 7061  e charge if a pa
-00001110: 7274 6961 6c20 7265 6675 6e64 2077 6173  rtial refund was
-00001120: 2069 7373 7565 6429 2e22 0a20 2020 2020   issued).".     
-00001130: 2020 2029 0a20 2020 2029 0a20 2020 2061     ).    ).    a
-00001140: 7070 6c69 6361 7469 6f6e 203d 206d 6f64  pplication = mod
-00001150: 656c 732e 4368 6172 4669 656c 6428 0a20  els.CharField(. 
-00001160: 2020 2020 2020 206d 6178 5f6c 656e 6774         max_lengt
-00001170: 683d 3235 352c 0a20 2020 2020 2020 2062  h=255,.        b
-00001180: 6c61 6e6b 3d54 7275 652c 0a20 2020 2020  lank=True,.     
-00001190: 2020 2068 656c 705f 7465 7874 3d22 4944     help_text="ID
-000011a0: 206f 6620 7468 6520 436f 6e6e 6563 7420   of the Connect 
-000011b0: 6170 706c 6963 6174 696f 6e20 7468 6174  application that
-000011c0: 2063 7265 6174 6564 2074 6865 2063 6861   created the cha
-000011d0: 7267 652e 222c 0a20 2020 2029 0a20 2020  rge.",.    ).   
-000011e0: 2061 7070 6c69 6361 7469 6f6e 5f66 6565   application_fee
-000011f0: 203d 2053 7472 6970 6546 6f72 6569 676e   = StripeForeign
-00001200: 4b65 7928 0a20 2020 2020 2020 2022 4170  Key(.        "Ap
-00001210: 706c 6963 6174 696f 6e46 6565 222c 0a20  plicationFee",. 
-00001220: 2020 2020 2020 206f 6e5f 6465 6c65 7465         on_delete
-00001230: 3d6d 6f64 656c 732e 5345 545f 4e55 4c4c  =models.SET_NULL
-00001240: 2c0a 2020 2020 2020 2020 6e75 6c6c 3d54  ,.        null=T
-00001250: 7275 652c 0a20 2020 2020 2020 2062 6c61  rue,.        bla
-00001260: 6e6b 3d54 7275 652c 0a20 2020 2020 2020  nk=True,.       
-00001270: 2072 656c 6174 6564 5f6e 616d 653d 2266   related_name="f
-00001280: 6565 5f66 6f72 5f63 6861 7267 6522 2c0a  ee_for_charge",.
-00001290: 2020 2020 2020 2020 6865 6c70 5f74 6578          help_tex
-000012a0: 743d 2254 6865 2061 7070 6c69 6361 7469  t="The applicati
-000012b0: 6f6e 2066 6565 2028 6966 2061 6e79 2920  on fee (if any) 
-000012c0: 666f 7220 7468 6520 6368 6172 6765 2e22  for the charge."
-000012d0: 2c0a 2020 2020 290a 2020 2020 6170 706c  ,.    ).    appl
-000012e0: 6963 6174 696f 6e5f 6665 655f 616d 6f75  ication_fee_amou
-000012f0: 6e74 203d 2053 7472 6970 6544 6563 696d  nt = StripeDecim
-00001300: 616c 4375 7272 656e 6379 416d 6f75 6e74  alCurrencyAmount
-00001310: 4669 656c 6428 0a20 2020 2020 2020 206e  Field(.        n
-00001320: 756c 6c3d 5472 7565 2c0a 2020 2020 2020  ull=True,.      
-00001330: 2020 626c 616e 6b3d 5472 7565 2c0a 2020    blank=True,.  
-00001340: 2020 2020 2020 6865 6c70 5f74 6578 743d        help_text=
-00001350: 2254 6865 2061 6d6f 756e 7420 2861 7320  "The amount (as 
-00001360: 6465 6369 6d61 6c29 206f 6620 7468 6520  decimal) of the 
-00001370: 6170 706c 6963 6174 696f 6e20 6665 6520  application fee 
-00001380: 2869 6620 616e 7929 2022 0a20 2020 2020  (if any) ".     
-00001390: 2020 2022 7265 7175 6573 7465 6420 666f     "requested fo
-000013a0: 7220 7468 6520 6368 6172 6765 2e22 2c0a  r the charge.",.
-000013b0: 2020 2020 290a 2020 2020 6261 6c61 6e63      ).    balanc
-000013c0: 655f 7472 616e 7361 6374 696f 6e20 3d20  e_transaction = 
-000013d0: 5374 7269 7065 466f 7265 6967 6e4b 6579  StripeForeignKey
-000013e0: 280a 2020 2020 2020 2020 2242 616c 616e  (.        "Balan
-000013f0: 6365 5472 616e 7361 6374 696f 6e22 2c0a  ceTransaction",.
-00001400: 2020 2020 2020 2020 6f6e 5f64 656c 6574          on_delet
-00001410: 653d 6d6f 6465 6c73 2e53 4554 5f4e 554c  e=models.SET_NUL
-00001420: 4c2c 0a20 2020 2020 2020 206e 756c 6c3d  L,.        null=
-00001430: 5472 7565 2c0a 2020 2020 2020 2020 6865  True,.        he
-00001440: 6c70 5f74 6578 743d 280a 2020 2020 2020  lp_text=(.      
-00001450: 2020 2020 2020 2254 6865 2062 616c 616e        "The balan
-00001460: 6365 2074 7261 6e73 6163 7469 6f6e 2074  ce transaction t
-00001470: 6861 7420 6465 7363 7269 6265 7320 7468  hat describes th
-00001480: 6520 696d 7061 6374 206f 6620 7468 6973  e impact of this
-00001490: 2063 6861 7267 6520 220a 2020 2020 2020   charge ".      
-000014a0: 2020 2020 2020 226f 6e20 796f 7572 2061        "on your a
-000014b0: 6363 6f75 6e74 2062 616c 616e 6365 2028  ccount balance (
-000014c0: 6e6f 7420 696e 636c 7564 696e 6720 7265  not including re
-000014d0: 6675 6e64 7320 6f72 2064 6973 7075 7465  funds or dispute
-000014e0: 7329 2e22 0a20 2020 2020 2020 2029 2c0a  s).".        ),.
-000014f0: 2020 2020 290a 2020 2020 6269 6c6c 696e      ).    billin
-00001500: 675f 6465 7461 696c 7320 3d20 4a53 4f4e  g_details = JSON
-00001510: 4669 656c 6428 0a20 2020 2020 2020 206e  Field(.        n
-00001520: 756c 6c3d 5472 7565 2c0a 2020 2020 2020  ull=True,.      
-00001530: 2020 6865 6c70 5f74 6578 743d 2242 696c    help_text="Bil
-00001540: 6c69 6e67 2069 6e66 6f72 6d61 7469 6f6e  ling information
-00001550: 2061 7373 6f63 6961 7465 6420 7769 7468   associated with
-00001560: 2074 6865 2050 6179 6d65 6e74 4d65 7468   the PaymentMeth
-00001570: 6f64 2061 7420 7468 6520 220a 2020 2020  od at the ".    
-00001580: 2020 2020 2274 696d 6520 6f66 2074 6865      "time of the
-00001590: 2074 7261 6e73 6163 7469 6f6e 2e22 2c0a   transaction.",.
-000015a0: 2020 2020 290a 2020 2020 6361 6c63 756c      ).    calcul
-000015b0: 6174 6564 5f73 7461 7465 6d65 6e74 5f64  ated_statement_d
-000015c0: 6573 6372 6970 746f 7220 3d20 6d6f 6465  escriptor = mode
-000015d0: 6c73 2e43 6861 7246 6965 6c64 280a 2020  ls.CharField(.  
-000015e0: 2020 2020 2020 6d61 785f 6c65 6e67 7468        max_length
-000015f0: 3d32 322c 0a20 2020 2020 2020 2064 6566  =22,.        def
-00001600: 6175 6c74 3d22 222c 0a20 2020 2020 2020  ault="",.       
-00001610: 2068 656c 705f 7465 7874 3d22 5468 6520   help_text="The 
-00001620: 6675 6c6c 2073 7461 7465 6d65 6e74 2064  full statement d
-00001630: 6573 6372 6970 746f 7220 7468 6174 2069  escriptor that i
-00001640: 7320 7061 7373 6564 2074 6f20 6361 7264  s passed to card
-00001650: 206e 6574 776f 726b 732c 2022 0a20 2020   networks, ".   
-00001660: 2020 2020 2022 616e 6420 7468 6174 2069       "and that i
-00001670: 7320 6469 7370 6c61 7965 6420 6f6e 2079  s displayed on y
-00001680: 6f75 7220 6375 7374 6f6d 6572 7327 2063  our customers' c
-00001690: 7265 6469 7420 6361 7264 2061 6e64 2062  redit card and b
-000016a0: 616e 6b20 7374 6174 656d 656e 7473 2e20  ank statements. 
-000016b0: 220a 2020 2020 2020 2020 2241 6c6c 6f77  ".        "Allow
-000016c0: 7320 796f 7520 746f 2073 6565 2077 6861  s you to see wha
-000016d0: 7420 7468 6520 7374 6174 656d 656e 7420  t the statement 
-000016e0: 6465 7363 7269 7074 6f72 206c 6f6f 6b73  descriptor looks
-000016f0: 206c 696b 6520 6166 7465 7220 7468 6520   like after the 
-00001700: 220a 2020 2020 2020 2020 2273 7461 7469  ".        "stati
-00001710: 6320 616e 6420 6479 6e61 6d69 6320 706f  c and dynamic po
-00001720: 7274 696f 6e73 2061 7265 2063 6f6d 6269  rtions are combi
-00001730: 6e65 642e 222c 0a20 2020 2029 0a20 2020  ned.",.    ).   
-00001740: 2063 6170 7475 7265 6420 3d20 6d6f 6465   captured = mode
-00001750: 6c73 2e42 6f6f 6c65 616e 4669 656c 6428  ls.BooleanField(
-00001760: 0a20 2020 2020 2020 2064 6566 6175 6c74  .        default
-00001770: 3d46 616c 7365 2c0a 2020 2020 2020 2020  =False,.        
-00001780: 6865 6c70 5f74 6578 743d 2249 6620 7468  help_text="If th
-00001790: 6520 6368 6172 6765 2077 6173 2063 7265  e charge was cre
-000017a0: 6174 6564 2077 6974 686f 7574 2063 6170  ated without cap
-000017b0: 7475 7269 6e67 2c20 7468 6973 2062 6f6f  turing, this boo
-000017c0: 6c65 616e 2022 0a20 2020 2020 2020 2022  lean ".        "
-000017d0: 7265 7072 6573 656e 7473 2077 6865 7468  represents wheth
-000017e0: 6572 206f 7220 6e6f 7420 6974 2069 7320  er or not it is 
-000017f0: 7374 696c 6c20 756e 6361 7074 7572 6564  still uncaptured
-00001800: 206f 7220 6861 7320 7369 6e63 6520 6265   or has since be
-00001810: 656e 2063 6170 7475 7265 642e 222c 0a20  en captured.",. 
-00001820: 2020 2029 0a20 2020 2063 7572 7265 6e63     ).    currenc
-00001830: 7920 3d20 5374 7269 7065 4375 7272 656e  y = StripeCurren
-00001840: 6379 436f 6465 4669 656c 6428 0a20 2020  cyCodeField(.   
-00001850: 2020 2020 2068 656c 705f 7465 7874 3d22       help_text="
-00001860: 5468 6520 6375 7272 656e 6379 2069 6e20  The currency in 
-00001870: 7768 6963 6820 7468 6520 6368 6172 6765  which the charge
-00001880: 2077 6173 206d 6164 652e 220a 2020 2020   was made.".    
-00001890: 290a 2020 2020 6375 7374 6f6d 6572 203d  ).    customer =
-000018a0: 2053 7472 6970 6546 6f72 6569 676e 4b65   StripeForeignKe
-000018b0: 7928 0a20 2020 2020 2020 2022 4375 7374  y(.        "Cust
-000018c0: 6f6d 6572 222c 0a20 2020 2020 2020 206f  omer",.        o
-000018d0: 6e5f 6465 6c65 7465 3d6d 6f64 656c 732e  n_delete=models.
-000018e0: 5345 545f 4e55 4c4c 2c0a 2020 2020 2020  SET_NULL,.      
-000018f0: 2020 6e75 6c6c 3d54 7275 652c 0a20 2020    null=True,.   
-00001900: 2020 2020 2062 6c61 6e6b 3d54 7275 652c       blank=True,
-00001910: 0a20 2020 2020 2020 2072 656c 6174 6564  .        related
-00001920: 5f6e 616d 653d 2263 6861 7267 6573 222c  _name="charges",
-00001930: 0a20 2020 2020 2020 2068 656c 705f 7465  .        help_te
-00001940: 7874 3d22 5468 6520 6375 7374 6f6d 6572  xt="The customer
-00001950: 2061 7373 6f63 6961 7465 6420 7769 7468   associated with
-00001960: 2074 6869 7320 6368 6172 6765 2e22 2c0a   this charge.",.
-00001970: 2020 2020 290a 0a20 2020 2064 6973 7075      )..    dispu
-00001980: 7465 203d 2053 7472 6970 6546 6f72 6569  te = StripeForei
-00001990: 676e 4b65 7928 0a20 2020 2020 2020 2022  gnKey(.        "
-000019a0: 4469 7370 7574 6522 2c0a 2020 2020 2020  Dispute",.      
-000019b0: 2020 6f6e 5f64 656c 6574 653d 6d6f 6465    on_delete=mode
-000019c0: 6c73 2e53 4554 5f4e 554c 4c2c 0a20 2020  ls.SET_NULL,.   
-000019d0: 2020 2020 206e 756c 6c3d 5472 7565 2c0a       null=True,.
-000019e0: 2020 2020 2020 2020 626c 616e 6b3d 5472          blank=Tr
-000019f0: 7565 2c0a 2020 2020 2020 2020 7265 6c61  ue,.        rela
-00001a00: 7465 645f 6e61 6d65 3d22 6368 6172 6765  ted_name="charge
-00001a10: 7322 2c0a 2020 2020 2020 2020 6865 6c70  s",.        help
-00001a20: 5f74 6578 743d 2244 6574 6169 6c73 2061  _text="Details a
-00001a30: 626f 7574 2074 6865 2064 6973 7075 7465  bout the dispute
-00001a40: 2069 6620 7468 6520 6368 6172 6765 2068   if the charge h
-00001a50: 6173 2062 6565 6e20 6469 7370 7574 6564  as been disputed
-00001a60: 2e22 2c0a 2020 2020 290a 2020 2020 6469  .",.    ).    di
-00001a70: 7370 7574 6564 203d 206d 6f64 656c 732e  sputed = models.
-00001a80: 426f 6f6c 6561 6e46 6965 6c64 280a 2020  BooleanField(.  
-00001a90: 2020 2020 2020 6465 6661 756c 743d 4661        default=Fa
-00001aa0: 6c73 652c 0a20 2020 2020 2020 2068 656c  lse,.        hel
-00001ab0: 705f 7465 7874 3d22 5768 6574 6865 7220  p_text="Whether 
-00001ac0: 7468 6520 6368 6172 6765 2068 6173 2062  the charge has b
-00001ad0: 6565 6e20 6469 7370 7574 6564 2e22 2c0a  een disputed.",.
-00001ae0: 2020 2020 290a 2020 2020 6661 696c 7572      ).    failur
-00001af0: 655f 636f 6465 203d 2053 7472 6970 6545  e_code = StripeE
-00001b00: 6e75 6d46 6965 6c64 280a 2020 2020 2020  numField(.      
-00001b10: 2020 656e 756d 3d65 6e75 6d73 2e41 7069    enum=enums.Api
-00001b20: 4572 726f 7243 6f64 652c 0a20 2020 2020  ErrorCode,.     
-00001b30: 2020 2064 6566 6175 6c74 3d22 222c 0a20     default="",. 
-00001b40: 2020 2020 2020 2062 6c61 6e6b 3d54 7275         blank=Tru
-00001b50: 652c 0a20 2020 2020 2020 2068 656c 705f  e,.        help_
-00001b60: 7465 7874 3d22 4572 726f 7220 636f 6465  text="Error code
-00001b70: 2065 7870 6c61 696e 696e 6720 7265 6173   explaining reas
-00001b80: 6f6e 2066 6f72 2063 6861 7267 6520 6661  on for charge fa
-00001b90: 696c 7572 6520 6966 2061 7661 696c 6162  ilure if availab
-00001ba0: 6c65 2e22 2c0a 2020 2020 290a 2020 2020  le.",.    ).    
-00001bb0: 6661 696c 7572 655f 6d65 7373 6167 6520  failure_message 
-00001bc0: 3d20 6d6f 6465 6c73 2e54 6578 7446 6965  = models.TextFie
-00001bd0: 6c64 280a 2020 2020 2020 2020 6d61 785f  ld(.        max_
-00001be0: 6c65 6e67 7468 3d35 3030 302c 0a20 2020  length=5000,.   
-00001bf0: 2020 2020 2064 6566 6175 6c74 3d22 222c       default="",
-00001c00: 0a20 2020 2020 2020 2062 6c61 6e6b 3d54  .        blank=T
-00001c10: 7275 652c 0a20 2020 2020 2020 2068 656c  rue,.        hel
-00001c20: 705f 7465 7874 3d22 4d65 7373 6167 6520  p_text="Message 
-00001c30: 746f 2075 7365 7220 6675 7274 6865 7220  to user further 
-00001c40: 6578 706c 6169 6e69 6e67 2072 6561 736f  explaining reaso
-00001c50: 6e20 220a 2020 2020 2020 2020 2266 6f72  n ".        "for
-00001c60: 2063 6861 7267 6520 6661 696c 7572 6520   charge failure 
-00001c70: 6966 2061 7661 696c 6162 6c65 2e22 2c0a  if available.",.
-00001c80: 2020 2020 290a 2020 2020 6672 6175 645f      ).    fraud_
-00001c90: 6465 7461 696c 7320 3d20 4a53 4f4e 4669  details = JSONFi
-00001ca0: 656c 6428 0a20 2020 2020 2020 2068 656c  eld(.        hel
-00001cb0: 705f 7465 7874 3d22 4861 7368 2077 6974  p_text="Hash wit
-00001cc0: 6820 696e 666f 726d 6174 696f 6e20 6f6e  h information on
-00001cd0: 2066 7261 7564 2061 7373 6573 736d 656e   fraud assessmen
-00001ce0: 7473 2066 6f72 2074 6865 2063 6861 7267  ts for the charg
-00001cf0: 652e 222c 0a20 2020 2020 2020 206e 756c  e.",.        nul
-00001d00: 6c3d 5472 7565 2c0a 2020 2020 2020 2020  l=True,.        
-00001d10: 626c 616e 6b3d 5472 7565 2c0a 2020 2020  blank=True,.    
-00001d20: 290a 2020 2020 696e 766f 6963 6520 3d20  ).    invoice = 
-00001d30: 5374 7269 7065 466f 7265 6967 6e4b 6579  StripeForeignKey
-00001d40: 280a 2020 2020 2020 2020 2249 6e76 6f69  (.        "Invoi
-00001d50: 6365 222c 0a20 2020 2020 2020 206f 6e5f  ce",.        on_
-00001d60: 6465 6c65 7465 3d6d 6f64 656c 732e 4341  delete=models.CA
-00001d70: 5343 4144 452c 0a20 2020 2020 2020 206e  SCADE,.        n
-00001d80: 756c 6c3d 5472 7565 2c0a 2020 2020 2020  ull=True,.      
-00001d90: 2020 7265 6c61 7465 645f 6e61 6d65 3d22    related_name="
-00001da0: 6368 6172 6765 7322 2c0a 2020 2020 2020  charges",.      
-00001db0: 2020 6865 6c70 5f74 6578 743d 2254 6865    help_text="The
-00001dc0: 2069 6e76 6f69 6365 2074 6869 7320 6368   invoice this ch
-00001dd0: 6172 6765 2069 7320 666f 7220 6966 206f  arge is for if o
-00001de0: 6e65 2065 7869 7374 732e 222c 0a20 2020  ne exists.",.   
-00001df0: 2029 0a20 2020 2023 2054 4f44 4f3a 206f   ).    # TODO: o
-00001e00: 7264 6572 2028 7265 7175 6972 6573 204f  rder (requires O
-00001e10: 7264 6572 206d 6f64 656c 290a 2020 2020  rder model).    
-00001e20: 6f6e 5f62 6568 616c 665f 6f66 203d 2053  on_behalf_of = S
-00001e30: 7472 6970 6546 6f72 6569 676e 4b65 7928  tripeForeignKey(
-00001e40: 0a20 2020 2020 2020 2022 4163 636f 756e  .        "Accoun
-00001e50: 7422 2c0a 2020 2020 2020 2020 6f6e 5f64  t",.        on_d
-00001e60: 656c 6574 653d 6d6f 6465 6c73 2e43 4153  elete=models.CAS
-00001e70: 4341 4445 2c0a 2020 2020 2020 2020 6e75  CADE,.        nu
-00001e80: 6c6c 3d54 7275 652c 0a20 2020 2020 2020  ll=True,.       
-00001e90: 2062 6c61 6e6b 3d54 7275 652c 0a20 2020   blank=True,.   
-00001ea0: 2020 2020 2072 656c 6174 6564 5f6e 616d       related_nam
-00001eb0: 653d 2263 6861 7267 6573 222c 0a20 2020  e="charges",.   
-00001ec0: 2020 2020 2068 656c 705f 7465 7874 3d22       help_text="
-00001ed0: 5468 6520 6163 636f 756e 7420 2869 6620  The account (if 
-00001ee0: 616e 7929 2074 6865 2063 6861 7267 6520  any) the charge 
-00001ef0: 7761 7320 6d61 6465 206f 6e20 6265 6861  was made on beha
-00001f00: 6c66 206f 6620 220a 2020 2020 2020 2020  lf of ".        
-00001f10: 2277 6974 686f 7574 2074 7269 6767 6572  "without trigger
-00001f20: 696e 6720 616e 2061 7574 6f6d 6174 6963  ing an automatic
-00001f30: 2074 7261 6e73 6665 722e 222c 0a20 2020   transfer.",.   
-00001f40: 2029 0a20 2020 206f 7574 636f 6d65 203d   ).    outcome =
-00001f50: 204a 534f 4e46 6965 6c64 280a 2020 2020   JSONField(.    
-00001f60: 2020 2020 6865 6c70 5f74 6578 743d 2244      help_text="D
-00001f70: 6574 6169 6c73 2061 626f 7574 2077 6865  etails about whe
-00001f80: 7468 6572 206f 7220 6e6f 7420 7468 6520  ther or not the 
-00001f90: 7061 796d 656e 7420 7761 7320 6163 6365  payment was acce
-00001fa0: 7074 6564 2c20 616e 6420 7768 792e 222c  pted, and why.",
-00001fb0: 0a20 2020 2020 2020 206e 756c 6c3d 5472  .        null=Tr
-00001fc0: 7565 2c0a 2020 2020 2020 2020 626c 616e  ue,.        blan
-00001fd0: 6b3d 5472 7565 2c0a 2020 2020 290a 2020  k=True,.    ).  
-00001fe0: 2020 7061 6964 203d 206d 6f64 656c 732e    paid = models.
-00001ff0: 426f 6f6c 6561 6e46 6965 6c64 280a 2020  BooleanField(.  
-00002000: 2020 2020 2020 6465 6661 756c 743d 4661        default=Fa
-00002010: 6c73 652c 0a20 2020 2020 2020 2068 656c  lse,.        hel
-00002020: 705f 7465 7874 3d22 5472 7565 2069 6620  p_text="True if 
-00002030: 7468 6520 6368 6172 6765 2073 7563 6365  the charge succe
-00002040: 6564 6564 2c20 220a 2020 2020 2020 2020  eded, ".        
-00002050: 226f 7220 7761 7320 7375 6363 6573 7366  "or was successf
-00002060: 756c 6c79 2061 7574 686f 7269 7a65 6420  ully authorized 
-00002070: 666f 7220 6c61 7465 7220 6361 7074 7572  for later captur
-00002080: 652c 2046 616c 7365 206f 7468 6572 7769  e, False otherwi
-00002090: 7365 2e22 2c0a 2020 2020 290a 2020 2020  se.",.    ).    
-000020a0: 7061 796d 656e 745f 696e 7465 6e74 203d  payment_intent =
-000020b0: 2053 7472 6970 6546 6f72 6569 676e 4b65   StripeForeignKe
-000020c0: 7928 0a20 2020 2020 2020 2022 5061 796d  y(.        "Paym
-000020d0: 656e 7449 6e74 656e 7422 2c0a 2020 2020  entIntent",.    
-000020e0: 2020 2020 6e75 6c6c 3d54 7275 652c 0a20      null=True,. 
-000020f0: 2020 2020 2020 206f 6e5f 6465 6c65 7465         on_delete
-00002100: 3d6d 6f64 656c 732e 5345 545f 4e55 4c4c  =models.SET_NULL
-00002110: 2c0a 2020 2020 2020 2020 7265 6c61 7465  ,.        relate
-00002120: 645f 6e61 6d65 3d22 6368 6172 6765 7322  d_name="charges"
-00002130: 2c0a 2020 2020 2020 2020 6865 6c70 5f74  ,.        help_t
-00002140: 6578 743d 2250 6179 6d65 6e74 496e 7465  ext="PaymentInte
-00002150: 6e74 2061 7373 6f63 6961 7465 6420 7769  nt associated wi
-00002160: 7468 2074 6869 7320 6368 6172 6765 2c20  th this charge, 
-00002170: 6966 206f 6e65 2065 7869 7374 732e 222c  if one exists.",
-00002180: 0a20 2020 2029 0a20 2020 2070 6179 6d65  .    ).    payme
-00002190: 6e74 5f6d 6574 686f 6420 3d20 5374 7269  nt_method = Stri
-000021a0: 7065 466f 7265 6967 6e4b 6579 280a 2020  peForeignKey(.  
-000021b0: 2020 2020 2020 2250 6179 6d65 6e74 4d65        "PaymentMe
-000021c0: 7468 6f64 222c 0a20 2020 2020 2020 206e  thod",.        n
-000021d0: 756c 6c3d 5472 7565 2c0a 2020 2020 2020  ull=True,.      
-000021e0: 2020 6f6e 5f64 656c 6574 653d 6d6f 6465    on_delete=mode
-000021f0: 6c73 2e53 4554 5f4e 554c 4c2c 0a20 2020  ls.SET_NULL,.   
-00002200: 2020 2020 2072 656c 6174 6564 5f6e 616d       related_nam
-00002210: 653d 2263 6861 7267 6573 222c 0a20 2020  e="charges",.   
-00002220: 2020 2020 2068 656c 705f 7465 7874 3d22       help_text="
-00002230: 5061 796d 656e 744d 6574 686f 6420 7573  PaymentMethod us
-00002240: 6564 2069 6e20 7468 6973 2063 6861 7267  ed in this charg
-00002250: 652e 222c 0a20 2020 2029 0a20 2020 2070  e.",.    ).    p
-00002260: 6179 6d65 6e74 5f6d 6574 686f 645f 6465  ayment_method_de
-00002270: 7461 696c 7320 3d20 4a53 4f4e 4669 656c  tails = JSONFiel
-00002280: 6428 0a20 2020 2020 2020 2068 656c 705f  d(.        help_
-00002290: 7465 7874 3d22 4465 7461 696c 7320 6162  text="Details ab
-000022a0: 6f75 7420 7468 6520 7061 796d 656e 7420  out the payment 
-000022b0: 6d65 7468 6f64 2061 7420 7468 6520 7469  method at the ti
-000022c0: 6d65 206f 6620 7468 6520 7472 616e 7361  me of the transa
-000022d0: 6374 696f 6e2e 222c 0a20 2020 2020 2020  ction.",.       
-000022e0: 206e 756c 6c3d 5472 7565 2c0a 2020 2020   null=True,.    
-000022f0: 2020 2020 626c 616e 6b3d 5472 7565 2c0a      blank=True,.
-00002300: 2020 2020 290a 2020 2020 7265 6365 6970      ).    receip
-00002310: 745f 656d 6169 6c20 3d20 6d6f 6465 6c73  t_email = models
-00002320: 2e54 6578 7446 6965 6c64 280a 2020 2020  .TextField(.    
-00002330: 2020 2020 6d61 785f 6c65 6e67 7468 3d38      max_length=8
-00002340: 3030 2c20 2023 2079 7570 2c20 3830 302e  00,  # yup, 800.
-00002350: 0a20 2020 2020 2020 2064 6566 6175 6c74  .        default
-00002360: 3d22 222c 0a20 2020 2020 2020 2062 6c61  ="",.        bla
-00002370: 6e6b 3d54 7275 652c 0a20 2020 2020 2020  nk=True,.       
-00002380: 2068 656c 705f 7465 7874 3d22 5468 6520   help_text="The 
-00002390: 656d 6169 6c20 6164 6472 6573 7320 7468  email address th
-000023a0: 6174 2074 6865 2072 6563 6569 7074 2066  at the receipt f
-000023b0: 6f72 2074 6869 7320 6368 6172 6765 2077  or this charge w
-000023c0: 6173 2073 656e 7420 746f 2e22 2c0a 2020  as sent to.",.  
-000023d0: 2020 290a 2020 2020 7265 6365 6970 745f    ).    receipt_
-000023e0: 6e75 6d62 6572 203d 206d 6f64 656c 732e  number = models.
-000023f0: 4368 6172 4669 656c 6428 0a20 2020 2020  CharField(.     
-00002400: 2020 206d 6178 5f6c 656e 6774 683d 3134     max_length=14
-00002410: 2c0a 2020 2020 2020 2020 6465 6661 756c  ,.        defaul
-00002420: 743d 2222 2c0a 2020 2020 2020 2020 626c  t="",.        bl
-00002430: 616e 6b3d 5472 7565 2c0a 2020 2020 2020  ank=True,.      
-00002440: 2020 6865 6c70 5f74 6578 743d 2254 6865    help_text="The
-00002450: 2074 7261 6e73 6163 7469 6f6e 206e 756d   transaction num
-00002460: 6265 7220 7468 6174 2061 7070 6561 7273  ber that appears
-00002470: 2022 0a20 2020 2020 2020 2022 6f6e 2065   ".        "on e
-00002480: 6d61 696c 2072 6563 6569 7074 7320 7365  mail receipts se
-00002490: 6e74 2066 6f72 2074 6869 7320 6368 6172  nt for this char
-000024a0: 6765 2e22 2c0a 2020 2020 290a 2020 2020  ge.",.    ).    
-000024b0: 7265 6365 6970 745f 7572 6c20 3d20 6d6f  receipt_url = mo
-000024c0: 6465 6c73 2e54 6578 7446 6965 6c64 280a  dels.TextField(.
-000024d0: 2020 2020 2020 2020 6d61 785f 6c65 6e67          max_leng
-000024e0: 7468 3d35 3030 302c 0a20 2020 2020 2020  th=5000,.       
-000024f0: 2064 6566 6175 6c74 3d22 222c 0a20 2020   default="",.   
-00002500: 2020 2020 2062 6c61 6e6b 3d54 7275 652c       blank=True,
-00002510: 0a20 2020 2020 2020 2068 656c 705f 7465  .        help_te
-00002520: 7874 3d22 5468 6973 2069 7320 7468 6520  xt="This is the 
-00002530: 5552 4c20 746f 2076 6965 7720 7468 6520  URL to view the 
-00002540: 7265 6365 6970 7420 666f 7220 7468 6973  receipt for this
-00002550: 2063 6861 7267 652e 2022 0a20 2020 2020   charge. ".     
-00002560: 2020 2022 5468 6520 7265 6365 6970 7420     "The receipt 
-00002570: 6973 206b 6570 7420 7570 2d74 6f2d 6461  is kept up-to-da
-00002580: 7465 2074 6f20 7468 6520 6c61 7465 7374  te to the latest
-00002590: 2073 7461 7465 206f 6620 7468 6520 6368   state of the ch
-000025a0: 6172 6765 2c20 220a 2020 2020 2020 2020  arge, ".        
-000025b0: 2269 6e63 6c75 6469 6e67 2061 6e79 2072  "including any r
-000025c0: 6566 756e 6473 2e20 4966 2074 6865 2063  efunds. If the c
-000025d0: 6861 7267 6520 6973 2066 6f72 2061 6e20  harge is for an 
-000025e0: 496e 766f 6963 652c 2022 0a20 2020 2020  Invoice, ".     
-000025f0: 2020 2022 7468 6520 7265 6365 6970 7420     "the receipt 
-00002600: 7769 6c6c 2062 6520 7374 796c 697a 6564  will be stylized
-00002610: 2061 7320 616e 2049 6e76 6f69 6365 2072   as an Invoice r
-00002620: 6563 6569 7074 2e22 2c0a 2020 2020 290a  eceipt.",.    ).
-00002630: 2020 2020 7265 6675 6e64 6564 203d 206d      refunded = m
-00002640: 6f64 656c 732e 426f 6f6c 6561 6e46 6965  odels.BooleanFie
-00002650: 6c64 280a 2020 2020 2020 2020 6465 6661  ld(.        defa
-00002660: 756c 743d 4661 6c73 652c 0a20 2020 2020  ult=False,.     
-00002670: 2020 2068 656c 705f 7465 7874 3d22 5768     help_text="Wh
-00002680: 6574 6865 7220 6f72 206e 6f74 2074 6865  ether or not the
-00002690: 2063 6861 7267 6520 6861 7320 6265 656e   charge has been
-000026a0: 2066 756c 6c79 2072 6566 756e 6465 642e   fully refunded.
-000026b0: 2022 0a20 2020 2020 2020 2022 4966 2074   ".        "If t
-000026c0: 6865 2063 6861 7267 6520 6973 206f 6e6c  he charge is onl
-000026d0: 7920 7061 7274 6961 6c6c 7920 7265 6675  y partially refu
-000026e0: 6e64 6564 2c20 220a 2020 2020 2020 2020  nded, ".        
-000026f0: 2274 6869 7320 6174 7472 6962 7574 6520  "this attribute 
-00002700: 7769 6c6c 2073 7469 6c6c 2062 6520 6661  will still be fa
-00002710: 6c73 652e 222c 0a20 2020 2029 0a20 2020  lse.",.    ).   
-00002720: 2023 2054 4f44 4f3a 2072 6576 6965 7720   # TODO: review 
-00002730: 2872 6571 7569 7265 7320 5265 7669 6577  (requires Review
-00002740: 206d 6f64 656c 290a 2020 2020 7368 6970   model).    ship
-00002750: 7069 6e67 203d 204a 534f 4e46 6965 6c64  ping = JSONField
-00002760: 280a 2020 2020 2020 2020 6e75 6c6c 3d54  (.        null=T
-00002770: 7275 652c 2062 6c61 6e6b 3d54 7275 652c  rue, blank=True,
-00002780: 2068 656c 705f 7465 7874 3d22 5368 6970   help_text="Ship
-00002790: 7069 6e67 2069 6e66 6f72 6d61 7469 6f6e  ping information
-000027a0: 2066 6f72 2074 6865 2063 6861 7267 6522   for the charge"
-000027b0: 0a20 2020 2029 0a20 2020 2073 6f75 7263  .    ).    sourc
-000027c0: 6520 3d20 5061 796d 656e 744d 6574 686f  e = PaymentMetho
-000027d0: 6446 6f72 6569 676e 4b65 7928 0a20 2020  dForeignKey(.   
-000027e0: 2020 2020 206f 6e5f 6465 6c65 7465 3d6d       on_delete=m
-000027f0: 6f64 656c 732e 5345 545f 4e55 4c4c 2c0a  odels.SET_NULL,.
-00002800: 2020 2020 2020 2020 6e75 6c6c 3d54 7275          null=Tru
-00002810: 652c 0a20 2020 2020 2020 2062 6c61 6e6b  e,.        blank
-00002820: 3d54 7275 652c 0a20 2020 2020 2020 2072  =True,.        r
-00002830: 656c 6174 6564 5f6e 616d 653d 2263 6861  elated_name="cha
-00002840: 7267 6573 222c 0a20 2020 2020 2020 2068  rges",.        h
-00002850: 656c 705f 7465 7874 3d22 5468 6520 736f  elp_text="The so
-00002860: 7572 6365 2075 7365 6420 666f 7220 7468  urce used for th
-00002870: 6973 2063 6861 7267 652e 222c 0a20 2020  is charge.",.   
-00002880: 2029 0a20 2020 2073 6f75 7263 655f 7472   ).    source_tr
-00002890: 616e 7366 6572 203d 2053 7472 6970 6546  ansfer = StripeF
-000028a0: 6f72 6569 676e 4b65 7928 0a20 2020 2020  oreignKey(.     
-000028b0: 2020 2022 5472 616e 7366 6572 222c 0a20     "Transfer",. 
-000028c0: 2020 2020 2020 206e 756c 6c3d 5472 7565         null=True
-000028d0: 2c0a 2020 2020 2020 2020 626c 616e 6b3d  ,.        blank=
-000028e0: 5472 7565 2c0a 2020 2020 2020 2020 6f6e  True,.        on
-000028f0: 5f64 656c 6574 653d 6d6f 6465 6c73 2e43  _delete=models.C
-00002900: 4153 4341 4445 2c0a 2020 2020 2020 2020  ASCADE,.        
-00002910: 6865 6c70 5f74 6578 743d 2254 6865 2074  help_text="The t
-00002920: 7261 6e73 6665 7220 7768 6963 6820 6372  ransfer which cr
-00002930: 6561 7465 6420 7468 6973 2063 6861 7267  eated this charg
-00002940: 652e 204f 6e6c 7920 7072 6573 656e 7420  e. Only present 
-00002950: 6966 2074 6865 2022 0a20 2020 2020 2020  if the ".       
-00002960: 2022 6368 6172 6765 2063 616d 6520 6672   "charge came fr
-00002970: 6f6d 2061 6e6f 7468 6572 2053 7472 6970  om another Strip
-00002980: 6520 6163 636f 756e 742e 222c 0a20 2020  e account.",.   
-00002990: 2020 2020 2072 656c 6174 6564 5f6e 616d       related_nam
-000029a0: 653d 222b 222c 0a20 2020 2029 0a20 2020  e="+",.    ).   
-000029b0: 2073 7461 7465 6d65 6e74 5f64 6573 6372   statement_descr
-000029c0: 6970 746f 7220 3d20 6d6f 6465 6c73 2e43  iptor = models.C
-000029d0: 6861 7246 6965 6c64 280a 2020 2020 2020  harField(.      
-000029e0: 2020 6d61 785f 6c65 6e67 7468 3d32 322c    max_length=22,
-000029f0: 0a20 2020 2020 2020 206e 756c 6c3d 5472  .        null=Tr
-00002a00: 7565 2c0a 2020 2020 2020 2020 626c 616e  ue,.        blan
-00002a10: 6b3d 5472 7565 2c0a 2020 2020 2020 2020  k=True,.        
-00002a20: 6865 6c70 5f74 6578 743d 2246 6f72 2063  help_text="For c
-00002a30: 6172 6420 6368 6172 6765 732c 2075 7365  ard charges, use
-00002a40: 2073 7461 7465 6d65 6e74 5f64 6573 6372   statement_descr
-00002a50: 6970 746f 725f 7375 6666 6978 2069 6e73  iptor_suffix ins
-00002a60: 7465 6164 2e20 220a 2020 2020 2020 2020  tead. ".        
-00002a70: 224f 7468 6572 7769 7365 2c20 796f 7520  "Otherwise, you 
-00002a80: 6361 6e20 7573 6520 7468 6973 2076 616c  can use this val
-00002a90: 7565 2061 7320 7468 6520 636f 6d70 6c65  ue as the comple
-00002aa0: 7465 2064 6573 6372 6970 7469 6f6e 206f  te description o
-00002ab0: 6620 6120 220a 2020 2020 2020 2020 2263  f a ".        "c
-00002ac0: 6861 7267 6520 6f6e 2079 6f75 7220 6375  harge on your cu
-00002ad0: 7374 6f6d 6572 7327 2073 7461 7465 6d65  stomers' stateme
-00002ae0: 6e74 732e 204d 7573 7420 636f 6e74 6169  nts. Must contai
-00002af0: 6e20 6174 206c 6561 7374 206f 6e65 206c  n at least one l
-00002b00: 6574 7465 722c 2022 0a20 2020 2020 2020  etter, ".       
-00002b10: 2022 6d61 7869 6d75 6d20 3232 2063 6861   "maximum 22 cha
-00002b20: 7261 6374 6572 732e 222c 0a20 2020 2029  racters.",.    )
-00002b30: 0a20 2020 2073 7461 7465 6d65 6e74 5f64  .    statement_d
-00002b40: 6573 6372 6970 746f 725f 7375 6666 6978  escriptor_suffix
-00002b50: 203d 206d 6f64 656c 732e 4368 6172 4669   = models.CharFi
-00002b60: 656c 6428 0a20 2020 2020 2020 206d 6178  eld(.        max
-00002b70: 5f6c 656e 6774 683d 3232 2c0a 2020 2020  _length=22,.    
-00002b80: 2020 2020 6e75 6c6c 3d54 7275 652c 0a20      null=True,. 
-00002b90: 2020 2020 2020 2062 6c61 6e6b 3d54 7275         blank=Tru
-00002ba0: 652c 0a20 2020 2020 2020 2068 656c 705f  e,.        help_
-00002bb0: 7465 7874 3d22 5072 6f76 6964 6573 2069  text="Provides i
-00002bc0: 6e66 6f72 6d61 7469 6f6e 2061 626f 7574  nformation about
-00002bd0: 2074 6865 2063 6861 7267 6520 7468 6174   the charge that
-00002be0: 2063 7573 746f 6d65 7273 2073 6565 206f   customers see o
-00002bf0: 6e20 220a 2020 2020 2020 2020 2274 6865  n ".        "the
-00002c00: 6972 2073 7461 7465 6d65 6e74 732e 2043  ir statements. C
-00002c10: 6f6e 6361 7465 6e61 7465 6420 7769 7468  oncatenated with
-00002c20: 2074 6865 2070 7265 6669 7820 2873 686f   the prefix (sho
-00002c30: 7274 656e 6564 2064 6573 6372 6970 746f  rtened descripto
-00002c40: 7229 2022 0a20 2020 2020 2020 2022 6f72  r) ".        "or
-00002c50: 2073 7461 7465 6d65 6e74 2064 6573 6372   statement descr
-00002c60: 6970 746f 7220 7468 6174 2773 2073 6574  iptor that's set
-00002c70: 206f 6e20 7468 6520 6163 636f 756e 7420   on the account 
-00002c80: 746f 2066 6f72 6d20 7468 6520 220a 2020  to form the ".  
-00002c90: 2020 2020 2020 2263 6f6d 706c 6574 6520        "complete 
-00002ca0: 7374 6174 656d 656e 7420 6465 7363 7269  statement descri
-00002cb0: 7074 6f72 2e20 220a 2020 2020 2020 2020  ptor. ".        
-00002cc0: 224d 6178 696d 756d 2032 3220 6368 6172  "Maximum 22 char
-00002cd0: 6163 7465 7273 2066 6f72 2074 6865 2063  acters for the c
-00002ce0: 6f6e 6361 7465 6e61 7465 6420 6465 7363  oncatenated desc
-00002cf0: 7269 7074 6f72 2e22 2c0a 2020 2020 290a  riptor.",.    ).
-00002d00: 2020 2020 7374 6174 7573 203d 2053 7472      status = Str
-00002d10: 6970 6545 6e75 6d46 6965 6c64 280a 2020  ipeEnumField(.  
-00002d20: 2020 2020 2020 656e 756d 3d65 6e75 6d73        enum=enums
-00002d30: 2e43 6861 7267 6553 7461 7475 732c 2068  .ChargeStatus, h
-00002d40: 656c 705f 7465 7874 3d22 5468 6520 7374  elp_text="The st
-00002d50: 6174 7573 206f 6620 7468 6520 7061 796d  atus of the paym
-00002d60: 656e 742e 220a 2020 2020 290a 2020 2020  ent.".    ).    
-00002d70: 7472 616e 7366 6572 203d 2053 7472 6970  transfer = Strip
-00002d80: 6546 6f72 6569 676e 4b65 7928 0a20 2020  eForeignKey(.   
-00002d90: 2020 2020 2022 5472 616e 7366 6572 222c       "Transfer",
-00002da0: 0a20 2020 2020 2020 206f 6e5f 6465 6c65  .        on_dele
-00002db0: 7465 3d6d 6f64 656c 732e 4341 5343 4144  te=models.CASCAD
-00002dc0: 452c 0a20 2020 2020 2020 206e 756c 6c3d  E,.        null=
-00002dd0: 5472 7565 2c0a 2020 2020 2020 2020 626c  True,.        bl
-00002de0: 616e 6b3d 5472 7565 2c0a 2020 2020 2020  ank=True,.      
-00002df0: 2020 6865 6c70 5f74 6578 743d 280a 2020    help_text=(.  
-00002e00: 2020 2020 2020 2020 2020 2254 6865 2074            "The t
-00002e10: 7261 6e73 6665 7220 746f 2074 6865 2060  ransfer to the `
-00002e20: 6465 7374 696e 6174 696f 6e60 2061 6363  destination` acc
-00002e30: 6f75 6e74 2028 6f6e 6c79 2061 7070 6c69  ount (only appli
-00002e40: 6361 626c 6520 6966 2022 0a20 2020 2020  cable if ".     
-00002e50: 2020 2020 2020 2022 7468 6520 6368 6172         "the char
-00002e60: 6765 2077 6173 2063 7265 6174 6564 2075  ge was created u
-00002e70: 7369 6e67 2074 6865 2060 6465 7374 696e  sing the `destin
-00002e80: 6174 696f 6e60 2070 6172 616d 6574 6572  ation` parameter
-00002e90: 292e 220a 2020 2020 2020 2020 292c 0a20  ).".        ),. 
-00002ea0: 2020 2029 0a20 2020 2074 7261 6e73 6665     ).    transfe
-00002eb0: 725f 6461 7461 203d 204a 534f 4e46 6965  r_data = JSONFie
-00002ec0: 6c64 280a 2020 2020 2020 2020 6e75 6c6c  ld(.        null
-00002ed0: 3d54 7275 652c 0a20 2020 2020 2020 2062  =True,.        b
-00002ee0: 6c61 6e6b 3d54 7275 652c 0a20 2020 2020  lank=True,.     
-00002ef0: 2020 2068 656c 705f 7465 7874 3d22 416e     help_text="An
-00002f00: 206f 7074 696f 6e61 6c20 6469 6374 696f   optional dictio
-00002f10: 6e61 7279 2069 6e63 6c75 6469 6e67 2074  nary including t
-00002f20: 6865 2061 6363 6f75 6e74 2074 6f20 6175  he account to au
-00002f30: 746f 6d61 7469 6361 6c6c 7920 220a 2020  tomatically ".  
-00002f40: 2020 2020 2020 2274 7261 6e73 6665 7220        "transfer 
-00002f50: 746f 2061 7320 7061 7274 206f 6620 6120  to as part of a 
-00002f60: 6465 7374 696e 6174 696f 6e20 6368 6172  destination char
-00002f70: 6765 2e22 2c0a 2020 2020 290a 2020 2020  ge.",.    ).    
-00002f80: 7472 616e 7366 6572 5f67 726f 7570 203d  transfer_group =
-00002f90: 206d 6f64 656c 732e 4368 6172 4669 656c   models.CharFiel
-00002fa0: 6428 0a20 2020 2020 2020 206d 6178 5f6c  d(.        max_l
-00002fb0: 656e 6774 683d 3235 352c 0a20 2020 2020  ength=255,.     
-00002fc0: 2020 206e 756c 6c3d 5472 7565 2c0a 2020     null=True,.  
-00002fd0: 2020 2020 2020 626c 616e 6b3d 5472 7565        blank=True
-00002fe0: 2c0a 2020 2020 2020 2020 6865 6c70 5f74  ,.        help_t
-00002ff0: 6578 743d 2241 2073 7472 696e 6720 7468  ext="A string th
-00003000: 6174 2069 6465 6e74 6966 6965 7320 7468  at identifies th
-00003010: 6973 2074 7261 6e73 6163 7469 6f6e 2061  is transaction a
-00003020: 7320 7061 7274 206f 6620 6120 6772 6f75  s part of a grou
-00003030: 702e 222c 0a20 2020 2029 0a0a 2020 2020  p.",.    )..    
-00003040: 6f62 6a65 6374 7320 3d20 4368 6172 6765  objects = Charge
-00003050: 4d61 6e61 6765 7228 290a 0a20 2020 2064  Manager()..    d
-00003060: 6566 205f 5f73 7472 5f5f 2873 656c 6629  ef __str__(self)
-00003070: 3a0a 2020 2020 2020 2020 616d 6f75 6e74  :.        amount
-00003080: 203d 2067 6574 5f66 7269 656e 646c 795f   = get_friendly_
-00003090: 6375 7272 656e 6379 5f61 6d6f 756e 7428  currency_amount(
-000030a0: 7365 6c66 2e61 6d6f 756e 742c 2073 656c  self.amount, sel
-000030b0: 662e 6375 7272 656e 6379 290a 2020 2020  f.currency).    
-000030c0: 2020 2020 7265 7475 726e 2066 227b 616d      return f"{am
-000030d0: 6f75 6e74 7d20 287b 7365 6c66 2e68 756d  ount} ({self.hum
-000030e0: 616e 5f72 6561 6461 626c 655f 7374 6174  an_readable_stat
-000030f0: 7573 7d29 220a 0a20 2020 2040 7072 6f70  us})"..    @prop
-00003100: 6572 7479 0a20 2020 2064 6566 2066 6565  erty.    def fee
-00003110: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00003120: 6966 2073 656c 662e 6261 6c61 6e63 655f  if self.balance_
-00003130: 7472 616e 7361 6374 696f 6e3a 0a20 2020  transaction:.   
-00003140: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00003150: 7365 6c66 2e62 616c 616e 6365 5f74 7261  self.balance_tra
-00003160: 6e73 6163 7469 6f6e 2e66 6565 0a0a 2020  nsaction.fee..  
-00003170: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
-00003180: 6465 6620 6875 6d61 6e5f 7265 6164 6162  def human_readab
-00003190: 6c65 5f73 7461 7475 7328 7365 6c66 2920  le_status(self) 
-000031a0: 2d3e 2073 7472 3a0a 2020 2020 2020 2020  -> str:.        
-000031b0: 6966 206e 6f74 2073 656c 662e 6361 7074  if not self.capt
-000031c0: 7572 6564 3a0a 2020 2020 2020 2020 2020  ured:.          
-000031d0: 2020 7265 7475 726e 2022 556e 6361 7074    return "Uncapt
-000031e0: 7572 6564 220a 2020 2020 2020 2020 656c  ured".        el
-000031f0: 6966 2073 656c 662e 6469 7370 7574 6564  if self.disputed
-00003200: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00003210: 7475 726e 2022 4469 7370 7574 6564 220a  turn "Disputed".
-00003220: 2020 2020 2020 2020 656c 6966 2073 656c          elif sel
-00003230: 662e 7265 6675 6e64 6564 3a0a 2020 2020  f.refunded:.    
-00003240: 2020 2020 2020 2020 7265 7475 726e 2022          return "
-00003250: 5265 6675 6e64 6564 220a 2020 2020 2020  Refunded".      
-00003260: 2020 7265 7475 726e 2065 6e75 6d73 2e43    return enums.C
-00003270: 6861 7267 6553 7461 7475 732e 6875 6d61  hargeStatus.huma
-00003280: 6e69 7a65 2873 656c 662e 7374 6174 7573  nize(self.status
-00003290: 290a 0a20 2020 2040 7072 6f70 6572 7479  )..    @property
-000032a0: 0a20 2020 2064 6566 2066 7261 7564 756c  .    def fraudul
-000032b0: 656e 7428 7365 6c66 2920 2d3e 2062 6f6f  ent(self) -> boo
-000032c0: 6c3a 0a20 2020 2020 2020 2072 6574 7572  l:.        retur
-000032d0: 6e20 280a 2020 2020 2020 2020 2020 2020  n (.            
-000032e0: 7365 6c66 2e66 7261 7564 5f64 6574 6169  self.fraud_detai
-000032f0: 6c73 2061 6e64 206c 6973 7428 7365 6c66  ls and list(self
-00003300: 2e66 7261 7564 5f64 6574 6169 6c73 2e76  .fraud_details.v
-00003310: 616c 7565 7328 2929 5b30 5d20 3d3d 2022  alues())[0] == "
-00003320: 6672 6175 6475 6c65 6e74 220a 2020 2020  fraudulent".    
-00003330: 2020 2020 290a 0a20 2020 2064 6566 205f      )..    def _
-00003340: 6361 6c63 756c 6174 655f 7265 6675 6e64  calculate_refund
-00003350: 5f61 6d6f 756e 7428 7365 6c66 2c20 616d  _amount(self, am
-00003360: 6f75 6e74 3a20 4f70 7469 6f6e 616c 5b44  ount: Optional[D
-00003370: 6563 696d 616c 5d29 202d 3e20 696e 743a  ecimal]) -> int:
-00003380: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00003390: 2020 2020 2052 6574 7572 6e73 2074 6865       Returns the
-000033a0: 2061 6d6f 756e 7420 7468 6174 2063 616e   amount that can
-000033b0: 2062 6520 7265 6675 6e64 6564 2028 696e   be refunded (in
-000033c0: 2063 656e 7473 290a 2020 2020 2020 2020   cents).        
-000033d0: 2222 220a 2020 2020 2020 2020 656c 6967  """.        elig
-000033e0: 6962 6c65 5f74 6f5f 7265 6675 6e64 203d  ible_to_refund =
-000033f0: 2073 656c 662e 616d 6f75 6e74 202d 2028   self.amount - (
-00003400: 7365 6c66 2e61 6d6f 756e 745f 7265 6675  self.amount_refu
-00003410: 6e64 6564 206f 7220 3029 0a20 2020 2020  nded or 0).     
-00003420: 2020 2061 6d6f 756e 745f 746f 5f72 6566     amount_to_ref
-00003430: 756e 6420 3d20 280a 2020 2020 2020 2020  und = (.        
-00003440: 2020 2020 6d69 6e28 656c 6967 6962 6c65      min(eligible
-00003450: 5f74 6f5f 7265 6675 6e64 2c20 616d 6f75  _to_refund, amou
-00003460: 6e74 2920 6966 2061 6d6f 756e 7420 656c  nt) if amount el
-00003470: 7365 2065 6c69 6769 626c 655f 746f 5f72  se eligible_to_r
-00003480: 6566 756e 640a 2020 2020 2020 2020 290a  efund.        ).
-00003490: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000034a0: 696e 7428 616d 6f75 6e74 5f74 6f5f 7265  int(amount_to_re
-000034b0: 6675 6e64 202a 2031 3030 290a 0a20 2020  fund * 100)..   
-000034c0: 2064 6566 2072 6566 756e 6428 7365 6c66   def refund(self
-000034d0: 2c20 616d 6f75 6e74 3a20 4465 6369 6d61  , amount: Decima
-000034e0: 6c20 3d20 4e6f 6e65 2c20 7265 6173 6f6e  l = None, reason
-000034f0: 3a20 7374 7220 3d20 4e6f 6e65 2920 2d3e  : str = None) ->
-00003500: 2022 4368 6172 6765 223a 0a20 2020 2020   "Charge":.     
-00003510: 2020 2022 2222 0a20 2020 2020 2020 2049     """.        I
-00003520: 6e69 7469 6174 6520 6120 7265 6675 6e64  nitiate a refund
-00003530: 2e20 5265 7475 726e 7320 7468 6520 6368  . Returns the ch
-00003540: 6172 6765 206f 626a 6563 742e 0a0a 2020  arge object...  
-00003550: 2020 2020 2020 3a70 6172 616d 2061 6d6f        :param amo
-00003560: 756e 743a 2041 2070 6f73 6974 6976 6520  unt: A positive 
-00003570: 6465 6369 6d61 6c20 616d 6f75 6e74 2072  decimal amount r
-00003580: 6570 7265 7365 6e74 696e 6720 686f 7720  epresenting how 
-00003590: 6d75 6368 206f 6620 7468 6973 2063 6861  much of this cha
-000035a0: 7267 650a 2020 2020 2020 2020 2020 2020  rge.            
-000035b0: 746f 2072 6566 756e 642e 2049 6620 616d  to refund. If am
-000035c0: 6f75 6e74 2069 7320 6e6f 7420 7072 6f76  ount is not prov
-000035d0: 6964 6564 2c20 7468 656e 2074 6869 7320  ided, then this 
-000035e0: 7769 6c6c 2062 6520 6120 6675 6c6c 2072  will be a full r
-000035f0: 6566 756e 642e 0a20 2020 2020 2020 2020  efund..         
-00003600: 2020 2043 616e 206f 6e6c 7920 7265 6675     Can only refu
-00003610: 6e64 2075 7020 746f 2074 6865 2075 6e72  nd up to the unr
-00003620: 6566 756e 6465 6420 616d 6f75 6e74 2072  efunded amount r
-00003630: 656d 6169 6e69 6e67 206f 6620 7468 6520  emaining of the 
-00003640: 6368 6172 6765 2e0a 2020 2020 2020 2020  charge..        
-00003650: 3a70 6172 616d 2072 6561 736f 6e3a 2053  :param reason: S
-00003660: 7472 696e 6720 696e 6469 6361 7469 6e67  tring indicating
-00003670: 2074 6865 2072 6561 736f 6e20 666f 7220   the reason for 
-00003680: 7468 6520 7265 6675 6e64 2e0a 2020 2020  the refund..    
-00003690: 2020 2020 2020 2020 4966 2073 6574 2c20          If set, 
-000036a0: 706f 7373 6962 6c65 2076 616c 7565 7320  possible values 
-000036b0: 6172 6520 6060 6475 706c 6963 6174 6560  are ``duplicate`
-000036c0: 602c 2060 6066 7261 7564 756c 656e 7460  `, ``fraudulent`
-000036d0: 602c 0a20 2020 2020 2020 2020 2020 2061  `,.            a
-000036e0: 6e64 2060 6072 6571 7565 7374 6564 5f62  nd ``requested_b
-000036f0: 795f 6375 7374 6f6d 6572 6060 2e20 5370  y_customer``. Sp
-00003700: 6563 6966 7969 6e67 2060 6066 7261 7564  ecifying ``fraud
-00003710: 756c 656e 7460 6020 6173 2074 6865 2072  ulent`` as the r
-00003720: 6561 736f 6e0a 2020 2020 2020 2020 2020  eason.          
-00003730: 2020 7768 656e 2079 6f75 2062 656c 6965    when you belie
-00003740: 7665 2074 6865 2063 6861 7267 6520 746f  ve the charge to
-00003750: 2062 6520 6672 6175 6475 6c65 6e74 2077   be fraudulent w
-00003760: 696c 6c0a 2020 2020 2020 2020 2020 2020  ill.            
-00003770: 6865 6c70 2053 7472 6970 6520 696d 7072  help Stripe impr
-00003780: 6f76 6520 7468 6569 7220 6672 6175 6420  ove their fraud 
-00003790: 6465 7465 6374 696f 6e20 616c 676f 7269  detection algori
-000037a0: 7468 6d73 2e0a 2020 2020 2020 2020 2222  thms..        ""
-000037b0: 220a 2020 2020 2020 2020 6368 6172 6765  ".        charge
-000037c0: 5f6f 626a 203d 2073 656c 662e 6170 695f  _obj = self.api_
-000037d0: 7265 7472 6965 7665 2829 2e72 6566 756e  retrieve().refun
-000037e0: 6428 0a20 2020 2020 2020 2020 2020 2061  d(.            a
-000037f0: 6d6f 756e 743d 7365 6c66 2e5f 6361 6c63  mount=self._calc
-00003800: 756c 6174 655f 7265 6675 6e64 5f61 6d6f  ulate_refund_amo
-00003810: 756e 7428 616d 6f75 6e74 3d61 6d6f 756e  unt(amount=amoun
-00003820: 7429 2c20 7265 6173 6f6e 3d72 6561 736f  t), reason=reaso
-00003830: 6e0a 2020 2020 2020 2020 290a 2020 2020  n.        ).    
-00003840: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00003850: 5f5f 636c 6173 735f 5f2e 7379 6e63 5f66  __class__.sync_f
-00003860: 726f 6d5f 7374 7269 7065 5f64 6174 6128  rom_stripe_data(
-00003870: 0a20 2020 2020 2020 2020 2020 2063 6861  .            cha
-00003880: 7267 655f 6f62 6a2c 2061 7069 5f6b 6579  rge_obj, api_key
-00003890: 3d73 656c 662e 6465 6661 756c 745f 6170  =self.default_ap
-000038a0: 695f 6b65 790a 2020 2020 2020 2020 290a  i_key.        ).
-000038b0: 0a20 2020 2064 6566 2063 6170 7475 7265  .    def capture
-000038c0: 2873 656c 662c 202a 2a6b 7761 7267 7329  (self, **kwargs)
-000038d0: 202d 3e20 2243 6861 7267 6522 3a0a 2020   -> "Charge":.  
-000038e0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-000038f0: 2020 4361 7074 7572 6520 7468 6520 7061    Capture the pa
-00003900: 796d 656e 7420 6f66 2061 6e20 6578 6973  yment of an exis
-00003910: 7469 6e67 2c20 756e 6361 7074 7572 6564  ting, uncaptured
-00003920: 2c20 6368 6172 6765 2e0a 2020 2020 2020  , charge..      
-00003930: 2020 5468 6973 2069 7320 7468 6520 7365    This is the se
-00003940: 636f 6e64 2068 616c 6620 6f66 2074 6865  cond half of the
-00003950: 2074 776f 2d73 7465 7020 7061 796d 656e   two-step paymen
-00003960: 7420 666c 6f77 2c20 7768 6572 6520 6669  t flow, where fi
-00003970: 7273 7420 796f 750a 2020 2020 2020 2020  rst you.        
-00003980: 6372 6561 7465 6420 6120 6368 6172 6765  created a charge
-00003990: 2077 6974 6820 7468 6520 6361 7074 7572   with the captur
-000039a0: 6520 6f70 7469 6f6e 2073 6574 2074 6f20  e option set to 
-000039b0: 4661 6c73 652e 0a0a 2020 2020 2020 2020  False...        
-000039c0: 5365 6520 6874 7470 733a 2f2f 7374 7269  See https://stri
-000039d0: 7065 2e63 6f6d 2f64 6f63 732f 6170 6923  pe.com/docs/api#
-000039e0: 6361 7074 7572 655f 6368 6172 6765 0a20  capture_charge. 
-000039f0: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
-00003a00: 2020 2020 6361 7074 7572 6564 5f63 6861      captured_cha
-00003a10: 7267 6520 3d20 7365 6c66 2e61 7069 5f72  rge = self.api_r
-00003a20: 6574 7269 6576 6528 292e 6361 7074 7572  etrieve().captur
-00003a30: 6528 2a2a 6b77 6172 6773 290a 2020 2020  e(**kwargs).    
-00003a40: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00003a50: 5f5f 636c 6173 735f 5f2e 7379 6e63 5f66  __class__.sync_f
-00003a60: 726f 6d5f 7374 7269 7065 5f64 6174 6128  rom_stripe_data(
-00003a70: 0a20 2020 2020 2020 2020 2020 2063 6170  .            cap
-00003a80: 7475 7265 645f 6368 6172 6765 2c20 6170  tured_charge, ap
-00003a90: 695f 6b65 793d 7365 6c66 2e64 6566 6175  i_key=self.defau
-00003aa0: 6c74 5f61 7069 5f6b 6579 0a20 2020 2020  lt_api_key.     
-00003ab0: 2020 2029 0a0a 2020 2020 6465 6620 5f61     )..    def _a
-00003ac0: 7474 6163 685f 6f62 6a65 6374 735f 706f  ttach_objects_po
-00003ad0: 7374 5f73 6176 655f 686f 6f6b 280a 2020  st_save_hook(.  
-00003ae0: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-00003af0: 2020 2020 636c 732c 0a20 2020 2020 2020      cls,.       
-00003b00: 2064 6174 612c 0a20 2020 2020 2020 2070   data,.        p
-00003b10: 656e 6469 6e67 5f72 656c 6174 696f 6e73  ending_relations
-00003b20: 3d4e 6f6e 652c 0a20 2020 2020 2020 2061  =None,.        a
-00003b30: 7069 5f6b 6579 3d64 6a73 7472 6970 655f  pi_key=djstripe_
-00003b40: 7365 7474 696e 6773 2e53 5452 4950 455f  settings.STRIPE_
-00003b50: 5345 4352 4554 5f4b 4559 2c0a 2020 2020  SECRET_KEY,.    
-00003b60: 293a 0a20 2020 2020 2020 2073 7570 6572  ):.        super
-00003b70: 2829 2e5f 6174 7461 6368 5f6f 626a 6563  ()._attach_objec
-00003b80: 7473 5f70 6f73 745f 7361 7665 5f68 6f6f  ts_post_save_hoo
-00003b90: 6b28 0a20 2020 2020 2020 2020 2020 2063  k(.            c
-00003ba0: 6c73 2c20 6461 7461 2c20 7065 6e64 696e  ls, data, pendin
-00003bb0: 675f 7265 6c61 7469 6f6e 733d 7065 6e64  g_relations=pend
-00003bc0: 696e 675f 7265 6c61 7469 6f6e 732c 2061  ing_relations, a
-00003bd0: 7069 5f6b 6579 3d61 7069 5f6b 6579 0a20  pi_key=api_key. 
-00003be0: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-00003bf0: 2020 636c 732e 5f73 7472 6970 655f 6f62    cls._stripe_ob
-00003c00: 6a65 6374 5f74 6f5f 7265 6675 6e64 7328  ject_to_refunds(
-00003c10: 0a20 2020 2020 2020 2020 2020 2074 6172  .            tar
-00003c20: 6765 745f 636c 733d 5265 6675 6e64 2c20  get_cls=Refund, 
-00003c30: 6461 7461 3d64 6174 612c 2063 6861 7267  data=data, charg
-00003c40: 653d 7365 6c66 2c20 6170 695f 6b65 793d  e=self, api_key=
-00003c50: 6170 695f 6b65 790a 2020 2020 2020 2020  api_key.        
-00003c60: 290a 0a0a 2320 544f 444f 2041 6464 2054  )...# TODO Add T
-00003c70: 6573 7473 0a63 6c61 7373 204d 616e 6461  ests.class Manda
-00003c80: 7465 2853 7472 6970 654d 6f64 656c 293a  te(StripeModel):
-00003c90: 0a20 2020 2022 2222 0a20 2020 2041 204d  .    """.    A M
-00003ca0: 616e 6461 7465 2069 7320 6120 7265 636f  andate is a reco
-00003cb0: 7264 206f 6620 7468 6520 7065 726d 6973  rd of the permis
-00003cc0: 7369 6f6e 2061 2063 7573 746f 6d65 7220  sion a customer 
-00003cd0: 6861 7320 6769 7665 6e20 796f 7520 746f  has given you to
-00003ce0: 2064 6562 6974 2074 6865 6972 2070 6179   debit their pay
-00003cf0: 6d65 6e74 206d 6574 686f 642e 0a0a 2020  ment method...  
-00003d00: 2020 6874 7470 733a 2f2f 7374 7269 7065    https://stripe
-00003d10: 2e63 6f6d 2f64 6f63 732f 6170 692f 6d61  .com/docs/api/ma
-00003d20: 6e64 6174 6573 0a20 2020 2022 2222 0a0a  ndates.    """..
-00003d30: 2020 2020 7374 7269 7065 5f63 6c61 7373      stripe_class
-00003d40: 203d 2073 7472 6970 652e 4d61 6e64 6174   = stripe.Mandat
-00003d50: 650a 0a20 2020 2063 7573 746f 6d65 725f  e..    customer_
-00003d60: 6163 6365 7074 616e 6365 203d 204a 534f  acceptance = JSO
-00003d70: 4e46 6965 6c64 280a 2020 2020 2020 2020  NField(.        
-00003d80: 6865 6c70 5f74 6578 743d 2244 6574 6169  help_text="Detai
-00003d90: 6c73 2061 626f 7574 2074 6865 2063 7573  ls about the cus
-00003da0: 746f 6d65 7227 7320 6163 6365 7074 616e  tomer's acceptan
-00003db0: 6365 206f 6620 7468 6520 6d61 6e64 6174  ce of the mandat
-00003dc0: 652e 220a 2020 2020 290a 2020 2020 7061  e.".    ).    pa
-00003dd0: 796d 656e 745f 6d65 7468 6f64 203d 2053  yment_method = S
-00003de0: 7472 6970 6546 6f72 6569 676e 4b65 7928  tripeForeignKey(
-00003df0: 2270 6179 6d65 6e74 6d65 7468 6f64 222c  "paymentmethod",
-00003e00: 206f 6e5f 6465 6c65 7465 3d6d 6f64 656c   on_delete=model
-00003e10: 732e 4341 5343 4144 4529 0a20 2020 2070  s.CASCADE).    p
-00003e20: 6179 6d65 6e74 5f6d 6574 686f 645f 6465  ayment_method_de
-00003e30: 7461 696c 7320 3d20 4a53 4f4e 4669 656c  tails = JSONFiel
-00003e40: 6428 0a20 2020 2020 2020 2068 656c 705f  d(.        help_
-00003e50: 7465 7874 3d22 4164 6469 7469 6f6e 616c  text="Additional
-00003e60: 206d 616e 6461 7465 2069 6e66 6f72 6d61   mandate informa
-00003e70: 7469 6f6e 2073 7065 6369 6669 6320 746f  tion specific to
-00003e80: 2074 6865 2070 6179 6d65 6e74 206d 6574   the payment met
-00003e90: 686f 6420 7479 7065 2e22 0a20 2020 2029  hod type.".    )
-00003ea0: 0a20 2020 2073 7461 7475 7320 3d20 5374  .    status = St
-00003eb0: 7269 7065 456e 756d 4669 656c 6428 0a20  ripeEnumField(. 
-00003ec0: 2020 2020 2020 2065 6e75 6d3d 656e 756d         enum=enum
-00003ed0: 732e 4d61 6e64 6174 6553 7461 7475 732c  s.MandateStatus,
-00003ee0: 0a20 2020 2020 2020 2068 656c 705f 7465  .        help_te
-00003ef0: 7874 3d22 5468 6520 7374 6174 7573 206f  xt="The status o
-00003f00: 6620 7468 6520 6d61 6e64 6174 652c 2077  f the mandate, w
-00003f10: 6869 6368 2069 6e64 6963 6174 6573 2077  hich indicates w
-00003f20: 6865 7468 6572 2069 7420 6361 6e20 6265  hether it can be
-00003f30: 2075 7365 6420 746f 2069 6e69 7469 6174   used to initiat
-00003f40: 6520 6120 7061 796d 656e 742e 222c 0a20  e a payment.",. 
-00003f50: 2020 2029 0a20 2020 2074 7970 6520 3d20     ).    type = 
-00003f60: 5374 7269 7065 456e 756d 4669 656c 6428  StripeEnumField(
-00003f70: 0a20 2020 2020 2020 2065 6e75 6d3d 656e  .        enum=en
-00003f80: 756d 732e 4d61 6e64 6174 6554 7970 652c  ums.MandateType,
-00003f90: 0a20 2020 2020 2020 2068 656c 705f 7465  .        help_te
-00003fa0: 7874 3d22 5468 6520 7374 6174 7573 206f  xt="The status o
-00003fb0: 6620 7468 6520 6d61 6e64 6174 652c 2077  f the mandate, w
-00003fc0: 6869 6368 2069 6e64 6963 6174 6573 2077  hich indicates w
-00003fd0: 6865 7468 6572 2069 7420 6361 6e20 6265  hether it can be
-00003fe0: 2075 7365 6420 746f 2069 6e69 7469 6174   used to initiat
-00003ff0: 6520 6120 7061 796d 656e 742e 222c 0a20  e a payment.",. 
-00004000: 2020 2029 0a20 2020 206d 756c 7469 5f75     ).    multi_u
-00004010: 7365 203d 204a 534f 4e46 6965 6c64 280a  se = JSONField(.
-00004020: 2020 2020 2020 2020 6e75 6c6c 3d54 7275          null=Tru
-00004030: 652c 0a20 2020 2020 2020 2062 6c61 6e6b  e,.        blank
-00004040: 3d54 7275 652c 0a20 2020 2020 2020 2068  =True,.        h
-00004050: 656c 705f 7465 7874 3d22 4966 2074 6869  elp_text="If thi
-00004060: 7320 6973 2061 2060 6d75 6c74 695f 7573  s is a `multi_us
-00004070: 6560 206d 616e 6461 7465 2c20 7468 6973  e` mandate, this
-00004080: 2068 6173 6820 636f 6e74 6169 6e73 2064   hash contains d
-00004090: 6574 6169 6c73 2061 626f 7574 2074 6865  etails about the
-000040a0: 206d 616e 6461 7465 2e22 2c0a 2020 2020   mandate.",.    
-000040b0: 290a 2020 2020 7369 6e67 6c65 5f75 7365  ).    single_use
-000040c0: 203d 204a 534f 4e46 6965 6c64 280a 2020   = JSONField(.  
-000040d0: 2020 2020 2020 6e75 6c6c 3d54 7275 652c        null=True,
-000040e0: 0a20 2020 2020 2020 2062 6c61 6e6b 3d54  .        blank=T
-000040f0: 7275 652c 0a20 2020 2020 2020 2068 656c  rue,.        hel
-00004100: 705f 7465 7874 3d22 4966 2074 6869 7320  p_text="If this 
-00004110: 6973 2061 2060 7369 6e67 6c65 5f75 7365  is a `single_use
-00004120: 6020 6d61 6e64 6174 652c 2074 6869 7320  ` mandate, this 
-00004130: 6861 7368 2063 6f6e 7461 696e 7320 6465  hash contains de
-00004140: 7461 696c 7320 6162 6f75 7420 7468 6520  tails about the 
-00004150: 6d61 6e64 6174 652e 222c 0a20 2020 2029  mandate.",.    )
-00004160: 0a0a 0a63 6c61 7373 2050 726f 6475 6374  ...class Product
-00004170: 2853 7472 6970 654d 6f64 656c 293a 0a20  (StripeModel):. 
-00004180: 2020 2022 2222 0a20 2020 2050 726f 6475     """.    Produ
-00004190: 6374 7320 6465 7363 7269 6265 2074 6865  cts describe the
-000041a0: 2073 7065 6369 6669 6320 676f 6f64 7320   specific goods 
-000041b0: 6f72 2073 6572 7669 6365 7320 796f 7520  or services you 
-000041c0: 6f66 6665 7220 746f 2079 6f75 7220 6375  offer to your cu
-000041d0: 7374 6f6d 6572 732e 0a20 2020 2046 6f72  stomers..    For
-000041e0: 2065 7861 6d70 6c65 2c20 796f 7520 6d69   example, you mi
-000041f0: 6768 7420 6f66 6665 7220 6120 5374 616e  ght offer a Stan
-00004200: 6461 7264 2061 6e64 2050 7265 6d69 756d  dard and Premium
-00004210: 2076 6572 7369 6f6e 206f 6620 796f 7572   version of your
-00004220: 2067 6f6f 6473 206f 7220 7365 7276 6963   goods or servic
-00004230: 653b 0a20 2020 2065 6163 6820 7665 7273  e;.    each vers
-00004240: 696f 6e20 776f 756c 6420 6265 2061 2073  ion would be a s
-00004250: 6570 6172 6174 6520 5072 6f64 7563 742e  eparate Product.
-00004260: 2054 6865 7920 6361 6e20 6265 2075 7365   They can be use
-00004270: 6420 696e 2063 6f6e 6a75 6e63 7469 6f6e  d in conjunction
-00004280: 2077 6974 680a 2020 2020 5072 6963 6573   with.    Prices
-00004290: 2074 6f20 636f 6e66 6967 7572 6520 7072   to configure pr
-000042a0: 6963 696e 6720 696e 2050 6179 6d65 6e74  icing in Payment
-000042b0: 204c 696e 6b73 2c20 4368 6563 6b6f 7574   Links, Checkout
-000042c0: 2c20 616e 6420 5375 6273 6372 6970 7469  , and Subscripti
-000042d0: 6f6e 732e 0a0a 2020 2020 5374 7269 7065  ons...    Stripe
-000042e0: 2064 6f63 756d 656e 7461 7469 6f6e 3a20   documentation: 
-000042f0: 6874 7470 733a 2f2f 7374 7269 7065 2e63  https://stripe.c
-00004300: 6f6d 2f64 6f63 732f 6170 693f 6c61 6e67  om/docs/api?lang
-00004310: 3d70 7974 686f 6e23 7072 6f64 7563 7473  =python#products
-00004320: 0a20 2020 2022 2222 0a0a 2020 2020 7374  .    """..    st
-00004330: 7269 7065 5f63 6c61 7373 203d 2073 7472  ripe_class = str
-00004340: 6970 652e 5072 6f64 7563 740a 2020 2020  ipe.Product.    
-00004350: 7374 7269 7065 5f64 6173 6862 6f61 7264  stripe_dashboard
-00004360: 5f69 7465 6d5f 6e61 6d65 203d 2022 7072  _item_name = "pr
-00004370: 6f64 7563 7473 220a 0a20 2020 2023 2046  oducts"..    # F
-00004380: 6965 6c64 7320 6170 706c 6963 6162 6c65  ields applicable
-00004390: 2074 6f20 626f 7468 2060 676f 6f64 6020   to both `good` 
-000043a0: 616e 6420 6073 6572 7669 6365 600a 2020  and `service`.  
-000043b0: 2020 6e61 6d65 203d 206d 6f64 656c 732e    name = models.
-000043c0: 5465 7874 4669 656c 6428 0a20 2020 2020  TextField(.     
-000043d0: 2020 206d 6178 5f6c 656e 6774 683d 3530     max_length=50
-000043e0: 3030 2c0a 2020 2020 2020 2020 6865 6c70  00,.        help
-000043f0: 5f74 6578 743d 280a 2020 2020 2020 2020  _text=(.        
-00004400: 2020 2020 2254 6865 2070 726f 6475 6374      "The product
-00004410: 2773 206e 616d 652c 206d 6561 6e74 2074  's name, meant t
-00004420: 6f20 6265 2064 6973 706c 6179 6162 6c65  o be displayable
-00004430: 2074 6f20 7468 6520 6375 7374 6f6d 6572   to the customer
-00004440: 2e20 220a 2020 2020 2020 2020 2020 2020  . ".            
-00004450: 2241 7070 6c69 6361 626c 6520 746f 2062  "Applicable to b
-00004460: 6f74 6820 6073 6572 7669 6365 6020 616e  oth `service` an
-00004470: 6420 6067 6f6f 6460 2074 7970 6573 2e22  d `good` types."
-00004480: 0a20 2020 2020 2020 2029 2c0a 2020 2020  .        ),.    
-00004490: 290a 2020 2020 7479 7065 203d 2053 7472  ).    type = Str
-000044a0: 6970 6545 6e75 6d46 6965 6c64 280a 2020  ipeEnumField(.  
-000044b0: 2020 2020 2020 656e 756d 3d65 6e75 6d73        enum=enums
-000044c0: 2e50 726f 6475 6374 5479 7065 2c0a 2020  .ProductType,.  
-000044d0: 2020 2020 2020 6865 6c70 5f74 6578 743d        help_text=
-000044e0: 280a 2020 2020 2020 2020 2020 2020 2254  (.            "T
-000044f0: 6865 2074 7970 6520 6f66 2074 6865 2070  he type of the p
-00004500: 726f 6475 6374 2e20 5468 6520 7072 6f64  roduct. The prod
-00004510: 7563 7420 6973 2065 6974 6865 7220 6f66  uct is either of
-00004520: 2074 7970 6520 6067 6f6f 6460 2c20 7768   type `good`, wh
-00004530: 6963 6820 6973 2022 0a20 2020 2020 2020  ich is ".       
-00004540: 2020 2020 2022 656c 6967 6962 6c65 2066       "eligible f
-00004550: 6f72 2075 7365 2077 6974 6820 4f72 6465  or use with Orde
-00004560: 7273 2061 6e64 2053 4b55 732c 206f 7220  rs and SKUs, or 
-00004570: 6073 6572 7669 6365 602c 2077 6869 6368  `service`, which
-00004580: 2069 7320 656c 6967 6962 6c65 2022 0a20   is eligible ". 
-00004590: 2020 2020 2020 2020 2020 2022 666f 7220             "for 
-000045a0: 7573 6520 7769 7468 2053 7562 7363 7269  use with Subscri
-000045b0: 7074 696f 6e73 2061 6e64 2050 6c61 6e73  ptions and Plans
-000045c0: 2e22 0a20 2020 2020 2020 2029 2c0a 2020  .".        ),.  
-000045d0: 2020 290a 0a20 2020 2023 2046 6965 6c64    )..    # Field
-000045e0: 7320 6170 706c 6963 6162 6c65 2074 6f20  s applicable to 
-000045f0: 6067 6f6f 6460 206f 6e6c 790a 2020 2020  `good` only.    
-00004600: 6163 7469 7665 203d 206d 6f64 656c 732e  active = models.
-00004610: 426f 6f6c 6561 6e46 6965 6c64 280a 2020  BooleanField(.  
-00004620: 2020 2020 2020 6e75 6c6c 3d54 7275 652c        null=True,
-00004630: 0a20 2020 2020 2020 2068 656c 705f 7465  .        help_te
-00004640: 7874 3d28 0a20 2020 2020 2020 2020 2020  xt=(.           
-00004650: 2022 5768 6574 6865 7220 7468 6520 7072   "Whether the pr
-00004660: 6f64 7563 7420 6973 2063 7572 7265 6e74  oduct is current
-00004670: 6c79 2061 7661 696c 6162 6c65 2066 6f72  ly available for
-00004680: 2070 7572 6368 6173 652e 2022 0a20 2020   purchase. ".   
-00004690: 2020 2020 2020 2020 2022 4f6e 6c79 2061           "Only a
-000046a0: 7070 6c69 6361 626c 6520 746f 2070 726f  pplicable to pro
-000046b0: 6475 6374 7320 6f66 2060 7479 7065 3d67  ducts of `type=g
-000046c0: 6f6f 6460 2e22 0a20 2020 2020 2020 2029  ood`.".        )
-000046d0: 2c0a 2020 2020 290a 2020 2020 6174 7472  ,.    ).    attr
-000046e0: 6962 7574 6573 203d 204a 534f 4e46 6965  ibutes = JSONFie
-000046f0: 6c64 280a 2020 2020 2020 2020 6e75 6c6c  ld(.        null
-00004700: 3d54 7275 652c 0a20 2020 2020 2020 2062  =True,.        b
-00004710: 6c61 6e6b 3d54 7275 652c 0a20 2020 2020  lank=True,.     
-00004720: 2020 2068 656c 705f 7465 7874 3d28 0a20     help_text=(. 
-00004730: 2020 2020 2020 2020 2020 2022 4120 6c69             "A li
-00004740: 7374 206f 6620 7570 2074 6f20 3520 6174  st of up to 5 at
-00004750: 7472 6962 7574 6573 2074 6861 7420 6561  tributes that ea
-00004760: 6368 2053 4b55 2063 616e 2070 726f 7669  ch SKU can provi
-00004770: 6465 2076 616c 7565 7320 666f 7220 220a  de values for ".
-00004780: 2020 2020 2020 2020 2020 2020 2728 652e              '(e.
-00004790: 672e 2c20 605b 2263 6f6c 6f72 222c 2022  g., `["color", "
-000047a0: 7369 7a65 225d 6029 2e20 4f6e 6c79 2061  size"]`). Only a
-000047b0: 7070 6c69 6361 626c 6520 746f 2070 726f  pplicable to pro
-000047c0: 6475 6374 7320 6f66 2060 7479 7065 3d67  ducts of `type=g
-000047d0: 6f6f 6460 2e27 0a20 2020 2020 2020 2029  ood`.'.        )
-000047e0: 2c0a 2020 2020 290a 2020 2020 6361 7074  ,.    ).    capt
-000047f0: 696f 6e20 3d20 6d6f 6465 6c73 2e54 6578  ion = models.Tex
-00004800: 7446 6965 6c64 280a 2020 2020 2020 2020  tField(.        
-00004810: 6465 6661 756c 743d 2222 2c0a 2020 2020  default="",.    
-00004820: 2020 2020 626c 616e 6b3d 5472 7565 2c0a      blank=True,.
-00004830: 2020 2020 2020 2020 6d61 785f 6c65 6e67          max_leng
-00004840: 7468 3d35 3030 302c 0a20 2020 2020 2020  th=5000,.       
-00004850: 2068 656c 705f 7465 7874 3d28 0a20 2020   help_text=(.   
-00004860: 2020 2020 2020 2020 2022 4120 7368 6f72           "A shor
-00004870: 7420 6f6e 652d 6c69 6e65 2064 6573 6372  t one-line descr
-00004880: 6970 7469 6f6e 206f 6620 7468 6520 7072  iption of the pr
-00004890: 6f64 7563 742c 206d 6561 6e74 2074 6f20  oduct, meant to 
-000048a0: 6265 2064 6973 706c 6179 6162 6c65 220a  be displayable".
-000048b0: 2020 2020 2020 2020 2020 2020 2274 6f20              "to 
-000048c0: 7468 6520 6375 7374 6f6d 6572 2e20 4f6e  the customer. On
-000048d0: 6c79 2061 7070 6c69 6361 626c 6520 746f  ly applicable to
-000048e0: 2070 726f 6475 6374 7320 6f66 2060 7479   products of `ty
-000048f0: 7065 3d67 6f6f 6460 2e22 0a20 2020 2020  pe=good`.".     
-00004900: 2020 2029 2c0a 2020 2020 290a 2020 2020     ),.    ).    
-00004910: 6465 6163 7469 7661 7465 5f6f 6e20 3d20  deactivate_on = 
-00004920: 4a53 4f4e 4669 656c 6428 0a20 2020 2020  JSONField(.     
-00004930: 2020 206e 756c 6c3d 5472 7565 2c0a 2020     null=True,.  
-00004940: 2020 2020 2020 626c 616e 6b3d 5472 7565        blank=True
-00004950: 2c0a 2020 2020 2020 2020 6865 6c70 5f74  ,.        help_t
-00004960: 6578 743d 280a 2020 2020 2020 2020 2020  ext=(.          
-00004970: 2020 2241 6e20 6172 7261 7920 6f66 2063    "An array of c
-00004980: 6f6e 6e65 6374 2061 7070 6c69 6361 7469  onnect applicati
-00004990: 6f6e 2069 6465 6e74 6966 6965 7273 2074  on identifiers t
-000049a0: 6861 7420 6361 6e6e 6f74 2070 7572 6368  hat cannot purch
-000049b0: 6173 6520 220a 2020 2020 2020 2020 2020  ase ".          
-000049c0: 2020 2274 6869 7320 7072 6f64 7563 742e    "this product.
-000049d0: 204f 6e6c 7920 6170 706c 6963 6162 6c65   Only applicable
-000049e0: 2074 6f20 7072 6f64 7563 7473 206f 6620   to products of 
-000049f0: 6074 7970 653d 676f 6f64 602e 220a 2020  `type=good`.".  
-00004a00: 2020 2020 2020 292c 0a20 2020 2029 0a20        ),.    ). 
-00004a10: 2020 2069 6d61 6765 7320 3d20 4a53 4f4e     images = JSON
-00004a20: 4669 656c 6428 0a20 2020 2020 2020 206e  Field(.        n
-00004a30: 756c 6c3d 5472 7565 2c0a 2020 2020 2020  ull=True,.      
-00004a40: 2020 626c 616e 6b3d 5472 7565 2c0a 2020    blank=True,.  
-00004a50: 2020 2020 2020 6865 6c70 5f74 6578 743d        help_text=
-00004a60: 280a 2020 2020 2020 2020 2020 2020 2241  (.            "A
-00004a70: 206c 6973 7420 6f66 2075 7020 746f 2038   list of up to 8
-00004a80: 2055 524c 7320 6f66 2069 6d61 6765 7320   URLs of images 
-00004a90: 666f 7220 7468 6973 2070 726f 6475 6374  for this product
-00004aa0: 2c20 6d65 616e 7420 746f 2062 6520 220a  , meant to be ".
-00004ab0: 2020 2020 2020 2020 2020 2020 2264 6973              "dis
-00004ac0: 706c 6179 6162 6c65 2074 6f20 7468 6520  playable to the 
-00004ad0: 6375 7374 6f6d 6572 2e20 4f6e 6c79 2061  customer. Only a
-00004ae0: 7070 6c69 6361 626c 6520 746f 2070 726f  pplicable to pro
-00004af0: 6475 6374 7320 6f66 2060 7479 7065 3d67  ducts of `type=g
-00004b00: 6f6f 6460 2e22 0a20 2020 2020 2020 2029  ood`.".        )
-00004b10: 2c0a 2020 2020 290a 2020 2020 7061 636b  ,.    ).    pack
-00004b20: 6167 655f 6469 6d65 6e73 696f 6e73 203d  age_dimensions =
-00004b30: 204a 534f 4e46 6965 6c64 280a 2020 2020   JSONField(.    
-00004b40: 2020 2020 6e75 6c6c 3d54 7275 652c 0a20      null=True,. 
-00004b50: 2020 2020 2020 2062 6c61 6e6b 3d54 7275         blank=Tru
-00004b60: 652c 0a20 2020 2020 2020 2068 656c 705f  e,.        help_
-00004b70: 7465 7874 3d28 0a20 2020 2020 2020 2020  text=(.         
-00004b80: 2020 2022 5468 6520 6469 6d65 6e73 696f     "The dimensio
-00004b90: 6e73 206f 6620 7468 6973 2070 726f 6475  ns of this produ
-00004ba0: 6374 2066 6f72 2073 6869 7070 696e 6720  ct for shipping 
-00004bb0: 7075 7270 6f73 6573 2e20 220a 2020 2020  purposes. ".    
-00004bc0: 2020 2020 2020 2020 2241 2053 4b55 2061          "A SKU a
-00004bd0: 7373 6f63 6961 7465 6420 7769 7468 2074  ssociated with t
-00004be0: 6869 7320 7072 6f64 7563 7420 6361 6e20  his product can 
-00004bf0: 6f76 6572 7269 6465 2074 6869 7320 7661  override this va
-00004c00: 6c75 6520 6279 2068 6176 696e 6720 6974  lue by having it
-00004c10: 7320 220a 2020 2020 2020 2020 2020 2020  s ".            
-00004c20: 226f 776e 2060 7061 636b 6167 655f 6469  "own `package_di
-00004c30: 6d65 6e73 696f 6e73 602e 204f 6e6c 7920  mensions`. Only 
-00004c40: 6170 706c 6963 6162 6c65 2074 6f20 7072  applicable to pr
-00004c50: 6f64 7563 7473 206f 6620 6074 7970 653d  oducts of `type=
-00004c60: 676f 6f64 602e 220a 2020 2020 2020 2020  good`.".        
-00004c70: 292c 0a20 2020 2029 0a20 2020 2073 6869  ),.    ).    shi
-00004c80: 7070 6162 6c65 203d 206d 6f64 656c 732e  ppable = models.
-00004c90: 426f 6f6c 6561 6e46 6965 6c64 280a 2020  BooleanField(.  
-00004ca0: 2020 2020 2020 6e75 6c6c 3d54 7275 652c        null=True,
-00004cb0: 0a20 2020 2020 2020 2062 6c61 6e6b 3d54  .        blank=T
-00004cc0: 7275 652c 0a20 2020 2020 2020 2068 656c  rue,.        hel
-00004cd0: 705f 7465 7874 3d28 0a20 2020 2020 2020  p_text=(.       
-00004ce0: 2020 2020 2022 5768 6574 6865 7220 7468       "Whether th
-00004cf0: 6973 2070 726f 6475 6374 2069 7320 6120  is product is a 
-00004d00: 7368 6970 7065 6420 676f 6f64 2e20 220a  shipped good. ".
-00004d10: 2020 2020 2020 2020 2020 2020 224f 6e6c              "Onl
-00004d20: 7920 6170 706c 6963 6162 6c65 2074 6f20  y applicable to 
-00004d30: 7072 6f64 7563 7473 206f 6620 6074 7970  products of `typ
-00004d40: 653d 676f 6f64 602e 220a 2020 2020 2020  e=good`.".      
-00004d50: 2020 292c 0a20 2020 2029 0a20 2020 2075    ),.    ).    u
-00004d60: 726c 203d 206d 6f64 656c 732e 4368 6172  rl = models.Char
-00004d70: 4669 656c 6428 0a20 2020 2020 2020 206d  Field(.        m
-00004d80: 6178 5f6c 656e 6774 683d 3739 392c 0a20  ax_length=799,. 
-00004d90: 2020 2020 2020 206e 756c 6c3d 5472 7565         null=True
-00004da0: 2c0a 2020 2020 2020 2020 626c 616e 6b3d  ,.        blank=
-00004db0: 5472 7565 2c0a 2020 2020 2020 2020 6865  True,.        he
-00004dc0: 6c70 5f74 6578 743d 280a 2020 2020 2020  lp_text=(.      
-00004dd0: 2020 2020 2020 2241 2055 524c 206f 6620        "A URL of 
-00004de0: 6120 7075 626c 6963 6c79 2d61 6363 6573  a publicly-acces
-00004df0: 7369 626c 6520 7765 6270 6167 6520 666f  sible webpage fo
-00004e00: 7220 7468 6973 2070 726f 6475 6374 2e20  r this product. 
-00004e10: 220a 2020 2020 2020 2020 2020 2020 224f  ".            "O
-00004e20: 6e6c 7920 6170 706c 6963 6162 6c65 2074  nly applicable t
-00004e30: 6f20 7072 6f64 7563 7473 206f 6620 6074  o products of `t
-00004e40: 7970 653d 676f 6f64 602e 220a 2020 2020  ype=good`.".    
-00004e50: 2020 2020 292c 0a20 2020 2029 0a0a 2020      ),.    )..  
-00004e60: 2020 2320 4669 656c 6473 2061 7661 696c    # Fields avail
-00004e70: 6162 6c65 2074 6f20 6073 6572 7669 6365  able to `service
-00004e80: 6020 6f6e 6c79 0a20 2020 2073 7461 7465  ` only.    state
-00004e90: 6d65 6e74 5f64 6573 6372 6970 746f 7220  ment_descriptor 
-00004ea0: 3d20 6d6f 6465 6c73 2e43 6861 7246 6965  = models.CharFie
-00004eb0: 6c64 280a 2020 2020 2020 2020 6d61 785f  ld(.        max_
-00004ec0: 6c65 6e67 7468 3d32 322c 0a20 2020 2020  length=22,.     
-00004ed0: 2020 2064 6566 6175 6c74 3d22 222c 0a20     default="",. 
-00004ee0: 2020 2020 2020 2062 6c61 6e6b 3d54 7275         blank=Tru
-00004ef0: 652c 0a20 2020 2020 2020 2068 656c 705f  e,.        help_
-00004f00: 7465 7874 3d28 0a20 2020 2020 2020 2020  text=(.         
-00004f10: 2020 2022 4578 7472 6120 696e 666f 726d     "Extra inform
-00004f20: 6174 696f 6e20 6162 6f75 7420 6120 7072  ation about a pr
-00004f30: 6f64 7563 7420 7768 6963 6820 7769 6c6c  oduct which will
-00004f40: 2061 7070 6561 7220 6f6e 2079 6f75 7220   appear on your 
-00004f50: 6375 7374 6f6d 6572 2773 2022 0a20 2020  customer's ".   
-00004f60: 2020 2020 2020 2020 2022 6372 6564 6974           "credit
-00004f70: 2063 6172 6420 7374 6174 656d 656e 742e   card statement.
-00004f80: 2049 6e20 7468 6520 6361 7365 2074 6861   In the case tha
-00004f90: 7420 6d75 6c74 6970 6c65 2070 726f 6475  t multiple produ
-00004fa0: 6374 7320 6172 6520 6269 6c6c 6564 2061  cts are billed a
-00004fb0: 7420 220a 2020 2020 2020 2020 2020 2020  t ".            
-00004fc0: 226f 6e63 652c 2074 6865 2066 6972 7374  "once, the first
-00004fd0: 2073 7461 7465 6d65 6e74 2064 6573 6372   statement descr
-00004fe0: 6970 746f 7220 7769 6c6c 2062 6520 7573  iptor will be us
-00004ff0: 6564 2e20 220a 2020 2020 2020 2020 2020  ed. ".          
-00005000: 2020 224f 6e6c 7920 6176 6169 6c61 626c    "Only availabl
-00005010: 6520 6f6e 2070 726f 6475 6374 7320 6f66  e on products of
-00005020: 2074 7970 653d 6073 6572 7669 6365 602e   type=`service`.
-00005030: 220a 2020 2020 2020 2020 292c 0a20 2020  ".        ),.   
-00005040: 2029 0a20 2020 2075 6e69 745f 6c61 6265   ).    unit_labe
-00005050: 6c20 3d20 6d6f 6465 6c73 2e43 6861 7246  l = models.CharF
-00005060: 6965 6c64 286d 6178 5f6c 656e 6774 683d  ield(max_length=
-00005070: 3132 2c20 6465 6661 756c 743d 2222 2c20  12, default="", 
-00005080: 626c 616e 6b3d 5472 7565 290a 0a20 2020  blank=True)..   
-00005090: 2064 6566 205f 5f73 7472 5f5f 2873 656c   def __str__(sel
-000050a0: 6629 3a0a 2020 2020 2020 2020 2320 3120  f):.        # 1 
-000050b0: 7072 6f64 7563 7420 6361 6e20 6861 7665  product can have
-000050c0: 2031 206f 7220 6d6f 7265 2074 6861 6e20   1 or more than 
-000050d0: 3120 7265 6c61 7465 6420 7072 6963 650a  1 related price.
-000050e0: 2020 2020 2020 2020 7072 6963 655f 7173          price_qs
-000050f0: 203d 2073 656c 662e 7072 6963 6573 2e61   = self.prices.a
-00005100: 6c6c 2829 0a20 2020 2020 2020 2070 7269  ll().        pri
-00005110: 6365 5f63 6f75 6e74 203d 2070 7269 6365  ce_count = price
-00005120: 5f71 732e 636f 756e 7428 290a 0a20 2020  _qs.count()..   
-00005130: 2020 2020 2069 6620 7072 6963 655f 636f       if price_co
-00005140: 756e 7420 3e20 313a 0a20 2020 2020 2020  unt > 1:.       
-00005150: 2020 2020 2072 6574 7572 6e20 6622 7b73       return f"{s
-00005160: 656c 662e 6e61 6d65 7d20 287b 7072 6963  elf.name} ({pric
-00005170: 655f 636f 756e 747d 2070 7269 6365 7329  e_count} prices)
-00005180: 220a 2020 2020 2020 2020 656c 6966 2070  ".        elif p
-00005190: 7269 6365 5f63 6f75 6e74 203d 3d20 313a  rice_count == 1:
-000051a0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-000051b0: 7572 6e20 6622 7b73 656c 662e 6e61 6d65  urn f"{self.name
-000051c0: 7d20 287b 7072 6963 655f 7173 5b30 5d2e  } ({price_qs[0].
-000051d0: 6875 6d61 6e5f 7265 6164 6162 6c65 5f70  human_readable_p
-000051e0: 7269 6365 7d29 220a 2020 2020 2020 2020  rice})".        
-000051f0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00005200: 2020 7265 7475 726e 2073 656c 662e 6e61    return self.na
-00005210: 6d65 0a0a 0a63 6c61 7373 2043 7573 746f  me...class Custo
-00005220: 6d65 7228 5374 7269 7065 4d6f 6465 6c29  mer(StripeModel)
-00005230: 3a0a 2020 2020 2222 220a 2020 2020 4375  :.    """.    Cu
-00005240: 7374 6f6d 6572 206f 626a 6563 7473 2061  stomer objects a
-00005250: 6c6c 6f77 2079 6f75 2074 6f20 7065 7266  llow you to perf
-00005260: 6f72 6d20 7265 6375 7272 696e 6720 6368  orm recurring ch
-00005270: 6172 6765 7320 616e 6420 7472 6163 6b20  arges and track 
-00005280: 6d75 6c74 6970 6c65 0a20 2020 2063 6861  multiple.    cha
-00005290: 7267 6573 2074 6861 7420 6172 6520 6173  rges that are as
-000052a0: 736f 6369 6174 6564 2077 6974 6820 7468  sociated with th
-000052b0: 6520 7361 6d65 2063 7573 746f 6d65 722e  e same customer.
-000052c0: 0a0a 2020 2020 5374 7269 7065 2064 6f63  ..    Stripe doc
-000052d0: 756d 656e 7461 7469 6f6e 3a20 6874 7470  umentation: http
-000052e0: 733a 2f2f 7374 7269 7065 2e63 6f6d 2f64  s://stripe.com/d
-000052f0: 6f63 732f 6170 693f 6c61 6e67 3d70 7974  ocs/api?lang=pyt
-00005300: 686f 6e23 6375 7374 6f6d 6572 730a 2020  hon#customers.  
-00005310: 2020 2222 220a 0a20 2020 2073 7472 6970    """..    strip
-00005320: 655f 636c 6173 7320 3d20 7374 7269 7065  e_class = stripe
-00005330: 2e43 7573 746f 6d65 720a 2020 2020 6578  .Customer.    ex
-00005340: 7061 6e64 5f66 6965 6c64 7320 3d20 5b22  pand_fields = ["
-00005350: 6465 6661 756c 745f 736f 7572 6365 222c  default_source",
-00005360: 2022 736f 7572 6365 7322 5d0a 2020 2020   "sources"].    
-00005370: 7374 7269 7065 5f64 6173 6862 6f61 7264  stripe_dashboard
-00005380: 5f69 7465 6d5f 6e61 6d65 203d 2022 6375  _item_name = "cu
-00005390: 7374 6f6d 6572 7322 0a0a 2020 2020 6164  stomers"..    ad
-000053a0: 6472 6573 7320 3d20 4a53 4f4e 4669 656c  dress = JSONFiel
-000053b0: 6428 6e75 6c6c 3d54 7275 652c 2062 6c61  d(null=True, bla
-000053c0: 6e6b 3d54 7275 652c 2068 656c 705f 7465  nk=True, help_te
-000053d0: 7874 3d22 5468 6520 6375 7374 6f6d 6572  xt="The customer
-000053e0: 2773 2061 6464 7265 7373 2e22 290a 2020  's address.").  
-000053f0: 2020 6261 6c61 6e63 6520 3d20 5374 7269    balance = Stri
-00005400: 7065 5175 616e 7475 6d43 7572 7265 6e63  peQuantumCurrenc
-00005410: 7941 6d6f 756e 7446 6965 6c64 280a 2020  yAmountField(.  
-00005420: 2020 2020 2020 6e75 6c6c 3d54 7275 652c        null=True,
-00005430: 0a20 2020 2020 2020 2062 6c61 6e6b 3d54  .        blank=T
-00005440: 7275 652c 0a20 2020 2020 2020 2064 6566  rue,.        def
-00005450: 6175 6c74 3d30 2c0a 2020 2020 2020 2020  ault=0,.        
-00005460: 6865 6c70 5f74 6578 743d 280a 2020 2020  help_text=(.    
-00005470: 2020 2020 2020 2020 2243 7572 7265 6e74          "Current
-00005480: 2062 616c 616e 6365 2028 696e 2063 656e   balance (in cen
-00005490: 7473 292c 2069 6620 616e 792c 2062 6569  ts), if any, bei
-000054a0: 6e67 2073 746f 7265 6420 6f6e 2074 6865  ng stored on the
-000054b0: 2063 7573 746f 6d65 7227 7320 220a 2020   customer's ".  
-000054c0: 2020 2020 2020 2020 2020 2261 6363 6f75            "accou
-000054d0: 6e74 2e20 220a 2020 2020 2020 2020 2020  nt. ".          
-000054e0: 2020 2249 6620 6e65 6761 7469 7665 2c20    "If negative, 
-000054f0: 7468 6520 6375 7374 6f6d 6572 2068 6173  the customer has
-00005500: 2063 7265 6469 7420 746f 2061 7070 6c79   credit to apply
-00005510: 2074 6f20 7468 6520 6e65 7874 2069 6e76   to the next inv
-00005520: 6f69 6365 2e20 220a 2020 2020 2020 2020  oice. ".        
-00005530: 2020 2020 2249 6620 706f 7369 7469 7665      "If positive
-00005540: 2c20 7468 6520 6375 7374 6f6d 6572 2068  , the customer h
-00005550: 6173 2061 6e20 616d 6f75 6e74 206f 7765  as an amount owe
-00005560: 6420 7468 6174 2077 696c 6c20 6265 2061  d that will be a
-00005570: 6464 6564 2074 6f20 7468 6520 220a 2020  dded to the ".  
-00005580: 2020 2020 2020 2020 2020 226e 6578 7420            "next 
-00005590: 696e 766f 6963 652e 2054 6865 2062 616c  invoice. The bal
-000055a0: 616e 6365 2064 6f65 7320 6e6f 7420 7265  ance does not re
-000055b0: 6665 7220 746f 2061 6e79 2075 6e70 6169  fer to any unpai
-000055c0: 6420 696e 766f 6963 6573 3b20 6974 2022  d invoices; it "
-000055d0: 0a20 2020 2020 2020 2020 2020 2022 736f  .            "so
-000055e0: 6c65 6c79 2074 616b 6573 2069 6e74 6f20  lely takes into 
-000055f0: 6163 636f 756e 7420 616d 6f75 6e74 7320  account amounts 
-00005600: 7468 6174 2068 6176 6520 7965 7420 746f  that have yet to
-00005610: 2062 6520 7375 6363 6573 7366 756c 6c79   be successfully
-00005620: 2022 0a20 2020 2020 2020 2020 2020 2022   ".            "
-00005630: 6170 706c 6965 6420 746f 2061 6e79 2069  applied to any i
-00005640: 6e76 6f69 6365 2e20 5468 6973 2062 616c  nvoice. This bal
-00005650: 616e 6365 2069 7320 6f6e 6c79 2074 616b  ance is only tak
-00005660: 656e 2069 6e74 6f20 6163 636f 756e 7420  en into account 
-00005670: 666f 7220 220a 2020 2020 2020 2020 2020  for ".          
-00005680: 2020 2272 6563 7572 7269 6e67 2062 696c    "recurring bil
-00005690: 6c69 6e67 2070 7572 706f 7365 7320 2869  ling purposes (i
-000056a0: 2e65 2e2c 2073 7562 7363 7269 7074 696f  .e., subscriptio
-000056b0: 6e73 2c20 696e 766f 6963 6573 2c20 696e  ns, invoices, in
-000056c0: 766f 6963 6520 6974 656d 7329 2e22 0a20  voice items).". 
-000056d0: 2020 2020 2020 2029 2c0a 2020 2020 290a         ),.    ).
-000056e0: 2020 2020 6375 7272 656e 6379 203d 2053      currency = S
-000056f0: 7472 6970 6543 7572 7265 6e63 7943 6f64  tripeCurrencyCod
-00005700: 6546 6965 6c64 280a 2020 2020 2020 2020  eField(.        
-00005710: 626c 616e 6b3d 5472 7565 2c0a 2020 2020  blank=True,.    
-00005720: 2020 2020 6465 6661 756c 743d 2222 2c0a      default="",.
-00005730: 2020 2020 2020 2020 6865 6c70 5f74 6578          help_tex
-00005740: 743d 2254 6865 2063 7572 7265 6e63 7920  t="The currency 
-00005750: 7468 6520 6375 7374 6f6d 6572 2063 616e  the customer can
-00005760: 2062 6520 6368 6172 6765 6420 696e 2066   be charged in f
-00005770: 6f72 2022 0a20 2020 2020 2020 2022 7265  or ".        "re
-00005780: 6375 7272 696e 6720 6269 6c6c 696e 6720  curring billing 
-00005790: 7075 7270 6f73 6573 222c 0a20 2020 2029  purposes",.    )
-000057a0: 0a20 2020 2064 6566 6175 6c74 5f73 6f75  .    default_sou
-000057b0: 7263 6520 3d20 5061 796d 656e 744d 6574  rce = PaymentMet
-000057c0: 686f 6446 6f72 6569 676e 4b65 7928 0a20  hodForeignKey(. 
-000057d0: 2020 2020 2020 206f 6e5f 6465 6c65 7465         on_delete
-000057e0: 3d6d 6f64 656c 732e 5345 545f 4e55 4c4c  =models.SET_NULL
-000057f0: 2c20 6e75 6c6c 3d54 7275 652c 2062 6c61  , null=True, bla
-00005800: 6e6b 3d54 7275 652c 2072 656c 6174 6564  nk=True, related
-00005810: 5f6e 616d 653d 2263 7573 746f 6d65 7273  _name="customers
-00005820: 220a 2020 2020 290a 2020 2020 6465 6c69  ".    ).    deli
-00005830: 6e71 7565 6e74 203d 206d 6f64 656c 732e  nquent = models.
-00005840: 426f 6f6c 6561 6e46 6965 6c64 280a 2020  BooleanField(.  
-00005850: 2020 2020 2020 6e75 6c6c 3d54 7275 652c        null=True,
-00005860: 0a20 2020 2020 2020 2062 6c61 6e6b 3d54  .        blank=T
-00005870: 7275 652c 0a20 2020 2020 2020 2064 6566  rue,.        def
-00005880: 6175 6c74 3d46 616c 7365 2c0a 2020 2020  ault=False,.    
-00005890: 2020 2020 6865 6c70 5f74 6578 743d 2257      help_text="W
-000058a0: 6865 7468 6572 206f 7220 6e6f 7420 7468  hether or not th
-000058b0: 6520 6c61 7465 7374 2063 6861 7267 6520  e latest charge 
-000058c0: 666f 7220 7468 6520 6375 7374 6f6d 6572  for the customer
-000058d0: 2773 2022 0a20 2020 2020 2020 2022 6c61  's ".        "la
-000058e0: 7465 7374 2069 6e76 6f69 6365 2068 6173  test invoice has
-000058f0: 2066 6169 6c65 642e 222c 0a20 2020 2029   failed.",.    )
-00005900: 0a20 2020 2023 2053 7472 6970 6520 4150  .    # Stripe AP
-00005910: 4920 7265 7475 726e 7320 6465 6c65 7465  I returns delete
-00005920: 6420 6375 7374 6f6d 6572 7320 6c69 6b65  d customers like
-00005930: 2073 6f3a 0a20 2020 2023 207b 0a20 2020   so:.    # {.   
-00005940: 2023 2020 2022 6964 223a 2022 6375 735f   #   "id": "cus_
-00005950: 4b58 3433 3957 3564 4b72 7069 3232 222c  KX439W5dKrpi22",
-00005960: 0a20 2020 2023 2020 2022 6f62 6a65 6374  .    #   "object
-00005970: 223a 2022 6375 7374 6f6d 6572 222c 0a20  ": "customer",. 
-00005980: 2020 2023 2020 2022 6465 6c65 7465 6422     #   "deleted"
-00005990: 3a20 7472 7565 2c0a 2020 2020 2320 7d0a  : true,.    # }.
-000059a0: 2020 2020 6465 6c65 7465 6420 3d20 6d6f      deleted = mo
-000059b0: 6465 6c73 2e42 6f6f 6c65 616e 4669 656c  dels.BooleanFiel
-000059c0: 6428 0a20 2020 2020 2020 2064 6566 6175  d(.        defau
-000059d0: 6c74 3d46 616c 7365 2c0a 2020 2020 2020  lt=False,.      
-000059e0: 2020 6e75 6c6c 3d54 7275 652c 0a20 2020    null=True,.   
-000059f0: 2020 2020 2062 6c61 6e6b 3d54 7275 652c       blank=True,
-00005a00: 0a20 2020 2020 2020 2068 656c 705f 7465  .        help_te
-00005a10: 7874 3d22 5768 6574 6865 7220 7468 6520  xt="Whether the 
-00005a20: 4375 7374 6f6d 6572 2069 6e73 7461 6e63  Customer instanc
-00005a30: 6520 6861 7320 6265 656e 2064 656c 6574  e has been delet
-00005a40: 6564 2075 7073 7472 6561 6d20 696e 2053  ed upstream in S
-00005a50: 7472 6970 6520 6f72 206e 6f74 2e22 2c0a  tripe or not.",.
-00005a60: 2020 2020 290a 2020 2020 2320 3c64 6973      ).    # <dis
-00005a70: 636f 756e 743e 0a20 2020 2063 6f75 706f  count>.    coupo
-00005a80: 6e20 3d20 6d6f 6465 6c73 2e46 6f72 6569  n = models.Forei
-00005a90: 676e 4b65 7928 0a20 2020 2020 2020 2022  gnKey(.        "
-00005aa0: 436f 7570 6f6e 222c 206e 756c 6c3d 5472  Coupon", null=Tr
-00005ab0: 7565 2c20 626c 616e 6b3d 5472 7565 2c20  ue, blank=True, 
-00005ac0: 6f6e 5f64 656c 6574 653d 6d6f 6465 6c73  on_delete=models
-00005ad0: 2e53 4554 5f4e 554c 4c0a 2020 2020 290a  .SET_NULL.    ).
-00005ae0: 2020 2020 636f 7570 6f6e 5f73 7461 7274      coupon_start
-00005af0: 203d 2053 7472 6970 6544 6174 6554 696d   = StripeDateTim
-00005b00: 6546 6965 6c64 280a 2020 2020 2020 2020  eField(.        
-00005b10: 6e75 6c6c 3d54 7275 652c 0a20 2020 2020  null=True,.     
-00005b20: 2020 2062 6c61 6e6b 3d54 7275 652c 0a20     blank=True,. 
-00005b30: 2020 2020 2020 2065 6469 7461 626c 653d         editable=
-00005b40: 4661 6c73 652c 0a20 2020 2020 2020 2068  False,.        h
-00005b50: 656c 705f 7465 7874 3d22 4966 2061 2063  elp_text="If a c
-00005b60: 6f75 706f 6e20 6973 2070 7265 7365 6e74  oupon is present
-00005b70: 2c20 7468 6520 6461 7465 2061 7420 7768  , the date at wh
-00005b80: 6963 6820 6974 2077 6173 2061 7070 6c69  ich it was appli
-00005b90: 6564 2e22 2c0a 2020 2020 290a 2020 2020  ed.",.    ).    
-00005ba0: 636f 7570 6f6e 5f65 6e64 203d 2053 7472  coupon_end = Str
-00005bb0: 6970 6544 6174 6554 696d 6546 6965 6c64  ipeDateTimeField
-00005bc0: 280a 2020 2020 2020 2020 6e75 6c6c 3d54  (.        null=T
-00005bd0: 7275 652c 0a20 2020 2020 2020 2062 6c61  rue,.        bla
-00005be0: 6e6b 3d54 7275 652c 0a20 2020 2020 2020  nk=True,.       
-00005bf0: 2065 6469 7461 626c 653d 4661 6c73 652c   editable=False,
-00005c00: 0a20 2020 2020 2020 2068 656c 705f 7465  .        help_te
-00005c10: 7874 3d22 4966 2061 2063 6f75 706f 6e20  xt="If a coupon 
-00005c20: 6973 2070 7265 7365 6e74 2061 6e64 2068  is present and h
-00005c30: 6173 2061 206c 696d 6974 6564 2064 7572  as a limited dur
-00005c40: 6174 696f 6e2c 2022 0a20 2020 2020 2020  ation, ".       
-00005c50: 2022 7468 6520 6461 7465 2074 6861 7420   "the date that 
-00005c60: 7468 6520 6469 7363 6f75 6e74 2077 696c  the discount wil
-00005c70: 6c20 656e 642e 222c 0a20 2020 2029 0a20  l end.",.    ). 
-00005c80: 2020 2023 203c 2f64 6973 636f 756e 743e     # </discount>
-00005c90: 0a20 2020 2065 6d61 696c 203d 206d 6f64  .    email = mod
-00005ca0: 656c 732e 5465 7874 4669 656c 6428 6d61  els.TextField(ma
-00005cb0: 785f 6c65 6e67 7468 3d35 3030 302c 2064  x_length=5000, d
-00005cc0: 6566 6175 6c74 3d22 222c 2062 6c61 6e6b  efault="", blank
-00005cd0: 3d54 7275 6529 0a20 2020 2069 6e76 6f69  =True).    invoi
-00005ce0: 6365 5f70 7265 6669 7820 3d20 6d6f 6465  ce_prefix = mode
-00005cf0: 6c73 2e43 6861 7246 6965 6c64 280a 2020  ls.CharField(.  
-00005d00: 2020 2020 2020 6465 6661 756c 743d 2222        default=""
-00005d10: 2c0a 2020 2020 2020 2020 626c 616e 6b3d  ,.        blank=
-00005d20: 5472 7565 2c0a 2020 2020 2020 2020 6d61  True,.        ma
-00005d30: 785f 6c65 6e67 7468 3d32 3535 2c0a 2020  x_length=255,.  
-00005d40: 2020 2020 2020 6865 6c70 5f74 6578 743d        help_text=
-00005d50: 280a 2020 2020 2020 2020 2020 2020 2254  (.            "T
-00005d60: 6865 2070 7265 6669 7820 666f 7220 7468  he prefix for th
-00005d70: 6520 6375 7374 6f6d 6572 2075 7365 6420  e customer used 
-00005d80: 746f 2067 656e 6572 6174 6520 756e 6971  to generate uniq
-00005d90: 7565 2069 6e76 6f69 6365 206e 756d 6265  ue invoice numbe
-00005da0: 7273 2e22 0a20 2020 2020 2020 2029 2c0a  rs.".        ),.
-00005db0: 2020 2020 290a 2020 2020 696e 766f 6963      ).    invoic
-00005dc0: 655f 7365 7474 696e 6773 203d 204a 534f  e_settings = JSO
-00005dd0: 4e46 6965 6c64 280a 2020 2020 2020 2020  NField(.        
-00005de0: 6e75 6c6c 3d54 7275 652c 2062 6c61 6e6b  null=True, blank
-00005df0: 3d54 7275 652c 2068 656c 705f 7465 7874  =True, help_text
-00005e00: 3d22 5468 6520 6375 7374 6f6d 6572 2773  ="The customer's
-00005e10: 2064 6566 6175 6c74 2069 6e76 6f69 6365   default invoice
-00005e20: 2073 6574 7469 6e67 732e 220a 2020 2020   settings.".    
-00005e30: 290a 2020 2020 2320 6465 6661 756c 745f  ).    # default_
-00005e40: 7061 796d 656e 745f 6d65 7468 6f64 2069  payment_method i
-00005e50: 7320 6163 7475 616c 6c79 206e 6573 7465  s actually neste
-00005e60: 6420 696e 7369 6465 2069 6e76 6f69 6365  d inside invoice
-00005e70: 5f73 6574 7469 6e67 730a 2020 2020 2320  _settings.    # 
-00005e80: 7468 6973 2066 6965 6c64 2069 7320 6120  this field is a 
-00005e90: 636f 6e76 656e 6965 6e63 6520 746f 2070  convenience to p
-00005ea0: 726f 7669 6465 2074 6865 2066 6f72 6569  rovide the forei
-00005eb0: 676e 206b 6579 0a20 2020 2064 6566 6175  gn key.    defau
-00005ec0: 6c74 5f70 6179 6d65 6e74 5f6d 6574 686f  lt_payment_metho
-00005ed0: 6420 3d20 5374 7269 7065 466f 7265 6967  d = StripeForeig
-00005ee0: 6e4b 6579 280a 2020 2020 2020 2020 2250  nKey(.        "P
-00005ef0: 6179 6d65 6e74 4d65 7468 6f64 222c 0a20  aymentMethod",. 
-00005f00: 2020 2020 2020 206e 756c 6c3d 5472 7565         null=True
-00005f10: 2c0a 2020 2020 2020 2020 626c 616e 6b3d  ,.        blank=
-00005f20: 5472 7565 2c0a 2020 2020 2020 2020 6f6e  True,.        on
-00005f30: 5f64 656c 6574 653d 6d6f 6465 6c73 2e53  _delete=models.S
-00005f40: 4554 5f4e 554c 4c2c 0a20 2020 2020 2020  ET_NULL,.       
-00005f50: 2072 656c 6174 6564 5f6e 616d 653d 222b   related_name="+
-00005f60: 222c 0a20 2020 2020 2020 2068 656c 705f  ",.        help_
-00005f70: 7465 7874 3d22 6465 6661 756c 7420 7061  text="default pa
-00005f80: 796d 656e 7420 6d65 7468 6f64 2075 7365  yment method use
-00005f90: 6420 666f 7220 7375 6273 6372 6970 7469  d for subscripti
-00005fa0: 6f6e 7320 616e 6420 696e 766f 6963 6573  ons and invoices
-00005fb0: 2022 0a20 2020 2020 2020 2022 666f 7220   ".        "for 
-00005fc0: 7468 6520 6375 7374 6f6d 6572 2e22 2c0a  the customer.",.
-00005fd0: 2020 2020 290a 2020 2020 6e61 6d65 203d      ).    name =
-00005fe0: 206d 6f64 656c 732e 5465 7874 4669 656c   models.TextFiel
-00005ff0: 6428 0a20 2020 2020 2020 206d 6178 5f6c  d(.        max_l
-00006000: 656e 6774 683d 3530 3030 2c0a 2020 2020  ength=5000,.    
-00006010: 2020 2020 6465 6661 756c 743d 2222 2c0a      default="",.
-00006020: 2020 2020 2020 2020 626c 616e 6b3d 5472          blank=Tr
-00006030: 7565 2c0a 2020 2020 2020 2020 6865 6c70  ue,.        help
-00006040: 5f74 6578 743d 2254 6865 2063 7573 746f  _text="The custo
-00006050: 6d65 7227 7320 6675 6c6c 206e 616d 6520  mer's full name 
-00006060: 6f72 2062 7573 696e 6573 7320 6e61 6d65  or business name
-00006070: 2e22 2c0a 2020 2020 290a 2020 2020 7068  .",.    ).    ph
-00006080: 6f6e 6520 3d20 6d6f 6465 6c73 2e54 6578  one = models.Tex
-00006090: 7446 6965 6c64 280a 2020 2020 2020 2020  tField(.        
-000060a0: 6d61 785f 6c65 6e67 7468 3d35 3030 302c  max_length=5000,
-000060b0: 0a20 2020 2020 2020 2064 6566 6175 6c74  .        default
-000060c0: 3d22 222c 0a20 2020 2020 2020 2062 6c61  ="",.        bla
-000060d0: 6e6b 3d54 7275 652c 0a20 2020 2020 2020  nk=True,.       
-000060e0: 2068 656c 705f 7465 7874 3d22 5468 6520   help_text="The 
-000060f0: 6375 7374 6f6d 6572 2773 2070 686f 6e65  customer's phone
-00006100: 206e 756d 6265 722e 222c 0a20 2020 2029   number.",.    )
-00006110: 0a20 2020 2070 7265 6665 7272 6564 5f6c  .    preferred_l
-00006120: 6f63 616c 6573 203d 204a 534f 4e46 6965  ocales = JSONFie
-00006130: 6c64 280a 2020 2020 2020 2020 6e75 6c6c  ld(.        null
-00006140: 3d54 7275 652c 0a20 2020 2020 2020 2062  =True,.        b
-00006150: 6c61 6e6b 3d54 7275 652c 0a20 2020 2020  lank=True,.     
-00006160: 2020 2068 656c 705f 7465 7874 3d28 0a20     help_text=(. 
-00006170: 2020 2020 2020 2020 2020 2022 5468 6520             "The 
-00006180: 6375 7374 6f6d 6572 2773 2070 7265 6665  customer's prefe
-00006190: 7272 6564 206c 6f63 616c 6573 2028 6c61  rred locales (la
-000061a0: 6e67 7561 6765 7329 2c20 6f72 6465 7265  nguages), ordere
-000061b0: 6420 6279 2070 7265 6665 7265 6e63 652e  d by preference.
-000061c0: 220a 2020 2020 2020 2020 292c 0a20 2020  ".        ),.   
-000061d0: 2029 0a20 2020 2073 6869 7070 696e 6720   ).    shipping 
-000061e0: 3d20 4a53 4f4e 4669 656c 6428 0a20 2020  = JSONField(.   
-000061f0: 2020 2020 206e 756c 6c3d 5472 7565 2c0a       null=True,.
-00006200: 2020 2020 2020 2020 626c 616e 6b3d 5472          blank=Tr
-00006210: 7565 2c0a 2020 2020 2020 2020 6865 6c70  ue,.        help
-00006220: 5f74 6578 743d 2253 6869 7070 696e 6720  _text="Shipping 
-00006230: 696e 666f 726d 6174 696f 6e20 6173 736f  information asso
-00006240: 6369 6174 6564 2077 6974 6820 7468 6520  ciated with the 
-00006250: 6375 7374 6f6d 6572 2e22 2c0a 2020 2020  customer.",.    
-00006260: 290a 2020 2020 7461 785f 6578 656d 7074  ).    tax_exempt
-00006270: 203d 2053 7472 6970 6545 6e75 6d46 6965   = StripeEnumFie
-00006280: 6c64 280a 2020 2020 2020 2020 656e 756d  ld(.        enum
-00006290: 3d65 6e75 6d73 2e43 7573 746f 6d65 7254  =enums.CustomerT
-000062a0: 6178 4578 656d 7074 2c0a 2020 2020 2020  axExempt,.      
+00000000: 6672 6f6d 2064 6563 696d 616c 2069 6d70  from decimal imp
+00000010: 6f72 7420 4465 6369 6d61 6c0a 6672 6f6d  ort Decimal.from
+00000020: 2074 7970 696e 6720 696d 706f 7274 204f   typing import O
+00000030: 7074 696f 6e61 6c2c 2055 6e69 6f6e 0a0a  ptional, Union..
+00000040: 696d 706f 7274 2073 7472 6970 650a 6672  import stripe.fr
+00000050: 6f6d 2064 6a61 6e67 6f2e 6170 7073 2069  om django.apps i
+00000060: 6d70 6f72 7420 6170 7073 0a66 726f 6d20  mport apps.from 
+00000070: 646a 616e 676f 2e64 6220 696d 706f 7274  django.db import
+00000080: 206d 6f64 656c 732c 2074 7261 6e73 6163   models, transac
+00000090: 7469 6f6e 0a66 726f 6d20 646a 616e 676f  tion.from django
+000000a0: 2e75 7469 6c73 2069 6d70 6f72 7420 7469  .utils import ti
+000000b0: 6d65 7a6f 6e65 0a66 726f 6d20 646a 616e  mezone.from djan
+000000c0: 676f 2e75 7469 6c73 2e66 756e 6374 696f  go.utils.functio
+000000d0: 6e61 6c20 696d 706f 7274 2063 6163 6865  nal import cache
+000000e0: 645f 7072 6f70 6572 7479 0a66 726f 6d20  d_property.from 
+000000f0: 646a 616e 676f 2e75 7469 6c73 2e74 6578  django.utils.tex
+00000100: 7420 696d 706f 7274 2066 6f72 6d61 745f  t import format_
+00000110: 6c61 7a79 0a66 726f 6d20 646a 616e 676f  lazy.from django
+00000120: 2e75 7469 6c73 2e74 7261 6e73 6c61 7469  .utils.translati
+00000130: 6f6e 2069 6d70 6f72 7420 6765 7474 6578  on import gettex
+00000140: 745f 6c61 7a79 2061 7320 5f0a 6672 6f6d  t_lazy as _.from
+00000150: 2073 7472 6970 652e 6572 726f 7220 696d   stripe.error im
+00000160: 706f 7274 2049 6e76 616c 6964 5265 7175  port InvalidRequ
+00000170: 6573 7445 7272 6f72 0a0a 6672 6f6d 202e  estError..from .
+00000180: 2e20 696d 706f 7274 2065 6e75 6d73 2c20  . import enums, 
+00000190: 7765 6268 6f6f 6b73 0a66 726f 6d20 2e2e  webhooks.from ..
+000001a0: 6578 6365 7074 696f 6e73 2069 6d70 6f72  exceptions impor
+000001b0: 7420 4d75 6c74 6970 6c65 5375 6273 6372  t MultipleSubscr
+000001c0: 6970 7469 6f6e 4578 6365 7074 696f 6e0a  iptionException.
+000001d0: 6672 6f6d 202e 2e66 6965 6c64 7320 696d  from ..fields im
+000001e0: 706f 7274 2028 0a20 2020 204a 534f 4e46  port (.    JSONF
+000001f0: 6965 6c64 2c0a 2020 2020 5061 796d 656e  ield,.    Paymen
+00000200: 744d 6574 686f 6446 6f72 6569 676e 4b65  tMethodForeignKe
+00000210: 792c 0a20 2020 2053 7472 6970 6543 7572  y,.    StripeCur
+00000220: 7265 6e63 7943 6f64 6546 6965 6c64 2c0a  rencyCodeField,.
+00000230: 2020 2020 5374 7269 7065 4461 7465 5469      StripeDateTi
+00000240: 6d65 4669 656c 642c 0a20 2020 2053 7472  meField,.    Str
+00000250: 6970 6544 6563 696d 616c 4375 7272 656e  ipeDecimalCurren
+00000260: 6379 416d 6f75 6e74 4669 656c 642c 0a20  cyAmountField,. 
+00000270: 2020 2053 7472 6970 6545 6e75 6d46 6965     StripeEnumFie
+00000280: 6c64 2c0a 2020 2020 5374 7269 7065 466f  ld,.    StripeFo
+00000290: 7265 6967 6e4b 6579 2c0a 2020 2020 5374  reignKey,.    St
+000002a0: 7269 7065 4964 4669 656c 642c 0a20 2020  ripeIdField,.   
+000002b0: 2053 7472 6970 6551 7561 6e74 756d 4375   StripeQuantumCu
+000002c0: 7272 656e 6379 416d 6f75 6e74 4669 656c  rrencyAmountFiel
+000002d0: 642c 0a29 0a66 726f 6d20 2e2e 6d61 6e61  d,.).from ..mana
+000002e0: 6765 7273 2069 6d70 6f72 7420 4368 6172  gers import Char
+000002f0: 6765 4d61 6e61 6765 720a 6672 6f6d 202e  geManager.from .
+00000300: 2e73 6574 7469 6e67 7320 696d 706f 7274  .settings import
+00000310: 2064 6a73 7472 6970 655f 7365 7474 696e   djstripe_settin
+00000320: 6773 0a66 726f 6d20 2e2e 7369 676e 616c  gs.from ..signal
+00000330: 7320 696d 706f 7274 2057 4542 484f 4f4b  s import WEBHOOK
+00000340: 5f53 4947 4e41 4c53 0a66 726f 6d20 2e2e  _SIGNALS.from ..
+00000350: 7574 696c 7320 696d 706f 7274 2067 6574  utils import get
+00000360: 5f66 7269 656e 646c 795f 6375 7272 656e  _friendly_curren
+00000370: 6379 5f61 6d6f 756e 742c 2067 6574 5f69  cy_amount, get_i
+00000380: 645f 6672 6f6d 5f73 7472 6970 655f 6461  d_from_stripe_da
+00000390: 7461 0a66 726f 6d20 2e62 6173 6520 696d  ta.from .base im
+000003a0: 706f 7274 2049 6465 6d70 6f74 656e 6379  port Idempotency
+000003b0: 4b65 792c 2053 7472 6970 654d 6f64 656c  Key, StripeModel
+000003c0: 2c20 6c6f 6767 6572 0a0a 0a64 6566 205f  , logger...def _
+000003d0: 7361 6e69 7469 7365 5f70 7269 6365 2870  sanitise_price(p
+000003e0: 7269 6365 3d4e 6f6e 652c 2070 6c61 6e3d  rice=None, plan=
+000003f0: 4e6f 6e65 2c20 2a2a 6b77 6172 6773 293a  None, **kwargs):
+00000400: 0a20 2020 2022 2222 0a20 2020 2048 656c  .    """.    Hel
+00000410: 7065 7220 666f 7220 4375 7374 6f6d 6572  per for Customer
+00000420: 2e73 7562 7363 7269 6265 2829 0a20 2020  .subscribe().   
+00000430: 2022 2222 0a0a 2020 2020 6966 2070 7269   """..    if pri
+00000440: 6365 2061 6e64 2070 6c61 6e3a 0a20 2020  ce and plan:.   
+00000450: 2020 2020 2072 6169 7365 2054 7970 6545       raise TypeE
+00000460: 7272 6f72 2822 7072 6963 6520 616e 6420  rror("price and 
+00000470: 706c 616e 2061 7267 756d 656e 7473 2063  plan arguments c
+00000480: 616e 6e6f 7420 626f 7468 2062 6520 6465  annot both be de
+00000490: 6669 6e65 642e 2229 0a0a 2020 2020 7072  fined.")..    pr
+000004a0: 6963 6520 3d20 7072 6963 6520 6f72 2070  ice = price or p
+000004b0: 6c61 6e0a 0a20 2020 2069 6620 6e6f 7420  lan..    if not 
+000004c0: 7072 6963 653a 0a20 2020 2020 2020 2072  price:.        r
+000004d0: 6169 7365 2054 7970 6545 7272 6f72 2822  aise TypeError("
+000004e0: 796f 7520 6e65 6564 2074 6f20 7365 7420  you need to set 
+000004f0: 6569 7468 6572 2070 7269 6365 206f 7220  either price or 
+00000500: 706c 616e 2229 0a0a 2020 2020 2320 436f  plan")..    # Co
+00000510: 6e76 6572 7420 5072 6963 6520 746f 2069  nvert Price to i
+00000520: 640a 2020 2020 6966 2069 7369 6e73 7461  d.    if isinsta
+00000530: 6e63 6528 7072 6963 652c 2053 7472 6970  nce(price, Strip
+00000540: 654d 6f64 656c 293a 0a20 2020 2020 2020  eModel):.       
+00000550: 2070 7269 6365 203d 2070 7269 6365 2e69   price = price.i
+00000560: 640a 0a20 2020 2072 6574 7572 6e20 7072  d..    return pr
+00000570: 6963 652c 206b 7761 7267 730a 0a0a 636c  ice, kwargs...cl
+00000580: 6173 7320 4261 6c61 6e63 6554 7261 6e73  ass BalanceTrans
+00000590: 6163 7469 6f6e 2853 7472 6970 654d 6f64  action(StripeMod
+000005a0: 656c 293a 0a20 2020 2022 2222 0a20 2020  el):.    """.   
+000005b0: 2041 2073 696e 676c 6520 7472 616e 7361   A single transa
+000005c0: 6374 696f 6e20 7468 6174 2075 7064 6174  ction that updat
+000005d0: 6573 2074 6865 2053 7472 6970 6520 6261  es the Stripe ba
+000005e0: 6c61 6e63 652e 0a0a 2020 2020 5374 7269  lance...    Stri
+000005f0: 7065 2064 6f63 756d 656e 7461 7469 6f6e  pe documentation
+00000600: 3a20 6874 7470 733a 2f2f 7374 7269 7065  : https://stripe
+00000610: 2e63 6f6d 2f64 6f63 732f 6170 693f 6c61  .com/docs/api?la
+00000620: 6e67 3d70 7974 686f 6e23 6261 6c61 6e63  ng=python#balanc
+00000630: 655f 7472 616e 7361 6374 696f 6e5f 6f62  e_transaction_ob
+00000640: 6a65 6374 0a20 2020 2022 2222 0a0a 2020  ject.    """..  
+00000650: 2020 7374 7269 7065 5f63 6c61 7373 203d    stripe_class =
+00000660: 2073 7472 6970 652e 4261 6c61 6e63 6554   stripe.BalanceT
+00000670: 7261 6e73 6163 7469 6f6e 0a0a 2020 2020  ransaction..    
+00000680: 616d 6f75 6e74 203d 2053 7472 6970 6551  amount = StripeQ
+00000690: 7561 6e74 756d 4375 7272 656e 6379 416d  uantumCurrencyAm
+000006a0: 6f75 6e74 4669 656c 6428 0a20 2020 2020  ountField(.     
+000006b0: 2020 2068 656c 705f 7465 7874 3d22 4772     help_text="Gr
+000006c0: 6f73 7320 616d 6f75 6e74 206f 6620 7468  oss amount of th
+000006d0: 6520 7472 616e 7361 6374 696f 6e2c 2069  e transaction, i
+000006e0: 6e20 6365 6e74 732e 220a 2020 2020 290a  n cents.".    ).
+000006f0: 2020 2020 6176 6169 6c61 626c 655f 6f6e      available_on
+00000700: 203d 2053 7472 6970 6544 6174 6554 696d   = StripeDateTim
+00000710: 6546 6965 6c64 280a 2020 2020 2020 2020  eField(.        
+00000720: 6865 6c70 5f74 6578 743d 280a 2020 2020  help_text=(.    
+00000730: 2020 2020 2020 2020 2254 6865 2064 6174          "The dat
+00000740: 6520 7468 6520 7472 616e 7361 6374 696f  e the transactio
+00000750: 6e27 7320 6e65 7420 6675 6e64 7320 220a  n's net funds ".
+00000760: 2020 2020 2020 2020 2020 2020 2277 696c              "wil
+00000770: 6c20 6265 636f 6d65 2061 7661 696c 6162  l become availab
+00000780: 6c65 2069 6e20 7468 6520 5374 7269 7065  le in the Stripe
+00000790: 2062 616c 616e 6365 2e22 0a20 2020 2020   balance.".     
+000007a0: 2020 2029 0a20 2020 2029 0a20 2020 2063     ).    ).    c
+000007b0: 7572 7265 6e63 7920 3d20 5374 7269 7065  urrency = Stripe
+000007c0: 4375 7272 656e 6379 436f 6465 4669 656c  CurrencyCodeFiel
+000007d0: 6428 290a 2020 2020 6578 6368 616e 6765  d().    exchange
+000007e0: 5f72 6174 6520 3d20 6d6f 6465 6c73 2e44  _rate = models.D
+000007f0: 6563 696d 616c 4669 656c 6428 6e75 6c6c  ecimalField(null
+00000800: 3d54 7275 652c 2064 6563 696d 616c 5f70  =True, decimal_p
+00000810: 6c61 6365 733d 362c 206d 6178 5f64 6967  laces=6, max_dig
+00000820: 6974 733d 3829 0a20 2020 2066 6565 203d  its=8).    fee =
+00000830: 2053 7472 6970 6551 7561 6e74 756d 4375   StripeQuantumCu
+00000840: 7272 656e 6379 416d 6f75 6e74 4669 656c  rrencyAmountFiel
+00000850: 6428 0a20 2020 2020 2020 2068 656c 705f  d(.        help_
+00000860: 7465 7874 3d22 4665 6520 2869 6e20 6365  text="Fee (in ce
+00000870: 6e74 7329 2070 6169 6420 666f 7220 7468  nts) paid for th
+00000880: 6973 2074 7261 6e73 6163 7469 6f6e 2e22  is transaction."
+00000890: 0a20 2020 2029 0a20 2020 2066 6565 5f64  .    ).    fee_d
+000008a0: 6574 6169 6c73 203d 204a 534f 4e46 6965  etails = JSONFie
+000008b0: 6c64 2829 0a20 2020 206e 6574 203d 2053  ld().    net = S
+000008c0: 7472 6970 6551 7561 6e74 756d 4375 7272  tripeQuantumCurr
+000008d0: 656e 6379 416d 6f75 6e74 4669 656c 6428  encyAmountField(
+000008e0: 0a20 2020 2020 2020 2068 656c 705f 7465  .        help_te
+000008f0: 7874 3d22 4e65 7420 616d 6f75 6e74 206f  xt="Net amount o
+00000900: 6620 7468 6520 7472 616e 7361 6374 696f  f the transactio
+00000910: 6e2c 2069 6e20 6365 6e74 732e 220a 2020  n, in cents.".  
+00000920: 2020 290a 2020 2020 736f 7572 6365 203d    ).    source =
+00000930: 2053 7472 6970 6549 6446 6965 6c64 2829   StripeIdField()
+00000940: 0a20 2020 2072 6570 6f72 7469 6e67 5f63  .    reporting_c
+00000950: 6174 6567 6f72 7920 3d20 5374 7269 7065  ategory = Stripe
+00000960: 456e 756d 4669 656c 6428 0a20 2020 2020  EnumField(.     
+00000970: 2020 2065 6e75 6d3d 656e 756d 732e 4261     enum=enums.Ba
+00000980: 6c61 6e63 6554 7261 6e73 6163 7469 6f6e  lanceTransaction
+00000990: 5265 706f 7274 696e 6743 6174 6567 6f72  ReportingCategor
+000009a0: 792c 0a20 2020 2020 2020 2068 656c 705f  y,.        help_
+000009b0: 7465 7874 3d28 0a20 2020 2020 2020 2020  text=(.         
+000009c0: 2020 2022 4d6f 7265 2069 6e66 6f72 6d61     "More informa
+000009d0: 7469 6f6e 3a20 6874 7470 733a 2f2f 7374  tion: https://st
+000009e0: 7269 7065 2e63 6f6d 2f64 6f63 732f 7265  ripe.com/docs/re
+000009f0: 706f 7274 732f 7265 706f 7274 696e 672d  ports/reporting-
+00000a00: 6361 7465 676f 7269 6573 220a 2020 2020  categories".    
+00000a10: 2020 2020 292c 0a20 2020 2029 0a20 2020      ),.    ).   
+00000a20: 2073 7461 7475 7320 3d20 5374 7269 7065   status = Stripe
+00000a30: 456e 756d 4669 656c 6428 656e 756d 3d65  EnumField(enum=e
+00000a40: 6e75 6d73 2e42 616c 616e 6365 5472 616e  nums.BalanceTran
+00000a50: 7361 6374 696f 6e53 7461 7475 7329 0a20  sactionStatus). 
+00000a60: 2020 2074 7970 6520 3d20 5374 7269 7065     type = Stripe
+00000a70: 456e 756d 4669 656c 6428 656e 756d 3d65  EnumField(enum=e
+00000a80: 6e75 6d73 2e42 616c 616e 6365 5472 616e  nums.BalanceTran
+00000a90: 7361 6374 696f 6e54 7970 6529 0a0a 2020  sactionType)..  
+00000aa0: 2020 6465 6620 5f5f 7374 725f 5f28 7365    def __str__(se
+00000ab0: 6c66 293a 0a20 2020 2020 2020 2061 6d6f  lf):.        amo
+00000ac0: 756e 7420 3d20 6765 745f 6672 6965 6e64  unt = get_friend
+00000ad0: 6c79 5f63 7572 7265 6e63 795f 616d 6f75  ly_currency_amou
+00000ae0: 6e74 2873 656c 662e 616d 6f75 6e74 202f  nt(self.amount /
+00000af0: 2031 3030 2c20 7365 6c66 2e63 7572 7265   100, self.curre
+00000b00: 6e63 7929 0a20 2020 2020 2020 2073 7461  ncy).        sta
+00000b10: 7475 7320 3d20 656e 756d 732e 4261 6c61  tus = enums.Bala
+00000b20: 6e63 6554 7261 6e73 6163 7469 6f6e 5374  nceTransactionSt
+00000b30: 6174 7573 2e68 756d 616e 697a 6528 7365  atus.humanize(se
+00000b40: 6c66 2e73 7461 7475 7329 0a20 2020 2020  lf.status).     
+00000b50: 2020 2072 6574 7572 6e20 6622 7b61 6d6f     return f"{amo
+00000b60: 756e 747d 2028 7b73 7461 7475 737d 2922  unt} ({status})"
+00000b70: 0a0a 2020 2020 6465 6620 6765 745f 736f  ..    def get_so
+00000b80: 7572 6365 5f63 6c61 7373 2873 656c 6629  urce_class(self)
+00000b90: 3a0a 2020 2020 2020 2020 7472 793a 0a20  :.        try:. 
+00000ba0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00000bb0: 6e20 6170 7073 2e67 6574 5f6d 6f64 656c  n apps.get_model
+00000bc0: 2822 646a 7374 7269 7065 222c 2073 656c  ("djstripe", sel
+00000bd0: 662e 7479 7065 290a 2020 2020 2020 2020  f.type).        
+00000be0: 6578 6365 7074 204c 6f6f 6b75 7045 7272  except LookupErr
+00000bf0: 6f72 3a0a 2020 2020 2020 2020 2020 2020  or:.            
+00000c00: 7261 6973 650a 0a20 2020 2064 6566 2067  raise..    def g
+00000c10: 6574 5f73 6f75 7263 655f 696e 7374 616e  et_source_instan
+00000c20: 6365 2873 656c 6629 3a0a 2020 2020 2020  ce(self):.      
+00000c30: 2020 7265 7475 726e 2073 656c 662e 6765    return self.ge
+00000c40: 745f 736f 7572 6365 5f63 6c61 7373 2829  t_source_class()
+00000c50: 2e6f 626a 6563 7473 2e67 6574 2869 643d  .objects.get(id=
+00000c60: 7365 6c66 2e73 6f75 7263 6529 0a0a 2020  self.source)..  
+00000c70: 2020 6465 6620 6765 745f 7374 7269 7065    def get_stripe
+00000c80: 5f64 6173 6862 6f61 7264 5f75 726c 2873  _dashboard_url(s
+00000c90: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
+00000ca0: 7475 726e 2073 656c 662e 6765 745f 736f  turn self.get_so
+00000cb0: 7572 6365 5f69 6e73 7461 6e63 6528 292e  urce_instance().
+00000cc0: 6765 745f 7374 7269 7065 5f64 6173 6862  get_stripe_dashb
+00000cd0: 6f61 7264 5f75 726c 2829 0a0a 0a63 6c61  oard_url()...cla
+00000ce0: 7373 2043 6861 7267 6528 5374 7269 7065  ss Charge(Stripe
+00000cf0: 4d6f 6465 6c29 3a0a 2020 2020 2222 220a  Model):.    """.
+00000d00: 2020 2020 546f 2063 6861 7267 6520 6120      To charge a 
+00000d10: 6372 6564 6974 206f 7220 6120 6465 6269  credit or a debi
+00000d20: 7420 6361 7264 2c20 796f 7520 6372 6561  t card, you crea
+00000d30: 7465 2061 2063 6861 7267 6520 6f62 6a65  te a charge obje
+00000d40: 6374 2e20 596f 7520 6361 6e0a 2020 2020  ct. You can.    
+00000d50: 7265 7472 6965 7665 2061 6e64 2072 6566  retrieve and ref
+00000d60: 756e 6420 696e 6469 7669 6475 616c 2063  und individual c
+00000d70: 6861 7267 6573 2061 7320 7765 6c6c 2061  harges as well a
+00000d80: 7320 6c69 7374 2061 6c6c 2063 6861 7267  s list all charg
+00000d90: 6573 2e20 4368 6172 6765 730a 2020 2020  es. Charges.    
+00000da0: 6172 6520 6964 656e 7469 6669 6564 2062  are identified b
+00000db0: 7920 6120 756e 6971 7565 2072 616e 646f  y a unique rando
+00000dc0: 6d20 4944 2e0a 0a20 2020 2053 7472 6970  m ID...    Strip
+00000dd0: 6520 646f 6375 6d65 6e74 6174 696f 6e3a  e documentation:
+00000de0: 2068 7474 7073 3a2f 2f73 7472 6970 652e   https://stripe.
+00000df0: 636f 6d2f 646f 6373 2f61 7069 3f6c 616e  com/docs/api?lan
+00000e00: 673d 7079 7468 6f6e 2363 6861 7267 6573  g=python#charges
+00000e10: 0a20 2020 2022 2222 0a0a 2020 2020 7374  .    """..    st
+00000e20: 7269 7065 5f63 6c61 7373 203d 2073 7472  ripe_class = str
+00000e30: 6970 652e 4368 6172 6765 0a20 2020 2065  ipe.Charge.    e
+00000e40: 7870 616e 645f 6669 656c 6473 203d 205b  xpand_fields = [
+00000e50: 2262 616c 616e 6365 5f74 7261 6e73 6163  "balance_transac
+00000e60: 7469 6f6e 225d 0a20 2020 2073 7472 6970  tion"].    strip
+00000e70: 655f 6461 7368 626f 6172 645f 6974 656d  e_dashboard_item
+00000e80: 5f6e 616d 6520 3d20 2270 6179 6d65 6e74  _name = "payment
+00000e90: 7322 0a0a 2020 2020 616d 6f75 6e74 203d  s"..    amount =
+00000ea0: 2053 7472 6970 6544 6563 696d 616c 4375   StripeDecimalCu
+00000eb0: 7272 656e 6379 416d 6f75 6e74 4669 656c  rrencyAmountFiel
+00000ec0: 6428 6865 6c70 5f74 6578 743d 2241 6d6f  d(help_text="Amo
+00000ed0: 756e 7420 6368 6172 6765 6420 2861 7320  unt charged (as 
+00000ee0: 6465 6369 6d61 6c29 2e22 290a 2020 2020  decimal).").    
+00000ef0: 616d 6f75 6e74 5f63 6170 7475 7265 6420  amount_captured 
+00000f00: 3d20 5374 7269 7065 4465 6369 6d61 6c43  = StripeDecimalC
+00000f10: 7572 7265 6e63 7941 6d6f 756e 7446 6965  urrencyAmountFie
+00000f20: 6c64 280a 2020 2020 2020 2020 6e75 6c6c  ld(.        null
+00000f30: 3d54 7275 652c 0a20 2020 2020 2020 2068  =True,.        h
+00000f40: 656c 705f 7465 7874 3d28 0a20 2020 2020  elp_text=(.     
+00000f50: 2020 2020 2020 2022 416d 6f75 6e74 2028         "Amount (
+00000f60: 6173 2064 6563 696d 616c 2920 6361 7074  as decimal) capt
+00000f70: 7572 6564 2028 6361 6e20 6265 206c 6573  ured (can be les
+00000f80: 7320 7468 616e 2074 6865 2061 6d6f 756e  s than the amoun
+00000f90: 7420 6174 7472 6962 7574 6520 220a 2020  t attribute ".  
+00000fa0: 2020 2020 2020 2020 2020 226f 6e20 7468            "on th
+00000fb0: 6520 6368 6172 6765 2069 6620 6120 7061  e charge if a pa
+00000fc0: 7274 6961 6c20 6361 7074 7572 6520 7761  rtial capture wa
+00000fd0: 7320 6973 7375 6564 292e 220a 2020 2020  s issued).".    
+00000fe0: 2020 2020 292c 0a20 2020 2029 0a20 2020      ),.    ).   
+00000ff0: 2061 6d6f 756e 745f 7265 6675 6e64 6564   amount_refunded
+00001000: 203d 2053 7472 6970 6544 6563 696d 616c   = StripeDecimal
+00001010: 4375 7272 656e 6379 416d 6f75 6e74 4669  CurrencyAmountFi
+00001020: 656c 6428 0a20 2020 2020 2020 2068 656c  eld(.        hel
+00001030: 705f 7465 7874 3d28 0a20 2020 2020 2020  p_text=(.       
+00001040: 2020 2020 2022 416d 6f75 6e74 2028 6173       "Amount (as
+00001050: 2064 6563 696d 616c 2920 7265 6675 6e64   decimal) refund
+00001060: 6564 2028 6361 6e20 6265 206c 6573 7320  ed (can be less 
+00001070: 7468 616e 2074 6865 2061 6d6f 756e 7420  than the amount 
+00001080: 6174 7472 6962 7574 6520 6f6e 2022 0a20  attribute on ". 
+00001090: 2020 2020 2020 2020 2020 2022 7468 6520             "the 
+000010a0: 6368 6172 6765 2069 6620 6120 7061 7274  charge if a part
+000010b0: 6961 6c20 7265 6675 6e64 2077 6173 2069  ial refund was i
+000010c0: 7373 7565 6429 2e22 0a20 2020 2020 2020  ssued).".       
+000010d0: 2029 0a20 2020 2029 0a20 2020 2061 7070   ).    ).    app
+000010e0: 6c69 6361 7469 6f6e 203d 206d 6f64 656c  lication = model
+000010f0: 732e 4368 6172 4669 656c 6428 0a20 2020  s.CharField(.   
+00001100: 2020 2020 206d 6178 5f6c 656e 6774 683d       max_length=
+00001110: 3235 352c 0a20 2020 2020 2020 2062 6c61  255,.        bla
+00001120: 6e6b 3d54 7275 652c 0a20 2020 2020 2020  nk=True,.       
+00001130: 2068 656c 705f 7465 7874 3d22 4944 206f   help_text="ID o
+00001140: 6620 7468 6520 436f 6e6e 6563 7420 6170  f the Connect ap
+00001150: 706c 6963 6174 696f 6e20 7468 6174 2063  plication that c
+00001160: 7265 6174 6564 2074 6865 2063 6861 7267  reated the charg
+00001170: 652e 222c 0a20 2020 2029 0a20 2020 2061  e.",.    ).    a
+00001180: 7070 6c69 6361 7469 6f6e 5f66 6565 203d  pplication_fee =
+00001190: 2053 7472 6970 6546 6f72 6569 676e 4b65   StripeForeignKe
+000011a0: 7928 0a20 2020 2020 2020 2022 4170 706c  y(.        "Appl
+000011b0: 6963 6174 696f 6e46 6565 222c 0a20 2020  icationFee",.   
+000011c0: 2020 2020 206f 6e5f 6465 6c65 7465 3d6d       on_delete=m
+000011d0: 6f64 656c 732e 5345 545f 4e55 4c4c 2c0a  odels.SET_NULL,.
+000011e0: 2020 2020 2020 2020 6e75 6c6c 3d54 7275          null=Tru
+000011f0: 652c 0a20 2020 2020 2020 2062 6c61 6e6b  e,.        blank
+00001200: 3d54 7275 652c 0a20 2020 2020 2020 2072  =True,.        r
+00001210: 656c 6174 6564 5f6e 616d 653d 2266 6565  elated_name="fee
+00001220: 5f66 6f72 5f63 6861 7267 6522 2c0a 2020  _for_charge",.  
+00001230: 2020 2020 2020 6865 6c70 5f74 6578 743d        help_text=
+00001240: 2254 6865 2061 7070 6c69 6361 7469 6f6e  "The application
+00001250: 2066 6565 2028 6966 2061 6e79 2920 666f   fee (if any) fo
+00001260: 7220 7468 6520 6368 6172 6765 2e22 2c0a  r the charge.",.
+00001270: 2020 2020 290a 2020 2020 6170 706c 6963      ).    applic
+00001280: 6174 696f 6e5f 6665 655f 616d 6f75 6e74  ation_fee_amount
+00001290: 203d 2053 7472 6970 6544 6563 696d 616c   = StripeDecimal
+000012a0: 4375 7272 656e 6379 416d 6f75 6e74 4669  CurrencyAmountFi
+000012b0: 656c 6428 0a20 2020 2020 2020 206e 756c  eld(.        nul
+000012c0: 6c3d 5472 7565 2c0a 2020 2020 2020 2020  l=True,.        
+000012d0: 626c 616e 6b3d 5472 7565 2c0a 2020 2020  blank=True,.    
+000012e0: 2020 2020 6865 6c70 5f74 6578 743d 280a      help_text=(.
+000012f0: 2020 2020 2020 2020 2020 2020 2254 6865              "The
+00001300: 2061 6d6f 756e 7420 2861 7320 6465 6369   amount (as deci
+00001310: 6d61 6c29 206f 6620 7468 6520 6170 706c  mal) of the appl
+00001320: 6963 6174 696f 6e20 6665 6520 2869 6620  ication fee (if 
+00001330: 616e 7929 2022 0a20 2020 2020 2020 2020  any) ".         
+00001340: 2020 2022 7265 7175 6573 7465 6420 666f     "requested fo
+00001350: 7220 7468 6520 6368 6172 6765 2e22 0a20  r the charge.". 
+00001360: 2020 2020 2020 2029 2c0a 2020 2020 290a         ),.    ).
+00001370: 2020 2020 6261 6c61 6e63 655f 7472 616e      balance_tran
+00001380: 7361 6374 696f 6e20 3d20 5374 7269 7065  saction = Stripe
+00001390: 466f 7265 6967 6e4b 6579 280a 2020 2020  ForeignKey(.    
+000013a0: 2020 2020 2242 616c 616e 6365 5472 616e      "BalanceTran
+000013b0: 7361 6374 696f 6e22 2c0a 2020 2020 2020  saction",.      
+000013c0: 2020 6f6e 5f64 656c 6574 653d 6d6f 6465    on_delete=mode
+000013d0: 6c73 2e53 4554 5f4e 554c 4c2c 0a20 2020  ls.SET_NULL,.   
+000013e0: 2020 2020 206e 756c 6c3d 5472 7565 2c0a       null=True,.
+000013f0: 2020 2020 2020 2020 6865 6c70 5f74 6578          help_tex
+00001400: 743d 280a 2020 2020 2020 2020 2020 2020  t=(.            
+00001410: 2254 6865 2062 616c 616e 6365 2074 7261  "The balance tra
+00001420: 6e73 6163 7469 6f6e 2074 6861 7420 6465  nsaction that de
+00001430: 7363 7269 6265 7320 7468 6520 696d 7061  scribes the impa
+00001440: 6374 206f 6620 7468 6973 2063 6861 7267  ct of this charg
+00001450: 6520 220a 2020 2020 2020 2020 2020 2020  e ".            
+00001460: 226f 6e20 796f 7572 2061 6363 6f75 6e74  "on your account
+00001470: 2062 616c 616e 6365 2028 6e6f 7420 696e   balance (not in
+00001480: 636c 7564 696e 6720 7265 6675 6e64 7320  cluding refunds 
+00001490: 6f72 2064 6973 7075 7465 7329 2e22 0a20  or disputes).". 
+000014a0: 2020 2020 2020 2029 2c0a 2020 2020 290a         ),.    ).
+000014b0: 2020 2020 6269 6c6c 696e 675f 6465 7461      billing_deta
+000014c0: 696c 7320 3d20 4a53 4f4e 4669 656c 6428  ils = JSONField(
+000014d0: 0a20 2020 2020 2020 206e 756c 6c3d 5472  .        null=Tr
+000014e0: 7565 2c0a 2020 2020 2020 2020 6865 6c70  ue,.        help
+000014f0: 5f74 6578 743d 280a 2020 2020 2020 2020  _text=(.        
+00001500: 2020 2020 2242 696c 6c69 6e67 2069 6e66      "Billing inf
+00001510: 6f72 6d61 7469 6f6e 2061 7373 6f63 6961  ormation associa
+00001520: 7465 6420 7769 7468 2074 6865 2050 6179  ted with the Pay
+00001530: 6d65 6e74 4d65 7468 6f64 2061 7420 7468  mentMethod at th
+00001540: 6520 220a 2020 2020 2020 2020 2020 2020  e ".            
+00001550: 2274 696d 6520 6f66 2074 6865 2074 7261  "time of the tra
+00001560: 6e73 6163 7469 6f6e 2e22 0a20 2020 2020  nsaction.".     
+00001570: 2020 2029 2c0a 2020 2020 290a 2020 2020     ),.    ).    
+00001580: 6361 6c63 756c 6174 6564 5f73 7461 7465  calculated_state
+00001590: 6d65 6e74 5f64 6573 6372 6970 746f 7220  ment_descriptor 
+000015a0: 3d20 6d6f 6465 6c73 2e43 6861 7246 6965  = models.CharFie
+000015b0: 6c64 280a 2020 2020 2020 2020 6d61 785f  ld(.        max_
+000015c0: 6c65 6e67 7468 3d32 322c 0a20 2020 2020  length=22,.     
+000015d0: 2020 2064 6566 6175 6c74 3d22 222c 0a20     default="",. 
+000015e0: 2020 2020 2020 2068 656c 705f 7465 7874         help_text
+000015f0: 3d28 0a20 2020 2020 2020 2020 2020 2022  =(.            "
+00001600: 5468 6520 6675 6c6c 2073 7461 7465 6d65  The full stateme
+00001610: 6e74 2064 6573 6372 6970 746f 7220 7468  nt descriptor th
+00001620: 6174 2069 7320 7061 7373 6564 2074 6f20  at is passed to 
+00001630: 6361 7264 206e 6574 776f 726b 732c 2022  card networks, "
+00001640: 0a20 2020 2020 2020 2020 2020 2022 616e  .            "an
+00001650: 6420 7468 6174 2069 7320 6469 7370 6c61  d that is displa
+00001660: 7965 6420 6f6e 2079 6f75 7220 6375 7374  yed on your cust
+00001670: 6f6d 6572 7327 2063 7265 6469 7420 6361  omers' credit ca
+00001680: 7264 2061 6e64 2062 616e 6b20 7374 6174  rd and bank stat
+00001690: 656d 656e 7473 2e20 220a 2020 2020 2020  ements. ".      
+000016a0: 2020 2020 2020 2241 6c6c 6f77 7320 796f        "Allows yo
+000016b0: 7520 746f 2073 6565 2077 6861 7420 7468  u to see what th
+000016c0: 6520 7374 6174 656d 656e 7420 6465 7363  e statement desc
+000016d0: 7269 7074 6f72 206c 6f6f 6b73 206c 696b  riptor looks lik
+000016e0: 6520 6166 7465 7220 7468 6520 220a 2020  e after the ".  
+000016f0: 2020 2020 2020 2020 2020 2273 7461 7469            "stati
+00001700: 6320 616e 6420 6479 6e61 6d69 6320 706f  c and dynamic po
+00001710: 7274 696f 6e73 2061 7265 2063 6f6d 6269  rtions are combi
+00001720: 6e65 642e 220a 2020 2020 2020 2020 292c  ned.".        ),
+00001730: 0a20 2020 2029 0a20 2020 2063 6170 7475  .    ).    captu
+00001740: 7265 6420 3d20 6d6f 6465 6c73 2e42 6f6f  red = models.Boo
+00001750: 6c65 616e 4669 656c 6428 0a20 2020 2020  leanField(.     
+00001760: 2020 2064 6566 6175 6c74 3d46 616c 7365     default=False
+00001770: 2c0a 2020 2020 2020 2020 6865 6c70 5f74  ,.        help_t
+00001780: 6578 743d 280a 2020 2020 2020 2020 2020  ext=(.          
+00001790: 2020 2249 6620 7468 6520 6368 6172 6765    "If the charge
+000017a0: 2077 6173 2063 7265 6174 6564 2077 6974   was created wit
+000017b0: 686f 7574 2063 6170 7475 7269 6e67 2c20  hout capturing, 
+000017c0: 7468 6973 2062 6f6f 6c65 616e 2072 6570  this boolean rep
+000017d0: 7265 7365 6e74 7322 0a20 2020 2020 2020  resents".       
+000017e0: 2020 2020 2022 2077 6865 7468 6572 206f       " whether o
+000017f0: 7220 6e6f 7420 6974 2069 7320 7374 696c  r not it is stil
+00001800: 6c20 756e 6361 7074 7572 6564 206f 7220  l uncaptured or 
+00001810: 6861 7320 7369 6e63 6520 6265 656e 2063  has since been c
+00001820: 6170 7475 7265 642e 220a 2020 2020 2020  aptured.".      
+00001830: 2020 292c 0a20 2020 2029 0a20 2020 2063    ),.    ).    c
+00001840: 7572 7265 6e63 7920 3d20 5374 7269 7065  urrency = Stripe
+00001850: 4375 7272 656e 6379 436f 6465 4669 656c  CurrencyCodeFiel
+00001860: 6428 0a20 2020 2020 2020 2068 656c 705f  d(.        help_
+00001870: 7465 7874 3d22 5468 6520 6375 7272 656e  text="The curren
+00001880: 6379 2069 6e20 7768 6963 6820 7468 6520  cy in which the 
+00001890: 6368 6172 6765 2077 6173 206d 6164 652e  charge was made.
+000018a0: 220a 2020 2020 290a 2020 2020 6375 7374  ".    ).    cust
+000018b0: 6f6d 6572 203d 2053 7472 6970 6546 6f72  omer = StripeFor
+000018c0: 6569 676e 4b65 7928 0a20 2020 2020 2020  eignKey(.       
+000018d0: 2022 4375 7374 6f6d 6572 222c 0a20 2020   "Customer",.   
+000018e0: 2020 2020 206f 6e5f 6465 6c65 7465 3d6d       on_delete=m
+000018f0: 6f64 656c 732e 5345 545f 4e55 4c4c 2c0a  odels.SET_NULL,.
+00001900: 2020 2020 2020 2020 6e75 6c6c 3d54 7275          null=Tru
+00001910: 652c 0a20 2020 2020 2020 2062 6c61 6e6b  e,.        blank
+00001920: 3d54 7275 652c 0a20 2020 2020 2020 2072  =True,.        r
+00001930: 656c 6174 6564 5f6e 616d 653d 2263 6861  elated_name="cha
+00001940: 7267 6573 222c 0a20 2020 2020 2020 2068  rges",.        h
+00001950: 656c 705f 7465 7874 3d22 5468 6520 6375  elp_text="The cu
+00001960: 7374 6f6d 6572 2061 7373 6f63 6961 7465  stomer associate
+00001970: 6420 7769 7468 2074 6869 7320 6368 6172  d with this char
+00001980: 6765 2e22 2c0a 2020 2020 290a 0a20 2020  ge.",.    )..   
+00001990: 2064 6973 7075 7465 203d 2053 7472 6970   dispute = Strip
+000019a0: 6546 6f72 6569 676e 4b65 7928 0a20 2020  eForeignKey(.   
+000019b0: 2020 2020 2022 4469 7370 7574 6522 2c0a       "Dispute",.
+000019c0: 2020 2020 2020 2020 6f6e 5f64 656c 6574          on_delet
+000019d0: 653d 6d6f 6465 6c73 2e53 4554 5f4e 554c  e=models.SET_NUL
+000019e0: 4c2c 0a20 2020 2020 2020 206e 756c 6c3d  L,.        null=
+000019f0: 5472 7565 2c0a 2020 2020 2020 2020 626c  True,.        bl
+00001a00: 616e 6b3d 5472 7565 2c0a 2020 2020 2020  ank=True,.      
+00001a10: 2020 7265 6c61 7465 645f 6e61 6d65 3d22    related_name="
+00001a20: 6368 6172 6765 7322 2c0a 2020 2020 2020  charges",.      
+00001a30: 2020 6865 6c70 5f74 6578 743d 2244 6574    help_text="Det
+00001a40: 6169 6c73 2061 626f 7574 2074 6865 2064  ails about the d
+00001a50: 6973 7075 7465 2069 6620 7468 6520 6368  ispute if the ch
+00001a60: 6172 6765 2068 6173 2062 6565 6e20 6469  arge has been di
+00001a70: 7370 7574 6564 2e22 2c0a 2020 2020 290a  sputed.",.    ).
+00001a80: 2020 2020 6469 7370 7574 6564 203d 206d      disputed = m
+00001a90: 6f64 656c 732e 426f 6f6c 6561 6e46 6965  odels.BooleanFie
+00001aa0: 6c64 280a 2020 2020 2020 2020 6465 6661  ld(.        defa
+00001ab0: 756c 743d 4661 6c73 652c 0a20 2020 2020  ult=False,.     
+00001ac0: 2020 2068 656c 705f 7465 7874 3d22 5768     help_text="Wh
+00001ad0: 6574 6865 7220 7468 6520 6368 6172 6765  ether the charge
+00001ae0: 2068 6173 2062 6565 6e20 6469 7370 7574   has been disput
+00001af0: 6564 2e22 2c0a 2020 2020 290a 2020 2020  ed.",.    ).    
+00001b00: 6661 696c 7572 655f 636f 6465 203d 2053  failure_code = S
+00001b10: 7472 6970 6545 6e75 6d46 6965 6c64 280a  tripeEnumField(.
+00001b20: 2020 2020 2020 2020 656e 756d 3d65 6e75          enum=enu
+00001b30: 6d73 2e41 7069 4572 726f 7243 6f64 652c  ms.ApiErrorCode,
+00001b40: 0a20 2020 2020 2020 2064 6566 6175 6c74  .        default
+00001b50: 3d22 222c 0a20 2020 2020 2020 2062 6c61  ="",.        bla
+00001b60: 6e6b 3d54 7275 652c 0a20 2020 2020 2020  nk=True,.       
+00001b70: 2068 656c 705f 7465 7874 3d22 4572 726f   help_text="Erro
+00001b80: 7220 636f 6465 2065 7870 6c61 696e 696e  r code explainin
+00001b90: 6720 7265 6173 6f6e 2066 6f72 2063 6861  g reason for cha
+00001ba0: 7267 6520 6661 696c 7572 6520 6966 2061  rge failure if a
+00001bb0: 7661 696c 6162 6c65 2e22 2c0a 2020 2020  vailable.",.    
+00001bc0: 290a 2020 2020 6661 696c 7572 655f 6d65  ).    failure_me
+00001bd0: 7373 6167 6520 3d20 6d6f 6465 6c73 2e54  ssage = models.T
+00001be0: 6578 7446 6965 6c64 280a 2020 2020 2020  extField(.      
+00001bf0: 2020 6d61 785f 6c65 6e67 7468 3d35 3030    max_length=500
+00001c00: 302c 0a20 2020 2020 2020 2064 6566 6175  0,.        defau
+00001c10: 6c74 3d22 222c 0a20 2020 2020 2020 2062  lt="",.        b
+00001c20: 6c61 6e6b 3d54 7275 652c 0a20 2020 2020  lank=True,.     
+00001c30: 2020 2068 656c 705f 7465 7874 3d28 0a20     help_text=(. 
+00001c40: 2020 2020 2020 2020 2020 2022 4d65 7373             "Mess
+00001c50: 6167 6520 746f 2075 7365 7220 6675 7274  age to user furt
+00001c60: 6865 7220 6578 706c 6169 6e69 6e67 2072  her explaining r
+00001c70: 6561 736f 6e20 666f 7220 6368 6172 6765  eason for charge
+00001c80: 2066 6169 6c75 7265 2069 6620 6176 6169   failure if avai
+00001c90: 6c61 626c 652e 220a 2020 2020 2020 2020  lable.".        
+00001ca0: 292c 0a20 2020 2029 0a20 2020 2066 7261  ),.    ).    fra
+00001cb0: 7564 5f64 6574 6169 6c73 203d 204a 534f  ud_details = JSO
+00001cc0: 4e46 6965 6c64 280a 2020 2020 2020 2020  NField(.        
+00001cd0: 6865 6c70 5f74 6578 743d 2248 6173 6820  help_text="Hash 
+00001ce0: 7769 7468 2069 6e66 6f72 6d61 7469 6f6e  with information
+00001cf0: 206f 6e20 6672 6175 6420 6173 7365 7373   on fraud assess
+00001d00: 6d65 6e74 7320 666f 7220 7468 6520 6368  ments for the ch
+00001d10: 6172 6765 2e22 2c0a 2020 2020 2020 2020  arge.",.        
+00001d20: 6e75 6c6c 3d54 7275 652c 0a20 2020 2020  null=True,.     
+00001d30: 2020 2062 6c61 6e6b 3d54 7275 652c 0a20     blank=True,. 
+00001d40: 2020 2029 0a20 2020 2069 6e76 6f69 6365     ).    invoice
+00001d50: 203d 2053 7472 6970 6546 6f72 6569 676e   = StripeForeign
+00001d60: 4b65 7928 0a20 2020 2020 2020 2022 496e  Key(.        "In
+00001d70: 766f 6963 6522 2c0a 2020 2020 2020 2020  voice",.        
+00001d80: 6f6e 5f64 656c 6574 653d 6d6f 6465 6c73  on_delete=models
+00001d90: 2e43 4153 4341 4445 2c0a 2020 2020 2020  .CASCADE,.      
+00001da0: 2020 6e75 6c6c 3d54 7275 652c 0a20 2020    null=True,.   
+00001db0: 2020 2020 2072 656c 6174 6564 5f6e 616d       related_nam
+00001dc0: 653d 2263 6861 7267 6573 222c 0a20 2020  e="charges",.   
+00001dd0: 2020 2020 2068 656c 705f 7465 7874 3d22       help_text="
+00001de0: 5468 6520 696e 766f 6963 6520 7468 6973  The invoice this
+00001df0: 2063 6861 7267 6520 6973 2066 6f72 2069   charge is for i
+00001e00: 6620 6f6e 6520 6578 6973 7473 2e22 2c0a  f one exists.",.
+00001e10: 2020 2020 290a 2020 2020 2320 544f 444f      ).    # TODO
+00001e20: 3a20 6f72 6465 7220 2872 6571 7569 7265  : order (require
+00001e30: 7320 4f72 6465 7220 6d6f 6465 6c29 0a20  s Order model). 
+00001e40: 2020 206f 6e5f 6265 6861 6c66 5f6f 6620     on_behalf_of 
+00001e50: 3d20 5374 7269 7065 466f 7265 6967 6e4b  = StripeForeignK
+00001e60: 6579 280a 2020 2020 2020 2020 2241 6363  ey(.        "Acc
+00001e70: 6f75 6e74 222c 0a20 2020 2020 2020 206f  ount",.        o
+00001e80: 6e5f 6465 6c65 7465 3d6d 6f64 656c 732e  n_delete=models.
+00001e90: 4341 5343 4144 452c 0a20 2020 2020 2020  CASCADE,.       
+00001ea0: 206e 756c 6c3d 5472 7565 2c0a 2020 2020   null=True,.    
+00001eb0: 2020 2020 626c 616e 6b3d 5472 7565 2c0a      blank=True,.
+00001ec0: 2020 2020 2020 2020 7265 6c61 7465 645f          related_
+00001ed0: 6e61 6d65 3d22 6368 6172 6765 7322 2c0a  name="charges",.
+00001ee0: 2020 2020 2020 2020 6865 6c70 5f74 6578          help_tex
+00001ef0: 743d 280a 2020 2020 2020 2020 2020 2020  t=(.            
+00001f00: 2254 6865 2061 6363 6f75 6e74 2028 6966  "The account (if
+00001f10: 2061 6e79 2920 7468 6520 6368 6172 6765   any) the charge
+00001f20: 2077 6173 206d 6164 6520 6f6e 2062 6568   was made on beh
+00001f30: 616c 6620 6f66 2022 0a20 2020 2020 2020  alf of ".       
+00001f40: 2020 2020 2022 7769 7468 6f75 7420 7472       "without tr
+00001f50: 6967 6765 7269 6e67 2061 6e20 6175 746f  iggering an auto
+00001f60: 6d61 7469 6320 7472 616e 7366 6572 2e22  matic transfer."
+00001f70: 0a20 2020 2020 2020 2029 2c0a 2020 2020  .        ),.    
+00001f80: 290a 2020 2020 6f75 7463 6f6d 6520 3d20  ).    outcome = 
+00001f90: 4a53 4f4e 4669 656c 6428 0a20 2020 2020  JSONField(.     
+00001fa0: 2020 2068 656c 705f 7465 7874 3d22 4465     help_text="De
+00001fb0: 7461 696c 7320 6162 6f75 7420 7768 6574  tails about whet
+00001fc0: 6865 7220 6f72 206e 6f74 2074 6865 2070  her or not the p
+00001fd0: 6179 6d65 6e74 2077 6173 2061 6363 6570  ayment was accep
+00001fe0: 7465 642c 2061 6e64 2077 6879 2e22 2c0a  ted, and why.",.
+00001ff0: 2020 2020 2020 2020 6e75 6c6c 3d54 7275          null=Tru
+00002000: 652c 0a20 2020 2020 2020 2062 6c61 6e6b  e,.        blank
+00002010: 3d54 7275 652c 0a20 2020 2029 0a20 2020  =True,.    ).   
+00002020: 2070 6169 6420 3d20 6d6f 6465 6c73 2e42   paid = models.B
+00002030: 6f6f 6c65 616e 4669 656c 6428 0a20 2020  ooleanField(.   
+00002040: 2020 2020 2064 6566 6175 6c74 3d46 616c       default=Fal
+00002050: 7365 2c0a 2020 2020 2020 2020 6865 6c70  se,.        help
+00002060: 5f74 6578 743d 280a 2020 2020 2020 2020  _text=(.        
+00002070: 2020 2020 2254 7275 6520 6966 2074 6865      "True if the
+00002080: 2063 6861 7267 6520 7375 6363 6565 6465   charge succeede
+00002090: 642c 2022 0a20 2020 2020 2020 2020 2020  d, ".           
+000020a0: 2022 6f72 2077 6173 2073 7563 6365 7373   "or was success
+000020b0: 6675 6c6c 7920 6175 7468 6f72 697a 6564  fully authorized
+000020c0: 2066 6f72 206c 6174 6572 2063 6170 7475   for later captu
+000020d0: 7265 2c20 4661 6c73 6520 6f74 6865 7277  re, False otherw
+000020e0: 6973 652e 220a 2020 2020 2020 2020 292c  ise.".        ),
+000020f0: 0a20 2020 2029 0a20 2020 2070 6179 6d65  .    ).    payme
+00002100: 6e74 5f69 6e74 656e 7420 3d20 5374 7269  nt_intent = Stri
+00002110: 7065 466f 7265 6967 6e4b 6579 280a 2020  peForeignKey(.  
+00002120: 2020 2020 2020 2250 6179 6d65 6e74 496e        "PaymentIn
+00002130: 7465 6e74 222c 0a20 2020 2020 2020 206e  tent",.        n
+00002140: 756c 6c3d 5472 7565 2c0a 2020 2020 2020  ull=True,.      
+00002150: 2020 6f6e 5f64 656c 6574 653d 6d6f 6465    on_delete=mode
+00002160: 6c73 2e53 4554 5f4e 554c 4c2c 0a20 2020  ls.SET_NULL,.   
+00002170: 2020 2020 2072 656c 6174 6564 5f6e 616d       related_nam
+00002180: 653d 2263 6861 7267 6573 222c 0a20 2020  e="charges",.   
+00002190: 2020 2020 2068 656c 705f 7465 7874 3d22       help_text="
+000021a0: 5061 796d 656e 7449 6e74 656e 7420 6173  PaymentIntent as
+000021b0: 736f 6369 6174 6564 2077 6974 6820 7468  sociated with th
+000021c0: 6973 2063 6861 7267 652c 2069 6620 6f6e  is charge, if on
+000021d0: 6520 6578 6973 7473 2e22 2c0a 2020 2020  e exists.",.    
+000021e0: 290a 2020 2020 7061 796d 656e 745f 6d65  ).    payment_me
+000021f0: 7468 6f64 203d 2053 7472 6970 6546 6f72  thod = StripeFor
+00002200: 6569 676e 4b65 7928 0a20 2020 2020 2020  eignKey(.       
+00002210: 2022 5061 796d 656e 744d 6574 686f 6422   "PaymentMethod"
+00002220: 2c0a 2020 2020 2020 2020 6e75 6c6c 3d54  ,.        null=T
+00002230: 7275 652c 0a20 2020 2020 2020 206f 6e5f  rue,.        on_
+00002240: 6465 6c65 7465 3d6d 6f64 656c 732e 5345  delete=models.SE
+00002250: 545f 4e55 4c4c 2c0a 2020 2020 2020 2020  T_NULL,.        
+00002260: 7265 6c61 7465 645f 6e61 6d65 3d22 6368  related_name="ch
+00002270: 6172 6765 7322 2c0a 2020 2020 2020 2020  arges",.        
+00002280: 6865 6c70 5f74 6578 743d 2250 6179 6d65  help_text="Payme
+00002290: 6e74 4d65 7468 6f64 2075 7365 6420 696e  ntMethod used in
+000022a0: 2074 6869 7320 6368 6172 6765 2e22 2c0a   this charge.",.
+000022b0: 2020 2020 290a 2020 2020 7061 796d 656e      ).    paymen
+000022c0: 745f 6d65 7468 6f64 5f64 6574 6169 6c73  t_method_details
+000022d0: 203d 204a 534f 4e46 6965 6c64 280a 2020   = JSONField(.  
+000022e0: 2020 2020 2020 6865 6c70 5f74 6578 743d        help_text=
+000022f0: 2244 6574 6169 6c73 2061 626f 7574 2074  "Details about t
+00002300: 6865 2070 6179 6d65 6e74 206d 6574 686f  he payment metho
+00002310: 6420 6174 2074 6865 2074 696d 6520 6f66  d at the time of
+00002320: 2074 6865 2074 7261 6e73 6163 7469 6f6e   the transaction
+00002330: 2e22 2c0a 2020 2020 2020 2020 6e75 6c6c  .",.        null
+00002340: 3d54 7275 652c 0a20 2020 2020 2020 2062  =True,.        b
+00002350: 6c61 6e6b 3d54 7275 652c 0a20 2020 2029  lank=True,.    )
+00002360: 0a20 2020 2072 6563 6569 7074 5f65 6d61  .    receipt_ema
+00002370: 696c 203d 206d 6f64 656c 732e 5465 7874  il = models.Text
+00002380: 4669 656c 6428 0a20 2020 2020 2020 206d  Field(.        m
+00002390: 6178 5f6c 656e 6774 683d 3830 302c 2020  ax_length=800,  
+000023a0: 2320 7975 702c 2038 3030 2e0a 2020 2020  # yup, 800..    
+000023b0: 2020 2020 6465 6661 756c 743d 2222 2c0a      default="",.
+000023c0: 2020 2020 2020 2020 626c 616e 6b3d 5472          blank=Tr
+000023d0: 7565 2c0a 2020 2020 2020 2020 6865 6c70  ue,.        help
+000023e0: 5f74 6578 743d 2254 6865 2065 6d61 696c  _text="The email
+000023f0: 2061 6464 7265 7373 2074 6861 7420 7468   address that th
+00002400: 6520 7265 6365 6970 7420 666f 7220 7468  e receipt for th
+00002410: 6973 2063 6861 7267 6520 7761 7320 7365  is charge was se
+00002420: 6e74 2074 6f2e 222c 0a20 2020 2029 0a20  nt to.",.    ). 
+00002430: 2020 2072 6563 6569 7074 5f6e 756d 6265     receipt_numbe
+00002440: 7220 3d20 6d6f 6465 6c73 2e43 6861 7246  r = models.CharF
+00002450: 6965 6c64 280a 2020 2020 2020 2020 6d61  ield(.        ma
+00002460: 785f 6c65 6e67 7468 3d31 342c 0a20 2020  x_length=14,.   
+00002470: 2020 2020 2064 6566 6175 6c74 3d22 222c       default="",
+00002480: 0a20 2020 2020 2020 2062 6c61 6e6b 3d54  .        blank=T
+00002490: 7275 652c 0a20 2020 2020 2020 2068 656c  rue,.        hel
+000024a0: 705f 7465 7874 3d28 0a20 2020 2020 2020  p_text=(.       
+000024b0: 2020 2020 2022 5468 6520 7472 616e 7361       "The transa
+000024c0: 6374 696f 6e20 6e75 6d62 6572 2074 6861  ction number tha
+000024d0: 7420 6170 7065 6172 7320 220a 2020 2020  t appears ".    
+000024e0: 2020 2020 2020 2020 226f 6e20 656d 6169          "on emai
+000024f0: 6c20 7265 6365 6970 7473 2073 656e 7420  l receipts sent 
+00002500: 666f 7220 7468 6973 2063 6861 7267 652e  for this charge.
+00002510: 220a 2020 2020 2020 2020 292c 0a20 2020  ".        ),.   
+00002520: 2029 0a20 2020 2072 6563 6569 7074 5f75   ).    receipt_u
+00002530: 726c 203d 206d 6f64 656c 732e 5465 7874  rl = models.Text
+00002540: 4669 656c 6428 0a20 2020 2020 2020 206d  Field(.        m
+00002550: 6178 5f6c 656e 6774 683d 3530 3030 2c0a  ax_length=5000,.
+00002560: 2020 2020 2020 2020 6465 6661 756c 743d          default=
+00002570: 2222 2c0a 2020 2020 2020 2020 626c 616e  "",.        blan
+00002580: 6b3d 5472 7565 2c0a 2020 2020 2020 2020  k=True,.        
+00002590: 6865 6c70 5f74 6578 743d 280a 2020 2020  help_text=(.    
+000025a0: 2020 2020 2020 2020 2254 6869 7320 6973          "This is
+000025b0: 2074 6865 2055 524c 2074 6f20 7669 6577   the URL to view
+000025c0: 2074 6865 2072 6563 6569 7074 2066 6f72   the receipt for
+000025d0: 2074 6869 7320 6368 6172 6765 2e20 220a   this charge. ".
+000025e0: 2020 2020 2020 2020 2020 2020 2254 6865              "The
+000025f0: 2072 6563 6569 7074 2069 7320 6b65 7074   receipt is kept
+00002600: 2075 702d 746f 2d64 6174 6520 746f 2074   up-to-date to t
+00002610: 6865 206c 6174 6573 7420 7374 6174 6520  he latest state 
+00002620: 6f66 2074 6865 2063 6861 7267 652c 2022  of the charge, "
+00002630: 0a20 2020 2020 2020 2020 2020 2022 696e  .            "in
+00002640: 636c 7564 696e 6720 616e 7920 7265 6675  cluding any refu
+00002650: 6e64 732e 2049 6620 7468 6520 6368 6172  nds. If the char
+00002660: 6765 2069 7320 666f 7220 616e 2049 6e76  ge is for an Inv
+00002670: 6f69 6365 2c20 220a 2020 2020 2020 2020  oice, ".        
+00002680: 2020 2020 2274 6865 2072 6563 6569 7074      "the receipt
+00002690: 2077 696c 6c20 6265 2073 7479 6c69 7a65   will be stylize
+000026a0: 6420 6173 2061 6e20 496e 766f 6963 6520  d as an Invoice 
+000026b0: 7265 6365 6970 742e 220a 2020 2020 2020  receipt.".      
+000026c0: 2020 292c 0a20 2020 2029 0a20 2020 2072    ),.    ).    r
+000026d0: 6566 756e 6465 6420 3d20 6d6f 6465 6c73  efunded = models
+000026e0: 2e42 6f6f 6c65 616e 4669 656c 6428 0a20  .BooleanField(. 
+000026f0: 2020 2020 2020 2064 6566 6175 6c74 3d46         default=F
+00002700: 616c 7365 2c0a 2020 2020 2020 2020 6865  alse,.        he
+00002710: 6c70 5f74 6578 743d 280a 2020 2020 2020  lp_text=(.      
+00002720: 2020 2020 2020 2257 6865 7468 6572 206f        "Whether o
+00002730: 7220 6e6f 7420 7468 6520 6368 6172 6765  r not the charge
+00002740: 2068 6173 2062 6565 6e20 6675 6c6c 7920   has been fully 
+00002750: 7265 6675 6e64 6564 2e20 220a 2020 2020  refunded. ".    
+00002760: 2020 2020 2020 2020 2249 6620 7468 6520          "If the 
+00002770: 6368 6172 6765 2069 7320 6f6e 6c79 2070  charge is only p
+00002780: 6172 7469 616c 6c79 2072 6566 756e 6465  artially refunde
+00002790: 642c 2022 0a20 2020 2020 2020 2020 2020  d, ".           
+000027a0: 2022 7468 6973 2061 7474 7269 6275 7465   "this attribute
+000027b0: 2077 696c 6c20 7374 696c 6c20 6265 2066   will still be f
+000027c0: 616c 7365 2e22 0a20 2020 2020 2020 2029  alse.".        )
+000027d0: 2c0a 2020 2020 290a 2020 2020 2320 544f  ,.    ).    # TO
+000027e0: 444f 3a20 7265 7669 6577 2028 7265 7175  DO: review (requ
+000027f0: 6972 6573 2052 6576 6965 7720 6d6f 6465  ires Review mode
+00002800: 6c29 0a20 2020 2073 6869 7070 696e 6720  l).    shipping 
+00002810: 3d20 4a53 4f4e 4669 656c 6428 0a20 2020  = JSONField(.   
+00002820: 2020 2020 206e 756c 6c3d 5472 7565 2c20       null=True, 
+00002830: 626c 616e 6b3d 5472 7565 2c20 6865 6c70  blank=True, help
+00002840: 5f74 6578 743d 2253 6869 7070 696e 6720  _text="Shipping 
+00002850: 696e 666f 726d 6174 696f 6e20 666f 7220  information for 
+00002860: 7468 6520 6368 6172 6765 220a 2020 2020  the charge".    
+00002870: 290a 2020 2020 736f 7572 6365 203d 2050  ).    source = P
+00002880: 6179 6d65 6e74 4d65 7468 6f64 466f 7265  aymentMethodFore
+00002890: 6967 6e4b 6579 280a 2020 2020 2020 2020  ignKey(.        
+000028a0: 6f6e 5f64 656c 6574 653d 6d6f 6465 6c73  on_delete=models
+000028b0: 2e53 4554 5f4e 554c 4c2c 0a20 2020 2020  .SET_NULL,.     
+000028c0: 2020 206e 756c 6c3d 5472 7565 2c0a 2020     null=True,.  
+000028d0: 2020 2020 2020 626c 616e 6b3d 5472 7565        blank=True
+000028e0: 2c0a 2020 2020 2020 2020 7265 6c61 7465  ,.        relate
+000028f0: 645f 6e61 6d65 3d22 6368 6172 6765 7322  d_name="charges"
+00002900: 2c0a 2020 2020 2020 2020 6865 6c70 5f74  ,.        help_t
+00002910: 6578 743d 2254 6865 2073 6f75 7263 6520  ext="The source 
+00002920: 7573 6564 2066 6f72 2074 6869 7320 6368  used for this ch
+00002930: 6172 6765 2e22 2c0a 2020 2020 290a 2020  arge.",.    ).  
+00002940: 2020 736f 7572 6365 5f74 7261 6e73 6665    source_transfe
+00002950: 7220 3d20 5374 7269 7065 466f 7265 6967  r = StripeForeig
+00002960: 6e4b 6579 280a 2020 2020 2020 2020 2254  nKey(.        "T
+00002970: 7261 6e73 6665 7222 2c0a 2020 2020 2020  ransfer",.      
+00002980: 2020 6e75 6c6c 3d54 7275 652c 0a20 2020    null=True,.   
+00002990: 2020 2020 2062 6c61 6e6b 3d54 7275 652c       blank=True,
+000029a0: 0a20 2020 2020 2020 206f 6e5f 6465 6c65  .        on_dele
+000029b0: 7465 3d6d 6f64 656c 732e 4341 5343 4144  te=models.CASCAD
+000029c0: 452c 0a20 2020 2020 2020 2068 656c 705f  E,.        help_
+000029d0: 7465 7874 3d28 0a20 2020 2020 2020 2020  text=(.         
+000029e0: 2020 2022 5468 6520 7472 616e 7366 6572     "The transfer
+000029f0: 2077 6869 6368 2063 7265 6174 6564 2074   which created t
+00002a00: 6869 7320 6368 6172 6765 2e20 4f6e 6c79  his charge. Only
+00002a10: 2070 7265 7365 6e74 2069 6620 7468 6520   present if the 
+00002a20: 220a 2020 2020 2020 2020 2020 2020 2263  ".            "c
+00002a30: 6861 7267 6520 6361 6d65 2066 726f 6d20  harge came from 
+00002a40: 616e 6f74 6865 7220 5374 7269 7065 2061  another Stripe a
+00002a50: 6363 6f75 6e74 2e22 0a20 2020 2020 2020  ccount.".       
+00002a60: 2029 2c0a 2020 2020 2020 2020 7265 6c61   ),.        rela
+00002a70: 7465 645f 6e61 6d65 3d22 2b22 2c0a 2020  ted_name="+",.  
+00002a80: 2020 290a 2020 2020 7374 6174 656d 656e    ).    statemen
+00002a90: 745f 6465 7363 7269 7074 6f72 203d 206d  t_descriptor = m
+00002aa0: 6f64 656c 732e 4368 6172 4669 656c 6428  odels.CharField(
+00002ab0: 0a20 2020 2020 2020 206d 6178 5f6c 656e  .        max_len
+00002ac0: 6774 683d 3232 2c0a 2020 2020 2020 2020  gth=22,.        
+00002ad0: 6e75 6c6c 3d54 7275 652c 0a20 2020 2020  null=True,.     
+00002ae0: 2020 2062 6c61 6e6b 3d54 7275 652c 0a20     blank=True,. 
+00002af0: 2020 2020 2020 2068 656c 705f 7465 7874         help_text
+00002b00: 3d28 0a20 2020 2020 2020 2020 2020 2022  =(.            "
+00002b10: 466f 7220 6361 7264 2063 6861 7267 6573  For card charges
+00002b20: 2c20 7573 6520 7374 6174 656d 656e 745f  , use statement_
+00002b30: 6465 7363 7269 7074 6f72 5f73 7566 6669  descriptor_suffi
+00002b40: 7820 696e 7374 6561 642e 2022 0a20 2020  x instead. ".   
+00002b50: 2020 2020 2020 2020 2022 4f74 6865 7277           "Otherw
+00002b60: 6973 652c 2079 6f75 2063 616e 2075 7365  ise, you can use
+00002b70: 2074 6869 7320 7661 6c75 6520 6173 2074   this value as t
+00002b80: 6865 2063 6f6d 706c 6574 6520 6465 7363  he complete desc
+00002b90: 7269 7074 696f 6e20 6f66 2061 2022 0a20  ription of a ". 
+00002ba0: 2020 2020 2020 2020 2020 2022 6368 6172             "char
+00002bb0: 6765 206f 6e20 796f 7572 2063 7573 746f  ge on your custo
+00002bc0: 6d65 7273 2720 7374 6174 656d 656e 7473  mers' statements
+00002bd0: 2e20 4d75 7374 2063 6f6e 7461 696e 2061  . Must contain a
+00002be0: 7420 6c65 6173 7420 6f6e 6520 6c65 7474  t least one lett
+00002bf0: 6572 2c20 220a 2020 2020 2020 2020 2020  er, ".          
+00002c00: 2020 226d 6178 696d 756d 2032 3220 6368    "maximum 22 ch
+00002c10: 6172 6163 7465 7273 2e22 0a20 2020 2020  aracters.".     
+00002c20: 2020 2029 2c0a 2020 2020 290a 2020 2020     ),.    ).    
+00002c30: 7374 6174 656d 656e 745f 6465 7363 7269  statement_descri
+00002c40: 7074 6f72 5f73 7566 6669 7820 3d20 6d6f  ptor_suffix = mo
+00002c50: 6465 6c73 2e43 6861 7246 6965 6c64 280a  dels.CharField(.
+00002c60: 2020 2020 2020 2020 6d61 785f 6c65 6e67          max_leng
+00002c70: 7468 3d32 322c 0a20 2020 2020 2020 206e  th=22,.        n
+00002c80: 756c 6c3d 5472 7565 2c0a 2020 2020 2020  ull=True,.      
+00002c90: 2020 626c 616e 6b3d 5472 7565 2c0a 2020    blank=True,.  
+00002ca0: 2020 2020 2020 6865 6c70 5f74 6578 743d        help_text=
+00002cb0: 280a 2020 2020 2020 2020 2020 2020 2250  (.            "P
+00002cc0: 726f 7669 6465 7320 696e 666f 726d 6174  rovides informat
+00002cd0: 696f 6e20 6162 6f75 7420 7468 6520 6368  ion about the ch
+00002ce0: 6172 6765 2074 6861 7420 6375 7374 6f6d  arge that custom
+00002cf0: 6572 7320 7365 6520 6f6e 2022 0a20 2020  ers see on ".   
+00002d00: 2020 2020 2020 2020 2022 7468 6569 7220           "their 
+00002d10: 7374 6174 656d 656e 7473 2e20 436f 6e63  statements. Conc
+00002d20: 6174 656e 6174 6564 2077 6974 6820 7468  atenated with th
+00002d30: 6520 7072 6566 6978 2028 7368 6f72 7465  e prefix (shorte
+00002d40: 6e65 6420 6465 7363 7269 7074 6f72 2920  ned descriptor) 
+00002d50: 220a 2020 2020 2020 2020 2020 2020 226f  ".            "o
+00002d60: 7220 7374 6174 656d 656e 7420 6465 7363  r statement desc
+00002d70: 7269 7074 6f72 2074 6861 7427 7320 7365  riptor that's se
+00002d80: 7420 6f6e 2074 6865 2061 6363 6f75 6e74  t on the account
+00002d90: 2074 6f20 666f 726d 2074 6865 2022 0a20   to form the ". 
+00002da0: 2020 2020 2020 2020 2020 2022 636f 6d70             "comp
+00002db0: 6c65 7465 2073 7461 7465 6d65 6e74 2064  lete statement d
+00002dc0: 6573 6372 6970 746f 722e 2022 0a20 2020  escriptor. ".   
+00002dd0: 2020 2020 2020 2020 2022 4d61 7869 6d75           "Maximu
+00002de0: 6d20 3232 2063 6861 7261 6374 6572 7320  m 22 characters 
+00002df0: 666f 7220 7468 6520 636f 6e63 6174 656e  for the concaten
+00002e00: 6174 6564 2064 6573 6372 6970 746f 722e  ated descriptor.
+00002e10: 220a 2020 2020 2020 2020 292c 0a20 2020  ".        ),.   
+00002e20: 2029 0a20 2020 2073 7461 7475 7320 3d20   ).    status = 
+00002e30: 5374 7269 7065 456e 756d 4669 656c 6428  StripeEnumField(
+00002e40: 0a20 2020 2020 2020 2065 6e75 6d3d 656e  .        enum=en
+00002e50: 756d 732e 4368 6172 6765 5374 6174 7573  ums.ChargeStatus
+00002e60: 2c20 6865 6c70 5f74 6578 743d 2254 6865  , help_text="The
+00002e70: 2073 7461 7475 7320 6f66 2074 6865 2070   status of the p
+00002e80: 6179 6d65 6e74 2e22 0a20 2020 2029 0a20  ayment.".    ). 
+00002e90: 2020 2074 7261 6e73 6665 7220 3d20 5374     transfer = St
+00002ea0: 7269 7065 466f 7265 6967 6e4b 6579 280a  ripeForeignKey(.
+00002eb0: 2020 2020 2020 2020 2254 7261 6e73 6665          "Transfe
+00002ec0: 7222 2c0a 2020 2020 2020 2020 6f6e 5f64  r",.        on_d
+00002ed0: 656c 6574 653d 6d6f 6465 6c73 2e43 4153  elete=models.CAS
+00002ee0: 4341 4445 2c0a 2020 2020 2020 2020 6e75  CADE,.        nu
+00002ef0: 6c6c 3d54 7275 652c 0a20 2020 2020 2020  ll=True,.       
+00002f00: 2062 6c61 6e6b 3d54 7275 652c 0a20 2020   blank=True,.   
+00002f10: 2020 2020 2068 656c 705f 7465 7874 3d28       help_text=(
+00002f20: 0a20 2020 2020 2020 2020 2020 2022 5468  .            "Th
+00002f30: 6520 7472 616e 7366 6572 2074 6f20 7468  e transfer to th
+00002f40: 6520 6064 6573 7469 6e61 7469 6f6e 6020  e `destination` 
+00002f50: 6163 636f 756e 7420 286f 6e6c 7920 6170  account (only ap
+00002f60: 706c 6963 6162 6c65 2069 6620 220a 2020  plicable if ".  
+00002f70: 2020 2020 2020 2020 2020 2274 6865 2063            "the c
+00002f80: 6861 7267 6520 7761 7320 6372 6561 7465  harge was create
+00002f90: 6420 7573 696e 6720 7468 6520 6064 6573  d using the `des
+00002fa0: 7469 6e61 7469 6f6e 6020 7061 7261 6d65  tination` parame
+00002fb0: 7465 7229 2e22 0a20 2020 2020 2020 2029  ter).".        )
+00002fc0: 2c0a 2020 2020 290a 2020 2020 7472 616e  ,.    ).    tran
+00002fd0: 7366 6572 5f64 6174 6120 3d20 4a53 4f4e  sfer_data = JSON
+00002fe0: 4669 656c 6428 0a20 2020 2020 2020 206e  Field(.        n
+00002ff0: 756c 6c3d 5472 7565 2c0a 2020 2020 2020  ull=True,.      
+00003000: 2020 626c 616e 6b3d 5472 7565 2c0a 2020    blank=True,.  
+00003010: 2020 2020 2020 6865 6c70 5f74 6578 743d        help_text=
+00003020: 280a 2020 2020 2020 2020 2020 2020 2241  (.            "A
+00003030: 6e20 6f70 7469 6f6e 616c 2064 6963 7469  n optional dicti
+00003040: 6f6e 6172 7920 696e 636c 7564 696e 6720  onary including 
+00003050: 7468 6520 6163 636f 756e 7420 746f 2061  the account to a
+00003060: 7574 6f6d 6174 6963 616c 6c79 2022 0a20  utomatically ". 
+00003070: 2020 2020 2020 2020 2020 2022 7472 616e             "tran
+00003080: 7366 6572 2074 6f20 6173 2070 6172 7420  sfer to as part 
+00003090: 6f66 2061 2064 6573 7469 6e61 7469 6f6e  of a destination
+000030a0: 2063 6861 7267 652e 220a 2020 2020 2020   charge.".      
+000030b0: 2020 292c 0a20 2020 2029 0a20 2020 2074    ),.    ).    t
+000030c0: 7261 6e73 6665 725f 6772 6f75 7020 3d20  ransfer_group = 
+000030d0: 6d6f 6465 6c73 2e43 6861 7246 6965 6c64  models.CharField
+000030e0: 280a 2020 2020 2020 2020 6d61 785f 6c65  (.        max_le
+000030f0: 6e67 7468 3d32 3535 2c0a 2020 2020 2020  ngth=255,.      
+00003100: 2020 6e75 6c6c 3d54 7275 652c 0a20 2020    null=True,.   
+00003110: 2020 2020 2062 6c61 6e6b 3d54 7275 652c       blank=True,
+00003120: 0a20 2020 2020 2020 2068 656c 705f 7465  .        help_te
+00003130: 7874 3d22 4120 7374 7269 6e67 2074 6861  xt="A string tha
+00003140: 7420 6964 656e 7469 6669 6573 2074 6869  t identifies thi
+00003150: 7320 7472 616e 7361 6374 696f 6e20 6173  s transaction as
+00003160: 2070 6172 7420 6f66 2061 2067 726f 7570   part of a group
+00003170: 2e22 2c0a 2020 2020 290a 0a20 2020 206f  .",.    )..    o
+00003180: 626a 6563 7473 203d 2043 6861 7267 654d  bjects = ChargeM
+00003190: 616e 6167 6572 2829 0a0a 2020 2020 6465  anager()..    de
+000031a0: 6620 5f5f 7374 725f 5f28 7365 6c66 293a  f __str__(self):
+000031b0: 0a20 2020 2020 2020 2061 6d6f 756e 7420  .        amount 
+000031c0: 3d20 6765 745f 6672 6965 6e64 6c79 5f63  = get_friendly_c
+000031d0: 7572 7265 6e63 795f 616d 6f75 6e74 2873  urrency_amount(s
+000031e0: 656c 662e 616d 6f75 6e74 2c20 7365 6c66  elf.amount, self
+000031f0: 2e63 7572 7265 6e63 7929 0a20 2020 2020  .currency).     
+00003200: 2020 2072 6574 7572 6e20 6622 7b61 6d6f     return f"{amo
+00003210: 756e 747d 2028 7b73 656c 662e 6875 6d61  unt} ({self.huma
+00003220: 6e5f 7265 6164 6162 6c65 5f73 7461 7475  n_readable_statu
+00003230: 737d 2922 0a0a 2020 2020 4070 726f 7065  s})"..    @prope
+00003240: 7274 790a 2020 2020 6465 6620 6665 6528  rty.    def fee(
+00003250: 7365 6c66 293a 0a20 2020 2020 2020 2069  self):.        i
+00003260: 6620 7365 6c66 2e62 616c 616e 6365 5f74  f self.balance_t
+00003270: 7261 6e73 6163 7469 6f6e 3a0a 2020 2020  ransaction:.    
+00003280: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00003290: 656c 662e 6261 6c61 6e63 655f 7472 616e  elf.balance_tran
+000032a0: 7361 6374 696f 6e2e 6665 650a 0a20 2020  saction.fee..   
+000032b0: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
+000032c0: 6566 2068 756d 616e 5f72 6561 6461 626c  ef human_readabl
+000032d0: 655f 7374 6174 7573 2873 656c 6629 202d  e_status(self) -
+000032e0: 3e20 7374 723a 0a20 2020 2020 2020 2069  > str:.        i
+000032f0: 6620 6e6f 7420 7365 6c66 2e63 6170 7475  f not self.captu
+00003300: 7265 643a 0a20 2020 2020 2020 2020 2020  red:.           
+00003310: 2072 6574 7572 6e20 2255 6e63 6170 7475   return "Uncaptu
+00003320: 7265 6422 0a20 2020 2020 2020 2065 6c69  red".        eli
+00003330: 6620 7365 6c66 2e64 6973 7075 7465 643a  f self.disputed:
+00003340: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00003350: 7572 6e20 2244 6973 7075 7465 6422 0a20  urn "Disputed". 
+00003360: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
+00003370: 2e72 6566 756e 6465 643a 0a20 2020 2020  .refunded:.     
+00003380: 2020 2020 2020 2072 6574 7572 6e20 2252         return "R
+00003390: 6566 756e 6465 6422 0a20 2020 2020 2020  efunded".       
+000033a0: 2072 6574 7572 6e20 656e 756d 732e 4368   return enums.Ch
+000033b0: 6172 6765 5374 6174 7573 2e68 756d 616e  argeStatus.human
+000033c0: 697a 6528 7365 6c66 2e73 7461 7475 7329  ize(self.status)
+000033d0: 0a0a 2020 2020 4070 726f 7065 7274 790a  ..    @property.
+000033e0: 2020 2020 6465 6620 6672 6175 6475 6c65      def fraudule
+000033f0: 6e74 2873 656c 6629 202d 3e20 626f 6f6c  nt(self) -> bool
+00003400: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+00003410: 2028 0a20 2020 2020 2020 2020 2020 2073   (.            s
+00003420: 656c 662e 6672 6175 645f 6465 7461 696c  elf.fraud_detail
+00003430: 7320 616e 6420 6c69 7374 2873 656c 662e  s and list(self.
+00003440: 6672 6175 645f 6465 7461 696c 732e 7661  fraud_details.va
+00003450: 6c75 6573 2829 295b 305d 203d 3d20 2266  lues())[0] == "f
+00003460: 7261 7564 756c 656e 7422 0a20 2020 2020  raudulent".     
+00003470: 2020 2029 0a0a 2020 2020 6465 6620 5f63     )..    def _c
+00003480: 616c 6375 6c61 7465 5f72 6566 756e 645f  alculate_refund_
+00003490: 616d 6f75 6e74 2873 656c 662c 2061 6d6f  amount(self, amo
+000034a0: 756e 743a 204f 7074 696f 6e61 6c5b 4465  unt: Optional[De
+000034b0: 6369 6d61 6c5d 2920 2d3e 2069 6e74 3a0a  cimal]) -> int:.
+000034c0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000034d0: 2020 2020 5265 7475 726e 7320 7468 6520      Returns the 
+000034e0: 616d 6f75 6e74 2074 6861 7420 6361 6e20  amount that can 
+000034f0: 6265 2072 6566 756e 6465 6420 2869 6e20  be refunded (in 
+00003500: 6365 6e74 7329 0a20 2020 2020 2020 2022  cents).        "
+00003510: 2222 0a20 2020 2020 2020 2065 6c69 6769  "".        eligi
+00003520: 626c 655f 746f 5f72 6566 756e 6420 3d20  ble_to_refund = 
+00003530: 7365 6c66 2e61 6d6f 756e 7420 2d20 2873  self.amount - (s
+00003540: 656c 662e 616d 6f75 6e74 5f72 6566 756e  elf.amount_refun
+00003550: 6465 6420 6f72 2030 290a 2020 2020 2020  ded or 0).      
+00003560: 2020 616d 6f75 6e74 5f74 6f5f 7265 6675    amount_to_refu
+00003570: 6e64 203d 2028 0a20 2020 2020 2020 2020  nd = (.         
+00003580: 2020 206d 696e 2865 6c69 6769 626c 655f     min(eligible_
+00003590: 746f 5f72 6566 756e 642c 2061 6d6f 756e  to_refund, amoun
+000035a0: 7429 2069 6620 616d 6f75 6e74 2065 6c73  t) if amount els
+000035b0: 6520 656c 6967 6962 6c65 5f74 6f5f 7265  e eligible_to_re
+000035c0: 6675 6e64 0a20 2020 2020 2020 2029 0a0a  fund.        )..
+000035d0: 2020 2020 2020 2020 7265 7475 726e 2069          return i
+000035e0: 6e74 2861 6d6f 756e 745f 746f 5f72 6566  nt(amount_to_ref
+000035f0: 756e 6420 2a20 3130 3029 0a0a 2020 2020  und * 100)..    
+00003600: 6465 6620 7265 6675 6e64 280a 2020 2020  def refund(.    
+00003610: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+00003620: 2020 616d 6f75 6e74 3a20 4465 6369 6d61    amount: Decima
+00003630: 6c20 3d20 4e6f 6e65 2c0a 2020 2020 2020  l = None,.      
+00003640: 2020 7265 6173 6f6e 3a20 7374 7220 3d20    reason: str = 
+00003650: 4e6f 6e65 2c0a 2020 2020 2020 2020 6170  None,.        ap
+00003660: 695f 6b65 793a 2073 7472 203d 204e 6f6e  i_key: str = Non
+00003670: 652c 0a20 2020 2020 2020 2073 7472 6970  e,.        strip
+00003680: 655f 6163 636f 756e 743a 2073 7472 203d  e_account: str =
+00003690: 204e 6f6e 652c 0a20 2020 2029 202d 3e20   None,.    ) -> 
+000036a0: 2252 6566 756e 6422 3a0a 2020 2020 2020  "Refund":.      
+000036b0: 2020 2222 220a 2020 2020 2020 2020 496e    """.        In
+000036c0: 6974 6961 7465 2061 2072 6566 756e 642e  itiate a refund.
+000036d0: 2052 6574 7572 6e73 2074 6865 2072 6566   Returns the ref
+000036e0: 756e 6420 6f62 6a65 6374 2e0a 0a20 2020  und object...   
+000036f0: 2020 2020 203a 7061 7261 6d20 616d 6f75       :param amou
+00003700: 6e74 3a20 4120 706f 7369 7469 7665 2064  nt: A positive d
+00003710: 6563 696d 616c 2061 6d6f 756e 7420 7265  ecimal amount re
+00003720: 7072 6573 656e 7469 6e67 2068 6f77 206d  presenting how m
+00003730: 7563 6820 6f66 2074 6869 7320 6368 6172  uch of this char
+00003740: 6765 0a20 2020 2020 2020 2020 2020 2074  ge.            t
+00003750: 6f20 7265 6675 6e64 2e20 4966 2061 6d6f  o refund. If amo
+00003760: 756e 7420 6973 206e 6f74 2070 726f 7669  unt is not provi
+00003770: 6465 642c 2074 6865 6e20 7468 6973 2077  ded, then this w
+00003780: 696c 6c20 6265 2061 2066 756c 6c20 7265  ill be a full re
+00003790: 6675 6e64 2e0a 2020 2020 2020 2020 2020  fund..          
+000037a0: 2020 4361 6e20 6f6e 6c79 2072 6566 756e    Can only refun
+000037b0: 6420 7570 2074 6f20 7468 6520 756e 7265  d up to the unre
+000037c0: 6675 6e64 6564 2061 6d6f 756e 7420 7265  funded amount re
+000037d0: 6d61 696e 696e 6720 6f66 2074 6865 2063  maining of the c
+000037e0: 6861 7267 652e 0a20 2020 2020 2020 203a  harge..        :
+000037f0: 7061 7261 6d20 7265 6173 6f6e 3a20 5374  param reason: St
+00003800: 7269 6e67 2069 6e64 6963 6174 696e 6720  ring indicating 
+00003810: 7468 6520 7265 6173 6f6e 2066 6f72 2074  the reason for t
+00003820: 6865 2072 6566 756e 642e 0a20 2020 2020  he refund..     
+00003830: 2020 2020 2020 2049 6620 7365 742c 2070         If set, p
+00003840: 6f73 7369 626c 6520 7661 6c75 6573 2061  ossible values a
+00003850: 7265 2060 6064 7570 6c69 6361 7465 6060  re ``duplicate``
+00003860: 2c20 6060 6672 6175 6475 6c65 6e74 6060  , ``fraudulent``
+00003870: 2c0a 2020 2020 2020 2020 2020 2020 616e  ,.            an
+00003880: 6420 6060 7265 7175 6573 7465 645f 6279  d ``requested_by
+00003890: 5f63 7573 746f 6d65 7260 602e 2053 7065  _customer``. Spe
+000038a0: 6369 6679 696e 6720 6060 6672 6175 6475  cifying ``fraudu
+000038b0: 6c65 6e74 6060 2061 7320 7468 6520 7265  lent`` as the re
+000038c0: 6173 6f6e 0a20 2020 2020 2020 2020 2020  ason.           
+000038d0: 2077 6865 6e20 796f 7520 6265 6c69 6576   when you believ
+000038e0: 6520 7468 6520 6368 6172 6765 2074 6f20  e the charge to 
+000038f0: 6265 2066 7261 7564 756c 656e 7420 7769  be fraudulent wi
+00003900: 6c6c 0a20 2020 2020 2020 2020 2020 2068  ll.            h
+00003910: 656c 7020 5374 7269 7065 2069 6d70 726f  elp Stripe impro
+00003920: 7665 2074 6865 6972 2066 7261 7564 2064  ve their fraud d
+00003930: 6574 6563 7469 6f6e 2061 6c67 6f72 6974  etection algorit
+00003940: 686d 732e 0a20 2020 2020 2020 2022 2222  hms..        """
+00003950: 0a20 2020 2020 2020 2023 2050 7265 6665  .        # Prefe
+00003960: 7220 7061 7373 6564 2069 6e20 7374 7269  r passed in stri
+00003970: 7065 5f61 6363 6f75 6e74 2069 6620 7365  pe_account if se
+00003980: 742e 0a20 2020 2020 2020 2069 6620 6e6f  t..        if no
+00003990: 7420 7374 7269 7065 5f61 6363 6f75 6e74  t stripe_account
+000039a0: 3a0a 2020 2020 2020 2020 2020 2020 7374  :.            st
+000039b0: 7269 7065 5f61 6363 6f75 6e74 203d 2073  ripe_account = s
+000039c0: 656c 662e 5f67 6574 5f73 7472 6970 655f  elf._get_stripe_
+000039d0: 6163 636f 756e 745f 6964 2861 7069 5f6b  account_id(api_k
+000039e0: 6579 290a 0a20 2020 2020 2020 2072 6566  ey)..        ref
+000039f0: 756e 645f 6f62 6a20 3d20 5265 6675 6e64  und_obj = Refund
+00003a00: 2e5f 6170 695f 6372 6561 7465 280a 2020  ._api_create(.  
+00003a10: 2020 2020 2020 2020 2020 6368 6172 6765            charge
+00003a20: 3d73 656c 662e 6964 2c0a 2020 2020 2020  =self.id,.      
+00003a30: 2020 2020 2020 616d 6f75 6e74 3d73 656c        amount=sel
+00003a40: 662e 5f63 616c 6375 6c61 7465 5f72 6566  f._calculate_ref
+00003a50: 756e 645f 616d 6f75 6e74 2861 6d6f 756e  und_amount(amoun
+00003a60: 743d 616d 6f75 6e74 292c 0a20 2020 2020  t=amount),.     
+00003a70: 2020 2020 2020 2072 6561 736f 6e3d 7265         reason=re
+00003a80: 6173 6f6e 2c0a 2020 2020 2020 2020 2020  ason,.          
+00003a90: 2020 6170 695f 6b65 793d 6170 695f 6b65    api_key=api_ke
+00003aa0: 7920 6f72 2073 656c 662e 6465 6661 756c  y or self.defaul
+00003ab0: 745f 6170 695f 6b65 792c 0a20 2020 2020  t_api_key,.     
+00003ac0: 2020 2020 2020 2073 7472 6970 655f 6163         stripe_ac
+00003ad0: 636f 756e 743d 7374 7269 7065 5f61 6363  count=stripe_acc
+00003ae0: 6f75 6e74 2c0a 2020 2020 2020 2020 290a  ount,.        ).
+00003af0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00003b00: 5265 6675 6e64 2e73 796e 635f 6672 6f6d  Refund.sync_from
+00003b10: 5f73 7472 6970 655f 6461 7461 280a 2020  _stripe_data(.  
+00003b20: 2020 2020 2020 2020 2020 7265 6675 6e64            refund
+00003b30: 5f6f 626a 2c0a 2020 2020 2020 2020 2020  _obj,.          
+00003b40: 2020 6170 695f 6b65 793d 6170 695f 6b65    api_key=api_ke
+00003b50: 7920 6f72 2073 656c 662e 6465 6661 756c  y or self.defaul
+00003b60: 745f 6170 695f 6b65 792c 0a20 2020 2020  t_api_key,.     
+00003b70: 2020 2020 2020 2073 7472 6970 655f 7665         stripe_ve
+00003b80: 7273 696f 6e3d 646a 7374 7269 7065 5f73  rsion=djstripe_s
+00003b90: 6574 7469 6e67 732e 5354 5249 5045 5f41  ettings.STRIPE_A
+00003ba0: 5049 5f56 4552 5349 4f4e 2c0a 2020 2020  PI_VERSION,.    
+00003bb0: 2020 2020 290a 0a20 2020 2064 6566 2063      )..    def c
+00003bc0: 6170 7475 7265 2873 656c 662c 202a 2a6b  apture(self, **k
+00003bd0: 7761 7267 7329 202d 3e20 2243 6861 7267  wargs) -> "Charg
+00003be0: 6522 3a0a 2020 2020 2020 2020 2222 220a  e":.        """.
+00003bf0: 2020 2020 2020 2020 4361 7074 7572 6520          Capture 
+00003c00: 7468 6520 7061 796d 656e 7420 6f66 2061  the payment of a
+00003c10: 6e20 6578 6973 7469 6e67 2c20 756e 6361  n existing, unca
+00003c20: 7074 7572 6564 2c20 6368 6172 6765 2e0a  ptured, charge..
+00003c30: 2020 2020 2020 2020 5468 6973 2069 7320          This is 
+00003c40: 7468 6520 7365 636f 6e64 2068 616c 6620  the second half 
+00003c50: 6f66 2074 6865 2074 776f 2d73 7465 7020  of the two-step 
+00003c60: 7061 796d 656e 7420 666c 6f77 2c20 7768  payment flow, wh
+00003c70: 6572 6520 6669 7273 7420 796f 750a 2020  ere first you.  
+00003c80: 2020 2020 2020 6372 6561 7465 6420 6120        created a 
+00003c90: 6368 6172 6765 2077 6974 6820 7468 6520  charge with the 
+00003ca0: 6361 7074 7572 6520 6f70 7469 6f6e 2073  capture option s
+00003cb0: 6574 2074 6f20 4661 6c73 652e 0a0a 2020  et to False...  
+00003cc0: 2020 2020 2020 5365 6520 6874 7470 733a        See https:
+00003cd0: 2f2f 7374 7269 7065 2e63 6f6d 2f64 6f63  //stripe.com/doc
+00003ce0: 732f 6170 6923 6361 7074 7572 655f 6368  s/api#capture_ch
+00003cf0: 6172 6765 0a20 2020 2020 2020 2022 2222  arge.        """
+00003d00: 0a0a 2020 2020 2020 2020 6361 7074 7572  ..        captur
+00003d10: 6564 5f63 6861 7267 6520 3d20 7365 6c66  ed_charge = self
+00003d20: 2e61 7069 5f72 6574 7269 6576 6528 292e  .api_retrieve().
+00003d30: 6361 7074 7572 6528 2a2a 6b77 6172 6773  capture(**kwargs
+00003d40: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00003d50: 2073 656c 662e 5f5f 636c 6173 735f 5f2e   self.__class__.
+00003d60: 7379 6e63 5f66 726f 6d5f 7374 7269 7065  sync_from_stripe
+00003d70: 5f64 6174 6128 0a20 2020 2020 2020 2020  _data(.         
+00003d80: 2020 2063 6170 7475 7265 645f 6368 6172     captured_char
+00003d90: 6765 2c20 6170 695f 6b65 793d 7365 6c66  ge, api_key=self
+00003da0: 2e64 6566 6175 6c74 5f61 7069 5f6b 6579  .default_api_key
+00003db0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00003dc0: 6465 6620 5f61 7474 6163 685f 6f62 6a65  def _attach_obje
+00003dd0: 6374 735f 706f 7374 5f73 6176 655f 686f  cts_post_save_ho
+00003de0: 6f6b 280a 2020 2020 2020 2020 7365 6c66  ok(.        self
+00003df0: 2c0a 2020 2020 2020 2020 636c 732c 0a20  ,.        cls,. 
+00003e00: 2020 2020 2020 2064 6174 612c 0a20 2020         data,.   
+00003e10: 2020 2020 2070 656e 6469 6e67 5f72 656c       pending_rel
+00003e20: 6174 696f 6e73 3d4e 6f6e 652c 0a20 2020  ations=None,.   
+00003e30: 2020 2020 2061 7069 5f6b 6579 3d64 6a73       api_key=djs
+00003e40: 7472 6970 655f 7365 7474 696e 6773 2e53  tripe_settings.S
+00003e50: 5452 4950 455f 5345 4352 4554 5f4b 4559  TRIPE_SECRET_KEY
+00003e60: 2c0a 2020 2020 293a 0a20 2020 2020 2020  ,.    ):.       
+00003e70: 2073 7570 6572 2829 2e5f 6174 7461 6368   super()._attach
+00003e80: 5f6f 626a 6563 7473 5f70 6f73 745f 7361  _objects_post_sa
+00003e90: 7665 5f68 6f6f 6b28 0a20 2020 2020 2020  ve_hook(.       
+00003ea0: 2020 2020 2063 6c73 2c20 6461 7461 2c20       cls, data, 
+00003eb0: 7065 6e64 696e 675f 7265 6c61 7469 6f6e  pending_relation
+00003ec0: 733d 7065 6e64 696e 675f 7265 6c61 7469  s=pending_relati
+00003ed0: 6f6e 732c 2061 7069 5f6b 6579 3d61 7069  ons, api_key=api
+00003ee0: 5f6b 6579 0a20 2020 2020 2020 2029 0a0a  _key.        )..
+00003ef0: 2020 2020 2020 2020 636c 732e 5f73 7472          cls._str
+00003f00: 6970 655f 6f62 6a65 6374 5f74 6f5f 7265  ipe_object_to_re
+00003f10: 6675 6e64 7328 0a20 2020 2020 2020 2020  funds(.         
+00003f20: 2020 2074 6172 6765 745f 636c 733d 5265     target_cls=Re
+00003f30: 6675 6e64 2c20 6461 7461 3d64 6174 612c  fund, data=data,
+00003f40: 2063 6861 7267 653d 7365 6c66 2c20 6170   charge=self, ap
+00003f50: 695f 6b65 793d 6170 695f 6b65 790a 2020  i_key=api_key.  
+00003f60: 2020 2020 2020 290a 0a0a 2320 544f 444f        )...# TODO
+00003f70: 2041 6464 2054 6573 7473 0a63 6c61 7373   Add Tests.class
+00003f80: 204d 616e 6461 7465 2853 7472 6970 654d   Mandate(StripeM
+00003f90: 6f64 656c 293a 0a20 2020 2022 2222 0a20  odel):.    """. 
+00003fa0: 2020 2041 204d 616e 6461 7465 2069 7320     A Mandate is 
+00003fb0: 6120 7265 636f 7264 206f 6620 7468 6520  a record of the 
+00003fc0: 7065 726d 6973 7369 6f6e 2061 2063 7573  permission a cus
+00003fd0: 746f 6d65 7220 6861 7320 6769 7665 6e20  tomer has given 
+00003fe0: 796f 7520 746f 2064 6562 6974 2074 6865  you to debit the
+00003ff0: 6972 2070 6179 6d65 6e74 206d 6574 686f  ir payment metho
+00004000: 642e 0a0a 2020 2020 6874 7470 733a 2f2f  d...    https://
+00004010: 7374 7269 7065 2e63 6f6d 2f64 6f63 732f  stripe.com/docs/
+00004020: 6170 692f 6d61 6e64 6174 6573 0a20 2020  api/mandates.   
+00004030: 2022 2222 0a0a 2020 2020 7374 7269 7065   """..    stripe
+00004040: 5f63 6c61 7373 203d 2073 7472 6970 652e  _class = stripe.
+00004050: 4d61 6e64 6174 650a 0a20 2020 2063 7573  Mandate..    cus
+00004060: 746f 6d65 725f 6163 6365 7074 616e 6365  tomer_acceptance
+00004070: 203d 204a 534f 4e46 6965 6c64 280a 2020   = JSONField(.  
+00004080: 2020 2020 2020 6865 6c70 5f74 6578 743d        help_text=
+00004090: 2244 6574 6169 6c73 2061 626f 7574 2074  "Details about t
+000040a0: 6865 2063 7573 746f 6d65 7227 7320 6163  he customer's ac
+000040b0: 6365 7074 616e 6365 206f 6620 7468 6520  ceptance of the 
+000040c0: 6d61 6e64 6174 652e 220a 2020 2020 290a  mandate.".    ).
+000040d0: 2020 2020 7061 796d 656e 745f 6d65 7468      payment_meth
+000040e0: 6f64 203d 2053 7472 6970 6546 6f72 6569  od = StripeForei
+000040f0: 676e 4b65 7928 2270 6179 6d65 6e74 6d65  gnKey("paymentme
+00004100: 7468 6f64 222c 206f 6e5f 6465 6c65 7465  thod", on_delete
+00004110: 3d6d 6f64 656c 732e 4341 5343 4144 4529  =models.CASCADE)
+00004120: 0a20 2020 2070 6179 6d65 6e74 5f6d 6574  .    payment_met
+00004130: 686f 645f 6465 7461 696c 7320 3d20 4a53  hod_details = JS
+00004140: 4f4e 4669 656c 6428 0a20 2020 2020 2020  ONField(.       
+00004150: 2068 656c 705f 7465 7874 3d22 4164 6469   help_text="Addi
+00004160: 7469 6f6e 616c 206d 616e 6461 7465 2069  tional mandate i
+00004170: 6e66 6f72 6d61 7469 6f6e 2073 7065 6369  nformation speci
+00004180: 6669 6320 746f 2074 6865 2070 6179 6d65  fic to the payme
+00004190: 6e74 206d 6574 686f 6420 7479 7065 2e22  nt method type."
+000041a0: 0a20 2020 2029 0a20 2020 2073 7461 7475  .    ).    statu
+000041b0: 7320 3d20 5374 7269 7065 456e 756d 4669  s = StripeEnumFi
+000041c0: 656c 6428 0a20 2020 2020 2020 2065 6e75  eld(.        enu
+000041d0: 6d3d 656e 756d 732e 4d61 6e64 6174 6553  m=enums.MandateS
+000041e0: 7461 7475 732c 0a20 2020 2020 2020 2068  tatus,.        h
+000041f0: 656c 705f 7465 7874 3d28 0a20 2020 2020  elp_text=(.     
+00004200: 2020 2020 2020 2022 5468 6520 7374 6174         "The stat
+00004210: 7573 206f 6620 7468 6520 6d61 6e64 6174  us of the mandat
+00004220: 652c 2077 6869 6368 2069 6e64 6963 6174  e, which indicat
+00004230: 6573 2077 6865 7468 6572 2069 7420 6361  es whether it ca
+00004240: 6e20 6265 2075 7365 6420 746f 220a 2020  n be used to".  
+00004250: 2020 2020 2020 2020 2020 2220 696e 6974            " init
+00004260: 6961 7465 2061 2070 6179 6d65 6e74 2e22  iate a payment."
+00004270: 0a20 2020 2020 2020 2029 2c0a 2020 2020  .        ),.    
+00004280: 290a 2020 2020 7479 7065 203d 2053 7472  ).    type = Str
+00004290: 6970 6545 6e75 6d46 6965 6c64 280a 2020  ipeEnumField(.  
+000042a0: 2020 2020 2020 656e 756d 3d65 6e75 6d73        enum=enums
+000042b0: 2e4d 616e 6461 7465 5479 7065 2c0a 2020  .MandateType,.  
+000042c0: 2020 2020 2020 6865 6c70 5f74 6578 743d        help_text=
+000042d0: 280a 2020 2020 2020 2020 2020 2020 2254  (.            "T
+000042e0: 6865 2073 7461 7475 7320 6f66 2074 6865  he status of the
+000042f0: 206d 616e 6461 7465 2c20 7768 6963 6820   mandate, which 
+00004300: 696e 6469 6361 7465 7320 7768 6574 6865  indicates whethe
+00004310: 7220 6974 2063 616e 2062 6520 7573 6564  r it can be used
+00004320: 2074 6f22 0a20 2020 2020 2020 2020 2020   to".           
+00004330: 2022 2069 6e69 7469 6174 6520 6120 7061   " initiate a pa
+00004340: 796d 656e 742e 220a 2020 2020 2020 2020  yment.".        
+00004350: 292c 0a20 2020 2029 0a20 2020 206d 756c  ),.    ).    mul
+00004360: 7469 5f75 7365 203d 204a 534f 4e46 6965  ti_use = JSONFie
+00004370: 6c64 280a 2020 2020 2020 2020 6e75 6c6c  ld(.        null
+00004380: 3d54 7275 652c 0a20 2020 2020 2020 2062  =True,.        b
+00004390: 6c61 6e6b 3d54 7275 652c 0a20 2020 2020  lank=True,.     
+000043a0: 2020 2068 656c 705f 7465 7874 3d28 0a20     help_text=(. 
+000043b0: 2020 2020 2020 2020 2020 2022 4966 2074             "If t
+000043c0: 6869 7320 6973 2061 2060 6d75 6c74 695f  his is a `multi_
+000043d0: 7573 6560 206d 616e 6461 7465 2c20 7468  use` mandate, th
+000043e0: 6973 2068 6173 6820 636f 6e74 6169 6e73  is hash contains
+000043f0: 2064 6574 6169 6c73 2061 626f 7574 2074   details about t
+00004400: 6865 220a 2020 2020 2020 2020 2020 2020  he".            
+00004410: 2220 6d61 6e64 6174 652e 220a 2020 2020  " mandate.".    
+00004420: 2020 2020 292c 0a20 2020 2029 0a20 2020      ),.    ).   
+00004430: 2073 696e 676c 655f 7573 6520 3d20 4a53   single_use = JS
+00004440: 4f4e 4669 656c 6428 0a20 2020 2020 2020  ONField(.       
+00004450: 206e 756c 6c3d 5472 7565 2c0a 2020 2020   null=True,.    
+00004460: 2020 2020 626c 616e 6b3d 5472 7565 2c0a      blank=True,.
+00004470: 2020 2020 2020 2020 6865 6c70 5f74 6578          help_tex
+00004480: 743d 280a 2020 2020 2020 2020 2020 2020  t=(.            
+00004490: 2249 6620 7468 6973 2069 7320 6120 6073  "If this is a `s
+000044a0: 696e 676c 655f 7573 6560 206d 616e 6461  ingle_use` manda
+000044b0: 7465 2c20 7468 6973 2068 6173 6820 636f  te, this hash co
+000044c0: 6e74 6169 6e73 2064 6574 6169 6c73 2061  ntains details a
+000044d0: 626f 7574 2074 6865 220a 2020 2020 2020  bout the".      
+000044e0: 2020 2020 2020 2220 6d61 6e64 6174 652e        " mandate.
+000044f0: 220a 2020 2020 2020 2020 292c 0a20 2020  ".        ),.   
+00004500: 2029 0a0a 0a63 6c61 7373 2050 726f 6475   )...class Produ
+00004510: 6374 2853 7472 6970 654d 6f64 656c 293a  ct(StripeModel):
+00004520: 0a20 2020 2022 2222 0a20 2020 2050 726f  .    """.    Pro
+00004530: 6475 6374 7320 6465 7363 7269 6265 2074  ducts describe t
+00004540: 6865 2073 7065 6369 6669 6320 676f 6f64  he specific good
+00004550: 7320 6f72 2073 6572 7669 6365 7320 796f  s or services yo
+00004560: 7520 6f66 6665 7220 746f 2079 6f75 7220  u offer to your 
+00004570: 6375 7374 6f6d 6572 732e 0a20 2020 2046  customers..    F
+00004580: 6f72 2065 7861 6d70 6c65 2c20 796f 7520  or example, you 
+00004590: 6d69 6768 7420 6f66 6665 7220 6120 5374  might offer a St
+000045a0: 616e 6461 7264 2061 6e64 2050 7265 6d69  andard and Premi
+000045b0: 756d 2076 6572 7369 6f6e 206f 6620 796f  um version of yo
+000045c0: 7572 2067 6f6f 6473 206f 7220 7365 7276  ur goods or serv
+000045d0: 6963 653b 0a20 2020 2065 6163 6820 7665  ice;.    each ve
+000045e0: 7273 696f 6e20 776f 756c 6420 6265 2061  rsion would be a
+000045f0: 2073 6570 6172 6174 6520 5072 6f64 7563   separate Produc
+00004600: 742e 2054 6865 7920 6361 6e20 6265 2075  t. They can be u
+00004610: 7365 6420 696e 2063 6f6e 6a75 6e63 7469  sed in conjuncti
+00004620: 6f6e 2077 6974 680a 2020 2020 5072 6963  on with.    Pric
+00004630: 6573 2074 6f20 636f 6e66 6967 7572 6520  es to configure 
+00004640: 7072 6963 696e 6720 696e 2050 6179 6d65  pricing in Payme
+00004650: 6e74 204c 696e 6b73 2c20 4368 6563 6b6f  nt Links, Checko
+00004660: 7574 2c20 616e 6420 5375 6273 6372 6970  ut, and Subscrip
+00004670: 7469 6f6e 732e 0a0a 2020 2020 5374 7269  tions...    Stri
+00004680: 7065 2064 6f63 756d 656e 7461 7469 6f6e  pe documentation
+00004690: 3a20 6874 7470 733a 2f2f 7374 7269 7065  : https://stripe
+000046a0: 2e63 6f6d 2f64 6f63 732f 6170 693f 6c61  .com/docs/api?la
+000046b0: 6e67 3d70 7974 686f 6e23 7072 6f64 7563  ng=python#produc
+000046c0: 7473 0a20 2020 2022 2222 0a0a 2020 2020  ts.    """..    
+000046d0: 7374 7269 7065 5f63 6c61 7373 203d 2073  stripe_class = s
+000046e0: 7472 6970 652e 5072 6f64 7563 740a 2020  tripe.Product.  
+000046f0: 2020 7374 7269 7065 5f64 6173 6862 6f61    stripe_dashboa
+00004700: 7264 5f69 7465 6d5f 6e61 6d65 203d 2022  rd_item_name = "
+00004710: 7072 6f64 7563 7473 220a 0a20 2020 2023  products"..    #
+00004720: 2046 6965 6c64 7320 6170 706c 6963 6162   Fields applicab
+00004730: 6c65 2074 6f20 626f 7468 2060 676f 6f64  le to both `good
+00004740: 6020 616e 6420 6073 6572 7669 6365 600a  ` and `service`.
+00004750: 2020 2020 6e61 6d65 203d 206d 6f64 656c      name = model
+00004760: 732e 5465 7874 4669 656c 6428 0a20 2020  s.TextField(.   
+00004770: 2020 2020 206d 6178 5f6c 656e 6774 683d       max_length=
+00004780: 3530 3030 2c0a 2020 2020 2020 2020 6865  5000,.        he
+00004790: 6c70 5f74 6578 743d 280a 2020 2020 2020  lp_text=(.      
+000047a0: 2020 2020 2020 2254 6865 2070 726f 6475        "The produ
+000047b0: 6374 2773 206e 616d 652c 206d 6561 6e74  ct's name, meant
+000047c0: 2074 6f20 6265 2064 6973 706c 6179 6162   to be displayab
+000047d0: 6c65 2074 6f20 7468 6520 6375 7374 6f6d  le to the custom
+000047e0: 6572 2e20 220a 2020 2020 2020 2020 2020  er. ".          
+000047f0: 2020 2241 7070 6c69 6361 626c 6520 746f    "Applicable to
+00004800: 2062 6f74 6820 6073 6572 7669 6365 6020   both `service` 
+00004810: 616e 6420 6067 6f6f 6460 2074 7970 6573  and `good` types
+00004820: 2e22 0a20 2020 2020 2020 2029 2c0a 2020  .".        ),.  
+00004830: 2020 290a 2020 2020 6465 6661 756c 745f    ).    default_
+00004840: 7072 6963 6520 3d20 5374 7269 7065 466f  price = StripeFo
+00004850: 7265 6967 6e4b 6579 280a 2020 2020 2020  reignKey(.      
+00004860: 2020 2250 7269 6365 222c 0a20 2020 2020    "Price",.     
+00004870: 2020 206f 6e5f 6465 6c65 7465 3d6d 6f64     on_delete=mod
+00004880: 656c 732e 5345 545f 4e55 4c4c 2c0a 2020  els.SET_NULL,.  
+00004890: 2020 2020 2020 6e75 6c6c 3d54 7275 652c        null=True,
+000048a0: 0a20 2020 2020 2020 2062 6c61 6e6b 3d54  .        blank=T
+000048b0: 7275 652c 0a20 2020 2020 2020 2072 656c  rue,.        rel
+000048c0: 6174 6564 5f6e 616d 653d 2270 726f 6475  ated_name="produ
+000048d0: 6374 7322 2c0a 2020 2020 2020 2020 6865  cts",.        he
+000048e0: 6c70 5f74 6578 743d 2254 6865 2064 6566  lp_text="The def
+000048f0: 6175 6c74 2070 7269 6365 2074 6869 7320  ault price this 
+00004900: 7072 6f64 7563 7420 6973 2061 7373 6f63  product is assoc
+00004910: 6961 7465 6420 7769 7468 2e22 2c0a 2020  iated with.",.  
+00004920: 2020 290a 2020 2020 7479 7065 203d 2053    ).    type = S
+00004930: 7472 6970 6545 6e75 6d46 6965 6c64 280a  tripeEnumField(.
+00004940: 2020 2020 2020 2020 656e 756d 3d65 6e75          enum=enu
+00004950: 6d73 2e50 726f 6475 6374 5479 7065 2c0a  ms.ProductType,.
+00004960: 2020 2020 2020 2020 6865 6c70 5f74 6578          help_tex
+00004970: 743d 280a 2020 2020 2020 2020 2020 2020  t=(.            
+00004980: 2254 6865 2074 7970 6520 6f66 2074 6865  "The type of the
+00004990: 2070 726f 6475 6374 2e20 5468 6520 7072   product. The pr
+000049a0: 6f64 7563 7420 6973 2065 6974 6865 7220  oduct is either 
+000049b0: 6f66 2074 7970 6520 6067 6f6f 6460 2c20  of type `good`, 
+000049c0: 7768 6963 6820 6973 2022 0a20 2020 2020  which is ".     
+000049d0: 2020 2020 2020 2022 656c 6967 6962 6c65         "eligible
+000049e0: 2066 6f72 2075 7365 2077 6974 6820 4f72   for use with Or
+000049f0: 6465 7273 2061 6e64 2053 4b55 732c 206f  ders and SKUs, o
+00004a00: 7220 6073 6572 7669 6365 602c 2077 6869  r `service`, whi
+00004a10: 6368 2069 7320 656c 6967 6962 6c65 2022  ch is eligible "
+00004a20: 0a20 2020 2020 2020 2020 2020 2022 666f  .            "fo
+00004a30: 7220 7573 6520 7769 7468 2053 7562 7363  r use with Subsc
+00004a40: 7269 7074 696f 6e73 2061 6e64 2050 6c61  riptions and Pla
+00004a50: 6e73 2e22 0a20 2020 2020 2020 2029 2c0a  ns.".        ),.
+00004a60: 2020 2020 290a 0a20 2020 2023 2046 6965      )..    # Fie
+00004a70: 6c64 7320 6170 706c 6963 6162 6c65 2074  lds applicable t
+00004a80: 6f20 6067 6f6f 6460 206f 6e6c 790a 2020  o `good` only.  
+00004a90: 2020 6163 7469 7665 203d 206d 6f64 656c    active = model
+00004aa0: 732e 426f 6f6c 6561 6e46 6965 6c64 280a  s.BooleanField(.
+00004ab0: 2020 2020 2020 2020 6e75 6c6c 3d54 7275          null=Tru
+00004ac0: 652c 0a20 2020 2020 2020 2068 656c 705f  e,.        help_
+00004ad0: 7465 7874 3d28 0a20 2020 2020 2020 2020  text=(.         
+00004ae0: 2020 2022 5768 6574 6865 7220 7468 6520     "Whether the 
+00004af0: 7072 6f64 7563 7420 6973 2063 7572 7265  product is curre
+00004b00: 6e74 6c79 2061 7661 696c 6162 6c65 2066  ntly available f
+00004b10: 6f72 2070 7572 6368 6173 652e 2022 0a20  or purchase. ". 
+00004b20: 2020 2020 2020 2020 2020 2022 4f6e 6c79             "Only
+00004b30: 2061 7070 6c69 6361 626c 6520 746f 2070   applicable to p
+00004b40: 726f 6475 6374 7320 6f66 2060 7479 7065  roducts of `type
+00004b50: 3d67 6f6f 6460 2e22 0a20 2020 2020 2020  =good`.".       
+00004b60: 2029 2c0a 2020 2020 290a 2020 2020 6174   ),.    ).    at
+00004b70: 7472 6962 7574 6573 203d 204a 534f 4e46  tributes = JSONF
+00004b80: 6965 6c64 280a 2020 2020 2020 2020 6e75  ield(.        nu
+00004b90: 6c6c 3d54 7275 652c 0a20 2020 2020 2020  ll=True,.       
+00004ba0: 2062 6c61 6e6b 3d54 7275 652c 0a20 2020   blank=True,.   
+00004bb0: 2020 2020 2068 656c 705f 7465 7874 3d28       help_text=(
+00004bc0: 0a20 2020 2020 2020 2020 2020 2022 4120  .            "A 
+00004bd0: 6c69 7374 206f 6620 7570 2074 6f20 3520  list of up to 5 
+00004be0: 6174 7472 6962 7574 6573 2074 6861 7420  attributes that 
+00004bf0: 6561 6368 2053 4b55 2063 616e 2070 726f  each SKU can pro
+00004c00: 7669 6465 2076 616c 7565 7320 666f 7220  vide values for 
+00004c10: 220a 2020 2020 2020 2020 2020 2020 2728  ".            '(
+00004c20: 652e 672e 2c20 605b 2263 6f6c 6f72 222c  e.g., `["color",
+00004c30: 2022 7369 7a65 225d 6029 2e20 4f6e 6c79   "size"]`). Only
+00004c40: 2061 7070 6c69 6361 626c 6520 746f 2070   applicable to p
+00004c50: 726f 6475 6374 7320 6f66 2060 7479 7065  roducts of `type
+00004c60: 3d67 6f6f 6460 2e27 0a20 2020 2020 2020  =good`.'.       
+00004c70: 2029 2c0a 2020 2020 290a 2020 2020 6361   ),.    ).    ca
+00004c80: 7074 696f 6e20 3d20 6d6f 6465 6c73 2e54  ption = models.T
+00004c90: 6578 7446 6965 6c64 280a 2020 2020 2020  extField(.      
+00004ca0: 2020 6465 6661 756c 743d 2222 2c0a 2020    default="",.  
+00004cb0: 2020 2020 2020 626c 616e 6b3d 5472 7565        blank=True
+00004cc0: 2c0a 2020 2020 2020 2020 6d61 785f 6c65  ,.        max_le
+00004cd0: 6e67 7468 3d35 3030 302c 0a20 2020 2020  ngth=5000,.     
+00004ce0: 2020 2068 656c 705f 7465 7874 3d28 0a20     help_text=(. 
+00004cf0: 2020 2020 2020 2020 2020 2022 4120 7368             "A sh
+00004d00: 6f72 7420 6f6e 652d 6c69 6e65 2064 6573  ort one-line des
+00004d10: 6372 6970 7469 6f6e 206f 6620 7468 6520  cription of the 
+00004d20: 7072 6f64 7563 742c 206d 6561 6e74 2074  product, meant t
+00004d30: 6f20 6265 2064 6973 706c 6179 6162 6c65  o be displayable
+00004d40: 220a 2020 2020 2020 2020 2020 2020 2274  ".            "t
+00004d50: 6f20 7468 6520 6375 7374 6f6d 6572 2e20  o the customer. 
+00004d60: 4f6e 6c79 2061 7070 6c69 6361 626c 6520  Only applicable 
+00004d70: 746f 2070 726f 6475 6374 7320 6f66 2060  to products of `
+00004d80: 7479 7065 3d67 6f6f 6460 2e22 0a20 2020  type=good`.".   
+00004d90: 2020 2020 2029 2c0a 2020 2020 290a 2020       ),.    ).  
+00004da0: 2020 6465 6163 7469 7661 7465 5f6f 6e20    deactivate_on 
+00004db0: 3d20 4a53 4f4e 4669 656c 6428 0a20 2020  = JSONField(.   
+00004dc0: 2020 2020 206e 756c 6c3d 5472 7565 2c0a       null=True,.
+00004dd0: 2020 2020 2020 2020 626c 616e 6b3d 5472          blank=Tr
+00004de0: 7565 2c0a 2020 2020 2020 2020 6865 6c70  ue,.        help
+00004df0: 5f74 6578 743d 280a 2020 2020 2020 2020  _text=(.        
+00004e00: 2020 2020 2241 6e20 6172 7261 7920 6f66      "An array of
+00004e10: 2063 6f6e 6e65 6374 2061 7070 6c69 6361   connect applica
+00004e20: 7469 6f6e 2069 6465 6e74 6966 6965 7273  tion identifiers
+00004e30: 2074 6861 7420 6361 6e6e 6f74 2070 7572   that cannot pur
+00004e40: 6368 6173 6520 220a 2020 2020 2020 2020  chase ".        
+00004e50: 2020 2020 2274 6869 7320 7072 6f64 7563      "this produc
+00004e60: 742e 204f 6e6c 7920 6170 706c 6963 6162  t. Only applicab
+00004e70: 6c65 2074 6f20 7072 6f64 7563 7473 206f  le to products o
+00004e80: 6620 6074 7970 653d 676f 6f64 602e 220a  f `type=good`.".
+00004e90: 2020 2020 2020 2020 292c 0a20 2020 2029          ),.    )
+00004ea0: 0a20 2020 2069 6d61 6765 7320 3d20 4a53  .    images = JS
+00004eb0: 4f4e 4669 656c 6428 0a20 2020 2020 2020  ONField(.       
+00004ec0: 206e 756c 6c3d 5472 7565 2c0a 2020 2020   null=True,.    
+00004ed0: 2020 2020 626c 616e 6b3d 5472 7565 2c0a      blank=True,.
+00004ee0: 2020 2020 2020 2020 6865 6c70 5f74 6578          help_tex
+00004ef0: 743d 280a 2020 2020 2020 2020 2020 2020  t=(.            
+00004f00: 2241 206c 6973 7420 6f66 2075 7020 746f  "A list of up to
+00004f10: 2038 2055 524c 7320 6f66 2069 6d61 6765   8 URLs of image
+00004f20: 7320 666f 7220 7468 6973 2070 726f 6475  s for this produ
+00004f30: 6374 2c20 6d65 616e 7420 746f 2062 6520  ct, meant to be 
+00004f40: 220a 2020 2020 2020 2020 2020 2020 2264  ".            "d
+00004f50: 6973 706c 6179 6162 6c65 2074 6f20 7468  isplayable to th
+00004f60: 6520 6375 7374 6f6d 6572 2e20 4f6e 6c79  e customer. Only
+00004f70: 2061 7070 6c69 6361 626c 6520 746f 2070   applicable to p
+00004f80: 726f 6475 6374 7320 6f66 2060 7479 7065  roducts of `type
+00004f90: 3d67 6f6f 6460 2e22 0a20 2020 2020 2020  =good`.".       
+00004fa0: 2029 2c0a 2020 2020 290a 2020 2020 7061   ),.    ).    pa
+00004fb0: 636b 6167 655f 6469 6d65 6e73 696f 6e73  ckage_dimensions
+00004fc0: 203d 204a 534f 4e46 6965 6c64 280a 2020   = JSONField(.  
+00004fd0: 2020 2020 2020 6e75 6c6c 3d54 7275 652c        null=True,
+00004fe0: 0a20 2020 2020 2020 2062 6c61 6e6b 3d54  .        blank=T
+00004ff0: 7275 652c 0a20 2020 2020 2020 2068 656c  rue,.        hel
+00005000: 705f 7465 7874 3d28 0a20 2020 2020 2020  p_text=(.       
+00005010: 2020 2020 2022 5468 6520 6469 6d65 6e73       "The dimens
+00005020: 696f 6e73 206f 6620 7468 6973 2070 726f  ions of this pro
+00005030: 6475 6374 2066 6f72 2073 6869 7070 696e  duct for shippin
+00005040: 6720 7075 7270 6f73 6573 2e20 220a 2020  g purposes. ".  
+00005050: 2020 2020 2020 2020 2020 2241 2053 4b55            "A SKU
+00005060: 2061 7373 6f63 6961 7465 6420 7769 7468   associated with
+00005070: 2074 6869 7320 7072 6f64 7563 7420 6361   this product ca
+00005080: 6e20 6f76 6572 7269 6465 2074 6869 7320  n override this 
+00005090: 7661 6c75 6520 6279 2068 6176 696e 6720  value by having 
+000050a0: 6974 7320 220a 2020 2020 2020 2020 2020  its ".          
+000050b0: 2020 226f 776e 2060 7061 636b 6167 655f    "own `package_
+000050c0: 6469 6d65 6e73 696f 6e73 602e 204f 6e6c  dimensions`. Onl
+000050d0: 7920 6170 706c 6963 6162 6c65 2074 6f20  y applicable to 
+000050e0: 7072 6f64 7563 7473 206f 6620 6074 7970  products of `typ
+000050f0: 653d 676f 6f64 602e 220a 2020 2020 2020  e=good`.".      
+00005100: 2020 292c 0a20 2020 2029 0a20 2020 2073    ),.    ).    s
+00005110: 6869 7070 6162 6c65 203d 206d 6f64 656c  hippable = model
+00005120: 732e 426f 6f6c 6561 6e46 6965 6c64 280a  s.BooleanField(.
+00005130: 2020 2020 2020 2020 6e75 6c6c 3d54 7275          null=Tru
+00005140: 652c 0a20 2020 2020 2020 2062 6c61 6e6b  e,.        blank
+00005150: 3d54 7275 652c 0a20 2020 2020 2020 2068  =True,.        h
+00005160: 656c 705f 7465 7874 3d28 0a20 2020 2020  elp_text=(.     
+00005170: 2020 2020 2020 2022 5768 6574 6865 7220         "Whether 
+00005180: 7468 6973 2070 726f 6475 6374 2069 7320  this product is 
+00005190: 6120 7368 6970 7065 6420 676f 6f64 2e20  a shipped good. 
+000051a0: 220a 2020 2020 2020 2020 2020 2020 224f  ".            "O
+000051b0: 6e6c 7920 6170 706c 6963 6162 6c65 2074  nly applicable t
+000051c0: 6f20 7072 6f64 7563 7473 206f 6620 6074  o products of `t
+000051d0: 7970 653d 676f 6f64 602e 220a 2020 2020  ype=good`.".    
+000051e0: 2020 2020 292c 0a20 2020 2029 0a20 2020      ),.    ).   
+000051f0: 2075 726c 203d 206d 6f64 656c 732e 4368   url = models.Ch
+00005200: 6172 4669 656c 6428 0a20 2020 2020 2020  arField(.       
+00005210: 206d 6178 5f6c 656e 6774 683d 3739 392c   max_length=799,
+00005220: 0a20 2020 2020 2020 206e 756c 6c3d 5472  .        null=Tr
+00005230: 7565 2c0a 2020 2020 2020 2020 626c 616e  ue,.        blan
+00005240: 6b3d 5472 7565 2c0a 2020 2020 2020 2020  k=True,.        
+00005250: 6865 6c70 5f74 6578 743d 280a 2020 2020  help_text=(.    
+00005260: 2020 2020 2020 2020 2241 2055 524c 206f          "A URL o
+00005270: 6620 6120 7075 626c 6963 6c79 2d61 6363  f a publicly-acc
+00005280: 6573 7369 626c 6520 7765 6270 6167 6520  essible webpage 
+00005290: 666f 7220 7468 6973 2070 726f 6475 6374  for this product
+000052a0: 2e20 220a 2020 2020 2020 2020 2020 2020  . ".            
+000052b0: 224f 6e6c 7920 6170 706c 6963 6162 6c65  "Only applicable
+000052c0: 2074 6f20 7072 6f64 7563 7473 206f 6620   to products of 
+000052d0: 6074 7970 653d 676f 6f64 602e 220a 2020  `type=good`.".  
+000052e0: 2020 2020 2020 292c 0a20 2020 2029 0a0a        ),.    )..
+000052f0: 2020 2020 2320 4669 656c 6473 2061 7661      # Fields ava
+00005300: 696c 6162 6c65 2074 6f20 6073 6572 7669  ilable to `servi
+00005310: 6365 6020 6f6e 6c79 0a20 2020 2073 7461  ce` only.    sta
+00005320: 7465 6d65 6e74 5f64 6573 6372 6970 746f  tement_descripto
+00005330: 7220 3d20 6d6f 6465 6c73 2e43 6861 7246  r = models.CharF
+00005340: 6965 6c64 280a 2020 2020 2020 2020 6d61  ield(.        ma
+00005350: 785f 6c65 6e67 7468 3d32 322c 0a20 2020  x_length=22,.   
+00005360: 2020 2020 2064 6566 6175 6c74 3d22 222c       default="",
+00005370: 0a20 2020 2020 2020 2062 6c61 6e6b 3d54  .        blank=T
+00005380: 7275 652c 0a20 2020 2020 2020 2068 656c  rue,.        hel
+00005390: 705f 7465 7874 3d28 0a20 2020 2020 2020  p_text=(.       
+000053a0: 2020 2020 2022 4578 7472 6120 696e 666f       "Extra info
+000053b0: 726d 6174 696f 6e20 6162 6f75 7420 6120  rmation about a 
+000053c0: 7072 6f64 7563 7420 7768 6963 6820 7769  product which wi
+000053d0: 6c6c 2061 7070 6561 7220 6f6e 2079 6f75  ll appear on you
+000053e0: 7220 6375 7374 6f6d 6572 2773 2022 0a20  r customer's ". 
+000053f0: 2020 2020 2020 2020 2020 2022 6372 6564             "cred
+00005400: 6974 2063 6172 6420 7374 6174 656d 656e  it card statemen
+00005410: 742e 2049 6e20 7468 6520 6361 7365 2074  t. In the case t
+00005420: 6861 7420 6d75 6c74 6970 6c65 2070 726f  hat multiple pro
+00005430: 6475 6374 7320 6172 6520 6269 6c6c 6564  ducts are billed
+00005440: 2061 7420 220a 2020 2020 2020 2020 2020   at ".          
+00005450: 2020 226f 6e63 652c 2074 6865 2066 6972    "once, the fir
+00005460: 7374 2073 7461 7465 6d65 6e74 2064 6573  st statement des
+00005470: 6372 6970 746f 7220 7769 6c6c 2062 6520  criptor will be 
+00005480: 7573 6564 2e20 220a 2020 2020 2020 2020  used. ".        
+00005490: 2020 2020 224f 6e6c 7920 6176 6169 6c61      "Only availa
+000054a0: 626c 6520 6f6e 2070 726f 6475 6374 7320  ble on products 
+000054b0: 6f66 2074 7970 653d 6073 6572 7669 6365  of type=`service
+000054c0: 602e 220a 2020 2020 2020 2020 292c 0a20  `.".        ),. 
+000054d0: 2020 2029 0a20 2020 2075 6e69 745f 6c61     ).    unit_la
+000054e0: 6265 6c20 3d20 6d6f 6465 6c73 2e43 6861  bel = models.Cha
+000054f0: 7246 6965 6c64 286d 6178 5f6c 656e 6774  rField(max_lengt
+00005500: 683d 3132 2c20 6465 6661 756c 743d 2222  h=12, default=""
+00005510: 2c20 626c 616e 6b3d 5472 7565 290a 0a20  , blank=True).. 
+00005520: 2020 2064 6566 205f 5f73 7472 5f5f 2873     def __str__(s
+00005530: 656c 6629 3a0a 2020 2020 2020 2020 2320  elf):.        # 
+00005540: 3120 7072 6f64 7563 7420 6361 6e20 6861  1 product can ha
+00005550: 7665 2031 206f 7220 6d6f 7265 2074 6861  ve 1 or more tha
+00005560: 6e20 3120 7265 6c61 7465 6420 7072 6963  n 1 related pric
+00005570: 650a 2020 2020 2020 2020 7072 6963 655f  e.        price_
+00005580: 7173 203d 2073 656c 662e 7072 6963 6573  qs = self.prices
+00005590: 2e61 6c6c 2829 0a20 2020 2020 2020 2070  .all().        p
+000055a0: 7269 6365 5f63 6f75 6e74 203d 2070 7269  rice_count = pri
+000055b0: 6365 5f71 732e 636f 756e 7428 290a 0a20  ce_qs.count().. 
+000055c0: 2020 2020 2020 2069 6620 7072 6963 655f         if price_
+000055d0: 636f 756e 7420 3e20 313a 0a20 2020 2020  count > 1:.     
+000055e0: 2020 2020 2020 2072 6574 7572 6e20 6622         return f"
+000055f0: 7b73 656c 662e 6e61 6d65 7d20 287b 7072  {self.name} ({pr
+00005600: 6963 655f 636f 756e 747d 2070 7269 6365  ice_count} price
+00005610: 7329 220a 2020 2020 2020 2020 656c 6966  s)".        elif
+00005620: 2070 7269 6365 5f63 6f75 6e74 203d 3d20   price_count == 
+00005630: 313a 0a20 2020 2020 2020 2020 2020 2072  1:.            r
+00005640: 6574 7572 6e20 6622 7b73 656c 662e 6e61  eturn f"{self.na
+00005650: 6d65 7d20 287b 7072 6963 655f 7173 5b30  me} ({price_qs[0
+00005660: 5d2e 6875 6d61 6e5f 7265 6164 6162 6c65  ].human_readable
+00005670: 5f70 7269 6365 7d29 220a 2020 2020 2020  _price})".      
+00005680: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00005690: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+000056a0: 6e61 6d65 0a0a 0a63 6c61 7373 2043 7573  name...class Cus
+000056b0: 746f 6d65 7228 5374 7269 7065 4d6f 6465  tomer(StripeMode
+000056c0: 6c29 3a0a 2020 2020 2222 220a 2020 2020  l):.    """.    
+000056d0: 4375 7374 6f6d 6572 206f 626a 6563 7473  Customer objects
+000056e0: 2061 6c6c 6f77 2079 6f75 2074 6f20 7065   allow you to pe
+000056f0: 7266 6f72 6d20 7265 6375 7272 696e 6720  rform recurring 
+00005700: 6368 6172 6765 7320 616e 6420 7472 6163  charges and trac
+00005710: 6b20 6d75 6c74 6970 6c65 0a20 2020 2063  k multiple.    c
+00005720: 6861 7267 6573 2074 6861 7420 6172 6520  harges that are 
+00005730: 6173 736f 6369 6174 6564 2077 6974 6820  associated with 
+00005740: 7468 6520 7361 6d65 2063 7573 746f 6d65  the same custome
+00005750: 722e 0a0a 2020 2020 5374 7269 7065 2064  r...    Stripe d
+00005760: 6f63 756d 656e 7461 7469 6f6e 3a20 6874  ocumentation: ht
+00005770: 7470 733a 2f2f 7374 7269 7065 2e63 6f6d  tps://stripe.com
+00005780: 2f64 6f63 732f 6170 693f 6c61 6e67 3d70  /docs/api?lang=p
+00005790: 7974 686f 6e23 6375 7374 6f6d 6572 730a  ython#customers.
+000057a0: 2020 2020 2222 220a 0a20 2020 2073 7472      """..    str
+000057b0: 6970 655f 636c 6173 7320 3d20 7374 7269  ipe_class = stri
+000057c0: 7065 2e43 7573 746f 6d65 720a 2020 2020  pe.Customer.    
+000057d0: 6578 7061 6e64 5f66 6965 6c64 7320 3d20  expand_fields = 
+000057e0: 5b22 6465 6661 756c 745f 736f 7572 6365  ["default_source
+000057f0: 222c 2022 736f 7572 6365 7322 5d0a 2020  ", "sources"].  
+00005800: 2020 7374 7269 7065 5f64 6173 6862 6f61    stripe_dashboa
+00005810: 7264 5f69 7465 6d5f 6e61 6d65 203d 2022  rd_item_name = "
+00005820: 6375 7374 6f6d 6572 7322 0a0a 2020 2020  customers"..    
+00005830: 6164 6472 6573 7320 3d20 4a53 4f4e 4669  address = JSONFi
+00005840: 656c 6428 6e75 6c6c 3d54 7275 652c 2062  eld(null=True, b
+00005850: 6c61 6e6b 3d54 7275 652c 2068 656c 705f  lank=True, help_
+00005860: 7465 7874 3d22 5468 6520 6375 7374 6f6d  text="The custom
+00005870: 6572 2773 2061 6464 7265 7373 2e22 290a  er's address.").
+00005880: 2020 2020 6261 6c61 6e63 6520 3d20 5374      balance = St
+00005890: 7269 7065 5175 616e 7475 6d43 7572 7265  ripeQuantumCurre
+000058a0: 6e63 7941 6d6f 756e 7446 6965 6c64 280a  ncyAmountField(.
+000058b0: 2020 2020 2020 2020 6e75 6c6c 3d54 7275          null=Tru
+000058c0: 652c 0a20 2020 2020 2020 2062 6c61 6e6b  e,.        blank
+000058d0: 3d54 7275 652c 0a20 2020 2020 2020 2064  =True,.        d
+000058e0: 6566 6175 6c74 3d30 2c0a 2020 2020 2020  efault=0,.      
+000058f0: 2020 6865 6c70 5f74 6578 743d 280a 2020    help_text=(.  
+00005900: 2020 2020 2020 2020 2020 2243 7572 7265            "Curre
+00005910: 6e74 2062 616c 616e 6365 2028 696e 2063  nt balance (in c
+00005920: 656e 7473 292c 2069 6620 616e 792c 2062  ents), if any, b
+00005930: 6569 6e67 2073 746f 7265 6420 6f6e 2074  eing stored on t
+00005940: 6865 2063 7573 746f 6d65 7227 7320 220a  he customer's ".
+00005950: 2020 2020 2020 2020 2020 2020 2261 6363              "acc
+00005960: 6f75 6e74 2e20 220a 2020 2020 2020 2020  ount. ".        
+00005970: 2020 2020 2249 6620 6e65 6761 7469 7665      "If negative
+00005980: 2c20 7468 6520 6375 7374 6f6d 6572 2068  , the customer h
+00005990: 6173 2063 7265 6469 7420 746f 2061 7070  as credit to app
+000059a0: 6c79 2074 6f20 7468 6520 6e65 7874 2069  ly to the next i
+000059b0: 6e76 6f69 6365 2e20 220a 2020 2020 2020  nvoice. ".      
+000059c0: 2020 2020 2020 2249 6620 706f 7369 7469        "If positi
+000059d0: 7665 2c20 7468 6520 6375 7374 6f6d 6572  ve, the customer
+000059e0: 2068 6173 2061 6e20 616d 6f75 6e74 206f   has an amount o
+000059f0: 7765 6420 7468 6174 2077 696c 6c20 6265  wed that will be
+00005a00: 2061 6464 6564 2074 6f20 7468 6520 220a   added to the ".
+00005a10: 2020 2020 2020 2020 2020 2020 226e 6578              "nex
+00005a20: 7420 696e 766f 6963 652e 2054 6865 2062  t invoice. The b
+00005a30: 616c 616e 6365 2064 6f65 7320 6e6f 7420  alance does not 
+00005a40: 7265 6665 7220 746f 2061 6e79 2075 6e70  refer to any unp
+00005a50: 6169 6420 696e 766f 6963 6573 3b20 6974  aid invoices; it
+00005a60: 2022 0a20 2020 2020 2020 2020 2020 2022   ".            "
+00005a70: 736f 6c65 6c79 2074 616b 6573 2069 6e74  solely takes int
+00005a80: 6f20 6163 636f 756e 7420 616d 6f75 6e74  o account amount
+00005a90: 7320 7468 6174 2068 6176 6520 7965 7420  s that have yet 
+00005aa0: 746f 2062 6520 7375 6363 6573 7366 756c  to be successful
+00005ab0: 6c79 2022 0a20 2020 2020 2020 2020 2020  ly ".           
+00005ac0: 2022 6170 706c 6965 6420 746f 2061 6e79   "applied to any
+00005ad0: 2069 6e76 6f69 6365 2e20 5468 6973 2062   invoice. This b
+00005ae0: 616c 616e 6365 2069 7320 6f6e 6c79 2074  alance is only t
+00005af0: 616b 656e 2069 6e74 6f20 6163 636f 756e  aken into accoun
+00005b00: 7420 666f 7220 220a 2020 2020 2020 2020  t for ".        
+00005b10: 2020 2020 2272 6563 7572 7269 6e67 2062      "recurring b
+00005b20: 696c 6c69 6e67 2070 7572 706f 7365 7320  illing purposes 
+00005b30: 2869 2e65 2e2c 2073 7562 7363 7269 7074  (i.e., subscript
+00005b40: 696f 6e73 2c20 696e 766f 6963 6573 2c20  ions, invoices, 
+00005b50: 696e 766f 6963 6520 6974 656d 7329 2e22  invoice items)."
+00005b60: 0a20 2020 2020 2020 2029 2c0a 2020 2020  .        ),.    
+00005b70: 290a 2020 2020 6375 7272 656e 6379 203d  ).    currency =
+00005b80: 2053 7472 6970 6543 7572 7265 6e63 7943   StripeCurrencyC
+00005b90: 6f64 6546 6965 6c64 280a 2020 2020 2020  odeField(.      
+00005ba0: 2020 626c 616e 6b3d 5472 7565 2c0a 2020    blank=True,.  
+00005bb0: 2020 2020 2020 6465 6661 756c 743d 2222        default=""
+00005bc0: 2c0a 2020 2020 2020 2020 6865 6c70 5f74  ,.        help_t
+00005bd0: 6578 743d 280a 2020 2020 2020 2020 2020  ext=(.          
+00005be0: 2020 2254 6865 2063 7572 7265 6e63 7920    "The currency 
+00005bf0: 7468 6520 6375 7374 6f6d 6572 2063 616e  the customer can
+00005c00: 2062 6520 6368 6172 6765 6420 696e 2066   be charged in f
+00005c10: 6f72 2072 6563 7572 7269 6e67 2062 696c  or recurring bil
+00005c20: 6c69 6e67 2070 7572 706f 7365 7322 0a20  ling purposes". 
+00005c30: 2020 2020 2020 2029 2c0a 2020 2020 290a         ),.    ).
+00005c40: 2020 2020 6465 6661 756c 745f 736f 7572      default_sour
+00005c50: 6365 203d 2050 6179 6d65 6e74 4d65 7468  ce = PaymentMeth
+00005c60: 6f64 466f 7265 6967 6e4b 6579 280a 2020  odForeignKey(.  
+00005c70: 2020 2020 2020 6f6e 5f64 656c 6574 653d        on_delete=
+00005c80: 6d6f 6465 6c73 2e53 4554 5f4e 554c 4c2c  models.SET_NULL,
+00005c90: 206e 756c 6c3d 5472 7565 2c20 626c 616e   null=True, blan
+00005ca0: 6b3d 5472 7565 2c20 7265 6c61 7465 645f  k=True, related_
+00005cb0: 6e61 6d65 3d22 6375 7374 6f6d 6572 7322  name="customers"
+00005cc0: 0a20 2020 2029 0a20 2020 2064 656c 696e  .    ).    delin
+00005cd0: 7175 656e 7420 3d20 6d6f 6465 6c73 2e42  quent = models.B
+00005ce0: 6f6f 6c65 616e 4669 656c 6428 0a20 2020  ooleanField(.   
+00005cf0: 2020 2020 206e 756c 6c3d 5472 7565 2c0a       null=True,.
+00005d00: 2020 2020 2020 2020 626c 616e 6b3d 5472          blank=Tr
+00005d10: 7565 2c0a 2020 2020 2020 2020 6465 6661  ue,.        defa
+00005d20: 756c 743d 4661 6c73 652c 0a20 2020 2020  ult=False,.     
+00005d30: 2020 2068 656c 705f 7465 7874 3d28 0a20     help_text=(. 
+00005d40: 2020 2020 2020 2020 2020 2022 5768 6574             "Whet
+00005d50: 6865 7220 6f72 206e 6f74 2074 6865 206c  her or not the l
+00005d60: 6174 6573 7420 6368 6172 6765 2066 6f72  atest charge for
+00005d70: 2074 6865 2063 7573 746f 6d65 7227 7320   the customer's 
+00005d80: 220a 2020 2020 2020 2020 2020 2020 226c  ".            "l
+00005d90: 6174 6573 7420 696e 766f 6963 6520 6861  atest invoice ha
+00005da0: 7320 6661 696c 6564 2e22 0a20 2020 2020  s failed.".     
+00005db0: 2020 2029 2c0a 2020 2020 290a 2020 2020     ),.    ).    
+00005dc0: 2320 5374 7269 7065 2041 5049 2072 6574  # Stripe API ret
+00005dd0: 7572 6e73 2064 656c 6574 6564 2063 7573  urns deleted cus
+00005de0: 746f 6d65 7273 206c 696b 6520 736f 3a0a  tomers like so:.
+00005df0: 2020 2020 2320 7b0a 2020 2020 2320 2020      # {.    #   
+00005e00: 2269 6422 3a20 2263 7573 5f4b 5834 3339  "id": "cus_KX439
+00005e10: 5735 644b 7270 6932 3222 2c0a 2020 2020  W5dKrpi22",.    
+00005e20: 2320 2020 226f 626a 6563 7422 3a20 2263  #   "object": "c
+00005e30: 7573 746f 6d65 7222 2c0a 2020 2020 2320  ustomer",.    # 
+00005e40: 2020 2264 656c 6574 6564 223a 2074 7275    "deleted": tru
+00005e50: 652c 0a20 2020 2023 207d 0a20 2020 2064  e,.    # }.    d
+00005e60: 656c 6574 6564 203d 206d 6f64 656c 732e  eleted = models.
+00005e70: 426f 6f6c 6561 6e46 6965 6c64 280a 2020  BooleanField(.  
+00005e80: 2020 2020 2020 6465 6661 756c 743d 4661        default=Fa
+00005e90: 6c73 652c 0a20 2020 2020 2020 206e 756c  lse,.        nul
+00005ea0: 6c3d 5472 7565 2c0a 2020 2020 2020 2020  l=True,.        
+00005eb0: 626c 616e 6b3d 5472 7565 2c0a 2020 2020  blank=True,.    
+00005ec0: 2020 2020 6865 6c70 5f74 6578 743d 280a      help_text=(.
+00005ed0: 2020 2020 2020 2020 2020 2020 2257 6865              "Whe
+00005ee0: 7468 6572 2074 6865 2043 7573 746f 6d65  ther the Custome
+00005ef0: 7220 696e 7374 616e 6365 2068 6173 2062  r instance has b
+00005f00: 6565 6e20 6465 6c65 7465 6420 7570 7374  een deleted upst
+00005f10: 7265 616d 2069 6e20 5374 7269 7065 206f  ream in Stripe o
+00005f20: 7220 6e6f 742e 220a 2020 2020 2020 2020  r not.".        
+00005f30: 292c 0a20 2020 2029 0a20 2020 2023 203c  ),.    ).    # <
+00005f40: 6469 7363 6f75 6e74 3e0a 2020 2020 636f  discount>.    co
+00005f50: 7570 6f6e 203d 206d 6f64 656c 732e 466f  upon = models.Fo
+00005f60: 7265 6967 6e4b 6579 280a 2020 2020 2020  reignKey(.      
+00005f70: 2020 2243 6f75 706f 6e22 2c20 6e75 6c6c    "Coupon", null
+00005f80: 3d54 7275 652c 2062 6c61 6e6b 3d54 7275  =True, blank=Tru
+00005f90: 652c 206f 6e5f 6465 6c65 7465 3d6d 6f64  e, on_delete=mod
+00005fa0: 656c 732e 5345 545f 4e55 4c4c 0a20 2020  els.SET_NULL.   
+00005fb0: 2029 0a20 2020 2063 6f75 706f 6e5f 7374   ).    coupon_st
+00005fc0: 6172 7420 3d20 5374 7269 7065 4461 7465  art = StripeDate
+00005fd0: 5469 6d65 4669 656c 6428 0a20 2020 2020  TimeField(.     
+00005fe0: 2020 206e 756c 6c3d 5472 7565 2c0a 2020     null=True,.  
+00005ff0: 2020 2020 2020 626c 616e 6b3d 5472 7565        blank=True
+00006000: 2c0a 2020 2020 2020 2020 6564 6974 6162  ,.        editab
+00006010: 6c65 3d46 616c 7365 2c0a 2020 2020 2020  le=False,.      
+00006020: 2020 6865 6c70 5f74 6578 743d 2249 6620    help_text="If 
+00006030: 6120 636f 7570 6f6e 2069 7320 7072 6573  a coupon is pres
+00006040: 656e 742c 2074 6865 2064 6174 6520 6174  ent, the date at
+00006050: 2077 6869 6368 2069 7420 7761 7320 6170   which it was ap
+00006060: 706c 6965 642e 222c 0a20 2020 2029 0a20  plied.",.    ). 
+00006070: 2020 2063 6f75 706f 6e5f 656e 6420 3d20     coupon_end = 
+00006080: 5374 7269 7065 4461 7465 5469 6d65 4669  StripeDateTimeFi
+00006090: 656c 6428 0a20 2020 2020 2020 206e 756c  eld(.        nul
+000060a0: 6c3d 5472 7565 2c0a 2020 2020 2020 2020  l=True,.        
+000060b0: 626c 616e 6b3d 5472 7565 2c0a 2020 2020  blank=True,.    
+000060c0: 2020 2020 6564 6974 6162 6c65 3d46 616c      editable=Fal
+000060d0: 7365 2c0a 2020 2020 2020 2020 6865 6c70  se,.        help
+000060e0: 5f74 6578 743d 280a 2020 2020 2020 2020  _text=(.        
+000060f0: 2020 2020 2249 6620 6120 636f 7570 6f6e      "If a coupon
+00006100: 2069 7320 7072 6573 656e 7420 616e 6420   is present and 
+00006110: 6861 7320 6120 6c69 6d69 7465 6420 6475  has a limited du
+00006120: 7261 7469 6f6e 2c20 220a 2020 2020 2020  ration, ".      
+00006130: 2020 2020 2020 2274 6865 2064 6174 6520        "the date 
+00006140: 7468 6174 2074 6865 2064 6973 636f 756e  that the discoun
+00006150: 7420 7769 6c6c 2065 6e64 2e22 0a20 2020  t will end.".   
+00006160: 2020 2020 2029 2c0a 2020 2020 290a 2020       ),.    ).  
+00006170: 2020 2320 3c2f 6469 7363 6f75 6e74 3e0a    # </discount>.
+00006180: 2020 2020 6469 7363 6f75 6e74 203d 204a      discount = J
+00006190: 534f 4e46 6965 6c64 280a 2020 2020 2020  SONField(.      
+000061a0: 2020 6e75 6c6c 3d54 7275 652c 0a20 2020    null=True,.   
+000061b0: 2020 2020 2062 6c61 6e6b 3d54 7275 652c       blank=True,
+000061c0: 0a20 2020 2020 2020 2068 656c 705f 7465  .        help_te
+000061d0: 7874 3d28 0a20 2020 2020 2020 2020 2020  xt=(.           
+000061e0: 2022 4465 7363 7269 6265 7320 7468 6520   "Describes the 
+000061f0: 6375 7272 656e 7420 6469 7363 6f75 6e74  current discount
+00006200: 2061 6374 6976 6520 6f6e 2074 6865 2063   active on the c
+00006210: 7573 746f 6d65 722c 2069 6620 7468 6572  ustomer, if ther
+00006220: 6520 6973 206f 6e65 2e22 0a20 2020 2020  e is one.".     
+00006230: 2020 2029 2c0a 2020 2020 290a 0a20 2020     ),.    )..   
+00006240: 2065 6d61 696c 203d 206d 6f64 656c 732e   email = models.
+00006250: 5465 7874 4669 656c 6428 6d61 785f 6c65  TextField(max_le
+00006260: 6e67 7468 3d35 3030 302c 2064 6566 6175  ngth=5000, defau
+00006270: 6c74 3d22 222c 2062 6c61 6e6b 3d54 7275  lt="", blank=Tru
+00006280: 6529 0a20 2020 2069 6e76 6f69 6365 5f70  e).    invoice_p
+00006290: 7265 6669 7820 3d20 6d6f 6465 6c73 2e43  refix = models.C
+000062a0: 6861 7246 6965 6c64 280a 2020 2020 2020  harField(.      
 000062b0: 2020 6465 6661 756c 743d 2222 2c0a 2020    default="",.  
-000062c0: 2020 2020 2020 6865 6c70 5f74 6578 743d        help_text=
-000062d0: 2244 6573 6372 6962 6573 2074 6865 2063  "Describes the c
-000062e0: 7573 746f 6d65 7227 7320 7461 7820 6578  ustomer's tax ex
-000062f0: 656d 7074 696f 6e20 7374 6174 7573 2e20  emption status. 
-00006300: 5768 656e 2073 6574 2074 6f20 7265 7665  When set to reve
-00006310: 7273 652c 2022 0a20 2020 2020 2020 2027  rse, ".        '
-00006320: 696e 766f 6963 6520 616e 6420 7265 6365  invoice and rece
-00006330: 6970 7420 5044 4673 2069 6e63 6c75 6465  ipt PDFs include
-00006340: 2074 6865 2074 6578 7420 2252 6576 6572   the text "Rever
-00006350: 7365 2063 6861 7267 6522 2e27 2c0a 2020  se charge".',.  
-00006360: 2020 290a 0a20 2020 2023 2064 6a2d 7374    )..    # dj-st
-00006370: 7269 7065 2066 6965 6c64 730a 2020 2020  ripe fields.    
-00006380: 7375 6273 6372 6962 6572 203d 206d 6f64  subscriber = mod
-00006390: 656c 732e 466f 7265 6967 6e4b 6579 280a  els.ForeignKey(.
-000063a0: 2020 2020 2020 2020 646a 7374 7269 7065          djstripe
-000063b0: 5f73 6574 7469 6e67 732e 6765 745f 7375  _settings.get_su
-000063c0: 6273 6372 6962 6572 5f6d 6f64 656c 5f73  bscriber_model_s
-000063d0: 7472 696e 6728 292c 0a20 2020 2020 2020  tring(),.       
-000063e0: 2062 6c61 6e6b 3d54 7275 652c 0a20 2020   blank=True,.   
-000063f0: 2020 2020 206e 756c 6c3d 5472 7565 2c0a       null=True,.
-00006400: 2020 2020 2020 2020 6f6e 5f64 656c 6574          on_delet
-00006410: 653d 6d6f 6465 6c73 2e53 4554 5f4e 554c  e=models.SET_NUL
-00006420: 4c2c 0a20 2020 2020 2020 2072 656c 6174  L,.        relat
-00006430: 6564 5f6e 616d 653d 2264 6a73 7472 6970  ed_name="djstrip
-00006440: 655f 6375 7374 6f6d 6572 7322 2c0a 2020  e_customers",.  
-00006450: 2020 290a 2020 2020 6461 7465 5f70 7572    ).    date_pur
-00006460: 6765 6420 3d20 6d6f 6465 6c73 2e44 6174  ged = models.Dat
-00006470: 6554 696d 6546 6965 6c64 286e 756c 6c3d  eTimeField(null=
-00006480: 5472 7565 2c20 6564 6974 6162 6c65 3d46  True, editable=F
-00006490: 616c 7365 290a 0a20 2020 2063 6c61 7373  alse)..    class
-000064a0: 204d 6574 6128 5374 7269 7065 4d6f 6465   Meta(StripeMode
-000064b0: 6c2e 4d65 7461 293a 0a20 2020 2020 2020  l.Meta):.       
-000064c0: 2075 6e69 7175 655f 746f 6765 7468 6572   unique_together
-000064d0: 203d 2028 2273 7562 7363 7269 6265 7222   = ("subscriber"
-000064e0: 2c20 226c 6976 656d 6f64 6522 2c20 2264  , "livemode", "d
-000064f0: 6a73 7472 6970 655f 6f77 6e65 725f 6163  jstripe_owner_ac
-00006500: 636f 756e 7422 290a 0a20 2020 2064 6566  count")..    def
-00006510: 205f 5f73 7472 5f5f 2873 656c 6629 3a0a   __str__(self):.
-00006520: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00006530: 7375 6273 6372 6962 6572 3a0a 2020 2020  subscriber:.    
-00006540: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00006550: 7472 2873 656c 662e 7375 6273 6372 6962  tr(self.subscrib
-00006560: 6572 290a 0a20 2020 2020 2020 2072 6574  er)..        ret
-00006570: 7572 6e20 7365 6c66 2e6e 616d 6520 6f72  urn self.name or
-00006580: 2073 656c 662e 6465 7363 7269 7074 696f   self.descriptio
-00006590: 6e20 6f72 2073 656c 662e 6964 0a0a 2020  n or self.id..  
-000065a0: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
-000065b0: 2020 2064 6566 205f 6d61 6e69 7075 6c61     def _manipula
-000065c0: 7465 5f73 7472 6970 655f 6f62 6a65 6374  te_stripe_object
-000065d0: 5f68 6f6f 6b28 636c 732c 2064 6174 6129  _hook(cls, data)
-000065e0: 3a0a 0a20 2020 2020 2020 2023 2073 7472  :..        # str
-000065f0: 6970 6520 6164 6473 2061 2064 656c 6574  ipe adds a delet
-00006600: 6564 2061 7474 7269 6275 7465 2069 6620  ed attribute if 
-00006610: 7468 6520 4375 7374 6f6d 6572 2068 6173  the Customer has
-00006620: 2062 6565 6e20 6465 6c65 7465 6420 7570   been deleted up
-00006630: 7374 7265 616d 0a20 2020 2020 2020 2069  stream.        i
-00006640: 6620 6461 7461 2e67 6574 2822 6465 6c65  f data.get("dele
-00006650: 7465 6422 293a 0a20 2020 2020 2020 2020  ted"):.         
-00006660: 2020 206c 6f67 6765 722e 7761 726e 696e     logger.warnin
-00006670: 6728 0a20 2020 2020 2020 2020 2020 2020  g(.             
-00006680: 2020 2066 2254 6869 7320 6375 7374 6f6d     f"This custom
-00006690: 6572 2028 7b64 6174 612e 6765 7428 2769  er ({data.get('i
-000066a0: 6427 297d 2920 6861 7320 6265 656e 2064  d')}) has been d
-000066b0: 656c 6574 6564 2075 7073 7472 6561 6d2c  eleted upstream,
-000066c0: 2069 6e20 5374 7269 7065 220a 2020 2020   in Stripe".    
-000066d0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-000066e0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-000066f0: 2020 2020 2023 2073 6574 2022 6465 6c65       # set "dele
-00006700: 7465 6422 206b 6579 2074 6f20 4661 6c73  ted" key to Fals
-00006710: 6520 2864 6566 6175 6c74 290a 2020 2020  e (default).    
-00006720: 2020 2020 2020 2020 6461 7461 5b22 6465          data["de
-00006730: 6c65 7465 6422 5d20 3d20 4661 6c73 650a  leted"] = False.
-00006740: 0a20 2020 2020 2020 2064 6973 636f 756e  .        discoun
-00006750: 7420 3d20 6461 7461 2e67 6574 2822 6469  t = data.get("di
-00006760: 7363 6f75 6e74 2229 0a20 2020 2020 2020  scount").       
-00006770: 2069 6620 6469 7363 6f75 6e74 3a0a 2020   if discount:.  
-00006780: 2020 2020 2020 2020 2020 6461 7461 5b22            data["
-00006790: 636f 7570 6f6e 5f73 7461 7274 225d 203d  coupon_start"] =
-000067a0: 2064 6973 636f 756e 745b 2273 7461 7274   discount["start
-000067b0: 225d 0a20 2020 2020 2020 2020 2020 2064  "].            d
-000067c0: 6174 615b 2263 6f75 706f 6e5f 656e 6422  ata["coupon_end"
-000067d0: 5d20 3d20 6469 7363 6f75 6e74 5b22 656e  ] = discount["en
-000067e0: 6422 5d0a 0a20 2020 2020 2020 2023 2050  d"]..        # P
-000067f0: 6f70 756c 6174 6520 7468 6520 6f62 6a65  opulate the obje
-00006800: 6374 2069 6420 666f 7220 6f75 7220 6465  ct id for our de
-00006810: 6661 756c 745f 7061 796d 656e 745f 6d65  fault_payment_me
-00006820: 7468 6f64 2066 6965 6c64 2028 6f72 2073  thod field (or s
-00006830: 6574 2069 7420 4e6f 6e65 290a 2020 2020  et it None).    
-00006840: 2020 2020 6461 7461 5b22 6465 6661 756c      data["defaul
-00006850: 745f 7061 796d 656e 745f 6d65 7468 6f64  t_payment_method
-00006860: 225d 203d 2064 6174 612e 6765 7428 2269  "] = data.get("i
-00006870: 6e76 6f69 6365 5f73 6574 7469 6e67 7322  nvoice_settings"
-00006880: 2c20 7b7d 292e 6765 7428 0a20 2020 2020  , {}).get(.     
-00006890: 2020 2020 2020 2022 6465 6661 756c 745f         "default_
-000068a0: 7061 796d 656e 745f 6d65 7468 6f64 220a  payment_method".
-000068b0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-000068c0: 2020 2072 6574 7572 6e20 6461 7461 0a0a     return data..
-000068d0: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
-000068e0: 0a20 2020 2064 6566 2067 6574 5f6f 725f  .    def get_or_
-000068f0: 6372 6561 7465 280a 2020 2020 2020 2020  create(.        
-00006900: 636c 732c 0a20 2020 2020 2020 2073 7562  cls,.        sub
-00006910: 7363 7269 6265 722c 0a20 2020 2020 2020  scriber,.       
-00006920: 206c 6976 656d 6f64 653d 646a 7374 7269   livemode=djstri
-00006930: 7065 5f73 6574 7469 6e67 732e 5354 5249  pe_settings.STRI
-00006940: 5045 5f4c 4956 455f 4d4f 4445 2c0a 2020  PE_LIVE_MODE,.  
-00006950: 2020 2020 2020 7374 7269 7065 5f61 6363        stripe_acc
-00006960: 6f75 6e74 3d4e 6f6e 652c 0a20 2020 2029  ount=None,.    )
-00006970: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-00006980: 2020 2020 2020 4765 7420 6f72 2063 7265        Get or cre
-00006990: 6174 6520 6120 646a 2d73 7472 6970 6520  ate a dj-stripe 
-000069a0: 6375 7374 6f6d 6572 2e0a 0a20 2020 2020  customer...     
-000069b0: 2020 203a 7061 7261 6d20 7375 6273 6372     :param subscr
-000069c0: 6962 6572 3a20 5468 6520 7375 6273 6372  iber: The subscr
-000069d0: 6962 6572 206d 6f64 656c 2069 6e73 7461  iber model insta
-000069e0: 6e63 6520 666f 7220 7768 6963 6820 746f  nce for which to
-000069f0: 2067 6574 206f 720a 2020 2020 2020 2020   get or.        
-00006a00: 2020 2020 6372 6561 7465 2061 2063 7573      create a cus
-00006a10: 746f 6d65 722e 0a20 2020 2020 2020 203a  tomer..        :
-00006a20: 7479 7065 2073 7562 7363 7269 6265 723a  type subscriber:
-00006a30: 2055 7365 720a 0a20 2020 2020 2020 203a   User..        :
-00006a40: 7061 7261 6d20 6c69 7665 6d6f 6465 3a20  param livemode: 
-00006a50: 5768 6574 6865 7220 746f 2067 6574 2074  Whether to get t
-00006a60: 6865 2073 7562 7363 7269 6265 7220 696e  he subscriber in
-00006a70: 206c 6976 6520 6f72 2074 6573 7420 6d6f   live or test mo
-00006a80: 6465 2e0a 2020 2020 2020 2020 3a74 7970  de..        :typ
-00006a90: 6520 6c69 7665 6d6f 6465 3a20 626f 6f6c  e livemode: bool
-00006aa0: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
-00006ab0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-00006ac0: 2020 2020 2020 2072 6574 7572 6e20 4375         return Cu
-00006ad0: 7374 6f6d 6572 2e6f 626a 6563 7473 2e67  stomer.objects.g
-00006ae0: 6574 2873 7562 7363 7269 6265 723d 7375  et(subscriber=su
-00006af0: 6273 6372 6962 6572 2c20 6c69 7665 6d6f  bscriber, livemo
-00006b00: 6465 3d6c 6976 656d 6f64 6529 2c20 4661  de=livemode), Fa
-00006b10: 6c73 650a 2020 2020 2020 2020 6578 6365  lse.        exce
-00006b20: 7074 2043 7573 746f 6d65 722e 446f 6573  pt Customer.Does
-00006b30: 4e6f 7445 7869 7374 3a0a 2020 2020 2020  NotExist:.      
-00006b40: 2020 2020 2020 6163 7469 6f6e 203d 2022        action = "
-00006b50: 6372 6561 7465 3a7b 7d22 2e66 6f72 6d61  create:{}".forma
-00006b60: 7428 7375 6273 6372 6962 6572 2e70 6b29  t(subscriber.pk)
-00006b70: 0a20 2020 2020 2020 2020 2020 2069 6465  .            ide
-00006b80: 6d70 6f74 656e 6379 5f6b 6579 203d 2064  mpotency_key = d
-00006b90: 6a73 7472 6970 655f 7365 7474 696e 6773  jstripe_settings
-00006ba0: 2e67 6574 5f69 6465 6d70 6f74 656e 6379  .get_idempotency
-00006bb0: 5f6b 6579 280a 2020 2020 2020 2020 2020  _key(.          
-00006bc0: 2020 2020 2020 2263 7573 746f 6d65 7222        "customer"
-00006bd0: 2c20 6163 7469 6f6e 2c20 6c69 7665 6d6f  , action, livemo
-00006be0: 6465 0a20 2020 2020 2020 2020 2020 2029  de.            )
-00006bf0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00006c00: 7572 6e20 280a 2020 2020 2020 2020 2020  urn (.          
-00006c10: 2020 2020 2020 636c 732e 6372 6561 7465        cls.create
-00006c20: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00006c30: 2020 2020 2020 7375 6273 6372 6962 6572        subscriber
-00006c40: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00006c50: 2020 2020 2020 6964 656d 706f 7465 6e63        idempotenc
-00006c60: 795f 6b65 793d 6964 656d 706f 7465 6e63  y_key=idempotenc
-00006c70: 795f 6b65 792c 0a20 2020 2020 2020 2020  y_key,.         
-00006c80: 2020 2020 2020 2020 2020 2073 7472 6970             strip
-00006c90: 655f 6163 636f 756e 743d 7374 7269 7065  e_account=stripe
-00006ca0: 5f61 6363 6f75 6e74 2c0a 2020 2020 2020  _account,.      
-00006cb0: 2020 2020 2020 2020 2020 292c 0a20 2020            ),.   
-00006cc0: 2020 2020 2020 2020 2020 2020 2054 7275               Tru
-00006cd0: 652c 0a20 2020 2020 2020 2020 2020 2029  e,.            )
-00006ce0: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
-00006cf0: 6f64 0a20 2020 2064 6566 2063 7265 6174  od.    def creat
-00006d00: 6528 636c 732c 2073 7562 7363 7269 6265  e(cls, subscribe
-00006d10: 722c 2069 6465 6d70 6f74 656e 6379 5f6b  r, idempotency_k
-00006d20: 6579 3d4e 6f6e 652c 2073 7472 6970 655f  ey=None, stripe_
-00006d30: 6163 636f 756e 743d 4e6f 6e65 293a 0a20  account=None):. 
-00006d40: 2020 2020 2020 206d 6574 6164 6174 6120         metadata 
-00006d50: 3d20 7b7d 0a20 2020 2020 2020 2073 7562  = {}.        sub
-00006d60: 7363 7269 6265 725f 6b65 7920 3d20 646a  scriber_key = dj
-00006d70: 7374 7269 7065 5f73 6574 7469 6e67 732e  stripe_settings.
-00006d80: 5355 4253 4352 4942 4552 5f43 5553 544f  SUBSCRIBER_CUSTO
-00006d90: 4d45 525f 4b45 590a 2020 2020 2020 2020  MER_KEY.        
-00006da0: 6966 2073 7562 7363 7269 6265 725f 6b65  if subscriber_ke
-00006db0: 7920 6e6f 7420 696e 2028 2222 2c20 4e6f  y not in ("", No
-00006dc0: 6e65 293a 0a20 2020 2020 2020 2020 2020  ne):.           
-00006dd0: 206d 6574 6164 6174 615b 7375 6273 6372   metadata[subscr
-00006de0: 6962 6572 5f6b 6579 5d20 3d20 7375 6273  iber_key] = subs
-00006df0: 6372 6962 6572 2e70 6b0a 0a20 2020 2020  criber.pk..     
-00006e00: 2020 2073 7472 6970 655f 6375 7374 6f6d     stripe_custom
-00006e10: 6572 203d 2063 6c73 2e5f 6170 695f 6372  er = cls._api_cr
-00006e20: 6561 7465 280a 2020 2020 2020 2020 2020  eate(.          
-00006e30: 2020 656d 6169 6c3d 7375 6273 6372 6962    email=subscrib
-00006e40: 6572 2e65 6d61 696c 2c0a 2020 2020 2020  er.email,.      
-00006e50: 2020 2020 2020 6964 656d 706f 7465 6e63        idempotenc
-00006e60: 795f 6b65 793d 6964 656d 706f 7465 6e63  y_key=idempotenc
-00006e70: 795f 6b65 792c 0a20 2020 2020 2020 2020  y_key,.         
-00006e80: 2020 206d 6574 6164 6174 613d 6d65 7461     metadata=meta
-00006e90: 6461 7461 2c0a 2020 2020 2020 2020 2020  data,.          
-00006ea0: 2020 7374 7269 7065 5f61 6363 6f75 6e74    stripe_account
-00006eb0: 3d73 7472 6970 655f 6163 636f 756e 742c  =stripe_account,
-00006ec0: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-00006ed0: 2020 2063 7573 746f 6d65 722c 2063 7265     customer, cre
-00006ee0: 6174 6564 203d 2043 7573 746f 6d65 722e  ated = Customer.
-00006ef0: 6f62 6a65 6374 732e 6765 745f 6f72 5f63  objects.get_or_c
-00006f00: 7265 6174 6528 0a20 2020 2020 2020 2020  reate(.         
-00006f10: 2020 2069 643d 7374 7269 7065 5f63 7573     id=stripe_cus
-00006f20: 746f 6d65 725b 2269 6422 5d2c 0a20 2020  tomer["id"],.   
-00006f30: 2020 2020 2020 2020 2064 6566 6175 6c74           default
-00006f40: 733d 7b0a 2020 2020 2020 2020 2020 2020  s={.            
-00006f50: 2020 2020 2273 7562 7363 7269 6265 7222      "subscriber"
-00006f60: 3a20 7375 6273 6372 6962 6572 2c0a 2020  : subscriber,.  
-00006f70: 2020 2020 2020 2020 2020 2020 2020 226c                "l
-00006f80: 6976 656d 6f64 6522 3a20 7374 7269 7065  ivemode": stripe
-00006f90: 5f63 7573 746f 6d65 725b 226c 6976 656d  _customer["livem
-00006fa0: 6f64 6522 5d2c 0a20 2020 2020 2020 2020  ode"],.         
-00006fb0: 2020 2020 2020 2022 6261 6c61 6e63 6522         "balance"
-00006fc0: 3a20 7374 7269 7065 5f63 7573 746f 6d65  : stripe_custome
-00006fd0: 722e 6765 7428 2262 616c 616e 6365 222c  r.get("balance",
-00006fe0: 2030 292c 0a20 2020 2020 2020 2020 2020   0),.           
-00006ff0: 2020 2020 2022 6465 6c69 6e71 7565 6e74       "delinquent
-00007000: 223a 2073 7472 6970 655f 6375 7374 6f6d  ": stripe_custom
-00007010: 6572 2e67 6574 2822 6465 6c69 6e71 7565  er.get("delinque
-00007020: 6e74 222c 2046 616c 7365 292c 0a20 2020  nt", False),.   
-00007030: 2020 2020 2020 2020 207d 2c0a 2020 2020           },.    
-00007040: 2020 2020 290a 0a20 2020 2020 2020 2072      )..        r
-00007050: 6574 7572 6e20 6375 7374 6f6d 6572 0a0a  eturn customer..
-00007060: 2020 2020 4070 726f 7065 7274 790a 2020      @property.  
-00007070: 2020 6465 6620 6372 6564 6974 7328 7365    def credits(se
-00007080: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
-00007090: 0a20 2020 2020 2020 2054 6865 2063 7573  .        The cus
-000070a0: 746f 6d65 7220 6973 2063 6f6e 7369 6465  tomer is conside
-000070b0: 7265 6420 746f 2068 6176 6520 6372 6564  red to have cred
-000070c0: 6974 7320 6966 2074 6865 6972 2062 616c  its if their bal
-000070d0: 616e 6365 2069 7320 6265 6c6f 7720 302e  ance is below 0.
-000070e0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000070f0: 2020 2020 2072 6574 7572 6e20 6162 7328       return abs(
-00007100: 6d69 6e28 7365 6c66 2e62 616c 616e 6365  min(self.balance
-00007110: 2c20 3029 290a 0a20 2020 2040 7072 6f70  , 0))..    @prop
-00007120: 6572 7479 0a20 2020 2064 6566 2063 7573  erty.    def cus
-00007130: 746f 6d65 725f 7061 796d 656e 745f 6d65  tomer_payment_me
-00007140: 7468 6f64 7328 7365 6c66 293a 0a20 2020  thods(self):.   
-00007150: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00007160: 2041 6e20 6974 6572 6162 6c65 206f 6620   An iterable of 
-00007170: 616c 6c20 6f66 2074 6865 2063 7573 746f  all of the custo
-00007180: 6d65 7227 7320 7061 796d 656e 7420 6d65  mer's payment me
-00007190: 7468 6f64 730a 2020 2020 2020 2020 2873  thods.        (s
-000071a0: 6f75 7263 6573 2c20 7468 656e 206c 6567  ources, then leg
-000071b0: 6163 7920 6361 7264 7329 0a20 2020 2020  acy cards).     
-000071c0: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
-000071d0: 6f72 2073 6f75 7263 6520 696e 2073 656c  or source in sel
-000071e0: 662e 736f 7572 6365 732e 6974 6572 6174  f.sources.iterat
-000071f0: 6f72 2829 3a0a 2020 2020 2020 2020 2020  or():.          
-00007200: 2020 7969 656c 6420 736f 7572 6365 0a0a    yield source..
-00007210: 2020 2020 2020 2020 666f 7220 6361 7264          for card
-00007220: 2069 6e20 7365 6c66 2e6c 6567 6163 795f   in self.legacy_
-00007230: 6361 7264 732e 6974 6572 6174 6f72 2829  cards.iterator()
-00007240: 3a0a 2020 2020 2020 2020 2020 2020 7969  :.            yi
-00007250: 656c 6420 6361 7264 0a0a 2020 2020 4070  eld card..    @p
-00007260: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
-00007270: 7065 6e64 696e 675f 6368 6172 6765 7328  pending_charges(
-00007280: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
-00007290: 2222 0a20 2020 2020 2020 2054 6865 2063  "".        The c
-000072a0: 7573 746f 6d65 7220 6973 2063 6f6e 7369  ustomer is consi
-000072b0: 6465 7265 6420 746f 2068 6176 6520 7065  dered to have pe
-000072c0: 6e64 696e 6720 6368 6172 6765 7320 6966  nding charges if
-000072d0: 2074 6865 6972 2062 616c 616e 6365 2069   their balance i
-000072e0: 7320 6162 6f76 6520 302e 0a20 2020 2020  s above 0..     
-000072f0: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
-00007300: 6574 7572 6e20 6d61 7828 7365 6c66 2e62  eturn max(self.b
-00007310: 616c 616e 6365 2c20 3029 0a0a 2020 2020  alance, 0)..    
-00007320: 6465 6620 7375 6273 6372 6962 6528 7365  def subscribe(se
-00007330: 6c66 2c20 2a2c 2069 7465 6d73 3d4e 6f6e  lf, *, items=Non
-00007340: 652c 2070 7269 6365 3d4e 6f6e 652c 2070  e, price=None, p
-00007350: 6c61 6e3d 4e6f 6e65 2c20 2a2a 6b77 6172  lan=None, **kwar
-00007360: 6773 293a 0a20 2020 2020 2020 2022 2222  gs):.        """
-00007370: 0a20 2020 2020 2020 2053 7562 7363 7269  .        Subscri
-00007380: 6265 7320 7468 6973 2063 7573 746f 6d65  bes this custome
-00007390: 7220 746f 2061 6c6c 2074 6865 2070 7269  r to all the pri
-000073a0: 6365 7320 6f72 2070 6c61 6e73 2069 6e20  ces or plans in 
-000073b0: 7468 6520 6974 656d 7320 6469 6374 2028  the items dict (
-000073c0: 5265 636f 6d6d 656e 6465 6429 2e0a 0a20  Recommended)... 
-000073d0: 2020 2020 2020 203a 7061 7261 6d20 6974         :param it
-000073e0: 656d 733a 2041 206c 6973 7420 6f66 2075  ems: A list of u
-000073f0: 7020 746f 2032 3020 7375 6273 6372 6970  p to 20 subscrip
-00007400: 7469 6f6e 2069 7465 6d73 2c20 6561 6368  tion items, each
-00007410: 2077 6974 6820 616e 2061 7474 6163 6865   with an attache
-00007420: 6420 7072 6963 650a 2020 2020 2020 2020  d price.        
-00007430: 3a74 7970 6520 6c69 7374 3a0a 2020 2020  :type list:.    
-00007440: 2020 2020 2020 2020 3a70 6172 616d 2069          :param i
-00007450: 7465 6d73 3a20 4120 6469 6374 696f 6e61  tems: A dictiona
-00007460: 7279 206f 6620 506c 616e 2028 6f72 2050  ry of Plan (or P
-00007470: 6c61 6e20 4944 2920 6f72 2050 7269 6365  lan ID) or Price
-00007480: 2028 6f72 2050 7269 6365 2049 4429 0a20   (or Price ID). 
-00007490: 2020 2020 2020 2020 2020 203a 7479 7065             :type
-000074a0: 2064 6963 743a 2020 5468 6520 7072 6963   dict:  The pric
-000074b0: 6520 6f72 2070 6c61 6e20 746f 2077 6869  e or plan to whi
-000074c0: 6368 2074 6f20 7375 6273 6372 6962 6520  ch to subscribe 
-000074d0: 7468 6520 6375 7374 6f6d 6572 2e0a 0a20  the customer... 
-000074e0: 2020 2020 2020 203a 7061 7261 6d20 7072         :param pr
-000074f0: 6963 653a 2054 6865 2070 7269 6365 2074  ice: The price t
-00007500: 6f20 7768 6963 6820 746f 2073 7562 7363  o which to subsc
-00007510: 7269 6265 2074 6865 2063 7573 746f 6d65  ribe the custome
-00007520: 722e 0a20 2020 2020 2020 203a 7479 7065  r..        :type
-00007530: 2070 7269 6365 3a20 5072 6963 6520 6f72   price: Price or
-00007540: 2073 7472 696e 6720 2870 7269 6365 2049   string (price I
-00007550: 4429 0a0a 2020 2020 2020 2020 3a70 6172  D)..        :par
-00007560: 616d 2070 6c61 6e3a 2054 6865 2070 6c61  am plan: The pla
-00007570: 6e20 746f 2077 6869 6368 2074 6f20 7375  n to which to su
-00007580: 6273 6372 6962 6520 7468 6520 6375 7374  bscribe the cust
-00007590: 6f6d 6572 2e0a 2020 2020 2020 2020 3a74  omer..        :t
-000075a0: 7970 6520 706c 616e 3a20 506c 616e 206f  ype plan: Plan o
-000075b0: 7220 7374 7269 6e67 2028 706c 616e 2049  r string (plan I
-000075c0: 4429 0a20 2020 2020 2020 2022 2222 0a20  D).        """. 
-000075d0: 2020 2020 2020 2066 726f 6d20 2e62 696c         from .bil
-000075e0: 6c69 6e67 2069 6d70 6f72 7420 5375 6273  ling import Subs
-000075f0: 6372 6970 7469 6f6e 0a0a 2020 2020 2020  cription..      
-00007600: 2020 6966 2028 6974 656d 7320 616e 6420    if (items and 
-00007610: 7072 6963 6529 206f 7220 2869 7465 6d73  price) or (items
-00007620: 2061 6e64 2070 6c61 6e29 206f 7220 2870   and plan) or (p
-00007630: 7269 6365 2061 6e64 2070 6c61 6e29 3a0a  rice and plan):.
-00007640: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00007650: 6520 5479 7065 4572 726f 7228 2250 6c65  e TypeError("Ple
-00007660: 6173 6520 6465 6669 6e65 206f 6e6c 7920  ase define only 
-00007670: 6f6e 6520 6f66 2069 7465 6d73 2c20 7072  one of items, pr
-00007680: 6963 6520 6f72 2070 6c61 6e20 6172 6775  ice or plan argu
-00007690: 6d65 6e74 732e 2229 0a0a 2020 2020 2020  ments.")..      
-000076a0: 2020 6966 2069 7465 6d73 2069 7320 4e6f    if items is No
-000076b0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-000076c0: 5f69 7465 6d73 203d 205b 7b22 7072 6963  _items = [{"pric
-000076d0: 6522 3a20 7072 6963 657d 5d0a 2020 2020  e": price}].    
-000076e0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-000076f0: 2020 2020 2020 5f69 7465 6d73 203d 205b        _items = [
-00007700: 5d0a 2020 2020 2020 2020 2020 2020 666f  ].            fo
-00007710: 7220 6974 656d 2069 6e20 6974 656d 733a  r item in items:
-00007720: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007730: 2070 7269 6365 203d 2069 7465 6d2e 6765   price = item.ge
-00007740: 7428 2270 7269 6365 222c 2022 2229 0a20  t("price", ""). 
-00007750: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00007760: 6c61 6e20 3d20 6974 656d 2e67 6574 2822  lan = item.get("
-00007770: 706c 616e 222c 2022 2229 0a20 2020 2020  plan", "").     
-00007780: 2020 2020 2020 2020 2020 2070 7269 6365             price
-00007790: 2c20 6b77 6172 6773 203d 205f 7361 6e69  , kwargs = _sani
-000077a0: 7469 7365 5f70 7269 6365 2870 7269 6365  tise_price(price
-000077b0: 2c20 706c 616e 2c20 2a2a 6b77 6172 6773  , plan, **kwargs
-000077c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000077d0: 2020 6966 2022 7072 6963 6522 2069 6e20    if "price" in 
-000077e0: 6974 656d 3a0a 2020 2020 2020 2020 2020  item:.          
-000077f0: 2020 2020 2020 2020 2020 5f69 7465 6d73            _items
-00007800: 2e61 7070 656e 6428 7b22 7072 6963 6522  .append({"price"
-00007810: 3a20 7072 6963 657d 290a 2020 2020 2020  : price}).      
-00007820: 2020 2020 2020 2020 2020 6966 2022 706c            if "pl
-00007830: 616e 2220 696e 2069 7465 6d3a 0a20 2020  an" in item:.   
-00007840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007850: 205f 6974 656d 732e 6170 7065 6e64 287b   _items.append({
-00007860: 2270 6c61 6e22 3a20 7072 6963 657d 290a  "plan": price}).
-00007870: 0a20 2020 2020 2020 2073 7472 6970 655f  .        stripe_
-00007880: 7375 6273 6372 6970 7469 6f6e 203d 2053  subscription = S
-00007890: 7562 7363 7269 7074 696f 6e2e 5f61 7069  ubscription._api
-000078a0: 5f63 7265 6174 6528 0a20 2020 2020 2020  _create(.       
-000078b0: 2020 2020 2069 7465 6d73 3d5f 6974 656d       items=_item
-000078c0: 732c 2063 7573 746f 6d65 723d 7365 6c66  s, customer=self
-000078d0: 2e69 642c 202a 2a6b 7761 7267 730a 2020  .id, **kwargs.  
-000078e0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-000078f0: 2061 7069 5f6b 6579 203d 206b 7761 7267   api_key = kwarg
-00007900: 732e 6765 7428 2261 7069 5f6b 6579 2229  s.get("api_key")
-00007910: 206f 7220 7365 6c66 2e64 6566 6175 6c74   or self.default
-00007920: 5f61 7069 5f6b 6579 0a20 2020 2020 2020  _api_key.       
-00007930: 2072 6574 7572 6e20 5375 6273 6372 6970   return Subscrip
-00007940: 7469 6f6e 2e73 796e 635f 6672 6f6d 5f73  tion.sync_from_s
-00007950: 7472 6970 655f 6461 7461 2873 7472 6970  tripe_data(strip
-00007960: 655f 7375 6273 6372 6970 7469 6f6e 2c20  e_subscription, 
-00007970: 6170 695f 6b65 793d 6170 695f 6b65 7929  api_key=api_key)
-00007980: 0a0a 2020 2020 6465 6620 6368 6172 6765  ..    def charge
-00007990: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
-000079a0: 2020 2020 2020 2020 616d 6f75 6e74 3a20          amount: 
-000079b0: 4465 6369 6d61 6c2c 0a20 2020 2020 2020  Decimal,.       
-000079c0: 202a 2c0a 2020 2020 2020 2020 6170 706c   *,.        appl
-000079d0: 6963 6174 696f 6e5f 6665 653a 2044 6563  ication_fee: Dec
-000079e0: 696d 616c 203d 204e 6f6e 652c 0a20 2020  imal = None,.   
-000079f0: 2020 2020 2073 6f75 7263 653a 2055 6e69       source: Uni
-00007a00: 6f6e 5b73 7472 2c20 5374 7269 7065 4d6f  on[str, StripeMo
-00007a10: 6465 6c5d 203d 204e 6f6e 652c 0a20 2020  del] = None,.   
-00007a20: 2020 2020 202a 2a6b 7761 7267 732c 0a20       **kwargs,. 
-00007a30: 2020 2029 202d 3e20 4368 6172 6765 3a0a     ) -> Charge:.
-00007a40: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00007a50: 2020 2020 4372 6561 7465 7320 6120 6368      Creates a ch
-00007a60: 6172 6765 2066 6f72 2074 6869 7320 6375  arge for this cu
-00007a70: 7374 6f6d 6572 2e0a 0a20 2020 2020 2020  stomer...       
-00007a80: 203a 7061 7261 6d20 616d 6f75 6e74 3a20   :param amount: 
-00007a90: 5468 6520 616d 6f75 6e74 2074 6f20 6368  The amount to ch
-00007aa0: 6172 6765 2e0a 2020 2020 2020 2020 3a74  arge..        :t
-00007ab0: 7970 6520 616d 6f75 6e74 3a20 4465 6369  ype amount: Deci
-00007ac0: 6d61 6c2e 2050 7265 6369 7369 6f6e 2069  mal. Precision i
-00007ad0: 7320 323b 2061 6e79 7468 696e 6720 6d6f  s 2; anything mo
-00007ae0: 7265 2077 696c 6c20 6265 2069 676e 6f72  re will be ignor
-00007af0: 6564 2e0a 2020 2020 2020 2020 3a70 6172  ed..        :par
-00007b00: 616d 2073 6f75 7263 653a 2054 6865 2073  am source: The s
-00007b10: 6f75 7263 6520 746f 2075 7365 2066 6f72  ource to use for
-00007b20: 2074 6869 7320 6368 6172 6765 2e0a 2020   this charge..  
-00007b30: 2020 2020 2020 2020 2020 4d75 7374 2062            Must b
-00007b40: 6520 6120 736f 7572 6365 2061 7474 7269  e a source attri
-00007b50: 6275 7465 6420 746f 2074 6869 7320 6375  buted to this cu
-00007b60: 7374 6f6d 6572 2e20 4966 204e 6f6e 652c  stomer. If None,
-00007b70: 2074 6865 2063 7573 746f 6d65 7227 730a   the customer's.
-00007b80: 2020 2020 2020 2020 2020 2020 6465 6661              defa
-00007b90: 756c 7420 736f 7572 6365 2069 7320 7573  ult source is us
-00007ba0: 6564 2e20 4361 6e20 6265 2065 6974 6865  ed. Can be eithe
-00007bb0: 7220 7468 6520 6964 206f 6620 7468 6520  r the id of the 
-00007bc0: 736f 7572 6365 206f 720a 2020 2020 2020  source or.      
-00007bd0: 2020 2020 2020 7468 6520 736f 7572 6365        the source
-00007be0: 206f 626a 6563 7420 6974 7365 6c66 2e0a   object itself..
-00007bf0: 2020 2020 2020 2020 3a74 7970 6520 736f          :type so
-00007c00: 7572 6365 3a20 7374 7269 6e67 2c20 536f  urce: string, So
-00007c10: 7572 6365 0a20 2020 2020 2020 2022 2222  urce.        """
-00007c20: 0a0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
-00007c30: 2069 7369 6e73 7461 6e63 6528 616d 6f75   isinstance(amou
-00007c40: 6e74 2c20 4465 6369 6d61 6c29 3a0a 2020  nt, Decimal):.  
-00007c50: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00007c60: 5661 6c75 6545 7272 6f72 2822 596f 7520  ValueError("You 
-00007c70: 6d75 7374 2073 7570 706c 7920 6120 6465  must supply a de
-00007c80: 6369 6d61 6c20 7661 6c75 6520 7265 7072  cimal value repr
-00007c90: 6573 656e 7469 6e67 2064 6f6c 6c61 7273  esenting dollars
-00007ca0: 2e22 290a 0a20 2020 2020 2020 2023 2043  .")..        # C
-00007cb0: 6f6e 7665 7274 2053 6f75 7263 6520 746f  onvert Source to
-00007cc0: 2069 640a 2020 2020 2020 2020 6966 2073   id.        if s
-00007cd0: 6f75 7263 6520 616e 6420 6973 696e 7374  ource and isinst
-00007ce0: 616e 6365 2873 6f75 7263 652c 2053 7472  ance(source, Str
-00007cf0: 6970 654d 6f64 656c 293a 0a20 2020 2020  ipeModel):.     
-00007d00: 2020 2020 2020 2073 6f75 7263 6520 3d20         source = 
-00007d10: 736f 7572 6365 2e69 640a 0a20 2020 2020  source.id..     
-00007d20: 2020 2073 7472 6970 655f 6368 6172 6765     stripe_charge
-00007d30: 203d 2043 6861 7267 652e 5f61 7069 5f63   = Charge._api_c
-00007d40: 7265 6174 6528 0a20 2020 2020 2020 2020  reate(.         
-00007d50: 2020 2063 7573 746f 6d65 723d 7365 6c66     customer=self
-00007d60: 2e69 642c 0a20 2020 2020 2020 2020 2020  .id,.           
-00007d70: 2061 6d6f 756e 743d 696e 7428 616d 6f75   amount=int(amou
-00007d80: 6e74 202a 2031 3030 292c 2020 2320 436f  nt * 100),  # Co
-00007d90: 6e76 6572 7420 646f 6c6c 6172 7320 696e  nvert dollars in
-00007da0: 746f 2063 656e 7473 0a20 2020 2020 2020  to cents.       
-00007db0: 2020 2020 2061 7070 6c69 6361 7469 6f6e       application
-00007dc0: 5f66 6565 3d69 6e74 2861 7070 6c69 6361  _fee=int(applica
-00007dd0: 7469 6f6e 5f66 6565 202a 2031 3030 290a  tion_fee * 100).
-00007de0: 2020 2020 2020 2020 2020 2020 6966 2061              if a
-00007df0: 7070 6c69 6361 7469 6f6e 5f66 6565 0a20  pplication_fee. 
-00007e00: 2020 2020 2020 2020 2020 2065 6c73 6520             else 
-00007e10: 4e6f 6e65 2c20 2023 2043 6f6e 7665 7274  None,  # Convert
-00007e20: 2064 6f6c 6c61 7273 2069 6e74 6f20 6365   dollars into ce
-00007e30: 6e74 730a 2020 2020 2020 2020 2020 2020  nts.            
-00007e40: 736f 7572 6365 3d73 6f75 7263 652c 0a20  source=source,. 
-00007e50: 2020 2020 2020 2020 2020 202a 2a6b 7761             **kwa
-00007e60: 7267 732c 0a20 2020 2020 2020 2029 0a0a  rgs,.        )..
-00007e70: 2020 2020 2020 2020 6170 695f 6b65 7920          api_key 
-00007e80: 3d20 6b77 6172 6773 2e67 6574 2822 6170  = kwargs.get("ap
-00007e90: 695f 6b65 7922 2920 6f72 2073 656c 662e  i_key") or self.
-00007ea0: 6465 6661 756c 745f 6170 695f 6b65 790a  default_api_key.
-00007eb0: 2020 2020 2020 2020 7265 7475 726e 2043          return C
-00007ec0: 6861 7267 652e 7379 6e63 5f66 726f 6d5f  harge.sync_from_
-00007ed0: 7374 7269 7065 5f64 6174 6128 7374 7269  stripe_data(stri
-00007ee0: 7065 5f63 6861 7267 652c 2061 7069 5f6b  pe_charge, api_k
-00007ef0: 6579 3d61 7069 5f6b 6579 290a 0a20 2020  ey=api_key)..   
-00007f00: 2064 6566 2061 6464 5f69 6e76 6f69 6365   def add_invoice
-00007f10: 5f69 7465 6d28 0a20 2020 2020 2020 2073  _item(.        s
-00007f20: 656c 662c 0a20 2020 2020 2020 2061 6d6f  elf,.        amo
-00007f30: 756e 742c 0a20 2020 2020 2020 2063 7572  unt,.        cur
-00007f40: 7265 6e63 792c 0a20 2020 2020 2020 2064  rency,.        d
-00007f50: 6573 6372 6970 7469 6f6e 3d4e 6f6e 652c  escription=None,
-00007f60: 0a20 2020 2020 2020 2064 6973 636f 756e  .        discoun
-00007f70: 7461 626c 653d 4e6f 6e65 2c0a 2020 2020  table=None,.    
-00007f80: 2020 2020 696e 766f 6963 653d 4e6f 6e65      invoice=None
-00007f90: 2c0a 2020 2020 2020 2020 6d65 7461 6461  ,.        metada
-00007fa0: 7461 3d4e 6f6e 652c 0a20 2020 2020 2020  ta=None,.       
-00007fb0: 2073 7562 7363 7269 7074 696f 6e3d 4e6f   subscription=No
-00007fc0: 6e65 2c0a 2020 2020 293a 0a20 2020 2020  ne,.    ):.     
-00007fd0: 2020 2022 2222 0a20 2020 2020 2020 2041     """.        A
-00007fe0: 6464 7320 616e 2061 7262 6974 7261 7279  dds an arbitrary
-00007ff0: 2063 6861 7267 6520 6f72 2063 7265 6469   charge or credi
-00008000: 7420 746f 2074 6865 2063 7573 746f 6d65  t to the custome
-00008010: 7227 7320 7570 636f 6d69 6e67 2069 6e76  r's upcoming inv
-00008020: 6f69 6365 2e0a 2020 2020 2020 2020 4469  oice..        Di
-00008030: 6666 6572 656e 7420 7468 616e 2063 7265  fferent than cre
-00008040: 6174 696e 6720 6120 6368 6172 6765 2e20  ating a charge. 
-00008050: 4368 6172 6765 7320 6172 6520 7365 7061  Charges are sepa
-00008060: 7261 7465 2062 696c 6c73 2074 6861 7420  rate bills that 
-00008070: 6765 740a 2020 2020 2020 2020 7072 6f63  get.        proc
-00008080: 6573 7365 6420 696d 6d65 6469 6174 656c  essed immediatel
-00008090: 792e 2049 6e76 6f69 6365 2069 7465 6d73  y. Invoice items
-000080a0: 2061 7265 2061 7070 656e 6465 6420 746f   are appended to
-000080b0: 2074 6865 2063 7573 746f 6d65 7227 7320   the customer's 
-000080c0: 6e65 7874 0a20 2020 2020 2020 2069 6e76  next.        inv
-000080d0: 6f69 6365 2e20 5468 6973 2069 7320 6578  oice. This is ex
-000080e0: 7472 656d 656c 7920 7573 6566 756c 2077  tremely useful w
-000080f0: 6865 6e20 6164 6469 6e67 2073 7572 6368  hen adding surch
-00008100: 6172 6765 7320 746f 2073 7562 7363 7269  arges to subscri
-00008110: 7074 696f 6e73 2e0a 0a20 2020 2020 2020  ptions...       
-00008120: 203a 7061 7261 6d20 616d 6f75 6e74 3a20   :param amount: 
-00008130: 5468 6520 616d 6f75 6e74 2074 6f20 6368  The amount to ch
-00008140: 6172 6765 2e0a 2020 2020 2020 2020 3a74  arge..        :t
-00008150: 7970 6520 616d 6f75 6e74 3a20 4465 6369  ype amount: Deci
-00008160: 6d61 6c2e 2050 7265 6369 7369 6f6e 2069  mal. Precision i
-00008170: 7320 323b 2061 6e79 7468 696e 6720 6d6f  s 2; anything mo
-00008180: 7265 2077 696c 6c20 6265 2069 676e 6f72  re will be ignor
-00008190: 6564 2e0a 2020 2020 2020 2020 3a70 6172  ed..        :par
-000081a0: 616d 2063 7572 7265 6e63 793a 2033 2d6c  am currency: 3-l
-000081b0: 6574 7465 7220 4953 4f20 636f 6465 2066  etter ISO code f
-000081c0: 6f72 2063 7572 7265 6e63 790a 2020 2020  or currency.    
-000081d0: 2020 2020 3a74 7970 6520 6375 7272 656e      :type curren
-000081e0: 6379 3a20 7374 7269 6e67 0a20 2020 2020  cy: string.     
-000081f0: 2020 203a 7061 7261 6d20 6465 7363 7269     :param descri
-00008200: 7074 696f 6e3a 2041 6e20 6172 6269 7472  ption: An arbitr
-00008210: 6172 7920 7374 7269 6e67 2e0a 2020 2020  ary string..    
-00008220: 2020 2020 3a74 7970 6520 6465 7363 7269      :type descri
-00008230: 7074 696f 6e3a 2073 7472 696e 670a 2020  ption: string.  
-00008240: 2020 2020 2020 3a70 6172 616d 2064 6973        :param dis
-00008250: 636f 756e 7461 626c 653a 2043 6f6e 7472  countable: Contr
-00008260: 6f6c 7320 7768 6574 6865 7220 6469 7363  ols whether disc
-00008270: 6f75 6e74 7320 6170 706c 7920 746f 2074  ounts apply to t
-00008280: 6869 7320 696e 766f 6963 6520 6974 656d  his invoice item
-00008290: 2e0a 2020 2020 2020 2020 2020 2020 4465  ..            De
-000082a0: 6661 756c 7473 2074 6f20 4661 6c73 6520  faults to False 
-000082b0: 666f 7220 7072 6f72 6174 696f 6e73 206f  for prorations o
-000082c0: 7220 6e65 6761 7469 7665 2069 6e76 6f69  r negative invoi
-000082d0: 6365 2069 7465 6d73 2c0a 2020 2020 2020  ce items,.      
-000082e0: 2020 2020 2020 616e 6420 5472 7565 2066        and True f
-000082f0: 6f72 2061 6c6c 206f 7468 6572 2069 6e76  or all other inv
-00008300: 6f69 6365 2069 7465 6d73 2e0a 2020 2020  oice items..    
-00008310: 2020 2020 3a74 7970 6520 6469 7363 6f75      :type discou
-00008320: 6e74 6162 6c65 3a20 626f 6f6c 6561 6e0a  ntable: boolean.
-00008330: 2020 2020 2020 2020 3a70 6172 616d 2069          :param i
-00008340: 6e76 6f69 6365 3a20 416e 2065 7869 7374  nvoice: An exist
-00008350: 696e 6720 696e 766f 6963 6520 746f 2061  ing invoice to a
-00008360: 6464 2074 6869 7320 696e 766f 6963 6520  dd this invoice 
-00008370: 6974 656d 2074 6f2e 0a20 2020 2020 2020  item to..       
-00008380: 2020 2020 2057 6865 6e20 6c65 6674 2062       When left b
-00008390: 6c61 6e6b 2c20 7468 6520 696e 766f 6963  lank, the invoic
-000083a0: 6520 6974 656d 2077 696c 6c20 6265 2061  e item will be a
-000083b0: 6464 6564 2074 6f20 7468 6520 6e65 7874  dded to the next
-000083c0: 2075 7063 6f6d 696e 6720 5c0a 2020 2020   upcoming \.    
-000083d0: 2020 2020 2020 2020 2073 6368 6564 756c           schedul
-000083e0: 6564 2069 6e76 6f69 6365 2e20 5c0a 2020  ed invoice. \.  
-000083f0: 2020 2020 2020 2020 2020 2055 7365 2074             Use t
-00008400: 6869 7320 7768 656e 2061 6464 696e 6720  his when adding 
-00008410: 696e 766f 6963 6520 6974 656d 7320 696e  invoice items in
-00008420: 2072 6573 706f 6e73 6520 746f 2061 6e20   response to an 
-00008430: 5c0a 2020 2020 2020 2020 2020 2020 2060  \.             `
-00008440: 6069 6e76 6f69 6365 2e63 7265 6174 6564  `invoice.created
-00008450: 6060 2077 6562 686f 6f6b 2e20 596f 7520  `` webhook. You 
-00008460: 6361 6e6e 6f74 2061 6464 2061 6e20 696e  cannot add an in
-00008470: 766f 6963 6520 5c0a 2020 2020 2020 2020  voice \.        
-00008480: 2020 2020 6974 656d 2074 6f20 616e 2069      item to an i
-00008490: 6e76 6f69 6365 2074 6861 7420 6861 7320  nvoice that has 
-000084a0: 616c 7265 6164 7920 6265 656e 2070 6169  already been pai
-000084b0: 642c 2061 7474 656d 7074 6564 206f 7220  d, attempted or 
-000084c0: 636c 6f73 6564 2e0a 2020 2020 2020 2020  closed..        
-000084d0: 3a74 7970 6520 696e 766f 6963 653a 2049  :type invoice: I
-000084e0: 6e76 6f69 6365 206f 7220 7374 7269 6e67  nvoice or string
-000084f0: 2028 696e 766f 6963 6520 4944 290a 2020   (invoice ID).  
-00008500: 2020 2020 2020 3a70 6172 616d 206d 6574        :param met
-00008510: 6164 6174 613a 2041 2073 6574 206f 6620  adata: A set of 
-00008520: 6b65 792f 7661 6c75 6520 7061 6972 7320  key/value pairs 
-00008530: 7573 6566 756c 2066 6f72 2073 746f 7269  useful for stori
-00008540: 6e67 0a20 2020 2020 2020 2020 2020 2061  ng.            a
-00008550: 6464 6974 696f 6e61 6c20 696e 666f 726d  dditional inform
-00008560: 6174 696f 6e2e 0a20 2020 2020 2020 203a  ation..        :
-00008570: 7479 7065 206d 6574 6164 6174 613a 2064  type metadata: d
-00008580: 6963 740a 2020 2020 2020 2020 3a70 6172  ict.        :par
-00008590: 616d 2073 7562 7363 7269 7074 696f 6e3a  am subscription:
-000085a0: 2041 2073 7562 7363 7269 7074 696f 6e20   A subscription 
-000085b0: 746f 2061 6464 2074 6869 7320 696e 766f  to add this invo
-000085c0: 6963 6520 6974 656d 2074 6f2e 0a20 2020  ice item to..   
-000085d0: 2020 2020 2020 2020 2057 6865 6e20 6c65           When le
-000085e0: 6674 2062 6c61 6e6b 2c20 7468 6520 696e  ft blank, the in
-000085f0: 766f 6963 6520 6974 656d 2077 696c 6c20  voice item will 
-00008600: 6265 2062 6520 6164 6465 6420 746f 2074  be be added to t
-00008610: 6865 206e 6578 7420 7570 636f 6d69 6e67  he next upcoming
-00008620: 205c 0a20 2020 2020 2020 2020 2020 2073   \.            s
-00008630: 6368 6564 756c 6564 2069 6e76 6f69 6365  cheduled invoice
-00008640: 2e20 5768 656e 2073 6574 2c20 7363 6865  . When set, sche
-00008650: 6475 6c65 6420 696e 766f 6963 6573 2066  duled invoices f
-00008660: 6f72 2073 7562 7363 7269 7074 696f 6e73  or subscriptions
-00008670: 206f 7468 6572 205c 0a20 2020 2020 2020   other \.       
-00008680: 2020 2020 2074 6861 6e20 7468 6520 7370       than the sp
-00008690: 6563 6966 6965 6420 7375 6273 6372 6970  ecified subscrip
-000086a0: 7469 6f6e 2077 696c 6c20 6967 6e6f 7265  tion will ignore
-000086b0: 2074 6865 2069 6e76 6f69 6365 2069 7465   the invoice ite
-000086c0: 6d2e 205c 0a20 2020 2020 2020 2020 2020  m. \.           
-000086d0: 2055 7365 2074 6869 7320 7768 656e 2079   Use this when y
-000086e0: 6f75 2077 616e 7420 746f 2065 7870 7265  ou want to expre
-000086f0: 7373 2074 6861 7420 616e 2069 6e76 6f69  ss that an invoi
-00008700: 6365 2069 7465 6d20 6861 7320 6265 656e  ce item has been
-00008710: 2061 6363 7275 6564 205c 0a20 2020 2020   accrued \.     
-00008720: 2020 2020 2020 2077 6974 6869 6e20 7468         within th
-00008730: 6520 636f 6e74 6578 7420 6f66 2061 2070  e context of a p
-00008740: 6172 7469 6375 6c61 7220 7375 6273 6372  articular subscr
-00008750: 6970 7469 6f6e 2e0a 2020 2020 2020 2020  iption..        
-00008760: 3a74 7970 6520 7375 6273 6372 6970 7469  :type subscripti
-00008770: 6f6e 3a20 5375 6273 6372 6970 7469 6f6e  on: Subscription
-00008780: 206f 7220 7374 7269 6e67 2028 7375 6273   or string (subs
-00008790: 6372 6970 7469 6f6e 2049 4429 0a0a 2020  cription ID)..  
-000087a0: 2020 2020 2020 2e2e 204e 6f74 6573 3a0a        .. Notes:.
-000087b0: 2020 2020 2020 2020 2e2e 2069 6620 796f          .. if yo
-000087c0: 7527 7265 2075 7369 6e67 2060 6043 7573  u're using ``Cus
-000087d0: 746f 6d65 722e 6164 645f 696e 766f 6963  tomer.add_invoic
-000087e0: 655f 6974 656d 2829 6060 2069 6e73 7465  e_item()`` inste
-000087f0: 6164 206f 660a 2020 2020 2020 2020 2e2e  ad of.        ..
-00008800: 2060 6043 7573 746f 6d65 722e 6164 645f   ``Customer.add_
-00008810: 696e 766f 6963 655f 6974 656d 2829 6060  invoice_item()``
-00008820: 2c20 6060 696e 766f 6963 6560 6020 616e  , ``invoice`` an
-00008830: 6420 6060 7375 6273 6372 6970 7469 6f6e  d ``subscription
-00008840: 7360 600a 2020 2020 2020 2020 2e2e 2063  s``.        .. c
-00008850: 616e 206f 6e6c 7920 6265 2073 7472 696e  an only be strin
-00008860: 6773 0a20 2020 2020 2020 2022 2222 0a20  gs.        """. 
-00008870: 2020 2020 2020 2066 726f 6d20 2e62 696c         from .bil
-00008880: 6c69 6e67 2069 6d70 6f72 7420 496e 766f  ling import Invo
-00008890: 6963 6549 7465 6d0a 0a20 2020 2020 2020  iceItem..       
-000088a0: 2069 6620 6e6f 7420 6973 696e 7374 616e   if not isinstan
-000088b0: 6365 2861 6d6f 756e 742c 2044 6563 696d  ce(amount, Decim
-000088c0: 616c 293a 0a20 2020 2020 2020 2020 2020  al):.           
-000088d0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-000088e0: 7228 2259 6f75 206d 7573 7420 7375 7070  r("You must supp
-000088f0: 6c79 2061 2064 6563 696d 616c 2076 616c  ly a decimal val
-00008900: 7565 2072 6570 7265 7365 6e74 696e 6720  ue representing 
-00008910: 646f 6c6c 6172 732e 2229 0a0a 2020 2020  dollars.")..    
-00008920: 2020 2020 2320 436f 6e76 6572 7420 496e      # Convert In
-00008930: 766f 6963 6520 746f 2069 640a 2020 2020  voice to id.    
-00008940: 2020 2020 6966 2069 6e76 6f69 6365 2069      if invoice i
-00008950: 7320 6e6f 7420 4e6f 6e65 2061 6e64 2069  s not None and i
-00008960: 7369 6e73 7461 6e63 6528 696e 766f 6963  sinstance(invoic
-00008970: 652c 2053 7472 6970 654d 6f64 656c 293a  e, StripeModel):
-00008980: 0a20 2020 2020 2020 2020 2020 2069 6e76  .            inv
-00008990: 6f69 6365 203d 2069 6e76 6f69 6365 2e69  oice = invoice.i
-000089a0: 640a 0a20 2020 2020 2020 2023 2043 6f6e  d..        # Con
-000089b0: 7665 7274 2053 7562 7363 7269 7074 696f  vert Subscriptio
-000089c0: 6e20 746f 2069 640a 2020 2020 2020 2020  n to id.        
-000089d0: 6966 2073 7562 7363 7269 7074 696f 6e20  if subscription 
-000089e0: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
-000089f0: 6973 696e 7374 616e 6365 2873 7562 7363  isinstance(subsc
-00008a00: 7269 7074 696f 6e2c 2053 7472 6970 654d  ription, StripeM
-00008a10: 6f64 656c 293a 0a20 2020 2020 2020 2020  odel):.         
-00008a20: 2020 2073 7562 7363 7269 7074 696f 6e20     subscription 
-00008a30: 3d20 7375 6273 6372 6970 7469 6f6e 2e69  = subscription.i
-00008a40: 640a 0a20 2020 2020 2020 2073 7472 6970  d..        strip
-00008a50: 655f 696e 766f 6963 6569 7465 6d20 3d20  e_invoiceitem = 
-00008a60: 496e 766f 6963 6549 7465 6d2e 5f61 7069  InvoiceItem._api
-00008a70: 5f63 7265 6174 6528 0a20 2020 2020 2020  _create(.       
-00008a80: 2020 2020 2061 6d6f 756e 743d 696e 7428       amount=int(
-00008a90: 616d 6f75 6e74 202a 2031 3030 292c 2020  amount * 100),  
-00008aa0: 2320 436f 6e76 6572 7420 646f 6c6c 6172  # Convert dollar
-00008ab0: 7320 696e 746f 2063 656e 7473 0a20 2020  s into cents.   
-00008ac0: 2020 2020 2020 2020 2063 7572 7265 6e63           currenc
-00008ad0: 793d 6375 7272 656e 6379 2c0a 2020 2020  y=currency,.    
-00008ae0: 2020 2020 2020 2020 6375 7374 6f6d 6572          customer
-00008af0: 3d73 656c 662e 6964 2c0a 2020 2020 2020  =self.id,.      
-00008b00: 2020 2020 2020 6465 7363 7269 7074 696f        descriptio
-00008b10: 6e3d 6465 7363 7269 7074 696f 6e2c 0a20  n=description,. 
-00008b20: 2020 2020 2020 2020 2020 2064 6973 636f             disco
-00008b30: 756e 7461 626c 653d 6469 7363 6f75 6e74  untable=discount
-00008b40: 6162 6c65 2c0a 2020 2020 2020 2020 2020  able,.          
-00008b50: 2020 696e 766f 6963 653d 696e 766f 6963    invoice=invoic
-00008b60: 652c 0a20 2020 2020 2020 2020 2020 206d  e,.            m
-00008b70: 6574 6164 6174 613d 6d65 7461 6461 7461  etadata=metadata
-00008b80: 2c0a 2020 2020 2020 2020 2020 2020 7375  ,.            su
-00008b90: 6273 6372 6970 7469 6f6e 3d73 7562 7363  bscription=subsc
-00008ba0: 7269 7074 696f 6e2c 0a20 2020 2020 2020  ription,.       
-00008bb0: 2029 0a0a 2020 2020 2020 2020 7265 7475   )..        retu
-00008bc0: 726e 2049 6e76 6f69 6365 4974 656d 2e73  rn InvoiceItem.s
-00008bd0: 796e 635f 6672 6f6d 5f73 7472 6970 655f  ync_from_stripe_
-00008be0: 6461 7461 280a 2020 2020 2020 2020 2020  data(.          
-00008bf0: 2020 7374 7269 7065 5f69 6e76 6f69 6365    stripe_invoice
-00008c00: 6974 656d 2c20 6170 695f 6b65 793d 7365  item, api_key=se
-00008c10: 6c66 2e64 6566 6175 6c74 5f61 7069 5f6b  lf.default_api_k
-00008c20: 6579 0a20 2020 2020 2020 2029 0a0a 2020  ey.        )..  
-00008c30: 2020 6465 6620 6164 645f 6361 7264 2873    def add_card(s
-00008c40: 656c 662c 2073 6f75 7263 652c 2073 6574  elf, source, set
-00008c50: 5f64 6566 6175 6c74 3d54 7275 6529 3a0a  _default=True):.
-00008c60: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00008c70: 2020 2020 4164 6473 2061 2063 6172 6420      Adds a card 
-00008c80: 746f 2074 6869 7320 6375 7374 6f6d 6572  to this customer
-00008c90: 2773 2061 6363 6f75 6e74 2e0a 0a20 2020  's account...   
-00008ca0: 2020 2020 203a 7061 7261 6d20 736f 7572       :param sour
-00008cb0: 6365 3a20 4569 7468 6572 2061 2074 6f6b  ce: Either a tok
-00008cc0: 656e 2c20 6c69 6b65 2074 6865 206f 6e65  en, like the one
-00008cd0: 7320 7265 7475 726e 6564 2062 7920 6f75  s returned by ou
-00008ce0: 7220 5374 7269 7065 2e6a 732c 206f 7220  r Stripe.js, or 
-00008cf0: 610a 2020 2020 2020 2020 2020 2020 6469  a.            di
-00008d00: 6374 696f 6e61 7279 2063 6f6e 7461 696e  ctionary contain
-00008d10: 696e 6720 6120 7573 6572 2773 2063 7265  ing a user's cre
-00008d20: 6469 7420 6361 7264 2064 6574 6169 6c73  dit card details
-00008d30: 2e0a 2020 2020 2020 2020 2020 2020 5374  ..            St
-00008d40: 7269 7065 2077 696c 6c20 6175 746f 6d61  ripe will automa
-00008d50: 7469 6361 6c6c 7920 7661 6c69 6461 7465  tically validate
-00008d60: 2074 6865 2063 6172 642e 0a20 2020 2020   the card..     
-00008d70: 2020 203a 7479 7065 2073 6f75 7263 653a     :type source:
-00008d80: 2073 7472 696e 672c 2064 6963 740a 2020   string, dict.  
-00008d90: 2020 2020 2020 3a70 6172 616d 2073 6574        :param set
-00008da0: 5f64 6566 6175 6c74 3a20 5768 6574 6865  _default: Whethe
-00008db0: 7220 6f72 206e 6f74 2074 6f20 7365 7420  r or not to set 
-00008dc0: 7468 6520 736f 7572 6365 2061 7320 7468  the source as th
-00008dd0: 6520 6375 7374 6f6d 6572 2773 0a20 2020  e customer's.   
-00008de0: 2020 2020 2020 2020 2064 6566 6175 6c74           default
-00008df0: 2073 6f75 7263 650a 2020 2020 2020 2020   source.        
-00008e00: 3a74 7970 6520 7365 745f 6465 6661 756c  :type set_defaul
-00008e10: 743a 2062 6f6f 6c65 616e 0a0a 2020 2020  t: boolean..    
-00008e20: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00008e30: 6672 6f6d 202e 7061 796d 656e 745f 6d65  from .payment_me
-00008e40: 7468 6f64 7320 696d 706f 7274 2044 6a73  thods import Djs
-00008e50: 7472 6970 6550 6179 6d65 6e74 4d65 7468  tripePaymentMeth
-00008e60: 6f64 0a0a 2020 2020 2020 2020 7374 7269  od..        stri
-00008e70: 7065 5f63 7573 746f 6d65 7220 3d20 7365  pe_customer = se
-00008e80: 6c66 2e61 7069 5f72 6574 7269 6576 6528  lf.api_retrieve(
-00008e90: 290a 2020 2020 2020 2020 6e65 775f 7374  ).        new_st
-00008ea0: 7269 7065 5f70 6179 6d65 6e74 5f6d 6574  ripe_payment_met
-00008eb0: 686f 6420 3d20 7374 7269 7065 5f63 7573  hod = stripe_cus
-00008ec0: 746f 6d65 722e 736f 7572 6365 732e 6372  tomer.sources.cr
-00008ed0: 6561 7465 2873 6f75 7263 653d 736f 7572  eate(source=sour
-00008ee0: 6365 290a 0a20 2020 2020 2020 2069 6620  ce)..        if 
-00008ef0: 7365 745f 6465 6661 756c 743a 0a20 2020  set_default:.   
-00008f00: 2020 2020 2020 2020 2073 7472 6970 655f           stripe_
-00008f10: 6375 7374 6f6d 6572 2e64 6566 6175 6c74  customer.default
-00008f20: 5f73 6f75 7263 6520 3d20 6e65 775f 7374  _source = new_st
-00008f30: 7269 7065 5f70 6179 6d65 6e74 5f6d 6574  ripe_payment_met
-00008f40: 686f 645b 2269 6422 5d0a 2020 2020 2020  hod["id"].      
-00008f50: 2020 2020 2020 7374 7269 7065 5f63 7573        stripe_cus
-00008f60: 746f 6d65 722e 7361 7665 2829 0a0a 2020  tomer.save()..  
-00008f70: 2020 2020 2020 6e65 775f 7061 796d 656e        new_paymen
-00008f80: 745f 6d65 7468 6f64 203d 2044 6a73 7472  t_method = Djstr
-00008f90: 6970 6550 6179 6d65 6e74 4d65 7468 6f64  ipePaymentMethod
-00008fa0: 2e66 726f 6d5f 7374 7269 7065 5f6f 626a  .from_stripe_obj
-00008fb0: 6563 7428 0a20 2020 2020 2020 2020 2020  ect(.           
-00008fc0: 206e 6577 5f73 7472 6970 655f 7061 796d   new_stripe_paym
-00008fd0: 656e 745f 6d65 7468 6f64 0a20 2020 2020  ent_method.     
-00008fe0: 2020 2029 0a0a 2020 2020 2020 2020 2320     )..        # 
-00008ff0: 4368 616e 6765 2074 6865 2064 6566 6175  Change the defau
-00009000: 6c74 2073 6f75 7263 650a 2020 2020 2020  lt source.      
-00009010: 2020 6966 2073 6574 5f64 6566 6175 6c74    if set_default
-00009020: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-00009030: 6c66 2e64 6566 6175 6c74 5f73 6f75 7263  lf.default_sourc
-00009040: 6520 3d20 6e65 775f 7061 796d 656e 745f  e = new_payment_
-00009050: 6d65 7468 6f64 0a20 2020 2020 2020 2020  method.         
-00009060: 2020 2073 656c 662e 7361 7665 2829 0a0a     self.save()..
-00009070: 2020 2020 2020 2020 7265 7475 726e 206e          return n
-00009080: 6577 5f70 6179 6d65 6e74 5f6d 6574 686f  ew_payment_metho
-00009090: 642e 7265 736f 6c76 6528 290a 0a20 2020  d.resolve()..   
-000090a0: 2064 6566 2061 6464 5f70 6179 6d65 6e74   def add_payment
-000090b0: 5f6d 6574 686f 6428 7365 6c66 2c20 7061  _method(self, pa
-000090c0: 796d 656e 745f 6d65 7468 6f64 2c20 7365  yment_method, se
-000090d0: 745f 6465 6661 756c 743d 5472 7565 293a  t_default=True):
-000090e0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000090f0: 2020 2020 2041 6464 7320 616e 2061 6c72       Adds an alr
-00009100: 6561 6479 2065 7869 7374 696e 6720 7061  eady existing pa
-00009110: 796d 656e 7420 6d65 7468 6f64 2074 6f20  yment method to 
-00009120: 7468 6973 2063 7573 746f 6d65 7227 7320  this customer's 
-00009130: 6163 636f 756e 740a 0a20 2020 2020 2020  account..       
-00009140: 203a 7061 7261 6d20 7061 796d 656e 745f   :param payment_
-00009150: 6d65 7468 6f64 3a20 5061 796d 656e 744d  method: PaymentM
-00009160: 6574 686f 6420 746f 2062 6520 6174 7461  ethod to be atta
-00009170: 6368 6564 2074 6f20 7468 6520 6375 7374  ched to the cust
-00009180: 6f6d 6572 0a20 2020 2020 2020 203a 7479  omer.        :ty
-00009190: 7065 2070 6179 6d65 6e74 5f6d 6574 686f  pe payment_metho
-000091a0: 643a 2073 7472 2c20 5061 796d 656e 744d  d: str, PaymentM
-000091b0: 6574 686f 640a 2020 2020 2020 2020 3a70  ethod.        :p
-000091c0: 6172 616d 2073 6574 5f64 6566 6175 6c74  aram set_default
-000091d0: 3a20 4966 2074 7275 652c 2074 6869 7320  : If true, this 
-000091e0: 7769 6c6c 2062 6520 7365 7420 6173 2074  will be set as t
-000091f0: 6865 2064 6566 6175 6c74 5f70 6179 6d65  he default_payme
-00009200: 6e74 5f6d 6574 686f 640a 2020 2020 2020  nt_method.      
-00009210: 2020 3a74 7970 6520 7365 745f 6465 6661    :type set_defa
-00009220: 756c 743a 2062 6f6f 6c0a 2020 2020 2020  ult: bool.      
-00009230: 2020 3a72 7479 7065 3a20 5061 796d 656e    :rtype: Paymen
-00009240: 744d 6574 686f 640a 2020 2020 2020 2020  tMethod.        
-00009250: 2222 220a 2020 2020 2020 2020 6672 6f6d  """.        from
-00009260: 202e 7061 796d 656e 745f 6d65 7468 6f64   .payment_method
-00009270: 7320 696d 706f 7274 2050 6179 6d65 6e74  s import Payment
-00009280: 4d65 7468 6f64 0a0a 2020 2020 2020 2020  Method..        
-00009290: 7374 7269 7065 5f63 7573 746f 6d65 7220  stripe_customer 
-000092a0: 3d20 7365 6c66 2e61 7069 5f72 6574 7269  = self.api_retri
-000092b0: 6576 6528 290a 2020 2020 2020 2020 7061  eve().        pa
-000092c0: 796d 656e 745f 6d65 7468 6f64 203d 2050  yment_method = P
-000092d0: 6179 6d65 6e74 4d65 7468 6f64 2e61 7474  aymentMethod.att
-000092e0: 6163 6828 7061 796d 656e 745f 6d65 7468  ach(payment_meth
-000092f0: 6f64 2c20 7374 7269 7065 5f63 7573 746f  od, stripe_custo
-00009300: 6d65 7229 0a0a 2020 2020 2020 2020 6966  mer)..        if
-00009310: 2073 6574 5f64 6566 6175 6c74 3a0a 2020   set_default:.  
-00009320: 2020 2020 2020 2020 2020 7374 7269 7065            stripe
-00009330: 5f63 7573 746f 6d65 725b 2269 6e76 6f69  _customer["invoi
-00009340: 6365 5f73 6574 7469 6e67 7322 5d5b 0a20  ce_settings"][. 
-00009350: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00009360: 6465 6661 756c 745f 7061 796d 656e 745f  default_payment_
-00009370: 6d65 7468 6f64 220a 2020 2020 2020 2020  method".        
-00009380: 2020 2020 5d20 3d20 7061 796d 656e 745f      ] = payment_
-00009390: 6d65 7468 6f64 2e69 640a 2020 2020 2020  method.id.      
-000093a0: 2020 2020 2020 7374 7269 7065 5f63 7573        stripe_cus
-000093b0: 746f 6d65 722e 7361 7665 2829 0a0a 2020  tomer.save()..  
-000093c0: 2020 2020 2020 2020 2020 2320 5265 6672            # Refr
-000093d0: 6573 6820 7365 6c66 2066 726f 6d20 7468  esh self from th
-000093e0: 6520 7374 7269 7065 2063 7573 746f 6d65  e stripe custome
-000093f0: 722c 2074 6869 7320 7368 6f75 6c64 2068  r, this should h
-00009400: 6176 6520 7477 6f20 6566 6665 6374 733a  ave two effects:
-00009410: 0a20 2020 2020 2020 2020 2020 2023 2031  .            # 1
-00009420: 2920 7365 7473 2073 656c 662e 6465 6661  ) sets self.defa
-00009430: 756c 745f 7061 796d 656e 745f 6d65 7468  ult_payment_meth
-00009440: 6f64 2028 7765 2072 656c 7920 6f6e 206c  od (we rely on l
-00009450: 6f67 6963 2069 6e0a 2020 2020 2020 2020  ogic in.        
-00009460: 2020 2020 2320 4375 7374 6f6d 6572 2e5f      # Customer._
-00009470: 6d61 6e69 7075 6c61 7465 5f73 7472 6970  manipulate_strip
-00009480: 655f 6f62 6a65 6374 5f68 6f6f 6b20 746f  e_object_hook to
-00009490: 2064 6f20 7468 6973 290a 2020 2020 2020   do this).      
-000094a0: 2020 2020 2020 2320 3229 2075 7064 6174        # 2) updat
-000094b0: 6573 2073 656c 662e 696e 766f 6963 655f  es self.invoice_
-000094c0: 7365 7474 696e 6773 2e64 6566 6175 6c74  settings.default
-000094d0: 5f70 6179 6d65 6e74 5f6d 6574 686f 6473  _payment_methods
-000094e0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000094f0: 662e 7379 6e63 5f66 726f 6d5f 7374 7269  f.sync_from_stri
-00009500: 7065 5f64 6174 6128 7374 7269 7065 5f63  pe_data(stripe_c
-00009510: 7573 746f 6d65 722c 2061 7069 5f6b 6579  ustomer, api_key
-00009520: 3d73 656c 662e 6465 6661 756c 745f 6170  =self.default_ap
-00009530: 695f 6b65 7929 0a20 2020 2020 2020 2020  i_key).         
-00009540: 2020 2073 656c 662e 7265 6672 6573 685f     self.refresh_
-00009550: 6672 6f6d 5f64 6228 290a 0a20 2020 2020  from_db()..     
-00009560: 2020 2072 6574 7572 6e20 7061 796d 656e     return paymen
-00009570: 745f 6d65 7468 6f64 0a0a 2020 2020 6465  t_method..    de
-00009580: 6620 7075 7267 6528 7365 6c66 293a 0a20  f purge(self):. 
-00009590: 2020 2020 2020 2022 2222 4375 7374 6f6d         """Custom
-000095a0: 6572 7320 6172 6520 736f 6674 2064 656c  ers are soft del
-000095b0: 6574 6564 2061 7320 6465 6c65 7465 6420  eted as deleted 
-000095c0: 6375 7374 6f6d 6572 7320 6172 6520 7374  customers are st
-000095d0: 696c 6c20 6163 6365 7373 6962 6c65 2062  ill accessible b
-000095e0: 7920 7468 650a 2020 2020 2020 2020 5374  y the.        St
-000095f0: 7269 7065 2041 5049 2061 6e64 2073 796e  ripe API and syn
-00009600: 6320 666f 7220 616c 6c20 5265 6c61 7465  c for all Relate
-00009610: 644d 6f64 656c 7320 776f 756c 6420 6661  dModels would fa
-00009620: 696c 2222 220a 2020 2020 2020 2020 7472  il""".        tr
-00009630: 793a 0a20 2020 2020 2020 2020 2020 2073  y:.            s
-00009640: 656c 662e 5f61 7069 5f64 656c 6574 6528  elf._api_delete(
-00009650: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
-00009660: 2049 6e76 616c 6964 5265 7175 6573 7445   InvalidRequestE
-00009670: 7272 6f72 2061 7320 6578 633a 0a20 2020  rror as exc:.   
-00009680: 2020 2020 2020 2020 2069 6620 224e 6f20           if "No 
-00009690: 7375 6368 2063 7573 746f 6d65 723a 2220  such customer:" 
-000096a0: 696e 2073 7472 2865 7863 293a 0a20 2020  in str(exc):.   
-000096b0: 2020 2020 2020 2020 2020 2020 2023 2054               # T
-000096c0: 6865 2065 7863 6570 7469 6f6e 2077 6173  he exception was
-000096d0: 2074 6872 6f77 6e20 6265 6361 7573 6520   thrown because 
-000096e0: 7468 6520 7374 7269 7065 2063 7573 746f  the stripe custo
-000096f0: 6d65 7220 7761 7320 616c 7265 6164 790a  mer was already.
-00009700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009710: 2320 6465 6c65 7465 6420 6f6e 2074 6865  # deleted on the
-00009720: 2073 7472 6970 6520 7369 6465 2c20 6967   stripe side, ig
-00009730: 6e6f 7265 2074 6865 2065 7863 6570 7469  nore the excepti
-00009740: 6f6e 0a20 2020 2020 2020 2020 2020 2020  on.             
-00009750: 2020 2070 6173 730a 2020 2020 2020 2020     pass.        
-00009760: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00009770: 2020 2020 2020 2020 2020 2320 5468 6520            # The 
-00009780: 6578 6365 7074 696f 6e20 7761 7320 7261  exception was ra
-00009790: 6973 6564 2066 6f72 2061 6e6f 7468 6572  ised for another
-000097a0: 2072 6561 736f 6e2c 2072 652d 7261 6973   reason, re-rais
-000097b0: 6520 6974 0a20 2020 2020 2020 2020 2020  e it.           
-000097c0: 2020 2020 2072 6169 7365 0a0a 2020 2020       raise..    
-000097d0: 2020 2020 2320 746f 6767 6c65 2074 6865      # toggle the
-000097e0: 2064 656c 6574 6564 2066 6c61 6720 6f6e   deleted flag on
-000097f0: 2043 7573 746f 6d65 7220 746f 2069 6e64   Customer to ind
-00009800: 6963 6174 6520 6974 2068 6173 2062 6565  icate it has bee
-00009810: 6e0a 2020 2020 2020 2020 2320 6465 6c65  n.        # dele
-00009820: 7465 6420 7570 7374 7265 616d 2069 6e20  ted upstream in 
-00009830: 5374 7269 7065 0a20 2020 2020 2020 2073  Stripe.        s
-00009840: 656c 662e 6465 6c65 7465 6420 3d20 5472  elf.deleted = Tr
-00009850: 7565 0a0a 2020 2020 2020 2020 6966 2073  ue..        if s
-00009860: 656c 662e 7375 6273 6372 6962 6572 3a0a  elf.subscriber:.
-00009870: 2020 2020 2020 2020 2020 2020 2320 4465              # De
-00009880: 6c65 7465 2074 6865 2069 6465 6d70 6f74  lete the idempot
-00009890: 656e 6379 206b 6579 2075 7365 6420 6279  ency key used by
-000098a0: 2043 7573 746f 6d65 722e 6372 6561 7465   Customer.create
-000098b0: 2829 0a20 2020 2020 2020 2020 2020 2023  ().            #
-000098c0: 2053 6f20 7265 2d63 7265 6174 696e 6720   So re-creating 
-000098d0: 6120 6375 7374 6f6d 6572 2066 6f72 2074  a customer for t
-000098e0: 6869 7320 7375 6273 6372 6962 6572 2062  his subscriber b
-000098f0: 6566 6f72 6520 7468 6520 6b65 7920 6578  efore the key ex
-00009900: 7069 7265 730a 2020 2020 2020 2020 2020  pires.          
-00009910: 2020 2320 646f 6573 6e27 7420 7265 7475    # doesn't retu
-00009920: 726e 2074 6865 206f 6c64 6572 2043 7573  rn the older Cus
-00009930: 746f 6d65 7220 6461 7461 0a20 2020 2020  tomer data.     
-00009940: 2020 2020 2020 2069 6465 6d70 6f74 656e         idempoten
-00009950: 6379 5f6b 6579 5f61 6374 696f 6e20 3d20  cy_key_action = 
-00009960: 2263 7573 746f 6d65 723a 6372 6561 7465  "customer:create
-00009970: 3a7b 7d22 2e66 6f72 6d61 7428 7365 6c66  :{}".format(self
-00009980: 2e73 7562 7363 7269 6265 722e 706b 290a  .subscriber.pk).
-00009990: 2020 2020 2020 2020 2020 2020 4964 656d              Idem
-000099a0: 706f 7465 6e63 794b 6579 2e6f 626a 6563  potencyKey.objec
-000099b0: 7473 2e66 696c 7465 7228 6163 7469 6f6e  ts.filter(action
-000099c0: 3d69 6465 6d70 6f74 656e 6379 5f6b 6579  =idempotency_key
-000099d0: 5f61 6374 696f 6e29 2e64 656c 6574 6528  _action).delete(
-000099e0: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-000099f0: 7375 6273 6372 6962 6572 203d 204e 6f6e  subscriber = Non
-00009a00: 650a 0a20 2020 2020 2020 2023 2052 656d  e..        # Rem
-00009a10: 6f76 6520 736f 7572 6365 730a 2020 2020  ove sources.    
-00009a20: 2020 2020 7365 6c66 2e64 6566 6175 6c74      self.default
-00009a30: 5f73 6f75 7263 6520 3d20 4e6f 6e65 0a20  _source = None. 
-00009a40: 2020 2020 2020 2066 6f72 2073 6f75 7263         for sourc
-00009a50: 6520 696e 2073 656c 662e 6c65 6761 6379  e in self.legacy
-00009a60: 5f63 6172 6473 2e61 6c6c 2829 3a0a 2020  _cards.all():.  
-00009a70: 2020 2020 2020 2020 2020 736f 7572 6365            source
-00009a80: 2e72 656d 6f76 6528 290a 0a20 2020 2020  .remove()..     
-00009a90: 2020 2066 6f72 2073 6f75 7263 6520 696e     for source in
-00009aa0: 2073 656c 662e 736f 7572 6365 732e 616c   self.sources.al
-00009ab0: 6c28 293a 0a20 2020 2020 2020 2020 2020  l():.           
-00009ac0: 2073 6f75 7263 652e 6465 7461 6368 2829   source.detach()
-00009ad0: 0a0a 2020 2020 2020 2020 7365 6c66 2e64  ..        self.d
-00009ae0: 6174 655f 7075 7267 6564 203d 2074 696d  ate_purged = tim
-00009af0: 657a 6f6e 652e 6e6f 7728 290a 2020 2020  ezone.now().    
-00009b00: 2020 2020 7365 6c66 2e73 6176 6528 290a      self.save().
-00009b10: 0a20 2020 2064 6566 205f 6765 745f 7661  .    def _get_va
-00009b20: 6c69 645f 7375 6273 6372 6970 7469 6f6e  lid_subscription
-00009b30: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
-00009b40: 2022 2222 4765 7420 6120 6c69 7374 206f   """Get a list o
-00009b50: 6620 7468 6973 2063 7573 746f 6d65 7227  f this customer'
-00009b60: 7320 7661 6c69 6420 7375 6273 6372 6970  s valid subscrip
-00009b70: 7469 6f6e 732e 2222 220a 0a20 2020 2020  tions."""..     
-00009b80: 2020 2072 6574 7572 6e20 5b0a 2020 2020     return [.    
-00009b90: 2020 2020 2020 2020 7375 6273 6372 6970          subscrip
-00009ba0: 7469 6f6e 0a20 2020 2020 2020 2020 2020  tion.           
-00009bb0: 2066 6f72 2073 7562 7363 7269 7074 696f   for subscriptio
-00009bc0: 6e20 696e 2073 656c 662e 7375 6273 6372  n in self.subscr
-00009bd0: 6970 7469 6f6e 732e 616c 6c28 290a 2020  iptions.all().  
-00009be0: 2020 2020 2020 2020 2020 6966 2073 7562            if sub
-00009bf0: 7363 7269 7074 696f 6e2e 6973 5f76 616c  scription.is_val
-00009c00: 6964 2829 0a20 2020 2020 2020 205d 0a0a  id().        ]..
-00009c10: 2020 2020 6465 6620 6973 5f73 7562 7363      def is_subsc
-00009c20: 7269 6265 645f 746f 2873 656c 662c 2070  ribed_to(self, p
-00009c30: 726f 6475 6374 3a20 556e 696f 6e5b 5072  roduct: Union[Pr
-00009c40: 6f64 7563 742c 2073 7472 5d29 202d 3e20  oduct, str]) -> 
-00009c50: 626f 6f6c 3a0a 2020 2020 2020 2020 2222  bool:.        ""
-00009c60: 220a 2020 2020 2020 2020 4368 6563 6b73  ".        Checks
-00009c70: 2074 6f20 7365 6520 6966 2074 6869 7320   to see if this 
-00009c80: 6375 7374 6f6d 6572 2068 6173 2061 6e20  customer has an 
-00009c90: 6163 7469 7665 2073 7562 7363 7269 7074  active subscript
-00009ca0: 696f 6e20 746f 2074 6865 2067 6976 656e  ion to the given
-00009cb0: 2070 726f 6475 6374 2e0a 0a20 2020 2020   product...     
-00009cc0: 2020 203a 7061 7261 6d20 7072 6f64 7563     :param produc
-00009cd0: 743a 2054 6865 2070 726f 6475 6374 2066  t: The product f
-00009ce0: 6f72 2077 6869 6368 2074 6f20 6368 6563  or which to chec
-00009cf0: 6b20 666f 7220 616e 2061 6374 6976 6520  k for an active 
-00009d00: 7375 6273 6372 6970 7469 6f6e 2e0a 2020  subscription..  
-00009d10: 2020 2020 2020 3a74 7970 6520 7072 6f64        :type prod
-00009d20: 7563 743a 2050 726f 6475 6374 206f 7220  uct: Product or 
-00009d30: 7374 7269 6e67 2028 7072 6f64 7563 7420  string (product 
-00009d40: 4944 290a 0a20 2020 2020 2020 203a 7265  ID)..        :re
-00009d50: 7475 726e 733a 2054 7275 6520 6966 2074  turns: True if t
-00009d60: 6865 7265 2065 7869 7374 7320 616e 2061  here exists an a
-00009d70: 6374 6976 6520 7375 6273 6372 6970 7469  ctive subscripti
-00009d80: 6f6e 2c20 4661 6c73 6520 6f74 6865 7277  on, False otherw
-00009d90: 6973 652e 0a20 2020 2020 2020 2022 2222  ise..        """
-00009da0: 0a0a 2020 2020 2020 2020 6966 2069 7369  ..        if isi
-00009db0: 6e73 7461 6e63 6528 7072 6f64 7563 742c  nstance(product,
-00009dc0: 2053 7472 6970 654d 6f64 656c 293a 0a20   StripeModel):. 
-00009dd0: 2020 2020 2020 2020 2020 2070 726f 6475             produ
-00009de0: 6374 203d 2070 726f 6475 6374 2e69 640a  ct = product.id.
-00009df0: 0a20 2020 2020 2020 2066 6f72 2073 7562  .        for sub
-00009e00: 7363 7269 7074 696f 6e20 696e 2073 656c  scription in sel
-00009e10: 662e 5f67 6574 5f76 616c 6964 5f73 7562  f._get_valid_sub
-00009e20: 7363 7269 7074 696f 6e73 2829 3a0a 2020  scriptions():.  
-00009e30: 2020 2020 2020 2020 2020 666f 7220 6974            for it
-00009e40: 656d 2069 6e20 7375 6273 6372 6970 7469  em in subscripti
-00009e50: 6f6e 2e69 7465 6d73 2e61 6c6c 2829 3a0a  on.items.all():.
-00009e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009e70: 6966 2069 7465 6d2e 7072 6963 6520 616e  if item.price an
-00009e80: 6420 6974 656d 2e70 7269 6365 2e70 726f  d item.price.pro
-00009e90: 6475 6374 2e69 6420 3d3d 2070 726f 6475  duct.id == produ
-00009ea0: 6374 3a0a 2020 2020 2020 2020 2020 2020  ct:.            
-00009eb0: 2020 2020 2020 2020 7265 7475 726e 2054          return T
-00009ec0: 7275 650a 2020 2020 2020 2020 7265 7475  rue.        retu
-00009ed0: 726e 2046 616c 7365 0a0a 2020 2020 6465  rn False..    de
-00009ee0: 6620 6861 735f 616e 795f 6163 7469 7665  f has_any_active
-00009ef0: 5f73 7562 7363 7269 7074 696f 6e28 7365  _subscription(se
-00009f00: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
-00009f10: 0a20 2020 2020 2020 2043 6865 636b 7320  .        Checks 
-00009f20: 746f 2073 6565 2069 6620 7468 6973 2063  to see if this c
-00009f30: 7573 746f 6d65 7220 6861 7320 616e 2061  ustomer has an a
-00009f40: 6374 6976 6520 7375 6273 6372 6970 7469  ctive subscripti
-00009f50: 6f6e 2074 6f20 616e 7920 706c 616e 2e0a  on to any plan..
-00009f60: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
-00009f70: 733a 2054 7275 6520 6966 2074 6865 7265  s: True if there
-00009f80: 2065 7869 7374 7320 616e 2061 6374 6976   exists an activ
-00009f90: 6520 7375 6273 6372 6970 7469 6f6e 2c20  e subscription, 
-00009fa0: 4661 6c73 6520 6f74 6865 7277 6973 652e  False otherwise.
-00009fb0: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
-00009fc0: 2020 2020 2020 7265 7475 726e 206c 656e        return len
-00009fd0: 2873 656c 662e 5f67 6574 5f76 616c 6964  (self._get_valid
-00009fe0: 5f73 7562 7363 7269 7074 696f 6e73 2829  _subscriptions()
-00009ff0: 2920 213d 2030 0a0a 2020 2020 4070 726f  ) != 0..    @pro
-0000a000: 7065 7274 790a 2020 2020 6465 6620 6163  perty.    def ac
-0000a010: 7469 7665 5f73 7562 7363 7269 7074 696f  tive_subscriptio
-0000a020: 6e73 2873 656c 6629 3a0a 2020 2020 2020  ns(self):.      
-0000a030: 2020 2222 220a 2020 2020 2020 2020 5265    """.        Re
-0000a040: 7475 726e 7320 6163 7469 7665 2073 7562  turns active sub
-0000a050: 7363 7269 7074 696f 6e73 0a20 2020 2020  scriptions.     
-0000a060: 2020 2028 7375 6273 6372 6970 7469 6f6e     (subscription
-0000a070: 7320 7769 7468 2061 6e20 6163 7469 7665  s with an active
-0000a080: 2073 7461 7475 7320 7468 6174 2065 6e64   status that end
-0000a090: 2069 6e20 7468 6520 6675 7475 7265 292e   in the future).
-0000a0a0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000a0b0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0000a0c0: 2e73 7562 7363 7269 7074 696f 6e73 2e66  .subscriptions.f
-0000a0d0: 696c 7465 7228 0a20 2020 2020 2020 2020  ilter(.         
-0000a0e0: 2020 2073 7461 7475 733d 656e 756d 732e     status=enums.
-0000a0f0: 5375 6273 6372 6970 7469 6f6e 5374 6174  SubscriptionStat
-0000a100: 7573 2e61 6374 6976 652c 0a20 2020 2020  us.active,.     
-0000a110: 2020 2020 2020 2063 7572 7265 6e74 5f70         current_p
-0000a120: 6572 696f 645f 656e 645f 5f67 743d 7469  eriod_end__gt=ti
-0000a130: 6d65 7a6f 6e65 2e6e 6f77 2829 2c0a 2020  mezone.now(),.  
-0000a140: 2020 2020 2020 290a 0a20 2020 2040 7072        )..    @pr
-0000a150: 6f70 6572 7479 0a20 2020 2064 6566 2076  operty.    def v
-0000a160: 616c 6964 5f73 7562 7363 7269 7074 696f  alid_subscriptio
-0000a170: 6e73 2873 656c 6629 3a0a 2020 2020 2020  ns(self):.      
-0000a180: 2020 2222 220a 2020 2020 2020 2020 5265    """.        Re
-0000a190: 7475 726e 7320 7468 6973 2063 7573 746f  turns this custo
-0000a1a0: 6d65 7227 7320 7661 6c69 6420 7375 6273  mer's valid subs
-0000a1b0: 6372 6970 7469 6f6e 730a 2020 2020 2020  criptions.      
-0000a1c0: 2020 2873 7562 7363 7269 7074 696f 6e73    (subscriptions
-0000a1d0: 2074 6861 7420 6172 656e 2774 2063 616e   that aren't can
-0000a1e0: 6365 6c65 6420 6f72 2069 6e63 6f6d 706c  celed or incompl
-0000a1f0: 6574 655f 6578 7069 7265 6429 2e0a 2020  ete_expired)..  
-0000a200: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000a210: 2020 7265 7475 726e 2073 656c 662e 7375    return self.su
-0000a220: 6273 6372 6970 7469 6f6e 732e 6578 636c  bscriptions.excl
-0000a230: 7564 6528 0a20 2020 2020 2020 2020 2020  ude(.           
-0000a240: 2073 7461 7475 735f 5f69 6e3d 5b0a 2020   status__in=[.  
-0000a250: 2020 2020 2020 2020 2020 2020 2020 656e                en
-0000a260: 756d 732e 5375 6273 6372 6970 7469 6f6e  ums.Subscription
-0000a270: 5374 6174 7573 2e63 616e 6365 6c65 642c  Status.canceled,
-0000a280: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a290: 2065 6e75 6d73 2e53 7562 7363 7269 7074   enums.Subscript
-0000a2a0: 696f 6e53 7461 7475 732e 696e 636f 6d70  ionStatus.incomp
-0000a2b0: 6c65 7465 5f65 7870 6972 6564 2c0a 2020  lete_expired,.  
-0000a2c0: 2020 2020 2020 2020 2020 5d0a 2020 2020            ].    
-0000a2d0: 2020 2020 290a 0a20 2020 2040 7072 6f70      )..    @prop
-0000a2e0: 6572 7479 0a20 2020 2064 6566 2073 7562  erty.    def sub
-0000a2f0: 7363 7269 7074 696f 6e28 7365 6c66 293a  scription(self):
-0000a300: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000a310: 2020 2020 2053 686f 7274 6375 7420 746f       Shortcut to
-0000a320: 2067 6574 2074 6869 7320 6375 7374 6f6d   get this custom
-0000a330: 6572 2773 2073 7562 7363 7269 7074 696f  er's subscriptio
-0000a340: 6e2e 0a0a 2020 2020 2020 2020 3a72 6574  n...        :ret
-0000a350: 7572 6e73 3a20 4e6f 6e65 2069 6620 7468  urns: None if th
-0000a360: 6520 6375 7374 6f6d 6572 2068 6173 206e  e customer has n
-0000a370: 6f20 7375 6273 6372 6970 7469 6f6e 732c  o subscriptions,
-0000a380: 2074 6865 2073 7562 7363 7269 7074 696f   the subscriptio
-0000a390: 6e20 6966 0a20 2020 2020 2020 2020 2020  n if.           
-0000a3a0: 2074 6865 2063 7573 746f 6d65 7220 6861   the customer ha
-0000a3b0: 7320 6120 7375 6273 6372 6970 7469 6f6e  s a subscription
-0000a3c0: 2e0a 2020 2020 2020 2020 3a72 6169 7365  ..        :raise
-0000a3d0: 7320 4d75 6c74 6970 6c65 5375 6273 6372  s MultipleSubscr
-0000a3e0: 6970 7469 6f6e 4578 6365 7074 696f 6e3a  iptionException:
-0000a3f0: 2052 6169 7365 6420 6966 2074 6865 2063   Raised if the c
-0000a400: 7573 746f 6d65 7220 6861 7320 6d75 6c74  ustomer has mult
-0000a410: 6970 6c65 0a20 2020 2020 2020 2020 2020  iple.           
-0000a420: 2073 7562 7363 7269 7074 696f 6e73 2e0a   subscriptions..
-0000a430: 2020 2020 2020 2020 2020 2020 496e 2074              In t
-0000a440: 6869 7320 6361 7365 2c20 7573 6520 6060  his case, use ``
-0000a450: 4375 7374 6f6d 6572 2e73 7562 7363 7269  Customer.subscri
-0000a460: 7074 696f 6e73 6060 2069 6e73 7465 6164  ptions`` instead
-0000a470: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
-0000a480: 2020 2020 2020 2073 7562 7363 7269 7074         subscript
-0000a490: 696f 6e73 203d 2073 656c 662e 7661 6c69  ions = self.vali
-0000a4a0: 645f 7375 6273 6372 6970 7469 6f6e 730a  d_subscriptions.
-0000a4b0: 0a20 2020 2020 2020 2069 6620 7375 6273  .        if subs
-0000a4c0: 6372 6970 7469 6f6e 732e 636f 756e 7428  criptions.count(
-0000a4d0: 2920 3e20 313a 0a20 2020 2020 2020 2020  ) > 1:.         
-0000a4e0: 2020 2072 6169 7365 204d 756c 7469 706c     raise Multipl
-0000a4f0: 6553 7562 7363 7269 7074 696f 6e45 7863  eSubscriptionExc
-0000a500: 6570 7469 6f6e 280a 2020 2020 2020 2020  eption(.        
-0000a510: 2020 2020 2020 2020 2254 6869 7320 6375          "This cu
-0000a520: 7374 6f6d 6572 2068 6173 206d 756c 7469  stomer has multi
-0000a530: 706c 6520 7375 6273 6372 6970 7469 6f6e  ple subscription
-0000a540: 732e 2055 7365 2043 7573 746f 6d65 722e  s. Use Customer.
-0000a550: 7375 6273 6372 6970 7469 6f6e 7320 220a  subscriptions ".
-0000a560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a570: 2274 6f20 6163 6365 7373 2074 6865 6d2e  "to access them.
-0000a580: 220a 2020 2020 2020 2020 2020 2020 290a  ".            ).
-0000a590: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0000a5a0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000a5b0: 2073 7562 7363 7269 7074 696f 6e73 2e66   subscriptions.f
-0000a5c0: 6972 7374 2829 0a0a 2020 2020 6465 6620  irst()..    def 
-0000a5d0: 6361 6e5f 6368 6172 6765 2873 656c 6629  can_charge(self)
-0000a5e0: 3a0a 2020 2020 2020 2020 2222 2244 6574  :.        """Det
-0000a5f0: 6572 6d69 6e65 7320 6966 2074 6869 7320  ermines if this 
-0000a600: 6375 7374 6f6d 6572 2069 7320 6162 6c65  customer is able
-0000a610: 2074 6f20 6265 2063 6861 7267 6564 2e22   to be charged."
-0000a620: 2222 0a0a 2020 2020 2020 2020 7761 726e  ""..        warn
-0000a630: 696e 6773 2e77 6172 6e28 0a20 2020 2020  ings.warn(.     
-0000a640: 2020 2020 2020 2022 4375 7374 6f6d 6572         "Customer
-0000a650: 2e63 616e 5f63 6861 7267 6528 2920 6973  .can_charge() is
-0000a660: 206d 6973 6c65 6164 696e 6720 616e 6420   misleading and 
-0000a670: 6465 7072 6563 6174 6564 2c20 7769 6c6c  deprecated, will
-0000a680: 2062 6520 7265 6d6f 7665 6420 696e 2064   be removed in d
-0000a690: 6a2d 7374 7269 7065 2032 2e38 2e20 220a  j-stripe 2.8. ".
-0000a6a0: 2020 2020 2020 2020 2020 2020 224c 6f6f              "Loo
-0000a6b0: 6b20 6174 2043 7573 746f 6d65 722e 7061  k at Customer.pa
-0000a6c0: 796d 656e 745f 6d65 7468 6f64 732e 616c  yment_methods.al
-0000a6d0: 6c28 2920 696e 7374 6561 642e 222c 0a20  l() instead.",. 
-0000a6e0: 2020 2020 2020 2020 2020 2044 6570 7265             Depre
-0000a6f0: 6361 7469 6f6e 5761 726e 696e 672c 0a20  cationWarning,. 
-0000a700: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-0000a710: 2020 7265 7475 726e 2028 0a20 2020 2020    return (.     
-0000a720: 2020 2020 2020 2073 656c 662e 6861 735f         self.has_
-0000a730: 7661 6c69 645f 736f 7572 6365 2829 206f  valid_source() o
-0000a740: 7220 7365 6c66 2e64 6566 6175 6c74 5f70  r self.default_p
-0000a750: 6179 6d65 6e74 5f6d 6574 686f 6420 6973  ayment_method is
-0000a760: 206e 6f74 204e 6f6e 650a 2020 2020 2020   not None.      
-0000a770: 2020 2920 616e 6420 7365 6c66 2e64 6174    ) and self.dat
-0000a780: 655f 7075 7267 6564 2069 7320 4e6f 6e65  e_purged is None
-0000a790: 0a0a 2020 2020 6465 6620 7365 6e64 5f69  ..    def send_i
-0000a7a0: 6e76 6f69 6365 2873 656c 6629 3a0a 2020  nvoice(self):.  
-0000a7b0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000a7c0: 2020 5061 7920 616e 6420 7365 6e64 2074    Pay and send t
-0000a7d0: 6865 2063 7573 746f 6d65 7227 7320 6c61  he customer's la
-0000a7e0: 7465 7374 2069 6e76 6f69 6365 2e0a 0a20  test invoice... 
-0000a7f0: 2020 2020 2020 203a 7265 7475 726e 733a         :returns:
-0000a800: 2054 7275 6520 6966 2061 6e20 696e 766f   True if an invo
-0000a810: 6963 6520 7761 7320 6162 6c65 2074 6f20  ice was able to 
-0000a820: 6265 2063 7265 6174 6564 2061 6e64 2070  be created and p
-0000a830: 6169 642c 2046 616c 7365 206f 7468 6572  aid, False other
-0000a840: 7769 7365 0a20 2020 2020 2020 2020 2020  wise.           
-0000a850: 2028 7479 7069 6361 6c6c 7920 6966 2074   (typically if t
-0000a860: 6865 7265 2077 6173 206e 6f74 6869 6e67  here was nothing
-0000a870: 2074 6f20 696e 766f 6963 6529 2e0a 2020   to invoice)..  
-0000a880: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000a890: 2020 6672 6f6d 202e 6269 6c6c 696e 6720    from .billing 
-0000a8a0: 696d 706f 7274 2049 6e76 6f69 6365 0a0a  import Invoice..
-0000a8b0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-0000a8c0: 2020 2020 2020 2020 2069 6e76 6f69 6365           invoice
-0000a8d0: 203d 2049 6e76 6f69 6365 2e5f 6170 695f   = Invoice._api_
-0000a8e0: 6372 6561 7465 2863 7573 746f 6d65 723d  create(customer=
-0000a8f0: 7365 6c66 2e69 6429 0a20 2020 2020 2020  self.id).       
-0000a900: 2020 2020 2069 6e76 6f69 6365 2e70 6179       invoice.pay
-0000a910: 2829 0a20 2020 2020 2020 2020 2020 2072  ().            r
-0000a920: 6574 7572 6e20 5472 7565 0a20 2020 2020  eturn True.     
-0000a930: 2020 2065 7863 6570 7420 496e 7661 6c69     except Invali
-0000a940: 6452 6571 7565 7374 4572 726f 723a 2020  dRequestError:  
-0000a950: 2320 544f 444f 3a20 4368 6563 6b20 7468  # TODO: Check th
-0000a960: 6973 2066 6f72 2061 206d 6f72 650a 2020  is for a more.  
-0000a970: 2020 2020 2020 2020 2020 2320 2020 2020            #     
-0000a980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a990: 2020 2020 2020 7370 6563 6966 6963 2065        specific e
-0000a9a0: 7272 6f72 206d 6573 7361 6765 2e0a 2020  rror message..  
-0000a9b0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000a9c0: 2046 616c 7365 2020 2320 5468 6572 6520   False  # There 
-0000a9d0: 7761 7320 6e6f 7468 696e 6720 746f 2069  was nothing to i
-0000a9e0: 6e76 6f69 6365 0a0a 2020 2020 6465 6620  nvoice..    def 
-0000a9f0: 7265 7472 795f 756e 7061 6964 5f69 6e76  retry_unpaid_inv
-0000aa00: 6f69 6365 7328 7365 6c66 293a 0a20 2020  oices(self):.   
-0000aa10: 2020 2020 2022 2222 4174 7465 6d70 7420       """Attempt 
-0000aa20: 746f 2072 6574 7279 2063 6f6c 6c65 6374  to retry collect
-0000aa30: 696e 6720 7061 796d 656e 7420 6f6e 2074  ing payment on t
-0000aa40: 6865 2063 7573 746f 6d65 7227 7320 756e  he customer's un
-0000aa50: 7061 6964 2069 6e76 6f69 6365 732e 2222  paid invoices.""
-0000aa60: 220a 0a20 2020 2020 2020 2073 656c 662e  "..        self.
-0000aa70: 5f73 796e 635f 696e 766f 6963 6573 2829  _sync_invoices()
-0000aa80: 0a20 2020 2020 2020 2066 6f72 2069 6e76  .        for inv
-0000aa90: 6f69 6365 2069 6e20 7365 6c66 2e69 6e76  oice in self.inv
-0000aaa0: 6f69 6365 732e 6669 6c74 6572 2861 7574  oices.filter(aut
-0000aab0: 6f5f 6164 7661 6e63 653d 5472 7565 292e  o_advance=True).
-0000aac0: 6578 636c 7564 6528 7374 6174 7573 3d22  exclude(status="
-0000aad0: 7061 6964 2229 3a0a 2020 2020 2020 2020  paid"):.        
-0000aae0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-0000aaf0: 2020 2020 2020 2020 2069 6e76 6f69 6365           invoice
-0000ab00: 2e72 6574 7279 2829 2020 2320 416c 7761  .retry()  # Alwa
-0000ab10: 7973 2072 6574 7279 2075 6e70 6169 6420  ys retry unpaid 
-0000ab20: 696e 766f 6963 6573 0a20 2020 2020 2020  invoices.       
-0000ab30: 2020 2020 2065 7863 6570 7420 496e 7661       except Inva
-0000ab40: 6c69 6452 6571 7565 7374 4572 726f 7220  lidRequestError 
-0000ab50: 6173 2065 7863 3a0a 2020 2020 2020 2020  as exc:.        
-0000ab60: 2020 2020 2020 2020 6966 2073 7472 2865          if str(e
-0000ab70: 7863 2920 213d 2022 496e 766f 6963 6520  xc) != "Invoice 
-0000ab80: 6973 2061 6c72 6561 6479 2070 6169 6422  is already paid"
-0000ab90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000aba0: 2020 2020 2020 7261 6973 650a 0a20 2020        raise..   
-0000abb0: 2064 6566 2068 6173 5f76 616c 6964 5f73   def has_valid_s
-0000abc0: 6f75 7263 6528 7365 6c66 293a 0a20 2020  ource(self):.   
-0000abd0: 2020 2020 2022 2222 4368 6563 6b20 7768       """Check wh
-0000abe0: 6574 6865 7220 7468 6520 6375 7374 6f6d  ether the custom
-0000abf0: 6572 2068 6173 2061 2076 616c 6964 2070  er has a valid p
-0000ac00: 6179 6d65 6e74 2073 6f75 7263 652e 2222  ayment source.""
-0000ac10: 220a 2020 2020 2020 2020 7761 726e 696e  ".        warnin
-0000ac20: 6773 2e77 6172 6e28 0a20 2020 2020 2020  gs.warn(.       
-0000ac30: 2020 2020 2022 4375 7374 6f6d 6572 2e68       "Customer.h
-0000ac40: 6173 5f76 616c 6964 5f73 6f75 7263 6528  as_valid_source(
-0000ac50: 2920 6973 2064 6570 7265 6361 7465 6420  ) is deprecated 
-0000ac60: 616e 6420 7769 6c6c 2062 6520 7265 6d6f  and will be remo
-0000ac70: 7665 6420 696e 2064 6a2d 7374 7269 7065  ved in dj-stripe
-0000ac80: 2032 2e38 2e20 220a 2020 2020 2020 2020   2.8. ".        
-0000ac90: 2020 2020 2255 7365 2060 4375 7374 6f6d      "Use `Custom
-0000aca0: 6572 2e64 6566 6175 6c74 5f73 6f75 7263  er.default_sourc
-0000acb0: 6520 6973 206e 6f74 204e 6f6e 6560 2069  e is not None` i
-0000acc0: 6e73 7465 6164 2e22 2c0a 2020 2020 2020  nstead.",.      
-0000acd0: 2020 2020 2020 4465 7072 6563 6174 696f        Deprecatio
-0000ace0: 6e57 6172 6e69 6e67 2c0a 2020 2020 2020  nWarning,.      
-0000acf0: 2020 290a 2020 2020 2020 2020 7265 7475    ).        retu
-0000ad00: 726e 2073 656c 662e 6465 6661 756c 745f  rn self.default_
-0000ad10: 736f 7572 6365 2069 7320 6e6f 7420 4e6f  source is not No
-0000ad20: 6e65 0a0a 2020 2020 6465 6620 6164 645f  ne..    def add_
-0000ad30: 636f 7570 6f6e 2873 656c 662c 2063 6f75  coupon(self, cou
-0000ad40: 706f 6e2c 2069 6465 6d70 6f74 656e 6379  pon, idempotency
-0000ad50: 5f6b 6579 3d4e 6f6e 6529 3a0a 2020 2020  _key=None):.    
-0000ad60: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000ad70: 4164 6420 6120 636f 7570 6f6e 2074 6f20  Add a coupon to 
-0000ad80: 6120 4375 7374 6f6d 6572 2e0a 0a20 2020  a Customer...   
-0000ad90: 2020 2020 2054 6865 2063 6f75 706f 6e20       The coupon 
-0000ada0: 6361 6e20 6265 2061 2043 6f75 706f 6e20  can be a Coupon 
-0000adb0: 6f62 6a65 6374 2c20 6f72 2061 2076 616c  object, or a val
-0000adc0: 6964 2053 7472 6970 6520 436f 7570 6f6e  id Stripe Coupon
-0000add0: 2049 442e 0a20 2020 2020 2020 2022 2222   ID..        """
-0000ade0: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
-0000adf0: 7374 616e 6365 2863 6f75 706f 6e2c 2053  stance(coupon, S
-0000ae00: 7472 6970 654d 6f64 656c 293a 0a20 2020  tripeModel):.   
-0000ae10: 2020 2020 2020 2020 2063 6f75 706f 6e20           coupon 
-0000ae20: 3d20 636f 7570 6f6e 2e69 640a 0a20 2020  = coupon.id..   
-0000ae30: 2020 2020 2073 7472 6970 655f 6375 7374       stripe_cust
-0000ae40: 6f6d 6572 203d 2073 656c 662e 6170 695f  omer = self.api_
-0000ae50: 7265 7472 6965 7665 2829 0a20 2020 2020  retrieve().     
-0000ae60: 2020 2073 7472 6970 655f 6375 7374 6f6d     stripe_custom
-0000ae70: 6572 5b22 636f 7570 6f6e 225d 203d 2063  er["coupon"] = c
-0000ae80: 6f75 706f 6e0a 2020 2020 2020 2020 7374  oupon.        st
-0000ae90: 7269 7065 5f63 7573 746f 6d65 722e 7361  ripe_customer.sa
-0000aea0: 7665 2869 6465 6d70 6f74 656e 6379 5f6b  ve(idempotency_k
-0000aeb0: 6579 3d69 6465 6d70 6f74 656e 6379 5f6b  ey=idempotency_k
-0000aec0: 6579 290a 2020 2020 2020 2020 7265 7475  ey).        retu
-0000aed0: 726e 2073 656c 662e 5f5f 636c 6173 735f  rn self.__class_
-0000aee0: 5f2e 7379 6e63 5f66 726f 6d5f 7374 7269  _.sync_from_stri
-0000aef0: 7065 5f64 6174 6128 0a20 2020 2020 2020  pe_data(.       
-0000af00: 2020 2020 2073 7472 6970 655f 6375 7374       stripe_cust
-0000af10: 6f6d 6572 2c20 6170 695f 6b65 793d 7365  omer, api_key=se
-0000af20: 6c66 2e64 6566 6175 6c74 5f61 7069 5f6b  lf.default_api_k
-0000af30: 6579 0a20 2020 2020 2020 2029 0a0a 2020  ey.        )..  
-0000af40: 2020 6465 6620 7570 636f 6d69 6e67 5f69    def upcoming_i
-0000af50: 6e76 6f69 6365 2873 656c 662c 202a 2a6b  nvoice(self, **k
-0000af60: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
-0000af70: 2222 2247 6574 7320 7468 6520 7570 636f  """Gets the upco
-0000af80: 6d69 6e67 2070 7265 7669 6577 2069 6e76  ming preview inv
-0000af90: 6f69 6365 2028 7369 6e67 756c 6172 2920  oice (singular) 
-0000afa0: 666f 7220 7468 6973 2063 7573 746f 6d65  for this custome
-0000afb0: 722e 0a0a 2020 2020 2020 2020 5365 6520  r...        See 
-0000afc0: 6049 6e76 6f69 6365 2e75 7063 6f6d 696e  `Invoice.upcomin
-0000afd0: 6728 2920 3c23 646a 7374 7269 7065 2e49  g() <#djstripe.I
-0000afe0: 6e76 6f69 6365 2e75 7063 6f6d 696e 673e  nvoice.upcoming>
-0000aff0: 605f 5f2e 0a0a 2020 2020 2020 2020 5468  `__...        Th
-0000b000: 6520 6060 6375 7374 6f6d 6572 6060 2061  e ``customer`` a
-0000b010: 7267 756d 656e 7420 746f 2074 6865 2060  rgument to the `
-0000b020: 6075 7063 6f6d 696e 6728 2960 6020 6361  `upcoming()`` ca
-0000b030: 6c6c 2069 7320 6175 746f 6d61 7469 6361  ll is automatica
-0000b040: 6c6c 7920 7365 740a 2020 2020 2020 2020  lly set.        
-0000b050: 2062 7920 7468 6973 206d 6574 686f 642e   by this method.
-0000b060: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000b070: 2020 2020 2066 726f 6d20 2e62 696c 6c69       from .billi
-0000b080: 6e67 2069 6d70 6f72 7420 496e 766f 6963  ng import Invoic
-0000b090: 650a 0a20 2020 2020 2020 206b 7761 7267  e..        kwarg
-0000b0a0: 735b 2263 7573 746f 6d65 7222 5d20 3d20  s["customer"] = 
-0000b0b0: 7365 6c66 0a20 2020 2020 2020 2072 6574  self.        ret
-0000b0c0: 7572 6e20 496e 766f 6963 652e 7570 636f  urn Invoice.upco
-0000b0d0: 6d69 6e67 282a 2a6b 7761 7267 7329 0a0a  ming(**kwargs)..
-0000b0e0: 2020 2020 6465 6620 5f61 7474 6163 685f      def _attach_
-0000b0f0: 6f62 6a65 6374 735f 706f 7374 5f73 6176  objects_post_sav
-0000b100: 655f 686f 6f6b 280a 2020 2020 2020 2020  e_hook(.        
-0000b110: 7365 6c66 2c0a 2020 2020 2020 2020 636c  self,.        cl
-0000b120: 732c 0a20 2020 2020 2020 2064 6174 612c  s,.        data,
-0000b130: 0a20 2020 2020 2020 2070 656e 6469 6e67  .        pending
-0000b140: 5f72 656c 6174 696f 6e73 3d4e 6f6e 652c  _relations=None,
-0000b150: 0a20 2020 2020 2020 2061 7069 5f6b 6579  .        api_key
-0000b160: 3d64 6a73 7472 6970 655f 7365 7474 696e  =djstripe_settin
-0000b170: 6773 2e53 5452 4950 455f 5345 4352 4554  gs.STRIPE_SECRET
-0000b180: 5f4b 4559 2c0a 2020 2020 293a 0a20 2020  _KEY,.    ):.   
-0000b190: 2020 2020 2066 726f 6d20 2e62 696c 6c69       from .billi
-0000b1a0: 6e67 2069 6d70 6f72 7420 436f 7570 6f6e  ng import Coupon
-0000b1b0: 0a20 2020 2020 2020 2066 726f 6d20 2e70  .        from .p
-0000b1c0: 6179 6d65 6e74 5f6d 6574 686f 6473 2069  ayment_methods i
-0000b1d0: 6d70 6f72 7420 446a 7374 7269 7065 5061  mport DjstripePa
-0000b1e0: 796d 656e 744d 6574 686f 640a 0a20 2020  ymentMethod..   
-0000b1f0: 2020 2020 2073 7570 6572 2829 2e5f 6174       super()._at
-0000b200: 7461 6368 5f6f 626a 6563 7473 5f70 6f73  tach_objects_pos
-0000b210: 745f 7361 7665 5f68 6f6f 6b28 0a20 2020  t_save_hook(.   
-0000b220: 2020 2020 2020 2020 2063 6c73 2c20 6461           cls, da
-0000b230: 7461 2c20 7065 6e64 696e 675f 7265 6c61  ta, pending_rela
-0000b240: 7469 6f6e 733d 7065 6e64 696e 675f 7265  tions=pending_re
-0000b250: 6c61 7469 6f6e 732c 2061 7069 5f6b 6579  lations, api_key
-0000b260: 3d61 7069 5f6b 6579 0a20 2020 2020 2020  =api_key.       
-0000b270: 2029 0a0a 2020 2020 2020 2020 7361 7665   )..        save
-0000b280: 203d 2046 616c 7365 0a0a 2020 2020 2020   = False..      
-0000b290: 2020 6375 7374 6f6d 6572 5f73 6f75 7263    customer_sourc
-0000b2a0: 6573 203d 2064 6174 612e 6765 7428 2273  es = data.get("s
-0000b2b0: 6f75 7263 6573 2229 0a20 2020 2020 2020  ources").       
-0000b2c0: 2073 6f75 7263 6573 203d 207b 7d0a 2020   sources = {}.  
-0000b2d0: 2020 2020 2020 6966 2063 7573 746f 6d65        if custome
-0000b2e0: 725f 736f 7572 6365 733a 0a20 2020 2020  r_sources:.     
-0000b2f0: 2020 2020 2020 2023 2048 6176 6520 746f         # Have to
-0000b300: 2063 7265 6174 6520 736f 7572 6365 7320   create sources 
-0000b310: 6265 666f 7265 2077 6520 6861 6e64 6c65  before we handle
-0000b320: 2074 6865 2064 6566 6175 6c74 5f73 6f75   the default_sou
-0000b330: 7263 650a 2020 2020 2020 2020 2020 2020  rce.            
-0000b340: 2320 5765 2073 6176 6520 616c 6c20 6f66  # We save all of
-0000b350: 2074 6865 6d20 696e 2074 6865 2060 736f   them in the `so
-0000b360: 7572 6365 7360 2064 6963 742c 2073 6f20  urces` dict, so 
-0000b370: 7468 6174 2077 6520 6361 6e20 6669 6e64  that we can find
-0000b380: 2074 6865 6d0a 2020 2020 2020 2020 2020   them.          
-0000b390: 2020 2320 6279 2069 6420 7768 656e 2077    # by id when w
-0000b3a0: 6520 6c6f 6f6b 2061 7420 7468 6520 6465  e look at the de
-0000b3b0: 6661 756c 745f 736f 7572 6365 2028 7765  fault_source (we
-0000b3c0: 206e 6565 6420 7468 6520 736f 7572 6365   need the source
-0000b3d0: 2074 7970 6529 2e0a 2020 2020 2020 2020   type)..        
-0000b3e0: 2020 2020 666f 7220 736f 7572 6365 2069      for source i
-0000b3f0: 6e20 6375 7374 6f6d 6572 5f73 6f75 7263  n customer_sourc
-0000b400: 6573 5b22 6461 7461 225d 3a0a 2020 2020  es["data"]:.    
-0000b410: 2020 2020 2020 2020 2020 2020 6f62 6a2c              obj,
-0000b420: 205f 203d 2044 6a73 7472 6970 6550 6179   _ = DjstripePay
-0000b430: 6d65 6e74 4d65 7468 6f64 2e5f 6765 745f  mentMethod._get_
-0000b440: 6f72 5f63 7265 6174 655f 736f 7572 6365  or_create_source
-0000b450: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000b460: 2020 2020 2020 736f 7572 6365 2c20 736f        source, so
-0000b470: 7572 6365 5b22 6f62 6a65 6374 225d 2c20  urce["object"], 
-0000b480: 6170 695f 6b65 793d 6170 695f 6b65 790a  api_key=api_key.
-0000b490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b4a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000b4b0: 2020 736f 7572 6365 735b 736f 7572 6365    sources[source
-0000b4c0: 5b22 6964 225d 5d20 3d20 6f62 6a0a 0a20  ["id"]] = obj.. 
-0000b4d0: 2020 2020 2020 2064 6973 636f 756e 7420         discount 
-0000b4e0: 3d20 6461 7461 2e67 6574 2822 6469 7363  = data.get("disc
-0000b4f0: 6f75 6e74 2229 0a20 2020 2020 2020 2069  ount").        i
-0000b500: 6620 6469 7363 6f75 6e74 3a0a 2020 2020  f discount:.    
-0000b510: 2020 2020 2020 2020 636f 7570 6f6e 2c20          coupon, 
-0000b520: 5f63 7265 6174 6564 203d 2043 6f75 706f  _created = Coupo
-0000b530: 6e2e 5f67 6574 5f6f 725f 6372 6561 7465  n._get_or_create
-0000b540: 5f66 726f 6d5f 7374 7269 7065 5f6f 626a  _from_stripe_obj
-0000b550: 6563 7428 0a20 2020 2020 2020 2020 2020  ect(.           
-0000b560: 2020 2020 2064 6973 636f 756e 742c 2022       discount, "
-0000b570: 636f 7570 6f6e 222c 2061 7069 5f6b 6579  coupon", api_key
-0000b580: 3d61 7069 5f6b 6579 0a20 2020 2020 2020  =api_key.       
-0000b590: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-0000b5a0: 2020 2069 6620 636f 7570 6f6e 2061 6e64     if coupon and
-0000b5b0: 2063 6f75 706f 6e20 213d 2073 656c 662e   coupon != self.
-0000b5c0: 636f 7570 6f6e 3a0a 2020 2020 2020 2020  coupon:.        
-0000b5d0: 2020 2020 2020 2020 7365 6c66 2e63 6f75          self.cou
-0000b5e0: 706f 6e20 3d20 636f 7570 6f6e 0a20 2020  pon = coupon.   
-0000b5f0: 2020 2020 2020 2020 2020 2020 2073 6176               sav
-0000b600: 6520 3d20 5472 7565 0a20 2020 2020 2020  e = True.       
-0000b610: 2065 6c69 6620 7365 6c66 2e63 6f75 706f   elif self.coupo
-0000b620: 6e3a 0a20 2020 2020 2020 2020 2020 2073  n:.            s
-0000b630: 656c 662e 636f 7570 6f6e 203d 204e 6f6e  elf.coupon = Non
-0000b640: 650a 2020 2020 2020 2020 2020 2020 7361  e.            sa
-0000b650: 7665 203d 2054 7275 650a 0a20 2020 2020  ve = True..     
-0000b660: 2020 2069 6620 7361 7665 3a0a 2020 2020     if save:.    
-0000b670: 2020 2020 2020 2020 7365 6c66 2e73 6176          self.sav
-0000b680: 6528 290a 0a20 2020 2064 6566 205f 6174  e()..    def _at
-0000b690: 7461 6368 5f6f 626a 6563 7473 5f68 6f6f  tach_objects_hoo
-0000b6a0: 6b28 0a20 2020 2020 2020 2073 656c 662c  k(.        self,
-0000b6b0: 2063 6c73 2c20 6461 7461 2c20 6375 7272   cls, data, curr
-0000b6c0: 656e 745f 6964 733d 4e6f 6e65 2c20 6170  ent_ids=None, ap
-0000b6d0: 695f 6b65 793d 646a 7374 7269 7065 5f73  i_key=djstripe_s
-0000b6e0: 6574 7469 6e67 732e 5354 5249 5045 5f53  ettings.STRIPE_S
-0000b6f0: 4543 5245 545f 4b45 590a 2020 2020 293a  ECRET_KEY.    ):
-0000b700: 0a20 2020 2020 2020 2023 2057 6865 6e20  .        # When 
-0000b710: 7765 2073 6176 6520 6120 6375 7374 6f6d  we save a custom
-0000b720: 6572 2074 6f20 5374 7269 7065 2c20 7765  er to Stripe, we
-0000b730: 2061 6464 2061 2072 6566 6572 656e 6365   add a reference
-0000b740: 2074 6f20 6974 7320 446a 616e 676f 2050   to its Django P
-0000b750: 4b0a 2020 2020 2020 2020 2320 696e 2074  K.        # in t
-0000b760: 6865 2060 646a 616e 676f 5f61 6363 6f75  he `django_accou
-0000b770: 6e74 6020 6b65 792e 2049 6620 7765 2066  nt` key. If we f
-0000b780: 696e 6420 7468 6174 2c20 7765 2072 652d  ind that, we re-
-0000b790: 6174 7461 6368 2074 6861 7420 504b 2e0a  attach that PK..
-0000b7a0: 2020 2020 2020 2020 7375 6273 6372 6962          subscrib
-0000b7b0: 6572 5f6b 6579 203d 2064 6a73 7472 6970  er_key = djstrip
-0000b7c0: 655f 7365 7474 696e 6773 2e53 5542 5343  e_settings.SUBSC
-0000b7d0: 5249 4245 525f 4355 5354 4f4d 4552 5f4b  RIBER_CUSTOMER_K
-0000b7e0: 4559 0a20 2020 2020 2020 2069 6620 7375  EY.        if su
-0000b7f0: 6273 6372 6962 6572 5f6b 6579 2069 6e20  bscriber_key in 
-0000b800: 2822 222c 204e 6f6e 6529 3a0a 2020 2020  ("", None):.    
-0000b810: 2020 2020 2020 2020 2320 4469 7361 626c          # Disabl
-0000b820: 6564 2e20 4e6f 7468 696e 6720 656c 7365  ed. Nothing else
-0000b830: 2074 6f20 646f 2e0a 2020 2020 2020 2020   to do..        
-0000b840: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
-0000b850: 2020 2020 7375 6273 6372 6962 6572 5f69      subscriber_i
-0000b860: 6420 3d20 6461 7461 2e67 6574 2822 6d65  d = data.get("me
-0000b870: 7461 6461 7461 222c 207b 7d29 2e67 6574  tadata", {}).get
-0000b880: 2873 7562 7363 7269 6265 725f 6b65 7929  (subscriber_key)
-0000b890: 0a20 2020 2020 2020 2069 6620 7375 6273  .        if subs
-0000b8a0: 6372 6962 6572 5f69 643a 0a20 2020 2020  criber_id:.     
-0000b8b0: 2020 2020 2020 2063 6c73 203d 2064 6a73         cls = djs
-0000b8c0: 7472 6970 655f 7365 7474 696e 6773 2e67  tripe_settings.g
-0000b8d0: 6574 5f73 7562 7363 7269 6265 725f 6d6f  et_subscriber_mo
-0000b8e0: 6465 6c28 290a 2020 2020 2020 2020 2020  del().          
-0000b8f0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-0000b900: 2020 2020 2020 2023 2057 6520 6861 7665         # We have
-0000b910: 2074 6f20 7065 7266 6f72 6d20 6120 6765   to perform a ge
-0000b920: 7428 292c 2069 6e73 7465 6164 206f 6620  t(), instead of 
-0000b930: 6a75 7374 2061 7474 6163 6869 6e67 2074  just attaching t
-0000b940: 6865 2050 4b0a 2020 2020 2020 2020 2020  he PK.          
-0000b950: 2020 2020 2020 2320 626c 696e 646c 7920        # blindly 
-0000b960: 6173 2074 6865 206f 626a 6563 7420 6d61  as the object ma
-0000b970: 7920 6861 7665 2062 6565 6e20 6465 6c65  y have been dele
-0000b980: 7465 6420 6f72 206e 6f74 2065 7869 7374  ted or not exist
-0000b990: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000b9a0: 2020 2320 4174 7465 6d70 7469 6e67 2074    # Attempting t
-0000b9b0: 6f20 7361 7665 2074 6861 7420 776f 756c  o save that woul
-0000b9c0: 6420 6361 7573 6520 616e 2049 6e74 6567  d cause an Integ
-0000b9d0: 7269 7479 4572 726f 722e 0a20 2020 2020  rityError..     
-0000b9e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000b9f0: 7375 6273 6372 6962 6572 203d 2063 6c73  subscriber = cls
-0000ba00: 2e6f 626a 6563 7473 2e67 6574 2870 6b3d  .objects.get(pk=
-0000ba10: 7375 6273 6372 6962 6572 5f69 6429 0a20  subscriber_id). 
-0000ba20: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-0000ba30: 7420 2863 6c73 2e44 6f65 734e 6f74 4578  t (cls.DoesNotEx
-0000ba40: 6973 742c 2056 616c 7565 4572 726f 7229  ist, ValueError)
-0000ba50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000ba60: 2020 6c6f 6767 6572 2e77 6172 6e69 6e67    logger.warning
-0000ba70: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000ba80: 2020 2020 2020 2243 6f75 6c64 206e 6f74        "Could not
-0000ba90: 2066 696e 6420 7375 6273 6372 6962 6572   find subscriber
-0000baa0: 2025 7220 6d61 7463 6869 6e67 2063 7573   %r matching cus
-0000bab0: 746f 6d65 7220 2572 222c 0a20 2020 2020  tomer %r",.     
-0000bac0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000bad0: 7562 7363 7269 6265 725f 6964 2c0a 2020  ubscriber_id,.  
-0000bae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000baf0: 2020 7365 6c66 2e69 642c 0a20 2020 2020    self.id,.     
-0000bb00: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0000bb10: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0000bb20: 662e 7375 6273 6372 6962 6572 203d 204e  f.subscriber = N
-0000bb30: 6f6e 650a 0a20 2020 2023 2053 594e 4320  one..    # SYNC 
-0000bb40: 6d65 7468 6f64 7320 7368 6f75 6c64 2062  methods should b
-0000bb50: 6520 6472 6f70 7065 6420 696e 2066 6176  e dropped in fav
-0000bb60: 6f72 206f 6620 7468 6520 6d61 7374 6572  or of the master
-0000bb70: 2073 796e 6320 696e 6672 6173 7472 7563   sync infrastruc
-0000bb80: 7475 7265 2070 726f 706f 7365 640a 2020  ture proposed.  
-0000bb90: 2020 6465 6620 5f73 796e 635f 696e 766f    def _sync_invo
-0000bba0: 6963 6573 2873 656c 662c 202a 2a6b 7761  ices(self, **kwa
-0000bbb0: 7267 7329 3a0a 2020 2020 2020 2020 6672  rgs):.        fr
-0000bbc0: 6f6d 202e 6269 6c6c 696e 6720 696d 706f  om .billing impo
-0000bbd0: 7274 2049 6e76 6f69 6365 0a0a 2020 2020  rt Invoice..    
-0000bbe0: 2020 2020 6170 695f 6b65 7920 3d20 6b77      api_key = kw
-0000bbf0: 6172 6773 2e67 6574 2822 6170 695f 6b65  args.get("api_ke
-0000bc00: 7922 2920 6f72 2073 656c 662e 6465 6661  y") or self.defa
-0000bc10: 756c 745f 6170 695f 6b65 790a 2020 2020  ult_api_key.    
-0000bc20: 2020 2020 666f 7220 7374 7269 7065 5f69      for stripe_i
-0000bc30: 6e76 6f69 6365 2069 6e20 496e 766f 6963  nvoice in Invoic
-0000bc40: 652e 6170 695f 6c69 7374 2863 7573 746f  e.api_list(custo
-0000bc50: 6d65 723d 7365 6c66 2e69 642c 202a 2a6b  mer=self.id, **k
-0000bc60: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
-0000bc70: 2020 2020 496e 766f 6963 652e 7379 6e63      Invoice.sync
-0000bc80: 5f66 726f 6d5f 7374 7269 7065 5f64 6174  _from_stripe_dat
-0000bc90: 6128 7374 7269 7065 5f69 6e76 6f69 6365  a(stripe_invoice
-0000bca0: 2c20 6170 695f 6b65 793d 6170 695f 6b65  , api_key=api_ke
-0000bcb0: 7929 0a0a 2020 2020 6465 6620 5f73 796e  y)..    def _syn
-0000bcc0: 635f 6368 6172 6765 7328 7365 6c66 2c20  c_charges(self, 
-0000bcd0: 2a2a 6b77 6172 6773 293a 0a20 2020 2020  **kwargs):.     
-0000bce0: 2020 2061 7069 5f6b 6579 203d 206b 7761     api_key = kwa
-0000bcf0: 7267 732e 6765 7428 2261 7069 5f6b 6579  rgs.get("api_key
-0000bd00: 2229 206f 7220 7365 6c66 2e64 6566 6175  ") or self.defau
-0000bd10: 6c74 5f61 7069 5f6b 6579 0a20 2020 2020  lt_api_key.     
-0000bd20: 2020 2066 6f72 2073 7472 6970 655f 6368     for stripe_ch
-0000bd30: 6172 6765 2069 6e20 4368 6172 6765 2e61  arge in Charge.a
-0000bd40: 7069 5f6c 6973 7428 6375 7374 6f6d 6572  pi_list(customer
-0000bd50: 3d73 656c 662e 6964 2c20 2a2a 6b77 6172  =self.id, **kwar
-0000bd60: 6773 293a 0a20 2020 2020 2020 2020 2020  gs):.           
-0000bd70: 2043 6861 7267 652e 7379 6e63 5f66 726f   Charge.sync_fro
-0000bd80: 6d5f 7374 7269 7065 5f64 6174 6128 7374  m_stripe_data(st
-0000bd90: 7269 7065 5f63 6861 7267 652c 2061 7069  ripe_charge, api
-0000bda0: 5f6b 6579 3d61 7069 5f6b 6579 290a 0a20  _key=api_key).. 
-0000bdb0: 2020 2064 6566 205f 7379 6e63 5f63 6172     def _sync_car
-0000bdc0: 6473 2873 656c 662c 202a 2a6b 7761 7267  ds(self, **kwarg
-0000bdd0: 7329 3a0a 2020 2020 2020 2020 6672 6f6d  s):.        from
-0000bde0: 202e 7061 796d 656e 745f 6d65 7468 6f64   .payment_method
-0000bdf0: 7320 696d 706f 7274 2043 6172 640a 0a20  s import Card.. 
-0000be00: 2020 2020 2020 2061 7069 5f6b 6579 203d         api_key =
-0000be10: 206b 7761 7267 732e 6765 7428 2261 7069   kwargs.get("api
-0000be20: 5f6b 6579 2229 206f 7220 7365 6c66 2e64  _key") or self.d
-0000be30: 6566 6175 6c74 5f61 7069 5f6b 6579 0a20  efault_api_key. 
-0000be40: 2020 2020 2020 2066 6f72 2073 7472 6970         for strip
-0000be50: 655f 6361 7264 2069 6e20 4361 7264 2e61  e_card in Card.a
-0000be60: 7069 5f6c 6973 7428 6375 7374 6f6d 6572  pi_list(customer
-0000be70: 3d73 656c 662c 202a 2a6b 7761 7267 7329  =self, **kwargs)
-0000be80: 3a0a 2020 2020 2020 2020 2020 2020 4361  :.            Ca
-0000be90: 7264 2e73 796e 635f 6672 6f6d 5f73 7472  rd.sync_from_str
-0000bea0: 6970 655f 6461 7461 2873 7472 6970 655f  ipe_data(stripe_
-0000beb0: 6361 7264 2c20 6170 695f 6b65 793d 6170  card, api_key=ap
-0000bec0: 695f 6b65 7929 0a0a 2020 2020 6465 6620  i_key)..    def 
-0000bed0: 5f73 796e 635f 7375 6273 6372 6970 7469  _sync_subscripti
-0000bee0: 6f6e 7328 7365 6c66 2c20 2a2a 6b77 6172  ons(self, **kwar
-0000bef0: 6773 293a 0a20 2020 2020 2020 2066 726f  gs):.        fro
-0000bf00: 6d20 2e62 696c 6c69 6e67 2069 6d70 6f72  m .billing impor
-0000bf10: 7420 5375 6273 6372 6970 7469 6f6e 0a0a  t Subscription..
-0000bf20: 2020 2020 2020 2020 6170 695f 6b65 7920          api_key 
-0000bf30: 3d20 6b77 6172 6773 2e67 6574 2822 6170  = kwargs.get("ap
-0000bf40: 695f 6b65 7922 2920 6f72 2073 656c 662e  i_key") or self.
-0000bf50: 6465 6661 756c 745f 6170 695f 6b65 790a  default_api_key.
-0000bf60: 2020 2020 2020 2020 666f 7220 7374 7269          for stri
-0000bf70: 7065 5f73 7562 7363 7269 7074 696f 6e20  pe_subscription 
-0000bf80: 696e 2053 7562 7363 7269 7074 696f 6e2e  in Subscription.
-0000bf90: 6170 695f 6c69 7374 280a 2020 2020 2020  api_list(.      
-0000bfa0: 2020 2020 2020 6375 7374 6f6d 6572 3d73        customer=s
-0000bfb0: 656c 662e 6964 2c20 7374 6174 7573 3d22  elf.id, status="
-0000bfc0: 616c 6c22 2c20 2a2a 6b77 6172 6773 0a20  all", **kwargs. 
-0000bfd0: 2020 2020 2020 2029 3a0a 2020 2020 2020         ):.      
-0000bfe0: 2020 2020 2020 5375 6273 6372 6970 7469        Subscripti
-0000bff0: 6f6e 2e73 796e 635f 6672 6f6d 5f73 7472  on.sync_from_str
-0000c000: 6970 655f 6461 7461 2873 7472 6970 655f  ipe_data(stripe_
-0000c010: 7375 6273 6372 6970 7469 6f6e 2c20 6170  subscription, ap
-0000c020: 695f 6b65 793d 6170 695f 6b65 7929 0a0a  i_key=api_key)..
-0000c030: 0a63 6c61 7373 2044 6973 7075 7465 2853  .class Dispute(S
-0000c040: 7472 6970 654d 6f64 656c 293a 0a20 2020  tripeModel):.   
-0000c050: 2022 2222 0a20 2020 2041 2064 6973 7075   """.    A dispu
-0000c060: 7465 206f 6363 7572 7320 7768 656e 2061  te occurs when a
-0000c070: 2063 7573 746f 6d65 7220 7175 6573 7469   customer questi
-0000c080: 6f6e 7320 796f 7572 2063 6861 7267 6520  ons your charge 
-0000c090: 7769 7468 2074 6865 6972 0a20 2020 2063  with their.    c
-0000c0a0: 6172 6420 6973 7375 6572 2e20 5768 656e  ard issuer. When
-0000c0b0: 2074 6869 7320 6861 7070 656e 732c 2079   this happens, y
-0000c0c0: 6f75 2772 6520 6769 7665 6e20 7468 6520  ou're given the 
-0000c0d0: 6f70 706f 7274 756e 6974 7920 746f 0a20  opportunity to. 
-0000c0e0: 2020 2072 6573 706f 6e64 2074 6f20 7468     respond to th
-0000c0f0: 6520 6469 7370 7574 6520 7769 7468 2065  e dispute with e
-0000c100: 7669 6465 6e63 6520 7468 6174 2073 686f  vidence that sho
-0000c110: 7773 2074 6861 7420 7468 6520 6368 6172  ws that the char
-0000c120: 6765 2069 7320 6c65 6769 7469 6d61 7465  ge is legitimate
-0000c130: 0a0a 2020 2020 5374 7269 7065 2064 6f63  ..    Stripe doc
-0000c140: 756d 656e 7461 7469 6f6e 3a20 6874 7470  umentation: http
-0000c150: 733a 2f2f 7374 7269 7065 2e63 6f6d 2f64  s://stripe.com/d
-0000c160: 6f63 732f 6170 693f 6c61 6e67 3d70 7974  ocs/api?lang=pyt
-0000c170: 686f 6e23 6469 7370 7574 6573 0a20 2020  hon#disputes.   
-0000c180: 2022 2222 0a0a 2020 2020 7374 7269 7065   """..    stripe
-0000c190: 5f63 6c61 7373 203d 2073 7472 6970 652e  _class = stripe.
-0000c1a0: 4469 7370 7574 650a 2020 2020 7374 7269  Dispute.    stri
-0000c1b0: 7065 5f64 6173 6862 6f61 7264 5f69 7465  pe_dashboard_ite
-0000c1c0: 6d5f 6e61 6d65 203d 2022 7061 796d 656e  m_name = "paymen
-0000c1d0: 7473 220a 0a20 2020 2061 6d6f 756e 7420  ts"..    amount 
-0000c1e0: 3d20 5374 7269 7065 5175 616e 7475 6d43  = StripeQuantumC
-0000c1f0: 7572 7265 6e63 7941 6d6f 756e 7446 6965  urrencyAmountFie
-0000c200: 6c64 280a 2020 2020 2020 2020 6865 6c70  ld(.        help
-0000c210: 5f74 6578 743d 280a 2020 2020 2020 2020  _text=(.        
-0000c220: 2020 2020 2244 6973 7075 7465 6420 616d      "Disputed am
-0000c230: 6f75 6e74 2028 696e 2063 656e 7473 292e  ount (in cents).
-0000c240: 2055 7375 616c 6c79 2074 6865 2061 6d6f   Usually the amo
-0000c250: 756e 7420 6f66 2074 6865 2063 6861 7267  unt of the charg
-0000c260: 652c 2022 0a20 2020 2020 2020 2020 2020  e, ".           
-0000c270: 2022 6275 7420 6361 6e20 6469 6666 6572   "but can differ
-0000c280: 2022 0a20 2020 2020 2020 2020 2020 2022   ".            "
-0000c290: 2875 7375 616c 6c79 2062 6563 6175 7365  (usually because
-0000c2a0: 206f 6620 6375 7272 656e 6379 2066 6c75   of currency flu
-0000c2b0: 6374 7561 7469 6f6e 206f 7220 6265 6361  ctuation or beca
-0000c2c0: 7573 6520 6f6e 6c79 2070 6172 7420 6f66  use only part of
-0000c2d0: 2022 0a20 2020 2020 2020 2020 2020 2022   ".            "
-0000c2e0: 7468 6520 6f72 6465 7220 6973 2064 6973  the order is dis
-0000c2f0: 7075 7465 6429 2e22 0a20 2020 2020 2020  puted).".       
-0000c300: 2029 0a20 2020 2029 0a20 2020 2062 616c   ).    ).    bal
-0000c310: 616e 6365 5f74 7261 6e73 6163 7469 6f6e  ance_transaction
-0000c320: 203d 2053 7472 6970 6546 6f72 6569 676e   = StripeForeign
-0000c330: 4b65 7928 0a20 2020 2020 2020 2022 4261  Key(.        "Ba
-0000c340: 6c61 6e63 6554 7261 6e73 6163 7469 6f6e  lanceTransaction
-0000c350: 222c 0a20 2020 2020 2020 206e 756c 6c3d  ",.        null=
-0000c360: 5472 7565 2c0a 2020 2020 2020 2020 6f6e  True,.        on
-0000c370: 5f64 656c 6574 653d 6d6f 6465 6c73 2e43  _delete=models.C
-0000c380: 4153 4341 4445 2c0a 2020 2020 2020 2020  ASCADE,.        
-0000c390: 7265 6c61 7465 645f 6e61 6d65 3d22 6469  related_name="di
-0000c3a0: 7370 7574 6573 222c 0a20 2020 2020 2020  sputes",.       
-0000c3b0: 2068 656c 705f 7465 7874 3d22 4261 6c61   help_text="Bala
-0000c3c0: 6e63 6520 7472 616e 7361 6374 696f 6e20  nce transaction 
-0000c3d0: 7468 6174 2064 6573 6372 6962 6573 2074  that describes t
-0000c3e0: 6865 2069 6d70 6163 7420 6f6e 2079 6f75  he impact on you
-0000c3f0: 7220 220a 2020 2020 2020 2020 2261 6363  r ".        "acc
-0000c400: 6f75 6e74 2062 616c 616e 6365 2e22 2c0a  ount balance.",.
-0000c410: 2020 2020 290a 2020 2020 6261 6c61 6e63      ).    balanc
-0000c420: 655f 7472 616e 7361 6374 696f 6e73 203d  e_transactions =
-0000c430: 204a 534f 4e46 6965 6c64 280a 2020 2020   JSONField(.    
-0000c440: 2020 2020 6465 6661 756c 743d 6c69 7374      default=list
-0000c450: 2c0a 2020 2020 2020 2020 6865 6c70 5f74  ,.        help_t
-0000c460: 6578 743d 224c 6973 7420 6f66 2030 2c20  ext="List of 0, 
-0000c470: 3120 6f72 2032 2042 616c 616e 6365 2054  1 or 2 Balance T
-0000c480: 7261 6e73 6163 7469 6f6e 7320 7468 6174  ransactions that
-0000c490: 2073 686f 7720 6675 6e64 7320 7769 7468   show funds with
-0000c4a0: 6472 6177 6e20 616e 6420 7265 696e 7374  drawn and reinst
-0000c4b0: 6174 6564 2074 6f20 796f 7572 2053 7472  ated to your Str
-0000c4c0: 6970 6520 6163 636f 756e 7420 6173 2061  ipe account as a
-0000c4d0: 2072 6573 756c 7420 6f66 2074 6869 7320   result of this 
-0000c4e0: 6469 7370 7574 652e 222c 0a20 2020 2029  dispute.",.    )
-0000c4f0: 0a20 2020 2023 2063 6861 7267 6520 6973  .    # charge is
-0000c500: 206e 756c 6c61 626c 6520 746f 2061 766f   nullable to avo
-0000c510: 6964 2069 6e66 696e 6974 6520 7379 6e63  id infinite sync
-0000c520: 2061 7320 4368 6172 6765 206d 6f64 656c   as Charge model
-0000c530: 2068 6173 2061 2064 6973 7075 7465 2066   has a dispute f
-0000c540: 6965 6c64 2061 7320 7765 6c6c 0a20 2020  ield as well.   
-0000c550: 2063 6861 7267 6520 3d20 5374 7269 7065   charge = Stripe
-0000c560: 466f 7265 6967 6e4b 6579 280a 2020 2020  ForeignKey(.    
-0000c570: 2020 2020 2243 6861 7267 6522 2c0a 2020      "Charge",.  
-0000c580: 2020 2020 2020 6e75 6c6c 3d54 7275 652c        null=True,
-0000c590: 0a20 2020 2020 2020 206f 6e5f 6465 6c65  .        on_dele
-0000c5a0: 7465 3d6d 6f64 656c 732e 4341 5343 4144  te=models.CASCAD
-0000c5b0: 452c 0a20 2020 2020 2020 2072 656c 6174  E,.        relat
-0000c5c0: 6564 5f6e 616d 653d 2264 6973 7075 7465  ed_name="dispute
-0000c5d0: 7322 2c0a 2020 2020 2020 2020 6865 6c70  s",.        help
-0000c5e0: 5f74 6578 743d 2254 6865 2063 6861 7267  _text="The charg
-0000c5f0: 6520 7468 6174 2077 6173 2064 6973 7075  e that was dispu
-0000c600: 7465 6422 2c0a 2020 2020 290a 2020 2020  ted",.    ).    
-0000c610: 6375 7272 656e 6379 203d 2053 7472 6970  currency = Strip
-0000c620: 6543 7572 7265 6e63 7943 6f64 6546 6965  eCurrencyCodeFie
-0000c630: 6c64 2829 0a20 2020 2065 7669 6465 6e63  ld().    evidenc
-0000c640: 6520 3d20 4a53 4f4e 4669 656c 6428 6865  e = JSONField(he
-0000c650: 6c70 5f74 6578 743d 2245 7669 6465 6e63  lp_text="Evidenc
-0000c660: 6520 7072 6f76 6964 6564 2074 6f20 7265  e provided to re
-0000c670: 7370 6f6e 6420 746f 2061 2064 6973 7075  spond to a dispu
-0000c680: 7465 2e22 290a 2020 2020 6576 6964 656e  te.").    eviden
-0000c690: 6365 5f64 6574 6169 6c73 203d 204a 534f  ce_details = JSO
-0000c6a0: 4e46 6965 6c64 2868 656c 705f 7465 7874  NField(help_text
-0000c6b0: 3d22 496e 666f 726d 6174 696f 6e20 6162  ="Information ab
-0000c6c0: 6f75 7420 7468 6520 6576 6964 656e 6365  out the evidence
-0000c6d0: 2073 7562 6d69 7373 696f 6e2e 2229 0a20   submission."). 
-0000c6e0: 2020 2069 735f 6368 6172 6765 5f72 6566     is_charge_ref
-0000c6f0: 756e 6461 626c 6520 3d20 6d6f 6465 6c73  undable = models
-0000c700: 2e42 6f6f 6c65 616e 4669 656c 6428 0a20  .BooleanField(. 
-0000c710: 2020 2020 2020 2068 656c 705f 7465 7874         help_text
-0000c720: 3d28 0a20 2020 2020 2020 2020 2020 2022  =(.            "
-0000c730: 4966 2074 7275 652c 2069 7420 6973 2073  If true, it is s
-0000c740: 7469 6c6c 2070 6f73 7369 626c 6520 746f  till possible to
-0000c750: 2072 6566 756e 6420 7468 6520 6469 7370   refund the disp
-0000c760: 7574 6564 2070 6179 6d65 6e74 2e20 220a  uted payment. ".
-0000c770: 2020 2020 2020 2020 2020 2020 224f 6e63              "Onc
-0000c780: 6520 7468 6520 7061 796d 656e 7420 6861  e the payment ha
-0000c790: 7320 6265 656e 2066 756c 6c79 2072 6566  s been fully ref
-0000c7a0: 756e 6465 642c 206e 6f20 6675 7274 6865  unded, no furthe
-0000c7b0: 7220 6675 6e64 7320 7769 6c6c 2022 0a20  r funds will ". 
-0000c7c0: 2020 2020 2020 2020 2020 2022 6265 2077             "be w
-0000c7d0: 6974 6864 7261 776e 2066 726f 6d20 796f  ithdrawn from yo
-0000c7e0: 7572 2053 7472 6970 6520 6163 636f 756e  ur Stripe accoun
-0000c7f0: 7420 6173 2061 2072 6573 756c 7420 6f66  t as a result of
-0000c800: 2074 6869 7320 6469 7370 7574 652e 220a   this dispute.".
-0000c810: 2020 2020 2020 2020 290a 2020 2020 290a          ).    ).
-0000c820: 2020 2020 7061 796d 656e 745f 696e 7465      payment_inte
-0000c830: 6e74 203d 2053 7472 6970 6546 6f72 6569  nt = StripeForei
-0000c840: 676e 4b65 7928 0a20 2020 2020 2020 2022  gnKey(.        "
-0000c850: 5061 796d 656e 7449 6e74 656e 7422 2c0a  PaymentIntent",.
-0000c860: 2020 2020 2020 2020 6e75 6c6c 3d54 7275          null=Tru
-0000c870: 652c 0a20 2020 2020 2020 206f 6e5f 6465  e,.        on_de
-0000c880: 6c65 7465 3d6d 6f64 656c 732e 4341 5343  lete=models.CASC
-0000c890: 4144 452c 0a20 2020 2020 2020 2072 656c  ADE,.        rel
-0000c8a0: 6174 6564 5f6e 616d 653d 2264 6973 7075  ated_name="dispu
-0000c8b0: 7465 7322 2c0a 2020 2020 2020 2020 6865  tes",.        he
-0000c8c0: 6c70 5f74 6578 743d 2254 6865 2050 6179  lp_text="The Pay
-0000c8d0: 6d65 6e74 496e 7465 6e74 2074 6861 7420  mentIntent that 
-0000c8e0: 7761 7320 6469 7370 7574 6564 222c 0a20  was disputed",. 
-0000c8f0: 2020 2029 0a20 2020 2072 6561 736f 6e20     ).    reason 
-0000c900: 3d20 5374 7269 7065 456e 756d 4669 656c  = StripeEnumFiel
-0000c910: 6428 656e 756d 3d65 6e75 6d73 2e44 6973  d(enum=enums.Dis
-0000c920: 7075 7465 5265 6173 6f6e 290a 2020 2020  puteReason).    
-0000c930: 7374 6174 7573 203d 2053 7472 6970 6545  status = StripeE
-0000c940: 6e75 6d46 6965 6c64 2865 6e75 6d3d 656e  numField(enum=en
-0000c950: 756d 732e 4469 7370 7574 6553 7461 7475  ums.DisputeStatu
-0000c960: 7329 0a0a 2020 2020 6465 6620 5f5f 7374  s)..    def __st
-0000c970: 725f 5f28 7365 6c66 293a 0a20 2020 2020  r__(self):.     
-0000c980: 2020 2061 6d6f 756e 7420 3d20 6765 745f     amount = get_
-0000c990: 6672 6965 6e64 6c79 5f63 7572 7265 6e63  friendly_currenc
-0000c9a0: 795f 616d 6f75 6e74 2873 656c 662e 616d  y_amount(self.am
-0000c9b0: 6f75 6e74 202f 2031 3030 2c20 7365 6c66  ount / 100, self
-0000c9c0: 2e63 7572 7265 6e63 7929 0a20 2020 2020  .currency).     
-0000c9d0: 2020 2073 7461 7475 7320 3d20 656e 756d     status = enum
-0000c9e0: 732e 4469 7370 7574 6553 7461 7475 732e  s.DisputeStatus.
-0000c9f0: 6875 6d61 6e69 7a65 2873 656c 662e 7374  humanize(self.st
-0000ca00: 6174 7573 290a 2020 2020 2020 2020 7265  atus).        re
-0000ca10: 7475 726e 2066 227b 616d 6f75 6e74 7d20  turn f"{amount} 
-0000ca20: 287b 7374 6174 7573 7d29 2022 0a0a 2020  ({status}) "..  
-0000ca30: 2020 6465 6620 6765 745f 7374 7269 7065    def get_stripe
-0000ca40: 5f64 6173 6862 6f61 7264 5f75 726c 2873  _dashboard_url(s
-0000ca50: 656c 6629 202d 3e20 7374 723a 0a20 2020  elf) -> str:.   
-0000ca60: 2020 2020 2022 2222 4765 7420 7468 6520       """Get the 
-0000ca70: 7374 7269 7065 2064 6173 6862 6f61 7264  stripe dashboard
-0000ca80: 2075 726c 2066 6f72 2074 6869 7320 6f62   url for this ob
-0000ca90: 6a65 6374 2e22 2222 0a20 2020 2020 2020  ject.""".       
-0000caa0: 2072 6574 7572 6e20 280a 2020 2020 2020   return (.      
-0000cab0: 2020 2020 2020 6622 7b73 656c 662e 5f67        f"{self._g
-0000cac0: 6574 5f62 6173 655f 7374 7269 7065 5f64  et_base_stripe_d
-0000cad0: 6173 6862 6f61 7264 5f75 726c 2829 7d22  ashboard_url()}"
-0000cae0: 0a20 2020 2020 2020 2020 2020 2066 227b  .            f"{
-0000caf0: 7365 6c66 2e73 7472 6970 655f 6461 7368  self.stripe_dash
-0000cb00: 626f 6172 645f 6974 656d 5f6e 616d 657d  board_item_name}
-0000cb10: 2f7b 7365 6c66 2e70 6179 6d65 6e74 5f69  /{self.payment_i
-0000cb20: 6e74 656e 742e 6964 7d22 0a20 2020 2020  ntent.id}".     
-0000cb30: 2020 2029 0a0a 2020 2020 6465 6620 5f61     )..    def _a
-0000cb40: 7474 6163 685f 6f62 6a65 6374 735f 706f  ttach_objects_po
-0000cb50: 7374 5f73 6176 655f 686f 6f6b 280a 2020  st_save_hook(.  
-0000cb60: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-0000cb70: 2020 2020 636c 732c 0a20 2020 2020 2020      cls,.       
-0000cb80: 2064 6174 612c 0a20 2020 2020 2020 2070   data,.        p
-0000cb90: 656e 6469 6e67 5f72 656c 6174 696f 6e73  ending_relations
-0000cba0: 3d4e 6f6e 652c 0a20 2020 2020 2020 2061  =None,.        a
-0000cbb0: 7069 5f6b 6579 3d64 6a73 7472 6970 655f  pi_key=djstripe_
-0000cbc0: 7365 7474 696e 6773 2e53 5452 4950 455f  settings.STRIPE_
-0000cbd0: 5345 4352 4554 5f4b 4559 2c0a 2020 2020  SECRET_KEY,.    
-0000cbe0: 293a 0a0a 2020 2020 2020 2020 7375 7065  ):..        supe
-0000cbf0: 7228 292e 5f61 7474 6163 685f 6f62 6a65  r()._attach_obje
-0000cc00: 6374 735f 706f 7374 5f73 6176 655f 686f  cts_post_save_ho
-0000cc10: 6f6b 280a 2020 2020 2020 2020 2020 2020  ok(.            
-0000cc20: 636c 732c 2064 6174 612c 2070 656e 6469  cls, data, pendi
-0000cc30: 6e67 5f72 656c 6174 696f 6e73 3d70 656e  ng_relations=pen
-0000cc40: 6469 6e67 5f72 656c 6174 696f 6e73 2c20  ding_relations, 
-0000cc50: 6170 695f 6b65 793d 6170 695f 6b65 790a  api_key=api_key.
-0000cc60: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-0000cc70: 2020 2023 2052 6574 7269 6576 6520 616e     # Retrieve an
-0000cc80: 6420 7361 7665 2066 696c 6573 2066 726f  d save files fro
-0000cc90: 6d20 7468 6520 6469 7370 7574 652e 6576  m the dispute.ev
-0000cca0: 6964 656e 6365 206f 626a 6563 742e 0a20  idence object.. 
-0000ccb0: 2020 2020 2020 2023 2074 6f64 6f20 6669         # todo fi
-0000ccc0: 6e64 2061 2062 6574 7465 7220 7761 7920  nd a better way 
-0000ccd0: 6f66 2072 6574 7269 6576 696e 6720 616e  of retrieving an
-0000cce0: 6420 7379 6e63 696e 6720 4669 6c65 2054  d syncing File T
-0000ccf0: 7970 6520 6669 656c 6473 2066 726f 6d20  ype fields from 
-0000cd00: 4469 7370 7574 6520 6f62 6a65 6374 0a20  Dispute object. 
-0000cd10: 2020 2020 2020 2066 6f72 2066 6965 6c64         for field
-0000cd20: 2069 6e20 280a 2020 2020 2020 2020 2020   in (.          
-0000cd30: 2020 2263 616e 6365 6c6c 6174 696f 6e5f    "cancellation_
-0000cd40: 706f 6c69 6379 222c 0a20 2020 2020 2020  policy",.       
-0000cd50: 2020 2020 2022 6375 7374 6f6d 6572 5f63       "customer_c
-0000cd60: 6f6d 6d75 6e69 6361 7469 6f6e 222c 0a20  ommunication",. 
-0000cd70: 2020 2020 2020 2020 2020 2022 6375 7374             "cust
-0000cd80: 6f6d 6572 5f73 6967 6e61 7475 7265 222c  omer_signature",
-0000cd90: 0a20 2020 2020 2020 2020 2020 2022 6475  .            "du
-0000cda0: 706c 6963 6174 655f 6368 6172 6765 5f64  plicate_charge_d
-0000cdb0: 6f63 756d 656e 7461 7469 6f6e 222c 0a20  ocumentation",. 
-0000cdc0: 2020 2020 2020 2020 2020 2022 7265 6365             "rece
-0000cdd0: 6970 7422 2c0a 2020 2020 2020 2020 2020  ipt",.          
-0000cde0: 2020 2272 6566 756e 645f 706f 6c69 6379    "refund_policy
-0000cdf0: 222c 0a20 2020 2020 2020 2020 2020 2022  ",.            "
-0000ce00: 7365 7276 6963 655f 646f 6375 6d65 6e74  service_document
-0000ce10: 6174 696f 6e22 2c0a 2020 2020 2020 2020  ation",.        
-0000ce20: 2020 2020 2273 6869 7070 696e 675f 646f      "shipping_do
-0000ce30: 6375 6d65 6e74 6174 696f 6e22 2c0a 2020  cumentation",.  
-0000ce40: 2020 2020 2020 2020 2020 2275 6e63 6174            "uncat
-0000ce50: 6567 6f72 697a 6564 5f66 696c 6522 2c0a  egorized_file",.
-0000ce60: 2020 2020 2020 2020 293a 0a20 2020 2020          ):.     
-0000ce70: 2020 2020 2020 2066 696c 655f 7570 6c6f         file_uplo
-0000ce80: 6164 5f69 6420 3d20 7365 6c66 2e65 7669  ad_id = self.evi
-0000ce90: 6465 6e63 652e 6765 7428 6669 656c 642c  dence.get(field,
-0000cea0: 204e 6f6e 6529 0a20 2020 2020 2020 2020   None).         
-0000ceb0: 2020 2069 6620 6669 6c65 5f75 706c 6f61     if file_uploa
-0000cec0: 645f 6964 3a0a 2020 2020 2020 2020 2020  d_id:.          
-0000ced0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-0000cee0: 2020 2020 2020 2020 2020 2020 2020 2046                 F
-0000cef0: 696c 652e 7379 6e63 5f66 726f 6d5f 7374  ile.sync_from_st
-0000cf00: 7269 7065 5f64 6174 6128 0a20 2020 2020  ripe_data(.     
-0000cf10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cf20: 2020 2046 696c 6528 6964 3d66 696c 655f     File(id=file_
-0000cf30: 7570 6c6f 6164 5f69 6429 2e61 7069 5f72  upload_id).api_r
-0000cf40: 6574 7269 6576 6528 6170 695f 6b65 793d  etrieve(api_key=
-0000cf50: 6170 695f 6b65 7929 2c0a 2020 2020 2020  api_key),.      
-0000cf60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cf70: 2020 6170 695f 6b65 793d 6170 695f 6b65    api_key=api_ke
-0000cf80: 792c 0a20 2020 2020 2020 2020 2020 2020  y,.             
-0000cf90: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0000cfa0: 2020 2020 2020 2020 2065 7863 6570 7420           except 
-0000cfb0: 7374 7269 7065 2e65 7272 6f72 2e50 6572  stripe.error.Per
-0000cfc0: 6d69 7373 696f 6e45 7272 6f72 3a0a 2020  missionError:.  
-0000cfd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cfe0: 2020 2320 4e6f 2070 6572 6d69 7373 696f    # No permissio
-0000cff0: 6e20 746f 2072 6574 7269 6576 6520 7468  n to retrieve th
-0000d000: 6520 6461 7461 2077 6974 6820 7468 6520  e data with the 
-0000d010: 6b65 790a 2020 2020 2020 2020 2020 2020  key.            
-0000d020: 2020 2020 2020 2020 2320 4c6f 6720 6120          # Log a 
-0000d030: 7761 726e 696e 6720 6d65 7373 6167 650a  warning message.
-0000d040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d050: 2020 2020 6c6f 6767 6572 2e77 6172 6e69      logger.warni
-0000d060: 6e67 280a 2020 2020 2020 2020 2020 2020  ng(.            
-0000d070: 2020 2020 2020 2020 2020 2020 224e 6f20              "No 
-0000d080: 7065 726d 6973 7369 6f6e 2074 6f20 7265  permission to re
-0000d090: 7472 6965 7665 2074 6865 2046 696c 6520  trieve the File 
-0000d0a0: 4576 6964 656e 6365 204f 626a 6563 742e  Evidence Object.
-0000d0b0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0000d0c0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0000d0d0: 2020 2020 2020 2020 6578 6365 7074 2073          except s
-0000d0e0: 7472 6970 652e 6572 726f 722e 496e 7661  tripe.error.Inva
-0000d0f0: 6c69 6452 6571 7565 7374 4572 726f 723a  lidRequestError:
-0000d100: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d110: 2020 2020 2072 6169 7365 0a0a 2020 2020       raise..    
-0000d120: 2020 2020 2320 6974 6572 6174 6520 616e      # iterate an
-0000d130: 6420 7379 6e63 2065 7665 7279 2062 616c  d sync every bal
-0000d140: 616e 6365 2074 7261 6e73 6163 7469 6f6e  ance transaction
-0000d150: 0a20 2020 2020 2020 2066 6f72 2073 7472  .        for str
-0000d160: 6970 655f 6261 6c61 6e63 655f 7472 616e  ipe_balance_tran
-0000d170: 7361 6374 696f 6e20 696e 2073 656c 662e  saction in self.
-0000d180: 6261 6c61 6e63 655f 7472 616e 7361 6374  balance_transact
-0000d190: 696f 6e73 3a0a 2020 2020 2020 2020 2020  ions:.          
-0000d1a0: 2020 4261 6c61 6e63 6554 7261 6e73 6163    BalanceTransac
-0000d1b0: 7469 6f6e 2e73 796e 635f 6672 6f6d 5f73  tion.sync_from_s
-0000d1c0: 7472 6970 655f 6461 7461 280a 2020 2020  tripe_data(.    
-0000d1d0: 2020 2020 2020 2020 2020 2020 7374 7269              stri
-0000d1e0: 7065 5f62 616c 616e 6365 5f74 7261 6e73  pe_balance_trans
-0000d1f0: 6163 7469 6f6e 2c20 6170 695f 6b65 793d  action, api_key=
-0000d200: 6170 695f 6b65 790a 2020 2020 2020 2020  api_key.        
-0000d210: 2020 2020 290a 0a0a 636c 6173 7320 4576      )...class Ev
-0000d220: 656e 7428 5374 7269 7065 4d6f 6465 6c29  ent(StripeModel)
-0000d230: 3a0a 2020 2020 2222 220a 2020 2020 4576  :.    """.    Ev
-0000d240: 656e 7473 2061 7265 2053 7472 6970 6527  ents are Stripe'
-0000d250: 7320 7761 7920 6f66 206c 6574 7469 6e67  s way of letting
-0000d260: 2079 6f75 206b 6e6f 7720 7768 656e 2073   you know when s
-0000d270: 6f6d 6574 6869 6e67 2069 6e74 6572 6573  omething interes
-0000d280: 7469 6e67 0a20 2020 2068 6170 7065 6e73  ting.    happens
-0000d290: 2069 6e20 796f 7572 2061 6363 6f75 6e74   in your account
-0000d2a0: 2e0a 2020 2020 5768 656e 2061 6e20 696e  ..    When an in
-0000d2b0: 7465 7265 7374 696e 6720 6576 656e 7420  teresting event 
-0000d2c0: 6f63 6375 7273 2c20 6120 6e65 7720 4576  occurs, a new Ev
-0000d2d0: 656e 7420 6f62 6a65 6374 2069 7320 6372  ent object is cr
-0000d2e0: 6561 7465 6420 616e 6420 504f 5354 6564  eated and POSTed
-0000d2f0: 0a20 2020 2074 6f20 7468 6520 636f 6e66  .    to the conf
-0000d300: 6967 7572 6564 2077 6562 686f 6f6b 2055  igured webhook U
-0000d310: 524c 2069 6620 7468 6520 4576 656e 7420  RL if the Event 
-0000d320: 7479 7065 206d 6174 6368 6573 2e0a 0a20  type matches... 
-0000d330: 2020 2053 7472 6970 6520 646f 6375 6d65     Stripe docume
-0000d340: 6e74 6174 696f 6e3a 2068 7474 7073 3a2f  ntation: https:/
-0000d350: 2f73 7472 6970 652e 636f 6d2f 646f 6373  /stripe.com/docs
-0000d360: 2f61 7069 2f65 7665 6e74 733f 6c61 6e67  /api/events?lang
-0000d370: 3d70 7974 686f 6e0a 2020 2020 2222 220a  =python.    """.
-0000d380: 0a20 2020 2073 7472 6970 655f 636c 6173  .    stripe_clas
-0000d390: 7320 3d20 7374 7269 7065 2e45 7665 6e74  s = stripe.Event
-0000d3a0: 0a20 2020 2073 7472 6970 655f 6461 7368  .    stripe_dash
-0000d3b0: 626f 6172 645f 6974 656d 5f6e 616d 6520  board_item_name 
-0000d3c0: 3d20 2265 7665 6e74 7322 0a0a 2020 2020  = "events"..    
-0000d3d0: 6170 695f 7665 7273 696f 6e20 3d20 6d6f  api_version = mo
-0000d3e0: 6465 6c73 2e43 6861 7246 6965 6c64 280a  dels.CharField(.
-0000d3f0: 2020 2020 2020 2020 6d61 785f 6c65 6e67          max_leng
-0000d400: 7468 3d36 342c 0a20 2020 2020 2020 2062  th=64,.        b
-0000d410: 6c61 6e6b 3d54 7275 652c 0a20 2020 2020  lank=True,.     
-0000d420: 2020 2068 656c 705f 7465 7874 3d22 7468     help_text="th
-0000d430: 6520 4150 4920 7665 7273 696f 6e20 6174  e API version at
-0000d440: 2077 6869 6368 2074 6865 2065 7665 6e74   which the event
-0000d450: 2064 6174 6120 7761 7320 220a 2020 2020   data was ".    
-0000d460: 2020 2020 2272 656e 6465 7265 642e 2042      "rendered. B
-0000d470: 6c61 6e6b 2066 6f72 206f 6c64 2065 6e74  lank for old ent
-0000d480: 7269 6573 206f 6e6c 792c 2061 6c6c 206e  ries only, all n
-0000d490: 6577 2065 6e74 7269 6573 2077 696c 6c20  ew entries will 
-0000d4a0: 6861 7665 2074 6869 7320 7661 6c75 6522  have this value"
-0000d4b0: 2c0a 2020 2020 290a 2020 2020 6461 7461  ,.    ).    data
-0000d4c0: 203d 204a 534f 4e46 6965 6c64 280a 2020   = JSONField(.  
-0000d4d0: 2020 2020 2020 6865 6c70 5f74 6578 743d        help_text=
-0000d4e0: 2264 6174 6120 7265 6365 6976 6564 2061  "data received a
-0000d4f0: 7420 7765 6268 6f6f 6b2e 2064 6174 6120  t webhook. data 
-0000d500: 7368 6f75 6c64 2062 6520 636f 6e73 6964  should be consid
-0000d510: 6572 6564 2074 6f20 6265 2067 6172 6261  ered to be garba
-0000d520: 6765 2022 0a20 2020 2020 2020 2022 756e  ge ".        "un
-0000d530: 7469 6c20 7661 6c69 6469 7479 2063 6865  til validity che
-0000d540: 636b 2069 7320 7275 6e20 616e 6420 7661  ck is run and va
-0000d550: 6c69 6420 666c 6167 2069 7320 7365 7422  lid flag is set"
-0000d560: 0a20 2020 2029 0a20 2020 2072 6571 7565  .    ).    reque
-0000d570: 7374 5f69 6420 3d20 6d6f 6465 6c73 2e43  st_id = models.C
-0000d580: 6861 7246 6965 6c64 280a 2020 2020 2020  harField(.      
-0000d590: 2020 6d61 785f 6c65 6e67 7468 3d35 302c    max_length=50,
-0000d5a0: 0a20 2020 2020 2020 2068 656c 705f 7465  .        help_te
-0000d5b0: 7874 3d22 496e 666f 726d 6174 696f 6e20  xt="Information 
-0000d5c0: 6162 6f75 7420 7468 6520 7265 7175 6573  about the reques
-0000d5d0: 7420 7468 6174 2074 7269 6767 6572 6564  t that triggered
-0000d5e0: 2074 6869 7320 6576 656e 742c 2022 0a20   this event, ". 
-0000d5f0: 2020 2020 2020 2022 666f 7220 7472 6163         "for trac
-0000d600: 6561 6269 6c69 7479 2070 7572 706f 7365  eability purpose
-0000d610: 732e 2049 6620 656d 7074 7920 7374 7269  s. If empty stri
-0000d620: 6e67 2074 6865 6e20 7468 6973 2069 7320  ng then this is 
-0000d630: 616e 206f 6c64 2065 6e74 7279 2022 0a20  an old entry ". 
-0000d640: 2020 2020 2020 2022 7769 7468 6f75 7420         "without 
-0000d650: 7468 6174 2064 6174 612e 2049 6620 4e75  that data. If Nu
-0000d660: 6c6c 2074 6865 6e20 7468 6973 2069 7320  ll then this is 
-0000d670: 6e6f 7420 616e 206f 6c64 2065 6e74 7279  not an old entry
-0000d680: 2c20 6275 7420 6120 5374 7269 7065 2022  , but a Stripe "
-0000d690: 0a20 2020 2020 2020 2022 2761 7574 6f6d  .        "'autom
-0000d6a0: 6174 6564 2720 6576 656e 7420 7769 7468  ated' event with
-0000d6b0: 206e 6f20 6173 736f 6369 6174 6564 2072   no associated r
-0000d6c0: 6571 7565 7374 2e22 2c0a 2020 2020 2020  equest.",.      
-0000d6d0: 2020 6465 6661 756c 743d 2222 2c0a 2020    default="",.  
-0000d6e0: 2020 2020 2020 626c 616e 6b3d 5472 7565        blank=True
-0000d6f0: 2c0a 2020 2020 290a 2020 2020 6964 656d  ,.    ).    idem
-0000d700: 706f 7465 6e63 795f 6b65 7920 3d20 6d6f  potency_key = mo
-0000d710: 6465 6c73 2e54 6578 7446 6965 6c64 2864  dels.TextField(d
-0000d720: 6566 6175 6c74 3d22 222c 2062 6c61 6e6b  efault="", blank
-0000d730: 3d54 7275 6529 0a20 2020 2074 7970 6520  =True).    type 
-0000d740: 3d20 6d6f 6465 6c73 2e43 6861 7246 6965  = models.CharFie
-0000d750: 6c64 286d 6178 5f6c 656e 6774 683d 3235  ld(max_length=25
-0000d760: 302c 2068 656c 705f 7465 7874 3d22 5374  0, help_text="St
-0000d770: 7269 7065 2773 2065 7665 6e74 2064 6573  ripe's event des
-0000d780: 6372 6970 7469 6f6e 2063 6f64 6522 290a  cription code").
-0000d790: 0a20 2020 2064 6566 205f 5f73 7472 5f5f  .    def __str__
-0000d7a0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-0000d7b0: 7265 7475 726e 2066 2274 7970 653d 7b73  return f"type={s
-0000d7c0: 656c 662e 7479 7065 7d2c 2069 643d 7b73  elf.type}, id={s
-0000d7d0: 656c 662e 6964 7d22 0a0a 2020 2020 6465  elf.id}"..    de
-0000d7e0: 6620 5f61 7474 6163 685f 6f62 6a65 6374  f _attach_object
-0000d7f0: 735f 686f 6f6b 280a 2020 2020 2020 2020  s_hook(.        
-0000d800: 7365 6c66 2c20 636c 732c 2064 6174 612c  self, cls, data,
-0000d810: 2063 7572 7265 6e74 5f69 6473 3d4e 6f6e   current_ids=Non
-0000d820: 652c 2061 7069 5f6b 6579 3d64 6a73 7472  e, api_key=djstr
-0000d830: 6970 655f 7365 7474 696e 6773 2e53 5452  ipe_settings.STR
-0000d840: 4950 455f 5345 4352 4554 5f4b 4559 0a20  IPE_SECRET_KEY. 
-0000d850: 2020 2029 3a0a 2020 2020 2020 2020 6966     ):.        if
-0000d860: 2073 656c 662e 6170 695f 7665 7273 696f   self.api_versio
-0000d870: 6e20 6973 204e 6f6e 653a 0a20 2020 2020  n is None:.     
-0000d880: 2020 2020 2020 2023 2061 7320 6f66 2061         # as of a
-0000d890: 7069 2076 6572 7369 6f6e 2032 3031 372d  pi version 2017-
-0000d8a0: 3032 2d31 342c 2074 6865 2061 6363 6f75  02-14, the accou
-0000d8b0: 6e74 2e61 7070 6c69 6361 7469 6f6e 2e64  nt.application.d
-0000d8c0: 6561 7574 686f 7269 7a65 640a 2020 2020  eauthorized.    
-0000d8d0: 2020 2020 2020 2020 2320 6576 656e 7420          # event 
-0000d8e0: 7365 6e64 7320 4e6f 6e65 2061 7320 6170  sends None as ap
-0000d8f0: 695f 7665 7273 696f 6e2e 0a20 2020 2020  i_version..     
-0000d900: 2020 2020 2020 2023 2049 6620 7765 2072         # If we r
-0000d910: 6563 6569 7665 2074 6861 742c 2073 746f  eceive that, sto
-0000d920: 7265 2061 6e20 656d 7074 7920 7374 7269  re an empty stri
-0000d930: 6e67 2069 6e73 7465 6164 2e0a 2020 2020  ng instead..    
-0000d940: 2020 2020 2020 2020 2320 5265 6d6f 7665          # Remove
-0000d950: 2074 6869 7320 6861 636b 2069 6620 7468   this hack if th
-0000d960: 6973 2067 6574 7320 6669 7865 6420 7570  is gets fixed up
-0000d970: 7374 7265 616d 2e0a 2020 2020 2020 2020  stream..        
-0000d980: 2020 2020 7365 6c66 2e61 7069 5f76 6572      self.api_ver
-0000d990: 7369 6f6e 203d 2022 220a 0a20 2020 2020  sion = ""..     
-0000d9a0: 2020 2072 6571 7565 7374 5f6f 626a 203d     request_obj =
-0000d9b0: 2064 6174 612e 6765 7428 2272 6571 7565   data.get("reque
-0000d9c0: 7374 222c 204e 6f6e 6529 0a20 2020 2020  st", None).     
-0000d9d0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-0000d9e0: 2872 6571 7565 7374 5f6f 626a 2c20 6469  (request_obj, di
-0000d9f0: 6374 293a 0a20 2020 2020 2020 2020 2020  ct):.           
-0000da00: 2023 2046 6f72 6d61 7420 6173 206f 6620   # Format as of 
-0000da10: 3230 3137 2d30 352d 3235 0a20 2020 2020  2017-05-25.     
-0000da20: 2020 2020 2020 2073 656c 662e 7265 7175         self.requ
-0000da30: 6573 745f 6964 203d 2072 6571 7565 7374  est_id = request
-0000da40: 5f6f 626a 2e67 6574 2822 6964 2229 206f  _obj.get("id") o
-0000da50: 7220 2222 0a20 2020 2020 2020 2020 2020  r "".           
-0000da60: 2073 656c 662e 6964 656d 706f 7465 6e63   self.idempotenc
-0000da70: 795f 6b65 7920 3d20 7265 7175 6573 745f  y_key = request_
-0000da80: 6f62 6a2e 6765 7428 2269 6465 6d70 6f74  obj.get("idempot
-0000da90: 656e 6379 5f6b 6579 2229 206f 7220 2222  ency_key") or ""
-0000daa0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-0000dab0: 2020 2020 2020 2020 2020 2023 2046 6f72             # For
-0000dac0: 6d61 7420 6265 666f 7265 2032 3031 372d  mat before 2017-
-0000dad0: 3035 2d32 350a 2020 2020 2020 2020 2020  05-25.          
-0000dae0: 2020 7365 6c66 2e72 6571 7565 7374 5f69    self.request_i
-0000daf0: 6420 3d20 7265 7175 6573 745f 6f62 6a20  d = request_obj 
-0000db00: 6f72 2022 220a 0a20 2020 2040 636c 6173  or ""..    @clas
-0000db10: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
-0000db20: 7072 6f63 6573 7328 636c 732c 2064 6174  process(cls, dat
-0000db30: 612c 2061 7069 5f6b 6579 3d64 6a73 7472  a, api_key=djstr
-0000db40: 6970 655f 7365 7474 696e 6773 2e53 5452  ipe_settings.STR
-0000db50: 4950 455f 5345 4352 4554 5f4b 4559 293a  IPE_SECRET_KEY):
-0000db60: 0a20 2020 2020 2020 2071 7320 3d20 636c  .        qs = cl
-0000db70: 732e 6f62 6a65 6374 732e 6669 6c74 6572  s.objects.filter
-0000db80: 2869 643d 6461 7461 5b22 6964 225d 290a  (id=data["id"]).
-0000db90: 2020 2020 2020 2020 6966 2071 732e 6578          if qs.ex
-0000dba0: 6973 7473 2829 3a0a 2020 2020 2020 2020  ists():.        
-0000dbb0: 2020 2020 7265 7475 726e 2071 732e 6669      return qs.fi
-0000dbc0: 7273 7428 290a 0a20 2020 2020 2020 2023  rst()..        #
-0000dbd0: 2052 6f6c 6c62 6163 6b20 616e 7920 4442   Rollback any DB
-0000dbe0: 206f 7065 7261 7469 6f6e 7320 696e 2074   operations in t
-0000dbf0: 6865 2063 6173 6520 6f66 2066 6169 6c75  he case of failu
-0000dc00: 7265 2073 6f0a 2020 2020 2020 2020 2320  re so.        # 
-0000dc10: 7765 2077 696c 6c20 7265 7472 7920 6372  we will retry cr
-0000dc20: 6561 7469 6e67 2061 6e64 2070 726f 6365  eating and proce
-0000dc30: 7373 696e 6720 7468 6520 6576 656e 7420  ssing the event 
-0000dc40: 7468 650a 2020 2020 2020 2020 2320 6e65  the.        # ne
-0000dc50: 7874 2074 696d 6520 7468 6520 7765 6268  xt time the webh
-0000dc60: 6f6f 6b20 6669 7265 732e 0a20 2020 2020  ook fires..     
-0000dc70: 2020 2077 6974 6820 7472 616e 7361 6374     with transact
-0000dc80: 696f 6e2e 6174 6f6d 6963 2829 3a0a 2020  ion.atomic():.  
-0000dc90: 2020 2020 2020 2020 2020 2320 7072 6f63            # proc
-0000dca0: 6573 7320 7468 6520 6576 656e 7420 616e  ess the event an
-0000dcb0: 6420 6372 6561 7465 2061 6e20 4576 656e  d create an Even
-0000dcc0: 7420 4f62 6a65 6374 0a20 2020 2020 2020  t Object.       
-0000dcd0: 2020 2020 2072 6574 203d 2063 6c73 2e5f       ret = cls._
-0000dce0: 6372 6561 7465 5f66 726f 6d5f 7374 7269  create_from_stri
-0000dcf0: 7065 5f6f 626a 6563 7428 6461 7461 2c20  pe_object(data, 
-0000dd00: 6170 695f 6b65 793d 6170 695f 6b65 7929  api_key=api_key)
-0000dd10: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0000dd20: 2e69 6e76 6f6b 655f 7765 6268 6f6f 6b5f  .invoke_webhook_
-0000dd30: 6861 6e64 6c65 7273 2829 0a20 2020 2020  handlers().     
-0000dd40: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
-0000dd50: 740a 0a20 2020 2064 6566 2069 6e76 6f6b  t..    def invok
-0000dd60: 655f 7765 6268 6f6f 6b5f 6861 6e64 6c65  e_webhook_handle
-0000dd70: 7273 2873 656c 6629 3a0a 2020 2020 2020  rs(self):.      
-0000dd80: 2020 2222 220a 2020 2020 2020 2020 496e    """.        In
-0000dd90: 766f 6b65 7320 616e 7920 7765 6268 6f6f  vokes any webhoo
-0000dda0: 6b20 6861 6e64 6c65 7273 2074 6861 7420  k handlers that 
-0000ddb0: 6861 7665 2062 6565 6e20 7265 6769 7374  have been regist
-0000ddc0: 6572 6564 2066 6f72 2074 6869 7320 6576  ered for this ev
-0000ddd0: 656e 740a 2020 2020 2020 2020 6261 7365  ent.        base
-0000dde0: 6420 6f6e 2065 7665 6e74 2074 7970 6520  d on event type 
-0000ddf0: 6f72 2065 7665 6e74 2073 7562 2d74 7970  or event sub-typ
-0000de00: 652e 0a0a 2020 2020 2020 2020 5365 6520  e...        See 
-0000de10: 6576 656e 7420 6861 6e64 6c65 7273 2072  event handlers r
-0000de20: 6567 6973 7465 7265 6420 696e 2074 6865  egistered in the
-0000de30: 2060 6064 6a73 7472 6970 652e 6576 656e   ``djstripe.even
-0000de40: 745f 6861 6e64 6c65 7273 6060 206d 6f64  t_handlers`` mod
-0000de50: 756c 650a 2020 2020 2020 2020 286f 7220  ule.        (or 
-0000de60: 6861 6e64 6c65 7273 2072 6567 6973 7465  handlers registe
-0000de70: 7265 6420 696e 2064 6a73 7472 6970 6520  red in djstripe 
-0000de80: 706c 7567 696e 7320 6f72 2063 6f6e 7472  plugins or contr
-0000de90: 6962 2070 6163 6b61 6765 7329 2e0a 2020  ib packages)..  
-0000dea0: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
-0000deb0: 2020 2077 6562 686f 6f6b 732e 6361 6c6c     webhooks.call
-0000dec0: 5f68 616e 646c 6572 7328 6576 656e 743d  _handlers(event=
-0000ded0: 7365 6c66 290a 0a20 2020 2020 2020 2073  self)..        s
-0000dee0: 6967 6e61 6c20 3d20 5745 4248 4f4f 4b5f  ignal = WEBHOOK_
-0000def0: 5349 474e 414c 532e 6765 7428 7365 6c66  SIGNALS.get(self
-0000df00: 2e74 7970 6529 0a20 2020 2020 2020 2069  .type).        i
-0000df10: 6620 7369 676e 616c 3a0a 2020 2020 2020  f signal:.      
-0000df20: 2020 2020 2020 7265 7475 726e 2073 6967        return sig
-0000df30: 6e61 6c2e 7365 6e64 2873 656e 6465 723d  nal.send(sender=
-0000df40: 4576 656e 742c 2065 7665 6e74 3d73 656c  Event, event=sel
-0000df50: 6629 0a0a 2020 2020 4063 6163 6865 645f  f)..    @cached_
-0000df60: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
-0000df70: 2070 6172 7473 2873 656c 6629 3a0a 2020   parts(self):.  
-0000df80: 2020 2020 2020 2222 2247 6574 7320 7468        """Gets th
-0000df90: 6520 6576 656e 7420 6361 7465 676f 7279  e event category
-0000dfa0: 2f76 6572 6220 6173 2061 206c 6973 7420  /verb as a list 
-0000dfb0: 6f66 2070 6172 7473 2e22 2222 0a20 2020  of parts.""".   
-0000dfc0: 2020 2020 2072 6574 7572 6e20 7374 7228       return str(
-0000dfd0: 7365 6c66 2e74 7970 6529 2e73 706c 6974  self.type).split
-0000dfe0: 2822 2e22 290a 0a20 2020 2040 6361 6368  (".")..    @cach
-0000dff0: 6564 5f70 726f 7065 7274 790a 2020 2020  ed_property.    
-0000e000: 6465 6620 6361 7465 676f 7279 2873 656c  def category(sel
-0000e010: 6629 3a0a 2020 2020 2020 2020 2222 2247  f):.        """G
-0000e020: 6574 7320 7468 6520 6576 656e 7420 6361  ets the event ca
-0000e030: 7465 676f 7279 2073 7472 696e 6720 2865  tegory string (e
-0000e040: 2e67 2e20 2763 7573 746f 6d65 7227 292e  .g. 'customer').
-0000e050: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
-0000e060: 726e 2073 656c 662e 7061 7274 735b 305d  rn self.parts[0]
-0000e070: 0a0a 2020 2020 4063 6163 6865 645f 7072  ..    @cached_pr
-0000e080: 6f70 6572 7479 0a20 2020 2064 6566 2076  operty.    def v
-0000e090: 6572 6228 7365 6c66 293a 0a20 2020 2020  erb(self):.     
-0000e0a0: 2020 2022 2222 4765 7473 2074 6865 2065     """Gets the e
-0000e0b0: 7665 6e74 2070 6173 742d 7465 6e73 6520  vent past-tense 
-0000e0c0: 7665 7262 2073 7472 696e 6720 2865 2e67  verb string (e.g
-0000e0d0: 2e20 2775 7064 6174 6564 2729 2e22 2222  . 'updated')."""
-0000e0e0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000e0f0: 222e 222e 6a6f 696e 2873 656c 662e 7061  ".".join(self.pa
-0000e100: 7274 735b 313a 5d29 0a0a 2020 2020 4070  rts[1:])..    @p
-0000e110: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
-0000e120: 6375 7374 6f6d 6572 2873 656c 6629 3a0a  customer(self):.
-0000e130: 2020 2020 2020 2020 6461 7461 203d 2073          data = s
-0000e140: 656c 662e 6461 7461 5b22 6f62 6a65 6374  elf.data["object
-0000e150: 225d 0a20 2020 2020 2020 2069 6620 6461  "].        if da
-0000e160: 7461 5b22 6f62 6a65 6374 225d 203d 3d20  ta["object"] == 
-0000e170: 2263 7573 746f 6d65 7222 3a0a 2020 2020  "customer":.    
-0000e180: 2020 2020 2020 2020 6375 7374 6f6d 6572          customer
-0000e190: 5f69 6420 3d20 6461 7461 2e67 6574 2822  _id = data.get("
-0000e1a0: 6964 2229 0a20 2020 2020 2020 2065 6c73  id").        els
-0000e1b0: 653a 0a20 2020 2020 2020 2020 2020 2063  e:.            c
-0000e1c0: 7573 746f 6d65 725f 6964 203d 2064 6174  ustomer_id = dat
-0000e1d0: 612e 6765 7428 2263 7573 746f 6d65 7222  a.get("customer"
-0000e1e0: 290a 0a20 2020 2020 2020 2069 6620 6375  )..        if cu
-0000e1f0: 7374 6f6d 6572 5f69 643a 0a20 2020 2020  stomer_id:.     
-0000e200: 2020 2020 2020 2072 6574 7572 6e20 4375         return Cu
-0000e210: 7374 6f6d 6572 2e5f 6765 745f 6f72 5f72  stomer._get_or_r
-0000e220: 6574 7269 6576 6528 0a20 2020 2020 2020  etrieve(.       
-0000e230: 2020 2020 2020 2020 2069 643d 6375 7374           id=cust
-0000e240: 6f6d 6572 5f69 642c 0a20 2020 2020 2020  omer_id,.       
-0000e250: 2020 2020 2020 2020 2073 7472 6970 655f           stripe_
-0000e260: 6163 636f 756e 743d 6765 7461 7474 7228  account=getattr(
-0000e270: 7365 6c66 2e64 6a73 7472 6970 655f 6f77  self.djstripe_ow
-0000e280: 6e65 725f 6163 636f 756e 742c 2022 6964  ner_account, "id
-0000e290: 222c 204e 6f6e 6529 2c0a 2020 2020 2020  ", None),.      
-0000e2a0: 2020 2020 2020 2020 2020 6170 695f 6b65            api_ke
-0000e2b0: 793d 7365 6c66 2e64 6566 6175 6c74 5f61  y=self.default_a
-0000e2c0: 7069 5f6b 6579 2c0a 2020 2020 2020 2020  pi_key,.        
-0000e2d0: 2020 2020 290a 0a0a 636c 6173 7320 4669      )...class Fi
-0000e2e0: 6c65 2853 7472 6970 654d 6f64 656c 293a  le(StripeModel):
-0000e2f0: 0a20 2020 2022 2222 0a20 2020 2054 6869  .    """.    Thi
-0000e300: 7320 6973 2061 6e20 6f62 6a65 6374 2072  s is an object r
-0000e310: 6570 7265 7365 6e74 696e 6720 6120 6669  epresenting a fi
-0000e320: 6c65 2068 6f73 7465 6420 6f6e 2053 7472  le hosted on Str
-0000e330: 6970 6527 7320 7365 7276 6572 732e 0a20  ipe's servers.. 
-0000e340: 2020 2054 6865 2066 696c 6520 6d61 7920     The file may 
-0000e350: 6861 7665 2062 6565 6e20 7570 6c6f 6164  have been upload
-0000e360: 6564 2062 7920 796f 7572 7365 6c66 2075  ed by yourself u
-0000e370: 7369 6e67 2074 6865 2063 7265 6174 6520  sing the create 
-0000e380: 6669 6c65 2072 6571 7565 7374 0a20 2020  file request.   
-0000e390: 2028 666f 7220 6578 616d 706c 652c 2077   (for example, w
-0000e3a0: 6865 6e20 7570 6c6f 6164 696e 6720 6469  hen uploading di
-0000e3b0: 7370 7574 6520 6576 6964 656e 6365 2920  spute evidence) 
-0000e3c0: 6f72 2069 7420 6d61 7920 6861 7665 2062  or it may have b
-0000e3d0: 6565 6e20 6372 6561 7465 6420 6279 0a20  een created by. 
-0000e3e0: 2020 2053 7472 6970 6520 2866 6f72 2065     Stripe (for e
-0000e3f0: 7861 6d70 6c65 2c20 7468 6520 7265 7375  xample, the resu
-0000e400: 6c74 7320 6f66 2061 2053 6967 6d61 2073  lts of a Sigma s
-0000e410: 6368 6564 756c 6564 2071 7565 7279 292e  cheduled query).
-0000e420: 0a0a 2020 2020 5374 7269 7065 2064 6f63  ..    Stripe doc
-0000e430: 756d 656e 7461 7469 6f6e 3a20 6874 7470  umentation: http
-0000e440: 733a 2f2f 7374 7269 7065 2e63 6f6d 2f64  s://stripe.com/d
-0000e450: 6f63 732f 6170 692f 6669 6c65 733f 6c61  ocs/api/files?la
-0000e460: 6e67 3d70 7974 686f 6e0a 2020 2020 2222  ng=python.    ""
-0000e470: 220a 0a20 2020 2073 7472 6970 655f 636c  "..    stripe_cl
-0000e480: 6173 7320 3d20 7374 7269 7065 2e46 696c  ass = stripe.Fil
-0000e490: 650a 0a20 2020 2066 696c 656e 616d 6520  e..    filename 
-0000e4a0: 3d20 6d6f 6465 6c73 2e43 6861 7246 6965  = models.CharFie
-0000e4b0: 6c64 280a 2020 2020 2020 2020 6d61 785f  ld(.        max_
-0000e4c0: 6c65 6e67 7468 3d32 3535 2c0a 2020 2020  length=255,.    
-0000e4d0: 2020 2020 6865 6c70 5f74 6578 743d 2241      help_text="A
-0000e4e0: 2066 696c 656e 616d 6520 666f 7220 7468   filename for th
-0000e4f0: 6520 6669 6c65 2c20 7375 6974 6162 6c65  e file, suitable
-0000e500: 2066 6f72 2073 6176 696e 6720 746f 2061   for saving to a
-0000e510: 2066 696c 6573 7973 7465 6d2e 222c 0a20   filesystem.",. 
-0000e520: 2020 2029 0a20 2020 2070 7572 706f 7365     ).    purpose
-0000e530: 203d 2053 7472 6970 6545 6e75 6d46 6965   = StripeEnumFie
-0000e540: 6c64 280a 2020 2020 2020 2020 656e 756d  ld(.        enum
-0000e550: 3d65 6e75 6d73 2e46 696c 6550 7572 706f  =enums.FilePurpo
-0000e560: 7365 2c20 6865 6c70 5f74 6578 743d 2254  se, help_text="T
-0000e570: 6865 2070 7572 706f 7365 206f 6620 7468  he purpose of th
-0000e580: 6520 7570 6c6f 6164 6564 2066 696c 652e  e uploaded file.
-0000e590: 220a 2020 2020 290a 2020 2020 7369 7a65  ".    ).    size
-0000e5a0: 203d 206d 6f64 656c 732e 496e 7465 6765   = models.Intege
-0000e5b0: 7246 6965 6c64 2868 656c 705f 7465 7874  rField(help_text
-0000e5c0: 3d22 5468 6520 7369 7a65 2069 6e20 6279  ="The size in by
-0000e5d0: 7465 7320 6f66 2074 6865 2066 696c 6520  tes of the file 
-0000e5e0: 7570 6c6f 6164 206f 626a 6563 742e 2229  upload object.")
-0000e5f0: 0a20 2020 2074 7970 6520 3d20 5374 7269  .    type = Stri
-0000e600: 7065 456e 756d 4669 656c 6428 0a20 2020  peEnumField(.   
-0000e610: 2020 2020 2065 6e75 6d3d 656e 756d 732e       enum=enums.
-0000e620: 4669 6c65 5479 7065 2c20 6865 6c70 5f74  FileType, help_t
-0000e630: 6578 743d 2254 6865 2074 7970 6520 6f66  ext="The type of
-0000e640: 2074 6865 2066 696c 6520 7265 7475 726e   the file return
-0000e650: 6564 2e22 0a20 2020 2029 0a20 2020 2075  ed.".    ).    u
-0000e660: 726c 203d 206d 6f64 656c 732e 4368 6172  rl = models.Char
-0000e670: 4669 656c 6428 0a20 2020 2020 2020 206d  Field(.        m
-0000e680: 6178 5f6c 656e 6774 683d 3230 302c 0a20  ax_length=200,. 
-0000e690: 2020 2020 2020 2068 656c 705f 7465 7874         help_text
-0000e6a0: 3d22 4120 7265 6164 2d6f 6e6c 7920 5552  ="A read-only UR
-0000e6b0: 4c20 7768 6572 6520 7468 6520 7570 6c6f  L where the uplo
-0000e6c0: 6164 6564 2066 696c 6520 6361 6e20 6265  aded file can be
-0000e6d0: 2061 6363 6573 7365 642e 222c 0a20 2020   accessed.",.   
-0000e6e0: 2029 0a0a 2020 2020 4063 6c61 7373 6d65   )..    @classme
-0000e6f0: 7468 6f64 0a20 2020 2064 6566 2069 735f  thod.    def is_
-0000e700: 7661 6c69 645f 6f62 6a65 6374 2863 6c73  valid_object(cls
-0000e710: 2c20 6461 7461 293a 0a20 2020 2020 2020  , data):.       
-0000e720: 2072 6574 7572 6e20 6461 7461 2061 6e64   return data and
-0000e730: 2064 6174 612e 6765 7428 226f 626a 6563   data.get("objec
-0000e740: 7422 2920 696e 2028 2266 696c 6522 2c20  t") in ("file", 
-0000e750: 2266 696c 655f 7570 6c6f 6164 2229 0a0a  "file_upload")..
-0000e760: 2020 2020 6465 6620 5f5f 7374 725f 5f28      def __str__(
-0000e770: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
-0000e780: 6574 7572 6e20 6622 7b73 656c 662e 6669  eturn f"{self.fi
-0000e790: 6c65 6e61 6d65 7d2c 207b 656e 756d 732e  lename}, {enums.
-0000e7a0: 4669 6c65 5075 7270 6f73 652e 6875 6d61  FilePurpose.huma
-0000e7b0: 6e69 7a65 2873 656c 662e 7075 7270 6f73  nize(self.purpos
-0000e7c0: 6529 7d22 0a0a 0a23 2041 6c69 6173 2066  e)}"...# Alias f
-0000e7d0: 6f72 2063 6f6d 7061 7469 6269 6c69 7479  or compatibility
-0000e7e0: 0a23 2053 7472 6970 6527 7320 5344 4b20  .# Stripe's SDK 
-0000e7f0: 6861 7320 7468 6520 7361 6d65 2061 6c69  has the same ali
-0000e800: 6173 2e0a 2320 446f 206e 6f74 2072 656d  as..# Do not rem
-0000e810: 6f76 652f 6465 7072 6563 6174 6520 6173  ove/deprecate as
-0000e820: 206c 6f6e 6720 6173 2069 7427 7320 7072   long as it's pr
-0000e830: 6573 656e 7420 7468 6572 652e 0a46 696c  esent there..Fil
-0000e840: 6555 706c 6f61 6420 3d20 4669 6c65 0a0a  eUpload = File..
-0000e850: 0a63 6c61 7373 2046 696c 654c 696e 6b28  .class FileLink(
-0000e860: 5374 7269 7065 4d6f 6465 6c29 3a0a 2020  StripeModel):.  
-0000e870: 2020 2222 220a 2020 2020 546f 2073 6861    """.    To sha
-0000e880: 7265 2074 6865 2063 6f6e 7465 6e74 7320  re the contents 
-0000e890: 6f66 2061 2046 696c 6520 6f62 6a65 6374  of a File object
-0000e8a0: 2077 6974 6820 6e6f 6e2d 5374 7269 7065   with non-Stripe
-0000e8b0: 2075 7365 7273 2c0a 2020 2020 796f 7520   users,.    you 
-0000e8c0: 6361 6e20 6372 6561 7465 2061 2046 696c  can create a Fil
-0000e8d0: 654c 696e 6b2e 2046 696c 654c 696e 6b73  eLink. FileLinks
-0000e8e0: 2063 6f6e 7461 696e 2061 2055 524c 2074   contain a URL t
-0000e8f0: 6861 7420 6361 6e20 6265 2075 7365 640a  hat can be used.
-0000e900: 2020 2020 746f 2072 6574 7269 6576 6520      to retrieve 
-0000e910: 7468 6520 636f 6e74 656e 7473 206f 6620  the contents of 
-0000e920: 7468 6520 6669 6c65 2077 6974 686f 7574  the file without
-0000e930: 2061 7574 6865 6e74 6963 6174 696f 6e2e   authentication.
-0000e940: 0a0a 2020 2020 5374 7269 7065 2064 6f63  ..    Stripe doc
-0000e950: 756d 656e 7461 7469 6f6e 3a20 6874 7470  umentation: http
-0000e960: 733a 2f2f 7374 7269 7065 2e63 6f6d 2f64  s://stripe.com/d
-0000e970: 6f63 732f 6170 692f 6669 6c65 5f6c 696e  ocs/api/file_lin
-0000e980: 6b73 3f6c 616e 673d 7079 7468 6f6e 0a20  ks?lang=python. 
-0000e990: 2020 2022 2222 0a0a 2020 2020 7374 7269     """..    stri
-0000e9a0: 7065 5f63 6c61 7373 203d 2073 7472 6970  pe_class = strip
-0000e9b0: 652e 4669 6c65 4c69 6e6b 0a0a 2020 2020  e.FileLink..    
-0000e9c0: 6578 7069 7265 735f 6174 203d 2053 7472  expires_at = Str
-0000e9d0: 6970 6544 6174 6554 696d 6546 6965 6c64  ipeDateTimeField
-0000e9e0: 280a 2020 2020 2020 2020 6e75 6c6c 3d54  (.        null=T
-0000e9f0: 7275 652c 2062 6c61 6e6b 3d54 7275 652c  rue, blank=True,
-0000ea00: 2068 656c 705f 7465 7874 3d22 5469 6d65   help_text="Time
-0000ea10: 2061 7420 7768 6963 6820 7468 6520 6c69   at which the li
-0000ea20: 6e6b 2065 7870 6972 6573 2e22 0a20 2020  nk expires.".   
-0000ea30: 2029 0a20 2020 2066 696c 6520 3d20 5374   ).    file = St
-0000ea40: 7269 7065 466f 7265 6967 6e4b 6579 2822  ripeForeignKey("
-0000ea50: 4669 6c65 222c 206f 6e5f 6465 6c65 7465  File", on_delete
-0000ea60: 3d6d 6f64 656c 732e 4341 5343 4144 4529  =models.CASCADE)
-0000ea70: 0a20 2020 2075 726c 203d 206d 6f64 656c  .    url = model
-0000ea80: 732e 5552 4c46 6965 6c64 2868 656c 705f  s.URLField(help_
-0000ea90: 7465 7874 3d22 5468 6520 7075 626c 6963  text="The public
-0000eaa0: 6c79 2061 6363 6573 7369 626c 6520 5552  ly accessible UR
-0000eab0: 4c20 746f 2064 6f77 6e6c 6f61 6420 7468  L to download th
-0000eac0: 6520 6669 6c65 2e22 290a 0a20 2020 2064  e file.")..    d
-0000ead0: 6566 205f 5f73 7472 5f5f 2873 656c 6629  ef __str__(self)
-0000eae0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-0000eaf0: 2066 227b 7365 6c66 2e66 696c 652e 6669   f"{self.file.fi
-0000eb00: 6c65 6e61 6d65 7d2c 207b 7365 6c66 2e75  lename}, {self.u
-0000eb10: 726c 7d22 0a0a 0a63 6c61 7373 2050 6179  rl}"...class Pay
-0000eb20: 6d65 6e74 496e 7465 6e74 2853 7472 6970  mentIntent(Strip
-0000eb30: 654d 6f64 656c 293a 0a20 2020 2022 2222  eModel):.    """
-0000eb40: 0a20 2020 2041 2050 6179 6d65 6e74 496e  .    A PaymentIn
-0000eb50: 7465 6e74 2067 7569 6465 7320 796f 7520  tent guides you 
-0000eb60: 7468 726f 7567 6820 7468 6520 7072 6f63  through the proc
-0000eb70: 6573 7320 6f66 2063 6f6c 6c65 6374 696e  ess of collectin
-0000eb80: 6720 6120 7061 796d 656e 740a 2020 2020  g a payment.    
-0000eb90: 6672 6f6d 2079 6f75 7220 6375 7374 6f6d  from your custom
-0000eba0: 6572 2e20 5765 2072 6563 6f6d 6d65 6e64  er. We recommend
-0000ebb0: 2074 6861 7420 796f 7520 6372 6561 7465   that you create
-0000ebc0: 2065 7861 6374 6c79 206f 6e65 2050 6179   exactly one Pay
-0000ebd0: 6d65 6e74 496e 7465 6e74 2066 6f72 2065  mentIntent for e
-0000ebe0: 6163 6820 6f72 6465 720a 2020 2020 6f72  ach order.    or
-0000ebf0: 2063 7573 746f 6d65 7220 7365 7373 696f   customer sessio
-0000ec00: 6e20 696e 2079 6f75 7220 7379 7374 656d  n in your system
-0000ec10: 2e20 596f 7520 6361 6e20 7265 6665 7265  . You can refere
-0000ec20: 6e63 6520 7468 6520 5061 796d 656e 7449  nce the PaymentI
-0000ec30: 6e74 656e 7420 6c61 7465 7220 746f 0a20  ntent later to. 
-0000ec40: 2020 2073 6565 2074 6865 2068 6973 746f     see the histo
-0000ec50: 7279 206f 6620 7061 796d 656e 7420 6174  ry of payment at
-0000ec60: 7465 6d70 7473 2066 6f72 2061 2070 6172  tempts for a par
-0000ec70: 7469 6375 6c61 7220 7365 7373 696f 6e2e  ticular session.
-0000ec80: 0a0a 2020 2020 4120 5061 796d 656e 7449  ..    A PaymentI
-0000ec90: 6e74 656e 7420 7472 616e 7369 7469 6f6e  ntent transition
-0000eca0: 7320 7468 726f 7567 6820 6d75 6c74 6970  s through multip
-0000ecb0: 6c65 2073 7461 7475 7365 7320 7468 726f  le statuses thro
-0000ecc0: 7567 686f 7574 2069 7473 206c 6966 6574  ughout its lifet
-0000ecd0: 696d 6520 6173 0a20 2020 2069 7420 696e  ime as.    it in
-0000ece0: 7465 7266 6163 6573 2077 6974 6820 5374  terfaces with St
-0000ecf0: 7269 7065 2e6a 7320 746f 2070 6572 666f  ripe.js to perfo
-0000ed00: 726d 2061 7574 6865 6e74 6963 6174 696f  rm authenticatio
-0000ed10: 6e20 666c 6f77 7320 616e 6420 756c 7469  n flows and ulti
-0000ed20: 6d61 7465 6c79 0a20 2020 2063 7265 6174  mately.    creat
-0000ed30: 6573 2061 7420 6d6f 7374 206f 6e65 2073  es at most one s
-0000ed40: 7563 6365 7373 6675 6c20 6368 6172 6765  uccessful charge
-0000ed50: 2e0a 0a20 2020 2053 7472 6970 6520 646f  ...    Stripe do
-0000ed60: 6375 6d65 6e74 6174 696f 6e3a 2068 7474  cumentation: htt
-0000ed70: 7073 3a2f 2f73 7472 6970 652e 636f 6d2f  ps://stripe.com/
-0000ed80: 646f 6373 2f61 7069 3f6c 616e 673d 7079  docs/api?lang=py
-0000ed90: 7468 6f6e 2370 6179 6d65 6e74 5f69 6e74  thon#payment_int
-0000eda0: 656e 7473 0a20 2020 2022 2222 0a0a 2020  ents.    """..  
-0000edb0: 2020 7374 7269 7065 5f63 6c61 7373 203d    stripe_class =
-0000edc0: 2073 7472 6970 652e 5061 796d 656e 7449   stripe.PaymentI
-0000edd0: 6e74 656e 740a 2020 2020 7374 7269 7065  ntent.    stripe
-0000ede0: 5f64 6173 6862 6f61 7264 5f69 7465 6d5f  _dashboard_item_
-0000edf0: 6e61 6d65 203d 2022 7061 796d 656e 7473  name = "payments
-0000ee00: 220a 0a20 2020 2061 6d6f 756e 7420 3d20  "..    amount = 
-0000ee10: 5374 7269 7065 5175 616e 7475 6d43 7572  StripeQuantumCur
-0000ee20: 7265 6e63 7941 6d6f 756e 7446 6965 6c64  rencyAmountField
-0000ee30: 280a 2020 2020 2020 2020 6865 6c70 5f74  (.        help_t
-0000ee40: 6578 743d 2241 6d6f 756e 7420 2869 6e20  ext="Amount (in 
-0000ee50: 6365 6e74 7329 2069 6e74 656e 6465 6420  cents) intended 
-0000ee60: 746f 2062 6520 636f 6c6c 6563 7465 6420  to be collected 
-0000ee70: 6279 2074 6869 7320 5061 796d 656e 7449  by this PaymentI
-0000ee80: 6e74 656e 742e 220a 2020 2020 290a 2020  ntent.".    ).  
-0000ee90: 2020 616d 6f75 6e74 5f63 6170 7475 7261    amount_captura
-0000eea0: 626c 6520 3d20 5374 7269 7065 5175 616e  ble = StripeQuan
-0000eeb0: 7475 6d43 7572 7265 6e63 7941 6d6f 756e  tumCurrencyAmoun
-0000eec0: 7446 6965 6c64 280a 2020 2020 2020 2020  tField(.        
-0000eed0: 6865 6c70 5f74 6578 743d 2241 6d6f 756e  help_text="Amoun
-0000eee0: 7420 2869 6e20 6365 6e74 7329 2074 6861  t (in cents) tha
-0000eef0: 7420 6361 6e20 6265 2063 6170 7475 7265  t can be capture
-0000ef00: 6420 6672 6f6d 2074 6869 7320 5061 796d  d from this Paym
-0000ef10: 656e 7449 6e74 656e 742e 220a 2020 2020  entIntent.".    
-0000ef20: 290a 2020 2020 616d 6f75 6e74 5f72 6563  ).    amount_rec
-0000ef30: 6569 7665 6420 3d20 5374 7269 7065 5175  eived = StripeQu
-0000ef40: 616e 7475 6d43 7572 7265 6e63 7941 6d6f  antumCurrencyAmo
-0000ef50: 756e 7446 6965 6c64 280a 2020 2020 2020  untField(.      
-0000ef60: 2020 6865 6c70 5f74 6578 743d 2241 6d6f    help_text="Amo
-0000ef70: 756e 7420 2869 6e20 6365 6e74 7329 2074  unt (in cents) t
-0000ef80: 6861 7420 7761 7320 636f 6c6c 6563 7465  hat was collecte
-0000ef90: 6420 6279 2074 6869 7320 5061 796d 656e  d by this Paymen
-0000efa0: 7449 6e74 656e 742e 220a 2020 2020 290a  tIntent.".    ).
-0000efb0: 2020 2020 2320 6170 706c 6963 6174 696f      # applicatio
-0000efc0: 6e0a 2020 2020 2320 6170 706c 6963 6174  n.    # applicat
-0000efd0: 696f 6e5f 6665 655f 616d 6f75 6e74 0a20  ion_fee_amount. 
-0000efe0: 2020 2063 616e 6365 6c65 645f 6174 203d     canceled_at =
-0000eff0: 2053 7472 6970 6544 6174 6554 696d 6546   StripeDateTimeF
-0000f000: 6965 6c64 280a 2020 2020 2020 2020 6e75  ield(.        nu
-0000f010: 6c6c 3d54 7275 652c 0a20 2020 2020 2020  ll=True,.       
-0000f020: 2062 6c61 6e6b 3d54 7275 652c 0a20 2020   blank=True,.   
-0000f030: 2020 2020 2064 6566 6175 6c74 3d4e 6f6e       default=Non
-0000f040: 652c 0a20 2020 2020 2020 2068 656c 705f  e,.        help_
-0000f050: 7465 7874 3d28 0a20 2020 2020 2020 2020  text=(.         
-0000f060: 2020 2022 506f 7075 6c61 7465 6420 7768     "Populated wh
-0000f070: 656e 2073 7461 7475 7320 6973 2063 616e  en status is can
-0000f080: 6365 6c65 642c 2074 6869 7320 6973 2074  celed, this is t
-0000f090: 6865 2074 696d 6520 6174 2077 6869 6368  he time at which
-0000f0a0: 2074 6865 2022 0a20 2020 2020 2020 2020   the ".         
-0000f0b0: 2020 2022 5061 796d 656e 7449 6e74 656e     "PaymentInten
-0000f0c0: 7420 7761 7320 6361 6e63 656c 6564 2e20  t was canceled. 
-0000f0d0: 4d65 6173 7572 6564 2069 6e20 7365 636f  Measured in seco
-0000f0e0: 6e64 7320 7369 6e63 6520 7468 6520 556e  nds since the Un
-0000f0f0: 6978 2065 706f 6368 2e22 0a20 2020 2020  ix epoch.".     
-0000f100: 2020 2029 2c0a 2020 2020 290a 0a20 2020     ),.    )..   
-0000f110: 2063 616e 6365 6c6c 6174 696f 6e5f 7265   cancellation_re
-0000f120: 6173 6f6e 203d 2053 7472 6970 6545 6e75  ason = StripeEnu
-0000f130: 6d46 6965 6c64 280a 2020 2020 2020 2020  mField(.        
-0000f140: 656e 756d 3d65 6e75 6d73 2e50 6179 6d65  enum=enums.Payme
-0000f150: 6e74 496e 7465 6e74 4361 6e63 656c 6c61  ntIntentCancella
-0000f160: 7469 6f6e 5265 6173 6f6e 2c0a 2020 2020  tionReason,.    
-0000f170: 2020 2020 626c 616e 6b3d 5472 7565 2c0a      blank=True,.
-0000f180: 2020 2020 2020 2020 6865 6c70 5f74 6578          help_tex
-0000f190: 743d 280a 2020 2020 2020 2020 2020 2020  t=(.            
-0000f1a0: 2252 6561 736f 6e20 666f 7220 6361 6e63  "Reason for canc
-0000f1b0: 656c 6c61 7469 6f6e 206f 6620 7468 6973  ellation of this
-0000f1c0: 2050 6179 6d65 6e74 496e 7465 6e74 2c20   PaymentIntent, 
-0000f1d0: 6569 7468 6572 2075 7365 722d 7072 6f76  either user-prov
-0000f1e0: 6964 6564 2022 0a20 2020 2020 2020 2020  ided ".         
-0000f1f0: 2020 2022 2864 7570 6c69 6361 7465 2c20     "(duplicate, 
-0000f200: 6672 6175 6475 6c65 6e74 2c20 7265 7175  fraudulent, requ
-0000f210: 6573 7465 645f 6279 5f63 7573 746f 6d65  ested_by_custome
-0000f220: 722c 206f 7220 6162 616e 646f 6e65 6429  r, or abandoned)
-0000f230: 206f 7220 220a 2020 2020 2020 2020 2020   or ".          
-0000f240: 2020 2267 656e 6572 6174 6564 2062 7920    "generated by 
-0000f250: 5374 7269 7065 2069 6e74 6572 6e61 6c6c  Stripe internall
-0000f260: 7920 2866 6169 6c65 645f 696e 766f 6963  y (failed_invoic
-0000f270: 652c 2076 6f69 645f 696e 766f 6963 652c  e, void_invoice,
-0000f280: 2022 0a20 2020 2020 2020 2020 2020 2022   ".            "
-0000f290: 6f72 2061 7574 6f6d 6174 6963 292e 220a  or automatic).".
-0000f2a0: 2020 2020 2020 2020 292c 0a20 2020 2029          ),.    )
-0000f2b0: 0a20 2020 2063 6170 7475 7265 5f6d 6574  .    capture_met
-0000f2c0: 686f 6420 3d20 5374 7269 7065 456e 756d  hod = StripeEnum
-0000f2d0: 4669 656c 6428 0a20 2020 2020 2020 2065  Field(.        e
-0000f2e0: 6e75 6d3d 656e 756d 732e 4361 7074 7572  num=enums.Captur
-0000f2f0: 654d 6574 686f 642c 0a20 2020 2020 2020  eMethod,.       
-0000f300: 2068 656c 705f 7465 7874 3d22 4361 7074   help_text="Capt
-0000f310: 7572 6520 6d65 7468 6f64 206f 6620 7468  ure method of th
-0000f320: 6973 2050 6179 6d65 6e74 496e 7465 6e74  is PaymentIntent
-0000f330: 2c20 6f6e 6520 6f66 2061 7574 6f6d 6174  , one of automat
-0000f340: 6963 206f 7220 6d61 6e75 616c 2e22 2c0a  ic or manual.",.
-0000f350: 2020 2020 290a 2020 2020 636c 6965 6e74      ).    client
-0000f360: 5f73 6563 7265 7420 3d20 6d6f 6465 6c73  _secret = models
-0000f370: 2e54 6578 7446 6965 6c64 280a 2020 2020  .TextField(.    
-0000f380: 2020 2020 6d61 785f 6c65 6e67 7468 3d35      max_length=5
-0000f390: 3030 302c 0a20 2020 2020 2020 2068 656c  000,.        hel
-0000f3a0: 705f 7465 7874 3d28 0a20 2020 2020 2020  p_text=(.       
-0000f3b0: 2020 2020 2022 5468 6520 636c 6965 6e74       "The client
-0000f3c0: 2073 6563 7265 7420 6f66 2074 6869 7320   secret of this 
-0000f3d0: 5061 796d 656e 7449 6e74 656e 742e 2022  PaymentIntent. "
-0000f3e0: 0a20 2020 2020 2020 2020 2020 2022 5573  .            "Us
-0000f3f0: 6564 2066 6f72 2063 6c69 656e 742d 7369  ed for client-si
-0000f400: 6465 2072 6574 7269 6576 616c 2075 7369  de retrieval usi
-0000f410: 6e67 2061 2070 7562 6c69 7368 6162 6c65  ng a publishable
-0000f420: 206b 6579 2e22 0a20 2020 2020 2020 2029   key.".        )
-0000f430: 2c0a 2020 2020 290a 2020 2020 636f 6e66  ,.    ).    conf
-0000f440: 6972 6d61 7469 6f6e 5f6d 6574 686f 6420  irmation_method 
-0000f450: 3d20 5374 7269 7065 456e 756d 4669 656c  = StripeEnumFiel
-0000f460: 6428 0a20 2020 2020 2020 2065 6e75 6d3d  d(.        enum=
-0000f470: 656e 756d 732e 436f 6e66 6972 6d61 7469  enums.Confirmati
-0000f480: 6f6e 4d65 7468 6f64 2c0a 2020 2020 2020  onMethod,.      
-0000f490: 2020 6865 6c70 5f74 6578 743d 280a 2020    help_text=(.  
-0000f4a0: 2020 2020 2020 2020 2020 2243 6f6e 6669            "Confi
-0000f4b0: 726d 6174 696f 6e20 6d65 7468 6f64 206f  rmation method o
-0000f4c0: 6620 7468 6973 2050 6179 6d65 6e74 496e  f this PaymentIn
-0000f4d0: 7465 6e74 2c20 6f6e 6520 6f66 206d 616e  tent, one of man
-0000f4e0: 7561 6c20 6f72 2061 7574 6f6d 6174 6963  ual or automatic
-0000f4f0: 2e22 0a20 2020 2020 2020 2029 2c0a 2020  .".        ),.  
-0000f500: 2020 290a 2020 2020 6375 7272 656e 6379    ).    currency
-0000f510: 203d 2053 7472 6970 6543 7572 7265 6e63   = StripeCurrenc
-0000f520: 7943 6f64 6546 6965 6c64 2829 0a20 2020  yCodeField().   
-0000f530: 2063 7573 746f 6d65 7220 3d20 5374 7269   customer = Stri
-0000f540: 7065 466f 7265 6967 6e4b 6579 280a 2020  peForeignKey(.  
-0000f550: 2020 2020 2020 2243 7573 746f 6d65 7222        "Customer"
-0000f560: 2c0a 2020 2020 2020 2020 6e75 6c6c 3d54  ,.        null=T
-0000f570: 7275 652c 0a20 2020 2020 2020 206f 6e5f  rue,.        on_
-0000f580: 6465 6c65 7465 3d6d 6f64 656c 732e 4341  delete=models.CA
-0000f590: 5343 4144 452c 0a20 2020 2020 2020 2068  SCADE,.        h
-0000f5a0: 656c 705f 7465 7874 3d22 4375 7374 6f6d  elp_text="Custom
-0000f5b0: 6572 2074 6869 7320 5061 796d 656e 7449  er this PaymentI
-0000f5c0: 6e74 656e 7420 6973 2066 6f72 2069 6620  ntent is for if 
-0000f5d0: 6f6e 6520 6578 6973 7473 2e22 2c0a 2020  one exists.",.  
-0000f5e0: 2020 290a 2020 2020 6465 7363 7269 7074    ).    descript
-0000f5f0: 696f 6e20 3d20 6d6f 6465 6c73 2e54 6578  ion = models.Tex
-0000f600: 7446 6965 6c64 280a 2020 2020 2020 2020  tField(.        
-0000f610: 6d61 785f 6c65 6e67 7468 3d31 3030 302c  max_length=1000,
-0000f620: 0a20 2020 2020 2020 2064 6566 6175 6c74  .        default
-0000f630: 3d22 222c 0a20 2020 2020 2020 2062 6c61  ="",.        bla
-0000f640: 6e6b 3d54 7275 652c 0a20 2020 2020 2020  nk=True,.       
-0000f650: 2068 656c 705f 7465 7874 3d28 0a20 2020   help_text=(.   
-0000f660: 2020 2020 2020 2020 2022 416e 2061 7262           "An arb
-0000f670: 6974 7261 7279 2073 7472 696e 6720 6174  itrary string at
-0000f680: 7461 6368 6564 2074 6f20 7468 6520 6f62  tached to the ob
-0000f690: 6a65 6374 2e20 220a 2020 2020 2020 2020  ject. ".        
-0000f6a0: 2020 2020 224f 6674 656e 2075 7365 6675      "Often usefu
-0000f6b0: 6c20 666f 7220 6469 7370 6c61 7969 6e67  l for displaying
-0000f6c0: 2074 6f20 7573 6572 732e 220a 2020 2020   to users.".    
-0000f6d0: 2020 2020 292c 0a20 2020 2029 0a20 2020      ),.    ).   
-0000f6e0: 206c 6173 745f 7061 796d 656e 745f 6572   last_payment_er
-0000f6f0: 726f 7220 3d20 4a53 4f4e 4669 656c 6428  ror = JSONField(
-0000f700: 0a20 2020 2020 2020 206e 756c 6c3d 5472  .        null=Tr
-0000f710: 7565 2c0a 2020 2020 2020 2020 626c 616e  ue,.        blan
-0000f720: 6b3d 5472 7565 2c0a 2020 2020 2020 2020  k=True,.        
-0000f730: 6865 6c70 5f74 6578 743d 280a 2020 2020  help_text=(.    
-0000f740: 2020 2020 2020 2020 2254 6865 2070 6179          "The pay
-0000f750: 6d65 6e74 2065 7272 6f72 2065 6e63 6f75  ment error encou
-0000f760: 6e74 6572 6564 2069 6e20 7468 6520 7072  ntered in the pr
-0000f770: 6576 696f 7573 2050 6179 6d65 6e74 496e  evious PaymentIn
-0000f780: 7465 6e74 2063 6f6e 6669 726d 6174 696f  tent confirmatio
-0000f790: 6e2e 220a 2020 2020 2020 2020 292c 0a20  n.".        ),. 
-0000f7a0: 2020 2029 0a20 2020 206e 6578 745f 6163     ).    next_ac
-0000f7b0: 7469 6f6e 203d 204a 534f 4e46 6965 6c64  tion = JSONField
-0000f7c0: 280a 2020 2020 2020 2020 6e75 6c6c 3d54  (.        null=T
-0000f7d0: 7275 652c 0a20 2020 2020 2020 2062 6c61  rue,.        bla
-0000f7e0: 6e6b 3d54 7275 652c 0a20 2020 2020 2020  nk=True,.       
-0000f7f0: 2068 656c 705f 7465 7874 3d28 0a20 2020   help_text=(.   
-0000f800: 2020 2020 2020 2020 2022 4966 2070 7265           "If pre
-0000f810: 7365 6e74 2c20 7468 6973 2070 726f 7065  sent, this prope
-0000f820: 7274 7920 7465 6c6c 7320 796f 7520 7768  rty tells you wh
-0000f830: 6174 2061 6374 696f 6e73 2079 6f75 206e  at actions you n
-0000f840: 6565 6420 746f 2074 616b 6520 220a 2020  eed to take ".  
-0000f850: 2020 2020 2020 2020 2020 2269 6e20 6f72            "in or
-0000f860: 6465 7220 666f 7220 796f 7572 2063 7573  der for your cus
-0000f870: 746f 6d65 7220 746f 2066 756c 6669 6c6c  tomer to fulfill
-0000f880: 2061 2070 6179 6d65 6e74 2075 7369 6e67   a payment using
-0000f890: 2074 6865 2070 726f 7669 6465 6420 736f   the provided so
-0000f8a0: 7572 6365 2e22 0a20 2020 2020 2020 2029  urce.".        )
-0000f8b0: 2c0a 2020 2020 290a 2020 2020 6f6e 5f62  ,.    ).    on_b
-0000f8c0: 6568 616c 665f 6f66 203d 2053 7472 6970  ehalf_of = Strip
-0000f8d0: 6546 6f72 6569 676e 4b65 7928 0a20 2020  eForeignKey(.   
-0000f8e0: 2020 2020 2022 4163 636f 756e 7422 2c0a       "Account",.
-0000f8f0: 2020 2020 2020 2020 6f6e 5f64 656c 6574          on_delet
-0000f900: 653d 6d6f 6465 6c73 2e43 4153 4341 4445  e=models.CASCADE
-0000f910: 2c0a 2020 2020 2020 2020 6e75 6c6c 3d54  ,.        null=T
-0000f920: 7275 652c 0a20 2020 2020 2020 2062 6c61  rue,.        bla
-0000f930: 6e6b 3d54 7275 652c 0a20 2020 2020 2020  nk=True,.       
-0000f940: 2068 656c 705f 7465 7874 3d22 5468 6520   help_text="The 
-0000f950: 6163 636f 756e 7420 2869 6620 616e 7929  account (if any)
-0000f960: 2066 6f72 2077 6869 6368 2074 6865 2066   for which the f
-0000f970: 756e 6473 206f 6620 7468 6520 220a 2020  unds of the ".  
-0000f980: 2020 2020 2020 2250 6179 6d65 6e74 496e        "PaymentIn
-0000f990: 7465 6e74 2061 7265 2069 6e74 656e 6465  tent are intende
-0000f9a0: 642e 222c 0a20 2020 2020 2020 2072 656c  d.",.        rel
-0000f9b0: 6174 6564 5f6e 616d 653d 2270 6179 6d65  ated_name="payme
-0000f9c0: 6e74 5f69 6e74 656e 7473 222c 0a20 2020  nt_intents",.   
-0000f9d0: 2029 0a20 2020 2070 6179 6d65 6e74 5f6d   ).    payment_m
-0000f9e0: 6574 686f 6420 3d20 5374 7269 7065 466f  ethod = StripeFo
-0000f9f0: 7265 6967 6e4b 6579 280a 2020 2020 2020  reignKey(.      
-0000fa00: 2020 2250 6179 6d65 6e74 4d65 7468 6f64    "PaymentMethod
-0000fa10: 222c 0a20 2020 2020 2020 206f 6e5f 6465  ",.        on_de
-0000fa20: 6c65 7465 3d6d 6f64 656c 732e 5345 545f  lete=models.SET_
-0000fa30: 4e55 4c4c 2c0a 2020 2020 2020 2020 6e75  NULL,.        nu
-0000fa40: 6c6c 3d54 7275 652c 0a20 2020 2020 2020  ll=True,.       
-0000fa50: 2062 6c61 6e6b 3d54 7275 652c 0a20 2020   blank=True,.   
-0000fa60: 2020 2020 2068 656c 705f 7465 7874 3d22       help_text="
-0000fa70: 5061 796d 656e 7420 6d65 7468 6f64 2075  Payment method u
-0000fa80: 7365 6420 696e 2074 6869 7320 5061 796d  sed in this Paym
-0000fa90: 656e 7449 6e74 656e 742e 222c 0a20 2020  entIntent.",.   
-0000faa0: 2029 0a20 2020 2070 6179 6d65 6e74 5f6d   ).    payment_m
-0000fab0: 6574 686f 645f 7479 7065 7320 3d20 4a53  ethod_types = JS
-0000fac0: 4f4e 4669 656c 6428 0a20 2020 2020 2020  ONField(.       
-0000fad0: 2068 656c 705f 7465 7874 3d28 0a20 2020   help_text=(.   
-0000fae0: 2020 2020 2020 2020 2022 5468 6520 6c69           "The li
-0000faf0: 7374 206f 6620 7061 796d 656e 7420 6d65  st of payment me
-0000fb00: 7468 6f64 2074 7970 6573 2028 652e 672e  thod types (e.g.
-0000fb10: 2063 6172 6429 2074 6861 7420 7468 6973   card) that this
-0000fb20: 2022 0a20 2020 2020 2020 2020 2020 2022   ".            "
-0000fb30: 5061 796d 656e 7449 6e74 656e 7420 6973  PaymentIntent is
-0000fb40: 2061 6c6c 6f77 6564 2074 6f20 7573 652e   allowed to use.
-0000fb50: 220a 2020 2020 2020 2020 290a 2020 2020  ".        ).    
-0000fb60: 290a 2020 2020 7265 6365 6970 745f 656d  ).    receipt_em
-0000fb70: 6169 6c20 3d20 6d6f 6465 6c73 2e43 6861  ail = models.Cha
-0000fb80: 7246 6965 6c64 280a 2020 2020 2020 2020  rField(.        
-0000fb90: 626c 616e 6b3d 5472 7565 2c0a 2020 2020  blank=True,.    
-0000fba0: 2020 2020 6d61 785f 6c65 6e67 7468 3d32      max_length=2
-0000fbb0: 3535 2c0a 2020 2020 2020 2020 6865 6c70  55,.        help
-0000fbc0: 5f74 6578 743d 280a 2020 2020 2020 2020  _text=(.        
-0000fbd0: 2020 2020 2245 6d61 696c 2061 6464 7265      "Email addre
-0000fbe0: 7373 2074 6861 7420 7468 6520 7265 6365  ss that the rece
-0000fbf0: 6970 7420 666f 7220 7468 6520 7265 7375  ipt for the resu
-0000fc00: 6c74 696e 6720 7061 796d 656e 7420 7769  lting payment wi
-0000fc10: 6c6c 2062 6520 7365 6e74 2074 6f2e 220a  ll be sent to.".
-0000fc20: 2020 2020 2020 2020 292c 0a20 2020 2029          ),.    )
-0000fc30: 0a20 2020 2023 2054 4f44 4f3a 2041 6464  .    # TODO: Add
-0000fc40: 2060 7265 7669 6577 6020 6669 656c 6420   `review` field 
-0000fc50: 6166 7465 7220 7765 2061 6464 2052 6576  after we add Rev
-0000fc60: 6965 7720 6d6f 6465 6c2e 0a20 2020 2073  iew model..    s
-0000fc70: 6574 7570 5f66 7574 7572 655f 7573 6167  etup_future_usag
-0000fc80: 6520 3d20 5374 7269 7065 456e 756d 4669  e = StripeEnumFi
-0000fc90: 656c 6428 0a20 2020 2020 2020 2065 6e75  eld(.        enu
-0000fca0: 6d3d 656e 756d 732e 496e 7465 6e74 5573  m=enums.IntentUs
-0000fcb0: 6167 652c 0a20 2020 2020 2020 206e 756c  age,.        nul
-0000fcc0: 6c3d 5472 7565 2c0a 2020 2020 2020 2020  l=True,.        
-0000fcd0: 626c 616e 6b3d 5472 7565 2c0a 2020 2020  blank=True,.    
-0000fce0: 2020 2020 6865 6c70 5f74 6578 743d 280a      help_text=(.
-0000fcf0: 2020 2020 2020 2020 2020 2020 2249 6e64              "Ind
-0000fd00: 6963 6174 6573 2074 6861 7420 796f 7520  icates that you 
-0000fd10: 696e 7465 6e64 2074 6f20 6d61 6b65 2066  intend to make f
-0000fd20: 7574 7572 6520 7061 796d 656e 7473 2077  uture payments w
-0000fd30: 6974 6820 7468 6973 2022 0a20 2020 2020  ith this ".     
-0000fd40: 2020 2020 2020 2022 5061 796d 656e 7449         "PaymentI
-0000fd50: 6e74 656e 7427 7320 7061 796d 656e 7420  ntent's payment 
-0000fd60: 6d65 7468 6f64 2e20 220a 2020 2020 2020  method. ".      
-0000fd70: 2020 2020 2020 2249 6620 7072 6573 656e        "If presen
-0000fd80: 742c 2074 6865 2070 6179 6d65 6e74 206d  t, the payment m
-0000fd90: 6574 686f 6420 7573 6564 2077 6974 6820  ethod used with 
-0000fda0: 7468 6973 2050 6179 6d65 6e74 496e 7465  this PaymentInte
-0000fdb0: 6e74 2063 616e 2022 0a20 2020 2020 2020  nt can ".       
-0000fdc0: 2020 2020 2022 6265 2061 7474 6163 6865       "be attache
-0000fdd0: 6420 746f 2061 2043 7573 746f 6d65 722c  d to a Customer,
-0000fde0: 2065 7665 6e20 6166 7465 7220 7468 6520   even after the 
-0000fdf0: 7472 616e 7361 6374 696f 6e20 636f 6d70  transaction comp
-0000fe00: 6c65 7465 732e 2022 0a20 2020 2020 2020  letes. ".       
-0000fe10: 2020 2020 2022 5573 6520 606f 6e5f 7365       "Use `on_se
-0000fe20: 7373 696f 6e60 2069 6620 796f 7520 696e  ssion` if you in
-0000fe30: 7465 6e64 2074 6f20 6f6e 6c79 2072 6575  tend to only reu
-0000fe40: 7365 2074 6865 2070 6179 6d65 6e74 206d  se the payment m
-0000fe50: 6574 686f 6420 220a 2020 2020 2020 2020  ethod ".        
-0000fe60: 2020 2020 2277 6865 6e20 796f 7572 2063      "when your c
-0000fe70: 7573 746f 6d65 7220 6973 2070 7265 7365  ustomer is prese
-0000fe80: 6e74 2069 6e20 796f 7572 2063 6865 636b  nt in your check
-0000fe90: 6f75 7420 666c 6f77 2e20 5573 6520 606f  out flow. Use `o
-0000fea0: 6666 5f73 6573 7369 6f6e 6020 220a 2020  ff_session` ".  
-0000feb0: 2020 2020 2020 2020 2020 2269 6620 796f            "if yo
-0000fec0: 7572 2063 7573 746f 6d65 7220 6d61 7920  ur customer may 
-0000fed0: 6f72 206d 6179 206e 6f74 2062 6520 696e  or may not be in
-0000fee0: 2079 6f75 7220 6368 6563 6b6f 7574 2066   your checkout f
-0000fef0: 6c6f 772e 2022 0a20 2020 2020 2020 2020  low. ".         
-0000ff00: 2020 2022 5374 7269 7065 2075 7365 7320     "Stripe uses 
-0000ff10: 6073 6574 7570 5f66 7574 7572 655f 7573  `setup_future_us
-0000ff20: 6167 6560 2074 6f20 6479 6e61 6d69 6361  age` to dynamica
-0000ff30: 6c6c 7920 6f70 7469 6d69 7a65 2022 0a20  lly optimize ". 
-0000ff40: 2020 2020 2020 2020 2020 2022 796f 7572             "your
-0000ff50: 2070 6179 6d65 6e74 2066 6c6f 7720 616e   payment flow an
-0000ff60: 6420 636f 6d70 6c79 2077 6974 6820 7265  d comply with re
-0000ff70: 6769 6f6e 616c 206c 6567 6973 6c61 7469  gional legislati
-0000ff80: 6f6e 2061 6e64 206e 6574 776f 726b 2072  on and network r
-0000ff90: 756c 6573 2e20 220a 2020 2020 2020 2020  ules. ".        
-0000ffa0: 2020 2020 2246 6f72 2065 7861 6d70 6c65      "For example
-0000ffb0: 2c20 6966 2079 6f75 7220 6375 7374 6f6d  , if your custom
-0000ffc0: 6572 2069 7320 696d 7061 6374 6564 2062  er is impacted b
-0000ffd0: 7920 5343 412c 2075 7369 6e67 2060 6f66  y SCA, using `of
-0000ffe0: 665f 7365 7373 696f 6e60 2022 0a20 2020  f_session` ".   
-0000fff0: 2020 2020 2020 2020 2022 7769 6c6c 2065           "will e
-00010000: 6e73 7572 6520 7468 6174 2074 6865 7920  nsure that they 
-00010010: 6172 6520 6175 7468 656e 7469 6361 7465  are authenticate
-00010020: 6420 7768 696c 6520 7072 6f63 6573 7369  d while processi
-00010030: 6e67 2074 6869 7320 220a 2020 2020 2020  ng this ".      
-00010040: 2020 2020 2020 2250 6179 6d65 6e74 496e        "PaymentIn
-00010050: 7465 6e74 2e20 596f 7520 7769 6c6c 2074  tent. You will t
-00010060: 6865 6e20 6265 2061 626c 6520 746f 206d  hen be able to m
-00010070: 616b 6520 6c61 7465 7220 6f66 662d 7365  ake later off-se
-00010080: 7373 696f 6e20 7061 796d 656e 7473 2022  ssion payments "
-00010090: 0a20 2020 2020 2020 2020 2020 2022 666f  .            "fo
-000100a0: 7220 7468 6973 2063 7573 746f 6d65 722e  r this customer.
-000100b0: 220a 2020 2020 2020 2020 292c 0a20 2020  ".        ),.   
-000100c0: 2029 0a20 2020 2073 6869 7070 696e 6720   ).    shipping 
-000100d0: 3d20 4a53 4f4e 4669 656c 6428 0a20 2020  = JSONField(.   
-000100e0: 2020 2020 206e 756c 6c3d 5472 7565 2c20       null=True, 
-000100f0: 626c 616e 6b3d 5472 7565 2c20 6865 6c70  blank=True, help
-00010100: 5f74 6578 743d 2253 6869 7070 696e 6720  _text="Shipping 
-00010110: 696e 666f 726d 6174 696f 6e20 666f 7220  information for 
-00010120: 7468 6973 2050 6179 6d65 6e74 496e 7465  this PaymentInte
-00010130: 6e74 2e22 0a20 2020 2029 0a20 2020 2073  nt.".    ).    s
-00010140: 7461 7465 6d65 6e74 5f64 6573 6372 6970  tatement_descrip
-00010150: 746f 7220 3d20 6d6f 6465 6c73 2e43 6861  tor = models.Cha
-00010160: 7246 6965 6c64 280a 2020 2020 2020 2020  rField(.        
-00010170: 6d61 785f 6c65 6e67 7468 3d32 322c 0a20  max_length=22,. 
-00010180: 2020 2020 2020 2062 6c61 6e6b 3d54 7275         blank=Tru
-00010190: 652c 0a20 2020 2020 2020 2068 656c 705f  e,.        help_
-000101a0: 7465 7874 3d28 0a20 2020 2020 2020 2020  text=(.         
-000101b0: 2020 2022 466f 7220 6e6f 6e2d 6361 7264     "For non-card
-000101c0: 2063 6861 7267 6573 2c20 796f 7520 6361   charges, you ca
-000101d0: 6e20 7573 6520 7468 6973 2076 616c 7565  n use this value
-000101e0: 2061 7320 7468 6520 636f 6d70 6c65 7465   as the complete
-000101f0: 2064 6573 6372 6970 7469 6f6e 2022 0a20   description ". 
-00010200: 2020 2020 2020 2020 2020 2022 7468 6174             "that
-00010210: 2061 7070 6561 7273 206f 6e20 796f 7572   appears on your
-00010220: 2063 7573 746f 6d65 7273 2720 7374 6174   customers' stat
-00010230: 656d 656e 7473 2e20 4d75 7374 2063 6f6e  ements. Must con
-00010240: 7461 696e 2061 7420 6c65 6173 7420 6f6e  tain at least on
-00010250: 6520 220a 2020 2020 2020 2020 2020 2020  e ".            
-00010260: 226c 6574 7465 722c 206d 6178 696d 756d  "letter, maximum
-00010270: 2032 3220 6368 6172 6163 7465 7273 2e22   22 characters."
-00010280: 0a20 2020 2020 2020 2029 2c0a 2020 2020  .        ),.    
-00010290: 290a 2020 2020 7374 6174 7573 203d 2053  ).    status = S
-000102a0: 7472 6970 6545 6e75 6d46 6965 6c64 280a  tripeEnumField(.
-000102b0: 2020 2020 2020 2020 656e 756d 3d65 6e75          enum=enu
-000102c0: 6d73 2e50 6179 6d65 6e74 496e 7465 6e74  ms.PaymentIntent
-000102d0: 5374 6174 7573 2c0a 2020 2020 2020 2020  Status,.        
-000102e0: 6865 6c70 5f74 6578 743d 280a 2020 2020  help_text=(.    
-000102f0: 2020 2020 2020 2020 2253 7461 7475 7320          "Status 
-00010300: 6f66 2074 6869 7320 5061 796d 656e 7449  of this PaymentI
-00010310: 6e74 656e 742c 206f 6e65 206f 6620 7265  ntent, one of re
-00010320: 7175 6972 6573 5f70 6179 6d65 6e74 5f6d  quires_payment_m
-00010330: 6574 686f 642c 2022 0a20 2020 2020 2020  ethod, ".       
-00010340: 2020 2020 2022 7265 7175 6972 6573 5f63       "requires_c
-00010350: 6f6e 6669 726d 6174 696f 6e2c 2072 6571  onfirmation, req
-00010360: 7569 7265 735f 6163 7469 6f6e 2c20 7072  uires_action, pr
-00010370: 6f63 6573 7369 6e67 2c20 7265 7175 6972  ocessing, requir
-00010380: 6573 5f63 6170 7475 7265 2c20 220a 2020  es_capture, ".  
-00010390: 2020 2020 2020 2020 2020 2263 616e 6365            "cance
-000103a0: 6c65 642c 206f 7220 7375 6363 6565 6465  led, or succeede
-000103b0: 642e 2022 0a20 2020 2020 2020 2020 2020  d. ".           
-000103c0: 2022 596f 7520 6361 6e20 7265 6164 206d   "You can read m
-000103d0: 6f72 6520 6162 6f75 7420 5061 796d 656e  ore about Paymen
-000103e0: 7449 6e74 656e 7420 7374 6174 7573 6573  tIntent statuses
-000103f0: 2068 6572 652e 220a 2020 2020 2020 2020   here.".        
-00010400: 292c 0a20 2020 2029 0a20 2020 2074 7261  ),.    ).    tra
-00010410: 6e73 6665 725f 6461 7461 203d 204a 534f  nsfer_data = JSO
-00010420: 4e46 6965 6c64 280a 2020 2020 2020 2020  NField(.        
-00010430: 6e75 6c6c 3d54 7275 652c 0a20 2020 2020  null=True,.     
-00010440: 2020 2062 6c61 6e6b 3d54 7275 652c 0a20     blank=True,. 
-00010450: 2020 2020 2020 2068 656c 705f 7465 7874         help_text
-00010460: 3d28 0a20 2020 2020 2020 2020 2020 2022  =(.            "
-00010470: 5468 6520 6461 7461 2077 6974 6820 7768  The data with wh
-00010480: 6963 6820 746f 2061 7574 6f6d 6174 6963  ich to automatic
-00010490: 616c 6c79 2063 7265 6174 6520 6120 5472  ally create a Tr
-000104a0: 616e 7366 6572 2077 6865 6e20 7468 6520  ansfer when the 
-000104b0: 7061 796d 656e 7420 220a 2020 2020 2020  payment ".      
-000104c0: 2020 2020 2020 2269 7320 6669 6e61 6c69        "is finali
-000104d0: 7a65 642e 2022 0a20 2020 2020 2020 2020  zed. ".         
-000104e0: 2020 2022 5365 6520 7468 6520 5061 796d     "See the Paym
-000104f0: 656e 7449 6e74 656e 7473 2043 6f6e 6e65  entIntents Conne
-00010500: 6374 2075 7361 6765 2067 7569 6465 2066  ct usage guide f
-00010510: 6f72 2064 6574 6169 6c73 2e22 0a20 2020  or details.".   
-00010520: 2020 2020 2029 2c0a 2020 2020 290a 2020       ),.    ).  
-00010530: 2020 7472 616e 7366 6572 5f67 726f 7570    transfer_group
-00010540: 203d 206d 6f64 656c 732e 4368 6172 4669   = models.CharFi
-00010550: 656c 6428 0a20 2020 2020 2020 2062 6c61  eld(.        bla
-00010560: 6e6b 3d54 7275 652c 0a20 2020 2020 2020  nk=True,.       
-00010570: 206d 6178 5f6c 656e 6774 683d 3235 352c   max_length=255,
-00010580: 0a20 2020 2020 2020 2068 656c 705f 7465  .        help_te
-00010590: 7874 3d28 0a20 2020 2020 2020 2020 2020  xt=(.           
-000105a0: 2022 4120 7374 7269 6e67 2074 6861 7420   "A string that 
-000105b0: 6964 656e 7469 6669 6573 2074 6865 2072  identifies the r
-000105c0: 6573 756c 7469 6e67 2070 6179 6d65 6e74  esulting payment
-000105d0: 2061 7320 7061 7274 206f 6620 6120 6772   as part of a gr
-000105e0: 6f75 702e 2022 0a20 2020 2020 2020 2020  oup. ".         
-000105f0: 2020 2022 5365 6520 7468 6520 5061 796d     "See the Paym
-00010600: 656e 7449 6e74 656e 7473 2043 6f6e 6e65  entIntents Conne
-00010610: 6374 2075 7361 6765 2067 7569 6465 2066  ct usage guide f
-00010620: 6f72 2064 6574 6169 6c73 2e22 0a20 2020  or details.".   
-00010630: 2020 2020 2029 2c0a 2020 2020 290a 0a20       ),.    ).. 
-00010640: 2020 2064 6566 205f 5f73 7472 5f5f 2873     def __str__(s
-00010650: 656c 6629 3a0a 2020 2020 2020 2020 6163  elf):.        ac
-00010660: 636f 756e 7420 3d20 7365 6c66 2e6f 6e5f  count = self.on_
-00010670: 6265 6861 6c66 5f6f 660a 2020 2020 2020  behalf_of.      
-00010680: 2020 6375 7374 6f6d 6572 203d 2073 656c    customer = sel
-00010690: 662e 6375 7374 6f6d 6572 0a20 2020 2020  f.customer.     
-000106a0: 2020 2061 6d6f 756e 7420 3d20 6765 745f     amount = get_
-000106b0: 6672 6965 6e64 6c79 5f63 7572 7265 6e63  friendly_currenc
-000106c0: 795f 616d 6f75 6e74 2873 656c 662e 616d  y_amount(self.am
-000106d0: 6f75 6e74 202f 2031 3030 2c20 7365 6c66  ount / 100, self
-000106e0: 2e63 7572 7265 6e63 7929 0a20 2020 2020  .currency).     
-000106f0: 2020 2073 7461 7475 7320 3d20 656e 756d     status = enum
-00010700: 732e 5061 796d 656e 7449 6e74 656e 7453  s.PaymentIntentS
-00010710: 7461 7475 732e 6875 6d61 6e69 7a65 2873  tatus.humanize(s
-00010720: 656c 662e 7374 6174 7573 290a 0a20 2020  elf.status)..   
-00010730: 2020 2020 2069 6620 6163 636f 756e 7420       if account 
-00010740: 616e 6420 6375 7374 6f6d 6572 3a0a 2020  and customer:.  
-00010750: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00010760: 2066 227b 616d 6f75 6e74 7d20 287b 7374   f"{amount} ({st
-00010770: 6174 7573 7d29 2066 6f72 207b 6163 636f  atus}) for {acco
-00010780: 756e 747d 2062 7920 7b63 7573 746f 6d65  unt} by {custome
-00010790: 727d 220a 2020 2020 2020 2020 6966 2061  r}".        if a
-000107a0: 6363 6f75 6e74 3a0a 2020 2020 2020 2020  ccount:.        
-000107b0: 2020 2020 7265 7475 726e 2066 227b 616d      return f"{am
-000107c0: 6f75 6e74 7d20 666f 7220 7b61 6363 6f75  ount} for {accou
-000107d0: 6e74 7d2e 207b 7374 6174 7573 7d22 0a20  nt}. {status}". 
-000107e0: 2020 2020 2020 2069 6620 6375 7374 6f6d         if custom
-000107f0: 6572 3a0a 2020 2020 2020 2020 2020 2020  er:.            
-00010800: 7265 7475 726e 2066 227b 616d 6f75 6e74  return f"{amount
-00010810: 7d20 6279 207b 6375 7374 6f6d 6572 7d2e  } by {customer}.
-00010820: 207b 7374 6174 7573 7d22 0a0a 2020 2020   {status}"..    
-00010830: 2020 2020 7265 7475 726e 2066 227b 616d      return f"{am
-00010840: 6f75 6e74 7d20 287b 7374 6174 7573 7d29  ount} ({status})
-00010850: 220a 0a20 2020 2064 6566 2075 7064 6174  "..    def updat
-00010860: 6528 7365 6c66 2c20 6170 695f 6b65 793d  e(self, api_key=
-00010870: 4e6f 6e65 2c20 2a2a 6b77 6172 6773 293a  None, **kwargs):
-00010880: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00010890: 2020 2020 2043 616c 6c20 7468 6520 7374       Call the st
-000108a0: 7269 7065 2041 5049 2773 206d 6f64 6966  ripe API's modif
-000108b0: 7920 6f70 6572 6174 696f 6e20 666f 7220  y operation for 
-000108c0: 7468 6973 206d 6f64 656c 0a0a 2020 2020  this model..    
-000108d0: 2020 2020 3a70 6172 616d 2061 7069 5f6b      :param api_k
-000108e0: 6579 3a20 5468 6520 6170 6920 6b65 7920  ey: The api key 
-000108f0: 746f 2075 7365 2066 6f72 2074 6869 7320  to use for this 
-00010900: 7265 7175 6573 742e 0a20 2020 2020 2020  request..       
-00010910: 2020 2020 2044 6566 6175 6c74 7320 746f       Defaults to
-00010920: 2064 6a73 7472 6970 655f 7365 7474 696e   djstripe_settin
-00010930: 6773 2e53 5452 4950 455f 5345 4352 4554  gs.STRIPE_SECRET
-00010940: 5f4b 4559 2e0a 2020 2020 2020 2020 3a74  _KEY..        :t
-00010950: 7970 6520 6170 695f 6b65 793a 2073 7472  ype api_key: str
-00010960: 696e 670a 2020 2020 2020 2020 2222 220a  ing.        """.
-00010970: 2020 2020 2020 2020 6170 695f 6b65 7920          api_key 
-00010980: 3d20 6170 695f 6b65 7920 6f72 2073 656c  = api_key or sel
-00010990: 662e 6465 6661 756c 745f 6170 695f 6b65  f.default_api_ke
-000109a0: 790a 2020 2020 2020 2020 7265 7370 6f6e  y.        respon
-000109b0: 7365 203d 2073 656c 662e 6170 695f 7265  se = self.api_re
-000109c0: 7472 6965 7665 2861 7069 5f6b 6579 3d61  trieve(api_key=a
-000109d0: 7069 5f6b 6579 290a 2020 2020 2020 2020  pi_key).        
-000109e0: 7265 7475 726e 2072 6573 706f 6e73 652e  return response.
-000109f0: 6d6f 6469 6679 2872 6573 706f 6e73 652e  modify(response.
-00010a00: 7374 7269 7065 5f69 642c 2061 7069 5f6b  stripe_id, api_k
-00010a10: 6579 3d61 7069 5f6b 6579 2c20 2a2a 6b77  ey=api_key, **kw
-00010a20: 6172 6773 290a 0a20 2020 2064 6566 205f  args)..    def _
-00010a30: 6170 695f 6361 6e63 656c 2873 656c 662c  api_cancel(self,
-00010a40: 2061 7069 5f6b 6579 3d4e 6f6e 652c 202a   api_key=None, *
-00010a50: 2a6b 7761 7267 7329 3a0a 2020 2020 2020  *kwargs):.      
-00010a60: 2020 2222 220a 2020 2020 2020 2020 4361    """.        Ca
-00010a70: 6c6c 2074 6865 2073 7472 6970 6520 4150  ll the stripe AP
-00010a80: 4927 7320 6361 6e63 656c 206f 7065 7261  I's cancel opera
-00010a90: 7469 6f6e 2066 6f72 2074 6869 7320 6d6f  tion for this mo
-00010aa0: 6465 6c0a 0a20 2020 2020 2020 203a 7061  del..        :pa
-00010ab0: 7261 6d20 6170 695f 6b65 793a 2054 6865  ram api_key: The
-00010ac0: 2061 7069 206b 6579 2074 6f20 7573 6520   api key to use 
-00010ad0: 666f 7220 7468 6973 2072 6571 7565 7374  for this request
-00010ae0: 2e0a 2020 2020 2020 2020 2020 2020 4465  ..            De
-00010af0: 6661 756c 7473 2074 6f20 646a 7374 7269  faults to djstri
-00010b00: 7065 5f73 6574 7469 6e67 732e 5354 5249  pe_settings.STRI
-00010b10: 5045 5f53 4543 5245 545f 4b45 592e 0a20  PE_SECRET_KEY.. 
-00010b20: 2020 2020 2020 203a 7479 7065 2061 7069         :type api
-00010b30: 5f6b 6579 3a20 7374 7269 6e67 0a20 2020  _key: string.   
-00010b40: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00010b50: 2061 7069 5f6b 6579 203d 2061 7069 5f6b   api_key = api_k
-00010b60: 6579 206f 7220 7365 6c66 2e64 6566 6175  ey or self.defau
-00010b70: 6c74 5f61 7069 5f6b 6579 0a0a 2020 2020  lt_api_key..    
-00010b80: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00010b90: 6170 695f 7265 7472 6965 7665 2861 7069  api_retrieve(api
-00010ba0: 5f6b 6579 3d61 7069 5f6b 6579 292e 6361  _key=api_key).ca
-00010bb0: 6e63 656c 282a 2a6b 7761 7267 7329 0a0a  ncel(**kwargs)..
-00010bc0: 2020 2020 6465 6620 5f61 7069 5f63 6f6e      def _api_con
-00010bd0: 6669 726d 2873 656c 662c 2061 7069 5f6b  firm(self, api_k
-00010be0: 6579 3d4e 6f6e 652c 202a 2a6b 7761 7267  ey=None, **kwarg
-00010bf0: 7329 3a0a 2020 2020 2020 2020 2222 220a  s):.        """.
-00010c00: 2020 2020 2020 2020 4361 6c6c 2074 6865          Call the
-00010c10: 2073 7472 6970 6520 4150 4927 7320 636f   stripe API's co
-00010c20: 6e66 6972 6d20 6f70 6572 6174 696f 6e20  nfirm operation 
-00010c30: 666f 7220 7468 6973 206d 6f64 656c 2e0a  for this model..
-00010c40: 0a20 2020 2020 2020 2043 6f6e 6669 726d  .        Confirm
-00010c50: 2074 6861 7420 796f 7572 2063 7573 746f   that your custo
-00010c60: 6d65 7220 696e 7465 6e64 7320 746f 2070  mer intends to p
-00010c70: 6179 2077 6974 6820 6375 7272 656e 7420  ay with current 
-00010c80: 6f72 0a20 2020 2020 2020 2070 726f 7669  or.        provi
-00010c90: 6465 6420 7061 796d 656e 7420 6d65 7468  ded payment meth
-00010ca0: 6f64 2e20 5570 6f6e 2063 6f6e 6669 726d  od. Upon confirm
-00010cb0: 6174 696f 6e2c 2074 6865 2050 6179 6d65  ation, the Payme
-00010cc0: 6e74 496e 7465 6e74 0a20 2020 2020 2020  ntIntent.       
-00010cd0: 2077 696c 6c20 6174 7465 6d70 7420 746f   will attempt to
-00010ce0: 2069 6e69 7469 6174 6520 6120 7061 796d   initiate a paym
-00010cf0: 656e 742e 0a0a 2020 2020 2020 2020 3a70  ent...        :p
-00010d00: 6172 616d 2061 7069 5f6b 6579 3a20 5468  aram api_key: Th
-00010d10: 6520 6170 6920 6b65 7920 746f 2075 7365  e api key to use
-00010d20: 2066 6f72 2074 6869 7320 7265 7175 6573   for this reques
-00010d30: 742e 0a20 2020 2020 2020 2020 2020 2044  t..            D
-00010d40: 6566 6175 6c74 7320 746f 2064 6a73 7472  efaults to djstr
-00010d50: 6970 655f 7365 7474 696e 6773 2e53 5452  ipe_settings.STR
-00010d60: 4950 455f 5345 4352 4554 5f4b 4559 2e0a  IPE_SECRET_KEY..
-00010d70: 2020 2020 2020 2020 3a74 7970 6520 6170          :type ap
-00010d80: 695f 6b65 793a 2073 7472 696e 670a 2020  i_key: string.  
-00010d90: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00010da0: 2020 6170 695f 6b65 7920 3d20 6170 695f    api_key = api_
-00010db0: 6b65 7920 6f72 2073 656c 662e 6465 6661  key or self.defa
-00010dc0: 756c 745f 6170 695f 6b65 790a 0a20 2020  ult_api_key..   
-00010dd0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00010de0: 2e61 7069 5f72 6574 7269 6576 6528 6170  .api_retrieve(ap
-00010df0: 695f 6b65 793d 6170 695f 6b65 7929 2e63  i_key=api_key).c
-00010e00: 6f6e 6669 726d 282a 2a6b 7761 7267 7329  onfirm(**kwargs)
-00010e10: 0a0a 0a63 6c61 7373 2053 6574 7570 496e  ...class SetupIn
-00010e20: 7465 6e74 2853 7472 6970 654d 6f64 656c  tent(StripeModel
-00010e30: 293a 0a20 2020 2022 2222 0a20 2020 2041  ):.    """.    A
-00010e40: 2053 6574 7570 496e 7465 6e74 2067 7569   SetupIntent gui
-00010e50: 6465 7320 796f 7520 7468 726f 7567 6820  des you through 
-00010e60: 7468 6520 7072 6f63 6573 7320 6f66 2073  the process of s
-00010e70: 6574 7469 6e67 2075 7020 6120 6375 7374  etting up a cust
-00010e80: 6f6d 6572 2773 0a20 2020 2070 6179 6d65  omer's.    payme
-00010e90: 6e74 2063 7265 6465 6e74 6961 6c73 2066  nt credentials f
-00010ea0: 6f72 2066 7574 7572 6520 7061 796d 656e  or future paymen
-00010eb0: 7473 2e20 466f 7220 6578 616d 706c 652c  ts. For example,
-00010ec0: 2079 6f75 2063 6f75 6c64 2075 7365 2061   you could use a
-00010ed0: 2053 6574 7570 496e 7465 6e74 0a20 2020   SetupIntent.   
-00010ee0: 2074 6f20 7365 7420 7570 2079 6f75 7220   to set up your 
-00010ef0: 6375 7374 6f6d 6572 2773 2063 6172 6420  customer's card 
-00010f00: 7769 7468 6f75 7420 696d 6d65 6469 6174  without immediat
-00010f10: 656c 7920 636f 6c6c 6563 7469 6e67 2061  ely collecting a
-00010f20: 2070 6179 6d65 6e74 2e0a 2020 2020 4c61   payment..    La
-00010f30: 7465 722c 2079 6f75 2063 616e 2075 7365  ter, you can use
-00010f40: 2050 6179 6d65 6e74 496e 7465 6e74 7320   PaymentIntents 
-00010f50: 746f 2064 7269 7665 2074 6865 2070 6179  to drive the pay
-00010f60: 6d65 6e74 2066 6c6f 772e 0a0a 2020 2020  ment flow...    
-00010f70: 4e4f 5445 3a20 596f 7520 7368 6f75 6c64  NOTE: You should
-00010f80: 206e 6f74 206d 6169 6e74 6169 6e20 6c6f   not maintain lo
-00010f90: 6e67 2d6c 6976 6564 2c20 756e 636f 6e66  ng-lived, unconf
-00010fa0: 6972 6d65 6420 5365 7475 7049 6e74 656e  irmed SetupInten
-00010fb0: 7473 2e0a 2020 2020 466f 7220 7365 6375  ts..    For secu
-00010fc0: 7269 7479 2070 7572 706f 7365 732c 2053  rity purposes, S
-00010fd0: 6574 7570 496e 7465 6e74 7320 6f6c 6465  etupIntents olde
-00010fe0: 7220 7468 616e 2032 3420 686f 7572 7320  r than 24 hours 
-00010ff0: 6d61 7920 6e6f 206c 6f6e 6765 7220 6265  may no longer be
-00011000: 2076 616c 6964 2e0a 0a20 2020 2053 7472   valid...    Str
-00011010: 6970 6520 646f 6375 6d65 6e74 6174 696f  ipe documentatio
-00011020: 6e3a 2068 7474 7073 3a2f 2f73 7472 6970  n: https://strip
-00011030: 652e 636f 6d2f 646f 6373 2f61 7069 3f6c  e.com/docs/api?l
-00011040: 616e 673d 7079 7468 6f6e 2373 6574 7570  ang=python#setup
-00011050: 5f69 6e74 656e 7473 0a20 2020 2022 2222  _intents.    """
-00011060: 0a0a 2020 2020 7374 7269 7065 5f63 6c61  ..    stripe_cla
-00011070: 7373 203d 2073 7472 6970 652e 5365 7475  ss = stripe.Setu
-00011080: 7049 6e74 656e 740a 0a20 2020 2061 7070  pIntent..    app
-00011090: 6c69 6361 7469 6f6e 203d 206d 6f64 656c  lication = model
-000110a0: 732e 4368 6172 4669 656c 6428 0a20 2020  s.CharField(.   
-000110b0: 2020 2020 206d 6178 5f6c 656e 6774 683d       max_length=
-000110c0: 3235 352c 0a20 2020 2020 2020 2062 6c61  255,.        bla
-000110d0: 6e6b 3d54 7275 652c 0a20 2020 2020 2020  nk=True,.       
-000110e0: 2068 656c 705f 7465 7874 3d22 4944 206f   help_text="ID o
-000110f0: 6620 7468 6520 436f 6e6e 6563 7420 6170  f the Connect ap
-00011100: 706c 6963 6174 696f 6e20 7468 6174 2063  plication that c
-00011110: 7265 6174 6564 2074 6865 2053 6574 7570  reated the Setup
-00011120: 496e 7465 6e74 2e22 2c0a 2020 2020 290a  Intent.",.    ).
-00011130: 2020 2020 6361 6e63 656c 6c61 7469 6f6e      cancellation
-00011140: 5f72 6561 736f 6e20 3d20 5374 7269 7065  _reason = Stripe
-00011150: 456e 756d 4669 656c 6428 0a20 2020 2020  EnumField(.     
-00011160: 2020 2065 6e75 6d3d 656e 756d 732e 5365     enum=enums.Se
-00011170: 7475 7049 6e74 656e 7443 616e 6365 6c6c  tupIntentCancell
-00011180: 6174 696f 6e52 6561 736f 6e2c 0a20 2020  ationReason,.   
-00011190: 2020 2020 2062 6c61 6e6b 3d54 7275 652c       blank=True,
-000111a0: 0a20 2020 2020 2020 2068 656c 705f 7465  .        help_te
-000111b0: 7874 3d28 0a20 2020 2020 2020 2020 2020  xt=(.           
-000111c0: 2022 5265 6173 6f6e 2066 6f72 2063 616e   "Reason for can
-000111d0: 6365 6c6c 6174 696f 6e20 6f66 2074 6869  cellation of thi
-000111e0: 7320 5365 7475 7049 6e74 656e 742c 206f  s SetupIntent, o
-000111f0: 6e65 206f 6620 6162 616e 646f 6e65 642c  ne of abandoned,
-00011200: 2022 0a20 2020 2020 2020 2020 2020 2022   ".            "
-00011210: 7265 7175 6573 7465 645f 6279 5f63 7573  requested_by_cus
-00011220: 746f 6d65 722c 206f 7220 6475 706c 6963  tomer, or duplic
-00011230: 6174 6522 0a20 2020 2020 2020 2029 2c0a  ate".        ),.
-00011240: 2020 2020 290a 2020 2020 636c 6965 6e74      ).    client
-00011250: 5f73 6563 7265 7420 3d20 6d6f 6465 6c73  _secret = models
-00011260: 2e54 6578 7446 6965 6c64 280a 2020 2020  .TextField(.    
-00011270: 2020 2020 6d61 785f 6c65 6e67 7468 3d35      max_length=5
-00011280: 3030 302c 0a20 2020 2020 2020 2062 6c61  000,.        bla
-00011290: 6e6b 3d54 7275 652c 0a20 2020 2020 2020  nk=True,.       
-000112a0: 2068 656c 705f 7465 7874 3d28 0a20 2020   help_text=(.   
-000112b0: 2020 2020 2020 2020 2022 5468 6520 636c           "The cl
-000112c0: 6965 6e74 2073 6563 7265 7420 6f66 2074  ient secret of t
-000112d0: 6869 7320 5365 7475 7049 6e74 656e 742e  his SetupIntent.
-000112e0: 2022 0a20 2020 2020 2020 2020 2020 2022   ".            "
-000112f0: 5573 6564 2066 6f72 2063 6c69 656e 742d  Used for client-
-00011300: 7369 6465 2072 6574 7269 6576 616c 2075  side retrieval u
-00011310: 7369 6e67 2061 2070 7562 6c69 7368 6162  sing a publishab
-00011320: 6c65 206b 6579 2e22 0a20 2020 2020 2020  le key.".       
-00011330: 2029 2c0a 2020 2020 290a 2020 2020 6375   ),.    ).    cu
-00011340: 7374 6f6d 6572 203d 2053 7472 6970 6546  stomer = StripeF
-00011350: 6f72 6569 676e 4b65 7928 0a20 2020 2020  oreignKey(.     
-00011360: 2020 2022 4375 7374 6f6d 6572 222c 0a20     "Customer",. 
-00011370: 2020 2020 2020 206e 756c 6c3d 5472 7565         null=True
-00011380: 2c0a 2020 2020 2020 2020 626c 616e 6b3d  ,.        blank=
-00011390: 5472 7565 2c0a 2020 2020 2020 2020 6f6e  True,.        on
-000113a0: 5f64 656c 6574 653d 6d6f 6465 6c73 2e53  _delete=models.S
-000113b0: 4554 5f4e 554c 4c2c 0a20 2020 2020 2020  ET_NULL,.       
-000113c0: 2068 656c 705f 7465 7874 3d22 4375 7374   help_text="Cust
-000113d0: 6f6d 6572 2074 6869 7320 5365 7475 7049  omer this SetupI
-000113e0: 6e74 656e 7420 6265 6c6f 6e67 7320 746f  ntent belongs to
-000113f0: 2c20 6966 206f 6e65 2065 7869 7374 732e  , if one exists.
-00011400: 222c 0a20 2020 2029 0a20 2020 206c 6173  ",.    ).    las
-00011410: 745f 7365 7475 705f 6572 726f 7220 3d20  t_setup_error = 
-00011420: 4a53 4f4e 4669 656c 6428 0a20 2020 2020  JSONField(.     
-00011430: 2020 206e 756c 6c3d 5472 7565 2c0a 2020     null=True,.  
-00011440: 2020 2020 2020 626c 616e 6b3d 5472 7565        blank=True
-00011450: 2c0a 2020 2020 2020 2020 6865 6c70 5f74  ,.        help_t
-00011460: 6578 743d 2254 6865 2065 7272 6f72 2065  ext="The error e
-00011470: 6e63 6f75 6e74 6572 6564 2069 6e20 7468  ncountered in th
-00011480: 6520 7072 6576 696f 7573 2053 6574 7570  e previous Setup
-00011490: 496e 7465 6e74 2063 6f6e 6669 726d 6174  Intent confirmat
-000114a0: 696f 6e2e 222c 0a20 2020 2029 0a20 2020  ion.",.    ).   
-000114b0: 206e 6578 745f 6163 7469 6f6e 203d 204a   next_action = J
-000114c0: 534f 4e46 6965 6c64 280a 2020 2020 2020  SONField(.      
-000114d0: 2020 6e75 6c6c 3d54 7275 652c 0a20 2020    null=True,.   
-000114e0: 2020 2020 2062 6c61 6e6b 3d54 7275 652c       blank=True,
-000114f0: 0a20 2020 2020 2020 2068 656c 705f 7465  .        help_te
-00011500: 7874 3d28 0a20 2020 2020 2020 2020 2020  xt=(.           
-00011510: 2022 4966 2070 7265 7365 6e74 2c20 7468   "If present, th
-00011520: 6973 2070 726f 7065 7274 7920 7465 6c6c  is property tell
-00011530: 7320 796f 7520 7768 6174 2061 6374 696f  s you what actio
-00011540: 6e73 2079 6f75 206e 6565 6420 746f 2074  ns you need to t
-00011550: 616b 6520 696e 220a 2020 2020 2020 2020  ake in".        
-00011560: 2020 2020 226f 7264 6572 2066 6f72 2079      "order for y
-00011570: 6f75 7220 6375 7374 6f6d 6572 2074 6f20  our customer to 
-00011580: 636f 6e74 696e 7565 2070 6179 6d65 6e74  continue payment
-00011590: 2073 6574 7570 2e22 0a20 2020 2020 2020   setup.".       
-000115a0: 2029 2c0a 2020 2020 290a 2020 2020 6f6e   ),.    ).    on
-000115b0: 5f62 6568 616c 665f 6f66 203d 2053 7472  _behalf_of = Str
-000115c0: 6970 6546 6f72 6569 676e 4b65 7928 0a20  ipeForeignKey(. 
-000115d0: 2020 2020 2020 2022 4163 636f 756e 7422         "Account"
-000115e0: 2c0a 2020 2020 2020 2020 6f6e 5f64 656c  ,.        on_del
-000115f0: 6574 653d 6d6f 6465 6c73 2e53 4554 5f4e  ete=models.SET_N
-00011600: 554c 4c2c 0a20 2020 2020 2020 206e 756c  ULL,.        nul
-00011610: 6c3d 5472 7565 2c0a 2020 2020 2020 2020  l=True,.        
-00011620: 626c 616e 6b3d 5472 7565 2c0a 2020 2020  blank=True,.    
-00011630: 2020 2020 6865 6c70 5f74 6578 743d 2254      help_text="T
-00011640: 6865 2061 6363 6f75 6e74 2028 6966 2061  he account (if a
-00011650: 6e79 2920 666f 7220 7768 6963 6820 7468  ny) for which th
-00011660: 6520 7365 7475 7020 6973 2069 6e74 656e  e setup is inten
-00011670: 6465 642e 222c 0a20 2020 2020 2020 2072  ded.",.        r
-00011680: 656c 6174 6564 5f6e 616d 653d 2273 6574  elated_name="set
-00011690: 7570 5f69 6e74 656e 7473 222c 0a20 2020  up_intents",.   
-000116a0: 2029 0a20 2020 2070 6179 6d65 6e74 5f6d   ).    payment_m
-000116b0: 6574 686f 6420 3d20 5374 7269 7065 466f  ethod = StripeFo
-000116c0: 7265 6967 6e4b 6579 280a 2020 2020 2020  reignKey(.      
-000116d0: 2020 2250 6179 6d65 6e74 4d65 7468 6f64    "PaymentMethod
-000116e0: 222c 0a20 2020 2020 2020 206f 6e5f 6465  ",.        on_de
-000116f0: 6c65 7465 3d6d 6f64 656c 732e 5345 545f  lete=models.SET_
-00011700: 4e55 4c4c 2c0a 2020 2020 2020 2020 6e75  NULL,.        nu
-00011710: 6c6c 3d54 7275 652c 0a20 2020 2020 2020  ll=True,.       
-00011720: 2062 6c61 6e6b 3d54 7275 652c 0a20 2020   blank=True,.   
-00011730: 2020 2020 2068 656c 705f 7465 7874 3d22       help_text="
-00011740: 5061 796d 656e 7420 6d65 7468 6f64 2075  Payment method u
-00011750: 7365 6420 696e 2074 6869 7320 5061 796d  sed in this Paym
-00011760: 656e 7449 6e74 656e 742e 222c 0a20 2020  entIntent.",.   
-00011770: 2029 0a20 2020 2070 6179 6d65 6e74 5f6d   ).    payment_m
-00011780: 6574 686f 645f 7479 7065 7320 3d20 4a53  ethod_types = JS
-00011790: 4f4e 4669 656c 6428 0a20 2020 2020 2020  ONField(.       
-000117a0: 2068 656c 705f 7465 7874 3d28 0a20 2020   help_text=(.   
-000117b0: 2020 2020 2020 2020 2022 5468 6520 6c69           "The li
-000117c0: 7374 206f 6620 7061 796d 656e 7420 6d65  st of payment me
-000117d0: 7468 6f64 2074 7970 6573 2028 652e 672e  thod types (e.g.
-000117e0: 2063 6172 6429 2074 6861 7420 7468 6973   card) that this
-000117f0: 2050 6179 6d65 6e74 496e 7465 6e74 2069   PaymentIntent i
-00011800: 7320 220a 2020 2020 2020 2020 2020 2020  s ".            
-00011810: 2261 6c6c 6f77 6564 2074 6f20 7573 652e  "allowed to use.
-00011820: 220a 2020 2020 2020 2020 290a 2020 2020  ".        ).    
-00011830: 290a 2020 2020 7374 6174 7573 203d 2053  ).    status = S
-00011840: 7472 6970 6545 6e75 6d46 6965 6c64 280a  tripeEnumField(.
-00011850: 2020 2020 2020 2020 656e 756d 3d65 6e75          enum=enu
-00011860: 6d73 2e53 6574 7570 496e 7465 6e74 5374  ms.SetupIntentSt
-00011870: 6174 7573 2c0a 2020 2020 2020 2020 6865  atus,.        he
-00011880: 6c70 5f74 6578 743d 280a 2020 2020 2020  lp_text=(.      
-00011890: 2020 2020 2020 2253 7461 7475 7320 6f66        "Status of
-000118a0: 2074 6869 7320 5365 7475 7049 6e74 656e   this SetupInten
-000118b0: 742c 206f 6e65 206f 6620 7265 7175 6972  t, one of requir
-000118c0: 6573 5f70 6179 6d65 6e74 5f6d 6574 686f  es_payment_metho
-000118d0: 642c 2022 0a20 2020 2020 2020 2020 2020  d, ".           
-000118e0: 2022 7265 7175 6972 6573 5f63 6f6e 6669   "requires_confi
-000118f0: 726d 6174 696f 6e2c 2072 6571 7569 7265  rmation, require
-00011900: 735f 6163 7469 6f6e 2c20 7072 6f63 6573  s_action, proces
-00011910: 7369 6e67 2c20 220a 2020 2020 2020 2020  sing, ".        
-00011920: 2020 2020 2263 616e 6365 6c65 642c 206f      "canceled, o
-00011930: 7220 7375 6363 6565 6465 642e 220a 2020  r succeeded.".  
-00011940: 2020 2020 2020 292c 0a20 2020 2029 0a20        ),.    ). 
-00011950: 2020 2075 7361 6765 203d 2053 7472 6970     usage = Strip
-00011960: 6545 6e75 6d46 6965 6c64 280a 2020 2020  eEnumField(.    
-00011970: 2020 2020 656e 756d 3d65 6e75 6d73 2e49      enum=enums.I
-00011980: 6e74 656e 7455 7361 6765 2c0a 2020 2020  ntentUsage,.    
-00011990: 2020 2020 6465 6661 756c 743d 656e 756d      default=enum
-000119a0: 732e 496e 7465 6e74 5573 6167 652e 6f66  s.IntentUsage.of
-000119b0: 665f 7365 7373 696f 6e2c 0a20 2020 2020  f_session,.     
-000119c0: 2020 2068 656c 705f 7465 7874 3d28 0a20     help_text=(. 
-000119d0: 2020 2020 2020 2020 2020 2022 496e 6469             "Indi
-000119e0: 6361 7465 7320 686f 7720 7468 6520 7061  cates how the pa
-000119f0: 796d 656e 7420 6d65 7468 6f64 2069 7320  yment method is 
-00011a00: 696e 7465 6e64 6564 2074 6f20 6265 2075  intended to be u
-00011a10: 7365 6420 696e 2074 6865 2066 7574 7572  sed in the futur
-00011a20: 652e 220a 2020 2020 2020 2020 292c 0a20  e.".        ),. 
-00011a30: 2020 2029 0a0a 2020 2020 6465 6620 5f5f     )..    def __
-00011a40: 7374 725f 5f28 7365 6c66 293a 0a20 2020  str__(self):.   
-00011a50: 2020 2020 2061 6363 6f75 6e74 203d 2073       account = s
-00011a60: 656c 662e 6f6e 5f62 6568 616c 665f 6f66  elf.on_behalf_of
-00011a70: 0a20 2020 2020 2020 2063 7573 746f 6d65  .        custome
-00011a80: 7220 3d20 7365 6c66 2e63 7573 746f 6d65  r = self.custome
-00011a90: 720a 0a20 2020 2020 2020 2069 6620 6163  r..        if ac
-00011aa0: 636f 756e 7420 616e 6420 6375 7374 6f6d  count and custom
-00011ab0: 6572 3a0a 2020 2020 2020 2020 2020 2020  er:.            
-00011ac0: 7265 7475 726e 2028 0a20 2020 2020 2020  return (.       
-00011ad0: 2020 2020 2020 2020 2066 227b 7365 6c66           f"{self
-00011ae0: 2e70 6179 6d65 6e74 5f6d 6574 686f 647d  .payment_method}
-00011af0: 2028 7b65 6e75 6d73 2e53 6574 7570 496e   ({enums.SetupIn
-00011b00: 7465 6e74 5374 6174 7573 2e68 756d 616e  tentStatus.human
-00011b10: 697a 6528 7365 6c66 2e73 7461 7475 7329  ize(self.status)
-00011b20: 7d29 2022 0a20 2020 2020 2020 2020 2020  }) ".           
-00011b30: 2020 2020 2066 2266 6f72 207b 6163 636f       f"for {acco
-00011b40: 756e 747d 2022 0a20 2020 2020 2020 2020  unt} ".         
-00011b50: 2020 2020 2020 2066 2262 7920 7b63 7573         f"by {cus
-00011b60: 746f 6d65 727d 220a 2020 2020 2020 2020  tomer}".        
-00011b70: 2020 2020 290a 0a20 2020 2020 2020 2069      )..        i
-00011b80: 6620 6163 636f 756e 743a 0a20 2020 2020  f account:.     
-00011b90: 2020 2020 2020 2072 6574 7572 6e20 6622         return f"
-00011ba0: 7b73 656c 662e 7061 796d 656e 745f 6d65  {self.payment_me
-00011bb0: 7468 6f64 7d20 666f 7220 7b61 6363 6f75  thod} for {accou
-00011bc0: 6e74 7d2e 207b 656e 756d 732e 5365 7475  nt}. {enums.Setu
-00011bd0: 7049 6e74 656e 7453 7461 7475 732e 6875  pIntentStatus.hu
-00011be0: 6d61 6e69 7a65 2873 656c 662e 7374 6174  manize(self.stat
-00011bf0: 7573 297d 220a 2020 2020 2020 2020 6966  us)}".        if
-00011c00: 2063 7573 746f 6d65 723a 0a20 2020 2020   customer:.     
-00011c10: 2020 2020 2020 2072 6574 7572 6e20 6622         return f"
-00011c20: 7b73 656c 662e 7061 796d 656e 745f 6d65  {self.payment_me
-00011c30: 7468 6f64 7d20 6279 207b 6375 7374 6f6d  thod} by {custom
-00011c40: 6572 7d2e 207b 656e 756d 732e 5365 7475  er}. {enums.Setu
-00011c50: 7049 6e74 656e 7453 7461 7475 732e 6875  pIntentStatus.hu
-00011c60: 6d61 6e69 7a65 2873 656c 662e 7374 6174  manize(self.stat
-00011c70: 7573 297d 220a 2020 2020 2020 2020 7265  us)}".        re
-00011c80: 7475 726e 2028 0a20 2020 2020 2020 2020  turn (.         
-00011c90: 2020 2066 227b 7365 6c66 2e70 6179 6d65     f"{self.payme
-00011ca0: 6e74 5f6d 6574 686f 647d 2028 7b65 6e75  nt_method} ({enu
-00011cb0: 6d73 2e53 6574 7570 496e 7465 6e74 5374  ms.SetupIntentSt
-00011cc0: 6174 7573 2e68 756d 616e 697a 6528 7365  atus.humanize(se
-00011cd0: 6c66 2e73 7461 7475 7329 7d29 220a 2020  lf.status)})".  
-00011ce0: 2020 2020 2020 290a 0a0a 2320 544f 444f        )...# TODO
-00011cf0: 2041 6464 2054 6573 7473 0a63 6c61 7373   Add Tests.class
-00011d00: 2050 6179 6f75 7428 5374 7269 7065 4d6f   Payout(StripeMo
-00011d10: 6465 6c29 3a0a 2020 2020 2222 220a 2020  del):.    """.  
-00011d20: 2020 4120 5061 796f 7574 206f 626a 6563    A Payout objec
-00011d30: 7420 6973 2063 7265 6174 6564 2077 6865  t is created whe
-00011d40: 6e20 796f 7520 7265 6365 6976 6520 6675  n you receive fu
-00011d50: 6e64 7320 6672 6f6d 2053 7472 6970 652c  nds from Stripe,
-00011d60: 206f 7220 7768 656e 2079 6f75 2069 6e69   or when you ini
-00011d70: 7469 6174 650a 2020 2020 6120 7061 796f  tiate.    a payo
-00011d80: 7574 2074 6f20 6569 7468 6572 2061 2062  ut to either a b
-00011d90: 616e 6b20 6163 636f 756e 7420 6f72 2064  ank account or d
-00011da0: 6562 6974 2063 6172 6420 6f66 2061 2063  ebit card of a c
-00011db0: 6f6e 6e65 6374 6564 2053 7472 6970 6520  onnected Stripe 
-00011dc0: 6163 636f 756e 742e 0a0a 2020 2020 5374  account...    St
-00011dd0: 7269 7065 2064 6f63 756d 656e 7461 7469  ripe documentati
-00011de0: 6f6e 3a20 6874 7470 733a 2f2f 7374 7269  on: https://stri
-00011df0: 7065 2e63 6f6d 2f64 6f63 732f 6170 693f  pe.com/docs/api?
-00011e00: 6c61 6e67 3d70 7974 686f 6e23 7061 796f  lang=python#payo
-00011e10: 7574 730a 2020 2020 2222 220a 0a20 2020  uts.    """..   
-00011e20: 2065 7870 616e 645f 6669 656c 6473 203d   expand_fields =
-00011e30: 205b 2264 6573 7469 6e61 7469 6f6e 225d   ["destination"]
-00011e40: 0a20 2020 2073 7472 6970 655f 636c 6173  .    stripe_clas
-00011e50: 7320 3d20 7374 7269 7065 2e50 6179 6f75  s = stripe.Payou
-00011e60: 740a 2020 2020 7374 7269 7065 5f64 6173  t.    stripe_das
-00011e70: 6862 6f61 7264 5f69 7465 6d5f 6e61 6d65  hboard_item_name
-00011e80: 203d 2022 7061 796f 7574 7322 0a0a 2020   = "payouts"..  
-00011e90: 2020 616d 6f75 6e74 203d 2053 7472 6970    amount = Strip
-00011ea0: 6544 6563 696d 616c 4375 7272 656e 6379  eDecimalCurrency
-00011eb0: 416d 6f75 6e74 4669 656c 6428 0a20 2020  AmountField(.   
-00011ec0: 2020 2020 2068 656c 705f 7465 7874 3d22       help_text="
-00011ed0: 416d 6f75 6e74 2028 6173 2064 6563 696d  Amount (as decim
-00011ee0: 616c 2920 746f 2062 6520 7472 616e 7366  al) to be transf
-00011ef0: 6572 7265 6420 746f 2079 6f75 7220 6261  erred to your ba
-00011f00: 6e6b 2061 6363 6f75 6e74 206f 7220 220a  nk account or ".
-00011f10: 2020 2020 2020 2020 2264 6562 6974 2063          "debit c
-00011f20: 6172 642e 220a 2020 2020 290a 2020 2020  ard.".    ).    
-00011f30: 6172 7269 7661 6c5f 6461 7465 203d 2053  arrival_date = S
-00011f40: 7472 6970 6544 6174 6554 696d 6546 6965  tripeDateTimeFie
-00011f50: 6c64 280a 2020 2020 2020 2020 6865 6c70  ld(.        help
-00011f60: 5f74 6578 743d 280a 2020 2020 2020 2020  _text=(.        
-00011f70: 2020 2020 2244 6174 6520 7468 6520 7061      "Date the pa
-00011f80: 796f 7574 2069 7320 6578 7065 6374 6564  yout is expected
-00011f90: 2074 6f20 6172 7269 7665 2069 6e20 7468   to arrive in th
-00011fa0: 6520 6261 6e6b 2e20 220a 2020 2020 2020  e bank. ".      
-00011fb0: 2020 2020 2020 2254 6869 7320 6661 6374        "This fact
-00011fc0: 6f72 7320 696e 2064 656c 6179 7320 6c69  ors in delays li
-00011fd0: 6b65 2077 6565 6b65 6e64 7320 6f72 2062  ke weekends or b
-00011fe0: 616e 6b20 686f 6c69 6461 7973 2e22 0a20  ank holidays.". 
-00011ff0: 2020 2020 2020 2029 0a20 2020 2029 0a20         ).    ). 
-00012000: 2020 2061 7574 6f6d 6174 6963 203d 206d     automatic = m
-00012010: 6f64 656c 732e 426f 6f6c 6561 6e46 6965  odels.BooleanFie
-00012020: 6c64 280a 2020 2020 2020 2020 6865 6c70  ld(.        help
-00012030: 5f74 6578 743d 280a 2020 2020 2020 2020  _text=(.        
-00012040: 2020 2020 2260 7472 7565 6020 6966 2074      "`true` if t
-00012050: 6865 2070 6179 6f75 7420 7761 7320 6372  he payout was cr
-00012060: 6561 7465 6420 6279 2061 6e20 6175 746f  eated by an auto
-00012070: 6d61 7465 6420 7061 796f 7574 2073 6368  mated payout sch
-00012080: 6564 756c 652c 2022 0a20 2020 2020 2020  edule, ".       
-00012090: 2020 2020 2022 616e 6420 6066 616c 7365       "and `false
-000120a0: 6020 6966 2069 7420 7761 7320 7265 7175  ` if it was requ
-000120b0: 6573 7465 6420 6d61 6e75 616c 6c79 2e22  ested manually."
-000120c0: 0a20 2020 2020 2020 2029 0a20 2020 2029  .        ).    )
-000120d0: 0a20 2020 2062 616c 616e 6365 5f74 7261  .    balance_tra
-000120e0: 6e73 6163 7469 6f6e 203d 2053 7472 6970  nsaction = Strip
-000120f0: 6546 6f72 6569 676e 4b65 7928 0a20 2020  eForeignKey(.   
-00012100: 2020 2020 2022 4261 6c61 6e63 6554 7261       "BalanceTra
-00012110: 6e73 6163 7469 6f6e 222c 0a20 2020 2020  nsaction",.     
-00012120: 2020 206f 6e5f 6465 6c65 7465 3d6d 6f64     on_delete=mod
-00012130: 656c 732e 5345 545f 4e55 4c4c 2c0a 2020  els.SET_NULL,.  
-00012140: 2020 2020 2020 6e75 6c6c 3d54 7275 652c        null=True,
-00012150: 0a20 2020 2020 2020 2068 656c 705f 7465  .        help_te
-00012160: 7874 3d22 4261 6c61 6e63 6520 7472 616e  xt="Balance tran
-00012170: 7361 6374 696f 6e20 7468 6174 2064 6573  saction that des
-00012180: 6372 6962 6573 2074 6865 2069 6d70 6163  cribes the impac
-00012190: 7420 6f6e 2079 6f75 7220 220a 2020 2020  t on your ".    
-000121a0: 2020 2020 2261 6363 6f75 6e74 2062 616c      "account bal
-000121b0: 616e 6365 2e22 2c0a 2020 2020 290a 2020  ance.",.    ).  
-000121c0: 2020 6375 7272 656e 6379 203d 2053 7472    currency = Str
-000121d0: 6970 6543 7572 7265 6e63 7943 6f64 6546  ipeCurrencyCodeF
-000121e0: 6965 6c64 2829 0a20 2020 2064 6573 7469  ield().    desti
-000121f0: 6e61 7469 6f6e 203d 2053 7472 6970 6546  nation = StripeF
-00012200: 6f72 6569 676e 4b65 7928 0a20 2020 2020  oreignKey(.     
-00012210: 2020 2022 4261 6e6b 4163 636f 756e 7422     "BankAccount"
-00012220: 2c0a 2020 2020 2020 2020 6f6e 5f64 656c  ,.        on_del
-00012230: 6574 653d 6d6f 6465 6c73 2e50 524f 5445  ete=models.PROTE
-00012240: 4354 2c0a 2020 2020 2020 2020 6e75 6c6c  CT,.        null
-00012250: 3d54 7275 652c 0a20 2020 2020 2020 2068  =True,.        h
-00012260: 656c 705f 7465 7874 3d22 4261 6e6b 2061  elp_text="Bank a
-00012270: 6363 6f75 6e74 206f 7220 6361 7264 2074  ccount or card t
-00012280: 6865 2070 6179 6f75 7420 7761 7320 7365  he payout was se
-00012290: 6e74 2074 6f2e 222c 0a20 2020 2029 0a20  nt to.",.    ). 
-000122a0: 2020 2066 6169 6c75 7265 5f62 616c 616e     failure_balan
-000122b0: 6365 5f74 7261 6e73 6163 7469 6f6e 203d  ce_transaction =
-000122c0: 2053 7472 6970 6546 6f72 6569 676e 4b65   StripeForeignKe
-000122d0: 7928 0a20 2020 2020 2020 2022 4261 6c61  y(.        "Bala
-000122e0: 6e63 6554 7261 6e73 6163 7469 6f6e 222c  nceTransaction",
-000122f0: 0a20 2020 2020 2020 206f 6e5f 6465 6c65  .        on_dele
-00012300: 7465 3d6d 6f64 656c 732e 5345 545f 4e55  te=models.SET_NU
-00012310: 4c4c 2c0a 2020 2020 2020 2020 7265 6c61  LL,.        rela
-00012320: 7465 645f 6e61 6d65 3d22 6661 696c 7572  ted_name="failur
-00012330: 655f 7061 796f 7574 7322 2c0a 2020 2020  e_payouts",.    
-00012340: 2020 2020 6e75 6c6c 3d54 7275 652c 0a20      null=True,. 
-00012350: 2020 2020 2020 2062 6c61 6e6b 3d54 7275         blank=Tru
-00012360: 652c 0a20 2020 2020 2020 2068 656c 705f  e,.        help_
-00012370: 7465 7874 3d28 0a20 2020 2020 2020 2020  text=(.         
-00012380: 2020 2022 4966 2074 6865 2070 6179 6f75     "If the payou
-00012390: 7420 6661 696c 6564 206f 7220 7761 7320  t failed or was 
-000123a0: 6361 6e63 656c 6564 2c20 7468 6973 2077  canceled, this w
-000123b0: 696c 6c20 6265 2074 6865 2062 616c 616e  ill be the balan
-000123c0: 6365 2022 0a20 2020 2020 2020 2020 2020  ce ".           
-000123d0: 2022 7472 616e 7361 6374 696f 6e20 7468   "transaction th
-000123e0: 6174 2072 6576 6572 7365 6420 7468 6520  at reversed the 
-000123f0: 696e 6974 6961 6c20 6261 6c61 6e63 6520  initial balance 
-00012400: 7472 616e 7361 6374 696f 6e2c 2061 6e64  transaction, and
-00012410: 2022 0a20 2020 2020 2020 2020 2020 2022   ".            "
-00012420: 7075 7473 2074 6865 2066 756e 6473 2066  puts the funds f
-00012430: 726f 6d20 7468 6520 6661 696c 6564 2070  rom the failed p
-00012440: 6179 6f75 7420 6261 636b 2069 6e20 796f  ayout back in yo
-00012450: 7572 2062 616c 616e 6365 2e22 0a20 2020  ur balance.".   
-00012460: 2020 2020 2029 2c0a 2020 2020 290a 2020       ),.    ).  
-00012470: 2020 6661 696c 7572 655f 636f 6465 203d    failure_code =
-00012480: 2053 7472 6970 6545 6e75 6d46 6965 6c64   StripeEnumField
-00012490: 280a 2020 2020 2020 2020 656e 756d 3d65  (.        enum=e
-000124a0: 6e75 6d73 2e50 6179 6f75 7446 6169 6c75  nums.PayoutFailu
-000124b0: 7265 436f 6465 2c0a 2020 2020 2020 2020  reCode,.        
-000124c0: 6465 6661 756c 743d 2222 2c0a 2020 2020  default="",.    
-000124d0: 2020 2020 626c 616e 6b3d 5472 7565 2c0a      blank=True,.
-000124e0: 2020 2020 2020 2020 6865 6c70 5f74 6578          help_tex
-000124f0: 743d 280a 2020 2020 2020 2020 2020 2020  t=(.            
-00012500: 2245 7272 6f72 2063 6f64 6520 6578 706c  "Error code expl
-00012510: 6169 6e69 6e67 2072 6561 736f 6e20 666f  aining reason fo
-00012520: 7220 7472 616e 7366 6572 2066 6169 6c75  r transfer failu
-00012530: 7265 2069 6620 6176 6169 6c61 626c 652e  re if available.
-00012540: 2022 0a20 2020 2020 2020 2020 2020 2022   ".            "
-00012550: 5365 6520 6874 7470 733a 2f2f 7374 7269  See https://stri
-00012560: 7065 2e63 6f6d 2f64 6f63 732f 6170 693f  pe.com/docs/api?
-00012570: 6c61 6e67 3d70 7974 686f 6e23 7472 616e  lang=python#tran
-00012580: 7366 6572 5f66 6169 6c75 7265 732e 220a  sfer_failures.".
-00012590: 2020 2020 2020 2020 292c 0a20 2020 2029          ),.    )
-000125a0: 0a20 2020 2066 6169 6c75 7265 5f6d 6573  .    failure_mes
-000125b0: 7361 6765 203d 206d 6f64 656c 732e 5465  sage = models.Te
-000125c0: 7874 4669 656c 6428 0a20 2020 2020 2020  xtField(.       
-000125d0: 2064 6566 6175 6c74 3d22 222c 0a20 2020   default="",.   
-000125e0: 2020 2020 2062 6c61 6e6b 3d54 7275 652c       blank=True,
-000125f0: 0a20 2020 2020 2020 2068 656c 705f 7465  .        help_te
-00012600: 7874 3d28 0a20 2020 2020 2020 2020 2020  xt=(.           
-00012610: 2022 4d65 7373 6167 6520 746f 2075 7365   "Message to use
-00012620: 7220 6675 7274 6865 7220 6578 706c 6169  r further explai
-00012630: 6e69 6e67 2072 6561 736f 6e20 666f 7220  ning reason for 
-00012640: 220a 2020 2020 2020 2020 2020 2020 2270  ".            "p
-00012650: 6179 6f75 7420 6661 696c 7572 6520 6966  ayout failure if
-00012660: 2061 7661 696c 6162 6c65 2e22 0a20 2020   available.".   
-00012670: 2020 2020 2029 2c0a 2020 2020 290a 2020       ),.    ).  
-00012680: 2020 6d65 7468 6f64 203d 2053 7472 6970    method = Strip
-00012690: 6545 6e75 6d46 6965 6c64 280a 2020 2020  eEnumField(.    
-000126a0: 2020 2020 6d61 785f 6c65 6e67 7468 3d38      max_length=8
-000126b0: 2c0a 2020 2020 2020 2020 656e 756d 3d65  ,.        enum=e
-000126c0: 6e75 6d73 2e50 6179 6f75 744d 6574 686f  nums.PayoutMetho
-000126d0: 642c 0a20 2020 2020 2020 2068 656c 705f  d,.        help_
-000126e0: 7465 7874 3d28 0a20 2020 2020 2020 2020  text=(.         
-000126f0: 2020 2022 5468 6520 6d65 7468 6f64 2075     "The method u
-00012700: 7365 6420 746f 2073 656e 6420 7468 6973  sed to send this
-00012710: 2070 6179 6f75 742e 2022 0a20 2020 2020   payout. ".     
-00012720: 2020 2020 2020 2022 6069 6e73 7461 6e74         "`instant
-00012730: 6020 6973 206f 6e6c 7920 7375 7070 6f72  ` is only suppor
-00012740: 7465 6420 666f 7220 7061 796f 7574 7320  ted for payouts 
-00012750: 746f 2064 6562 6974 2063 6172 6473 2e22  to debit cards."
-00012760: 0a20 2020 2020 2020 2029 2c0a 2020 2020  .        ),.    
-00012770: 290a 2020 2020 2320 544f 444f 3a20 606f  ).    # TODO: `o
-00012780: 7269 6769 6e61 6c5f 7061 796f 7574 6020  riginal_payout` 
-00012790: 696d 706c 2061 7320 4f6e 6554 6f4f 6e65  impl as OneToOne
-000127a0: 2c20 7769 7468 2060 7265 7665 7273 6564  , with `reversed
-000127b0: 5f62 7960 2072 6576 6572 7365 2072 656c  _by` reverse rel
-000127c0: 6174 696f 6e0a 2020 2020 2320 6f72 6967  ation.    # orig
-000127d0: 696e 616c 5f70 6179 6f75 7420 3d20 5374  inal_payout = St
-000127e0: 7269 7065 466f 7265 6967 6e4b 6579 280a  ripeForeignKey(.
-000127f0: 2020 2020 2320 2020 2020 2250 6179 6f75      #     "Payou
-00012800: 7422 2c0a 2020 2020 2320 2020 2020 6f6e  t",.    #     on
-00012810: 5f64 656c 6574 653d 6d6f 6465 6c73 2e53  _delete=models.S
-00012820: 4554 5f4e 554c 4c2c 0a20 2020 2023 2020  ET_NULL,.    #  
-00012830: 2020 206e 756c 6c3d 5472 7565 2c0a 2020     null=True,.  
-00012840: 2020 2320 2020 2020 626c 616e 6b3d 5472    #     blank=Tr
-00012850: 7565 2c0a 2020 2020 2320 2020 2020 6865  ue,.    #     he
-00012860: 6c70 5f74 6578 743d 2249 6620 7468 6520  lp_text="If the 
-00012870: 7061 796f 7574 2072 6576 6572 7365 7320  payout reverses 
-00012880: 616e 6f74 6865 722c 2074 6869 7320 6973  another, this is
-00012890: 2074 6865 206f 7269 6769 6e61 6c20 7061   the original pa
-000128a0: 796f 7574 2e22 2c0a 2020 2020 2320 290a  yout.",.    # ).
-000128b0: 2020 2020 736f 7572 6365 5f74 7970 6520      source_type 
-000128c0: 3d20 5374 7269 7065 456e 756d 4669 656c  = StripeEnumFiel
-000128d0: 6428 0a20 2020 2020 2020 2065 6e75 6d3d  d(.        enum=
-000128e0: 656e 756d 732e 5061 796f 7574 536f 7572  enums.PayoutSour
-000128f0: 6365 5479 7065 2c0a 2020 2020 2020 2020  ceType,.        
-00012900: 6865 6c70 5f74 6578 743d 2254 6865 2073  help_text="The s
-00012910: 6f75 7263 6520 6261 6c61 6e63 6520 7468  ource balance th
-00012920: 6973 2070 6179 6f75 7420 6361 6d65 2066  is payout came f
-00012930: 726f 6d2e 222c 0a20 2020 2029 0a20 2020  rom.",.    ).   
-00012940: 2073 7461 7465 6d65 6e74 5f64 6573 6372   statement_descr
-00012950: 6970 746f 7220 3d20 6d6f 6465 6c73 2e43  iptor = models.C
-00012960: 6861 7246 6965 6c64 280a 2020 2020 2020  harField(.      
-00012970: 2020 6d61 785f 6c65 6e67 7468 3d32 3535    max_length=255
-00012980: 2c0a 2020 2020 2020 2020 6465 6661 756c  ,.        defaul
-00012990: 743d 2222 2c0a 2020 2020 2020 2020 626c  t="",.        bl
-000129a0: 616e 6b3d 5472 7565 2c0a 2020 2020 2020  ank=True,.      
-000129b0: 2020 6865 6c70 5f74 6578 743d 2245 7874    help_text="Ext
-000129c0: 7261 2069 6e66 6f72 6d61 7469 6f6e 2061  ra information a
-000129d0: 626f 7574 2061 2070 6179 6f75 7420 746f  bout a payout to
-000129e0: 2062 6520 6469 7370 6c61 7965 6420 220a   be displayed ".
-000129f0: 2020 2020 2020 2020 226f 6e20 7468 6520          "on the 
-00012a00: 7573 6572 2773 2062 616e 6b20 7374 6174  user's bank stat
-00012a10: 656d 656e 742e 222c 0a20 2020 2029 0a20  ement.",.    ). 
-00012a20: 2020 2073 7461 7475 7320 3d20 5374 7269     status = Stri
-00012a30: 7065 456e 756d 4669 656c 6428 0a20 2020  peEnumField(.   
-00012a40: 2020 2020 2065 6e75 6d3d 656e 756d 732e       enum=enums.
-00012a50: 5061 796f 7574 5374 6174 7573 2c0a 2020  PayoutStatus,.  
-00012a60: 2020 2020 2020 6865 6c70 5f74 6578 743d        help_text=
-00012a70: 280a 2020 2020 2020 2020 2020 2020 2243  (.            "C
-00012a80: 7572 7265 6e74 2073 7461 7475 7320 6f66  urrent status of
-00012a90: 2074 6865 2070 6179 6f75 742e 2022 0a20   the payout. ". 
-00012aa0: 2020 2020 2020 2020 2020 2022 4120 7061             "A pa
-00012ab0: 796f 7574 2077 696c 6c20 6265 2060 7065  yout will be `pe
-00012ac0: 6e64 696e 6760 2075 6e74 696c 2069 7420  nding` until it 
-00012ad0: 6973 2073 7562 6d69 7474 6564 2074 6f20  is submitted to 
-00012ae0: 7468 6520 6261 6e6b 2c20 220a 2020 2020  the bank, ".    
-00012af0: 2020 2020 2020 2020 2261 7420 7768 6963          "at whic
-00012b00: 6820 706f 696e 7420 6974 2062 6563 6f6d  h point it becom
-00012b10: 6573 2060 696e 5f74 7261 6e73 6974 602e  es `in_transit`.
-00012b20: 2022 0a20 2020 2020 2020 2020 2020 2022   ".            "
-00012b30: 4974 2077 696c 6c20 7468 656e 2063 6861  It will then cha
-00012b40: 6e67 6520 746f 2070 6169 6420 6966 2074  nge to paid if t
-00012b50: 6865 2074 7261 6e73 6163 7469 6f6e 2067  he transaction g
-00012b60: 6f65 7320 7468 726f 7567 682e 2022 0a20  oes through. ". 
-00012b70: 2020 2020 2020 2020 2020 2022 4966 2069             "If i
-00012b80: 7420 646f 6573 206e 6f74 2067 6f20 7468  t does not go th
-00012b90: 726f 7567 6820 7375 6363 6573 7366 756c  rough successful
-00012ba0: 6c79 2c20 220a 2020 2020 2020 2020 2020  ly, ".          
-00012bb0: 2020 2269 7473 2073 7461 7475 7320 7769    "its status wi
-00012bc0: 6c6c 2063 6861 6e67 6520 746f 2060 6661  ll change to `fa
-00012bd0: 696c 6564 6020 6f72 2060 6361 6e63 656c  iled` or `cancel
-00012be0: 6564 602e 220a 2020 2020 2020 2020 292c  ed`.".        ),
-00012bf0: 0a20 2020 2029 0a20 2020 2074 7970 6520  .    ).    type 
-00012c00: 3d20 5374 7269 7065 456e 756d 4669 656c  = StripeEnumFiel
-00012c10: 6428 656e 756d 3d65 6e75 6d73 2e50 6179  d(enum=enums.Pay
-00012c20: 6f75 7454 7970 6529 0a0a 2020 2020 6465  outType)..    de
-00012c30: 6620 5f5f 7374 725f 5f28 7365 6c66 293a  f __str__(self):
-00012c40: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00012c50: 6622 7b73 656c 662e 616d 6f75 6e74 7d20  f"{self.amount} 
-00012c60: 287b 656e 756d 732e 5061 796f 7574 5374  ({enums.PayoutSt
-00012c70: 6174 7573 2e68 756d 616e 697a 6528 7365  atus.humanize(se
-00012c80: 6c66 2e73 7461 7475 7329 7d29 220a 0a0a  lf.status)})"...
-00012c90: 636c 6173 7320 5072 6963 6528 5374 7269  class Price(Stri
-00012ca0: 7065 4d6f 6465 6c29 3a0a 2020 2020 2222  peModel):.    ""
-00012cb0: 220a 2020 2020 5072 6963 6573 2064 6566  ".    Prices def
-00012cc0: 696e 6520 7468 6520 756e 6974 2063 6f73  ine the unit cos
-00012cd0: 742c 2063 7572 7265 6e63 792c 2061 6e64  t, currency, and
-00012ce0: 2028 6f70 7469 6f6e 616c 2920 6269 6c6c   (optional) bill
-00012cf0: 696e 6720 6379 636c 6520 666f 720a 2020  ing cycle for.  
-00012d00: 2020 626f 7468 2072 6563 7572 7269 6e67    both recurring
-00012d10: 2061 6e64 206f 6e65 2d74 696d 6520 7075   and one-time pu
-00012d20: 7263 6861 7365 7320 6f66 2070 726f 6475  rchases of produ
-00012d30: 6374 732e 0a0a 2020 2020 5072 6963 6520  cts...    Price 
-00012d40: 616e 6420 506c 616e 206f 626a 6563 7473  and Plan objects
-00012d50: 2061 7265 2074 6865 2073 616d 652c 2062   are the same, b
-00012d60: 7574 2075 7365 2061 2064 6966 6665 7265  ut use a differe
-00012d70: 6e74 2072 6570 7265 7365 6e74 6174 696f  nt representatio
-00012d80: 6e2e 0a20 2020 2043 7265 6174 696e 6720  n..    Creating 
-00012d90: 6120 7265 6375 7272 696e 6720 5072 6963  a recurring Pric
-00012da0: 6520 696e 2053 7472 6970 6520 616c 736f  e in Stripe also
-00012db0: 206d 616b 6573 2061 2050 6c61 6e20 6176   makes a Plan av
-00012dc0: 6169 6c61 626c 652c 2061 6e64 2076 6963  ailable, and vic
-00012dd0: 6520 7665 7273 612e 0a20 2020 2054 6869  e versa..    Thi
-00012de0: 7320 6973 206e 6f74 2074 6865 2063 6173  s is not the cas
-00012df0: 6520 666f 7220 6120 5072 6963 6520 7769  e for a Price wi
-00012e00: 7468 2069 6e74 6572 7661 6c3d 6f6e 655f  th interval=one_
-00012e10: 7469 6d65 2e0a 0a20 2020 2050 7269 6365  time...    Price
-00012e20: 206f 626a 6563 7473 2061 7265 2061 206d   objects are a m
-00012e30: 6f72 6520 7265 6365 6e74 2041 5049 2072  ore recent API r
-00012e40: 6570 7265 7365 6e74 6174 696f 6e2c 2073  epresentation, s
-00012e50: 7570 706f 7274 206d 6f72 6520 6665 6174  upport more feat
-00012e60: 7572 6573 0a20 2020 2061 6e64 2069 7473  ures.    and its
-00012e70: 2075 7361 6765 2069 7320 656e 636f 7572   usage is encour
-00012e80: 6167 6564 2069 6e73 7465 6164 206f 6620  aged instead of 
-00012e90: 506c 616e 206f 626a 6563 7473 2e0a 0a20  Plan objects... 
-00012ea0: 2020 2053 7472 6970 6520 646f 6375 6d65     Stripe docume
-00012eb0: 6e74 6174 696f 6e3a 0a20 2020 202d 2068  ntation:.    - h
-00012ec0: 7474 7073 3a2f 2f73 7472 6970 652e 636f  ttps://stripe.co
-00012ed0: 6d2f 646f 6373 2f61 7069 2f70 7269 6365  m/docs/api/price
-00012ee0: 730a 2020 2020 2d20 6874 7470 733a 2f2f  s.    - https://
-00012ef0: 7374 7269 7065 2e63 6f6d 2f64 6f63 732f  stripe.com/docs/
-00012f00: 6269 6c6c 696e 672f 7072 6963 6573 2d67  billing/prices-g
-00012f10: 7569 6465 0a20 2020 2022 2222 0a0a 2020  uide.    """..  
-00012f20: 2020 7374 7269 7065 5f63 6c61 7373 203d    stripe_class =
-00012f30: 2073 7472 6970 652e 5072 6963 650a 2020   stripe.Price.  
-00012f40: 2020 6578 7061 6e64 5f66 6965 6c64 7320    expand_fields 
-00012f50: 3d20 5b22 7072 6f64 7563 7422 2c20 2274  = ["product", "t
-00012f60: 6965 7273 225d 0a20 2020 2073 7472 6970  iers"].    strip
-00012f70: 655f 6461 7368 626f 6172 645f 6974 656d  e_dashboard_item
-00012f80: 5f6e 616d 6520 3d20 2270 7269 6365 7322  _name = "prices"
-00012f90: 0a0a 2020 2020 6163 7469 7665 203d 206d  ..    active = m
-00012fa0: 6f64 656c 732e 426f 6f6c 6561 6e46 6965  odels.BooleanFie
-00012fb0: 6c64 280a 2020 2020 2020 2020 6865 6c70  ld(.        help
-00012fc0: 5f74 6578 743d 2257 6865 7468 6572 2074  _text="Whether t
-00012fd0: 6865 2070 7269 6365 2063 616e 2062 6520  he price can be 
-00012fe0: 7573 6564 2066 6f72 206e 6577 2070 7572  used for new pur
-00012ff0: 6368 6173 6573 2e22 0a20 2020 2029 0a20  chases.".    ). 
-00013000: 2020 2063 7572 7265 6e63 7920 3d20 5374     currency = St
-00013010: 7269 7065 4375 7272 656e 6379 436f 6465  ripeCurrencyCode
-00013020: 4669 656c 6428 290a 2020 2020 6e69 636b  Field().    nick
-00013030: 6e61 6d65 203d 206d 6f64 656c 732e 4368  name = models.Ch
-00013040: 6172 4669 656c 6428 0a20 2020 2020 2020  arField(.       
-00013050: 206d 6178 5f6c 656e 6774 683d 3235 302c   max_length=250,
-00013060: 0a20 2020 2020 2020 2062 6c61 6e6b 3d54  .        blank=T
-00013070: 7275 652c 0a20 2020 2020 2020 2068 656c  rue,.        hel
-00013080: 705f 7465 7874 3d22 4120 6272 6965 6620  p_text="A brief 
-00013090: 6465 7363 7269 7074 696f 6e20 6f66 2074  description of t
-000130a0: 6865 2070 6c61 6e2c 2068 6964 6465 6e20  he plan, hidden 
-000130b0: 6672 6f6d 2063 7573 746f 6d65 7273 2e22  from customers."
-000130c0: 2c0a 2020 2020 290a 2020 2020 7072 6f64  ,.    ).    prod
-000130d0: 7563 7420 3d20 5374 7269 7065 466f 7265  uct = StripeFore
-000130e0: 6967 6e4b 6579 280a 2020 2020 2020 2020  ignKey(.        
-000130f0: 2250 726f 6475 6374 222c 0a20 2020 2020  "Product",.     
-00013100: 2020 206f 6e5f 6465 6c65 7465 3d6d 6f64     on_delete=mod
-00013110: 656c 732e 4341 5343 4144 452c 0a20 2020  els.CASCADE,.   
-00013120: 2020 2020 2072 656c 6174 6564 5f6e 616d       related_nam
-00013130: 653d 2270 7269 6365 7322 2c0a 2020 2020  e="prices",.    
-00013140: 2020 2020 6865 6c70 5f74 6578 743d 2254      help_text="T
-00013150: 6865 2070 726f 6475 6374 2074 6869 7320  he product this 
-00013160: 7072 6963 6520 6973 2061 7373 6f63 6961  price is associa
-00013170: 7465 6420 7769 7468 2e22 2c0a 2020 2020  ted with.",.    
-00013180: 290a 2020 2020 7265 6375 7272 696e 6720  ).    recurring 
-00013190: 3d20 4a53 4f4e 4669 656c 6428 0a20 2020  = JSONField(.   
-000131a0: 2020 2020 2064 6566 6175 6c74 3d4e 6f6e       default=Non
-000131b0: 652c 0a20 2020 2020 2020 2062 6c61 6e6b  e,.        blank
-000131c0: 3d54 7275 652c 0a20 2020 2020 2020 206e  =True,.        n
-000131d0: 756c 6c3d 5472 7565 2c0a 2020 2020 2020  ull=True,.      
-000131e0: 2020 6865 6c70 5f74 6578 743d 280a 2020    help_text=(.  
-000131f0: 2020 2020 2020 2020 2020 2254 6865 2072            "The r
-00013200: 6563 7572 7269 6e67 2063 6f6d 706f 6e65  ecurring compone
-00013210: 6e74 7320 6f66 2061 2070 7269 6365 2073  nts of a price s
-00013220: 7563 6820 6173 2060 696e 7465 7276 616c  uch as `interval
-00013230: 6020 616e 6420 6075 7361 6765 5f74 7970  ` and `usage_typ
-00013240: 6560 2e22 0a20 2020 2020 2020 2029 2c0a  e`.".        ),.
-00013250: 2020 2020 290a 2020 2020 7479 7065 203d      ).    type =
-00013260: 2053 7472 6970 6545 6e75 6d46 6965 6c64   StripeEnumField
-00013270: 280a 2020 2020 2020 2020 656e 756d 3d65  (.        enum=e
-00013280: 6e75 6d73 2e50 7269 6365 5479 7065 2c0a  nums.PriceType,.
-00013290: 2020 2020 2020 2020 6865 6c70 5f74 6578          help_tex
-000132a0: 743d 280a 2020 2020 2020 2020 2020 2020  t=(.            
-000132b0: 2257 6865 7468 6572 2074 6865 2070 7269  "Whether the pri
-000132c0: 6365 2069 7320 666f 7220 6120 6f6e 652d  ce is for a one-
-000132d0: 7469 6d65 2070 7572 6368 6173 6520 6f72  time purchase or
-000132e0: 2061 2072 6563 7572 7269 6e67 2022 0a20   a recurring ". 
-000132f0: 2020 2020 2020 2020 2020 2022 2873 7562             "(sub
-00013300: 7363 7269 7074 696f 6e29 2070 7572 6368  scription) purch
-00013310: 6173 652e 220a 2020 2020 2020 2020 292c  ase.".        ),
-00013320: 0a20 2020 2029 0a20 2020 2075 6e69 745f  .    ).    unit_
-00013330: 616d 6f75 6e74 203d 2053 7472 6970 6551  amount = StripeQ
-00013340: 7561 6e74 756d 4375 7272 656e 6379 416d  uantumCurrencyAm
-00013350: 6f75 6e74 4669 656c 6428 0a20 2020 2020  ountField(.     
-00013360: 2020 206e 756c 6c3d 5472 7565 2c0a 2020     null=True,.  
-00013370: 2020 2020 2020 626c 616e 6b3d 5472 7565        blank=True
-00013380: 2c0a 2020 2020 2020 2020 6865 6c70 5f74  ,.        help_t
-00013390: 6578 743d 280a 2020 2020 2020 2020 2020  ext=(.          
-000133a0: 2020 2254 6865 2075 6e69 7420 616d 6f75    "The unit amou
-000133b0: 6e74 2069 6e20 6365 6e74 7320 746f 2062  nt in cents to b
-000133c0: 6520 6368 6172 6765 642c 2072 6570 7265  e charged, repre
-000133d0: 7365 6e74 6564 2061 7320 6120 7768 6f6c  sented as a whol
-000133e0: 6520 220a 2020 2020 2020 2020 2020 2020  e ".            
-000133f0: 2269 6e74 6567 6572 2069 6620 706f 7373  "integer if poss
-00013400: 6962 6c65 2e20 4e75 6c6c 2069 6620 6120  ible. Null if a 
-00013410: 7375 622d 6365 6e74 2070 7265 6369 7369  sub-cent precisi
-00013420: 6f6e 2069 7320 7265 7175 6972 6564 2e22  on is required."
-00013430: 0a20 2020 2020 2020 2029 2c0a 2020 2020  .        ),.    
-00013440: 290a 2020 2020 756e 6974 5f61 6d6f 756e  ).    unit_amoun
-00013450: 745f 6465 6369 6d61 6c20 3d20 5374 7269  t_decimal = Stri
-00013460: 7065 4465 6369 6d61 6c43 7572 7265 6e63  peDecimalCurrenc
-00013470: 7941 6d6f 756e 7446 6965 6c64 280a 2020  yAmountField(.  
-00013480: 2020 2020 2020 6e75 6c6c 3d54 7275 652c        null=True,
-00013490: 0a20 2020 2020 2020 2062 6c61 6e6b 3d54  .        blank=T
-000134a0: 7275 652c 0a20 2020 2020 2020 206d 6178  rue,.        max
-000134b0: 5f64 6967 6974 733d 3139 2c0a 2020 2020  _digits=19,.    
-000134c0: 2020 2020 6465 6369 6d61 6c5f 706c 6163      decimal_plac
-000134d0: 6573 3d31 322c 0a20 2020 2020 2020 2068  es=12,.        h
-000134e0: 656c 705f 7465 7874 3d28 0a20 2020 2020  elp_text=(.     
-000134f0: 2020 2020 2020 2022 5468 6520 756e 6974         "The unit
-00013500: 2061 6d6f 756e 7420 696e 2063 656e 7473   amount in cents
-00013510: 2074 6f20 6265 2063 6861 7267 6564 2c20   to be charged, 
-00013520: 7265 7072 6573 656e 7465 6420 6173 2061  represented as a
-00013530: 2064 6563 696d 616c 2022 0a20 2020 2020   decimal ".     
-00013540: 2020 2020 2020 2022 7374 7269 6e67 2077         "string w
-00013550: 6974 6820 6174 206d 6f73 7420 3132 2064  ith at most 12 d
-00013560: 6563 696d 616c 2070 6c61 6365 732e 220a  ecimal places.".
-00013570: 2020 2020 2020 2020 292c 0a20 2020 2029          ),.    )
-00013580: 0a0a 2020 2020 2320 4d6f 7265 2061 7474  ..    # More att
-00013590: 7269 6275 7465 73e2 80a6 0a20 2020 2062  ributes....    b
-000135a0: 696c 6c69 6e67 5f73 6368 656d 6520 3d20  illing_scheme = 
-000135b0: 5374 7269 7065 456e 756d 4669 656c 6428  StripeEnumField(
-000135c0: 0a20 2020 2020 2020 2065 6e75 6d3d 656e  .        enum=en
-000135d0: 756d 732e 4269 6c6c 696e 6753 6368 656d  ums.BillingSchem
-000135e0: 652c 0a20 2020 2020 2020 2062 6c61 6e6b  e,.        blank
-000135f0: 3d54 7275 652c 0a20 2020 2020 2020 2068  =True,.        h
-00013600: 656c 705f 7465 7874 3d28 0a20 2020 2020  elp_text=(.     
-00013610: 2020 2020 2020 2022 4465 7363 7269 6265         "Describe
-00013620: 7320 686f 7720 746f 2063 6f6d 7075 7465  s how to compute
-00013630: 2074 6865 2070 7269 6365 2070 6572 2070   the price per p
-00013640: 6572 696f 642e 2022 0a20 2020 2020 2020  eriod. ".       
-00013650: 2020 2020 2022 4569 7468 6572 2060 7065       "Either `pe
-00013660: 725f 756e 6974 6020 6f72 2060 7469 6572  r_unit` or `tier
-00013670: 6564 602e 2022 0a20 2020 2020 2020 2020  ed`. ".         
-00013680: 2020 2022 6070 6572 5f75 6e69 7460 2069     "`per_unit` i
-00013690: 6e64 6963 6174 6573 2074 6861 7420 7468  ndicates that th
-000136a0: 6520 6669 7865 6420 616d 6f75 6e74 2028  e fixed amount (
-000136b0: 7370 6563 6966 6965 6420 696e 2060 756e  specified in `un
-000136c0: 6974 5f61 6d6f 756e 7460 2022 0a20 2020  it_amount` ".   
-000136d0: 2020 2020 2020 2020 2022 6f72 2060 756e           "or `un
-000136e0: 6974 5f61 6d6f 756e 745f 6465 6369 6d61  it_amount_decima
-000136f0: 6c60 2920 7769 6c6c 2062 6520 6368 6172  l`) will be char
-00013700: 6765 6420 7065 7220 756e 6974 2069 6e20  ged per unit in 
-00013710: 6071 7561 6e74 6974 7960 2022 0a20 2020  `quantity` ".   
-00013720: 2020 2020 2020 2020 2022 2866 6f72 2070           "(for p
-00013730: 7269 6365 7320 7769 7468 2060 7573 6167  rices with `usag
-00013740: 655f 7479 7065 3d6c 6963 656e 7365 6460  e_type=licensed`
-00013750: 292c 206f 7220 7065 7220 756e 6974 206f  ), or per unit o
-00013760: 6620 746f 7461 6c20 220a 2020 2020 2020  f total ".      
-00013770: 2020 2020 2020 2275 7361 6765 2028 666f        "usage (fo
-00013780: 7220 7072 6963 6573 2077 6974 6820 6075  r prices with `u
-00013790: 7361 6765 5f74 7970 653d 6d65 7465 7265  sage_type=metere
-000137a0: 6460 292e 2022 0a20 2020 2020 2020 2020  d`). ".         
-000137b0: 2020 2022 6074 6965 7265 6460 2069 6e64     "`tiered` ind
-000137c0: 6963 6174 6573 2074 6861 7420 7468 6520  icates that the 
-000137d0: 756e 6974 2070 7269 6369 6e67 2077 696c  unit pricing wil
-000137e0: 6c20 6265 2063 6f6d 7075 7465 6420 7573  l be computed us
-000137f0: 696e 6720 220a 2020 2020 2020 2020 2020  ing ".          
-00013800: 2020 2261 2074 6965 7269 6e67 2073 7472    "a tiering str
-00013810: 6174 6567 7920 6173 2064 6566 696e 6564  ategy as defined
-00013820: 2075 7369 6e67 2074 6865 2060 7469 6572   using the `tier
-00013830: 7360 2061 6e64 2060 7469 6572 735f 6d6f  s` and `tiers_mo
-00013840: 6465 6020 220a 2020 2020 2020 2020 2020  de` ".          
-00013850: 2020 2261 7474 7269 6275 7465 732e 220a    "attributes.".
-00013860: 2020 2020 2020 2020 292c 0a20 2020 2029          ),.    )
-00013870: 0a20 2020 206c 6f6f 6b75 705f 6b65 7920  .    lookup_key 
-00013880: 3d20 6d6f 6465 6c73 2e43 6861 7246 6965  = models.CharFie
-00013890: 6c64 280a 2020 2020 2020 2020 6d61 785f  ld(.        max_
-000138a0: 6c65 6e67 7468 3d32 3530 2c0a 2020 2020  length=250,.    
-000138b0: 2020 2020 6e75 6c6c 3d54 7275 652c 0a20      null=True,. 
-000138c0: 2020 2020 2020 2062 6c61 6e6b 3d54 7275         blank=Tru
-000138d0: 652c 0a20 2020 2020 2020 2068 656c 705f  e,.        help_
-000138e0: 7465 7874 3d22 4120 6c6f 6f6b 7570 206b  text="A lookup k
-000138f0: 6579 2075 7365 6420 746f 2072 6574 7269  ey used to retri
-00013900: 6576 6520 7072 6963 6573 2064 796e 616d  eve prices dynam
-00013910: 6963 616c 6c79 2066 726f 6d20 6120 220a  ically from a ".
-00013920: 2020 2020 2020 2020 2273 7461 7469 6320          "static 
-00013930: 7374 7269 6e67 2e22 2c0a 2020 2020 290a  string.",.    ).
-00013940: 2020 2020 7469 6572 7320 3d20 4a53 4f4e      tiers = JSON
-00013950: 4669 656c 6428 0a20 2020 2020 2020 206e  Field(.        n
-00013960: 756c 6c3d 5472 7565 2c0a 2020 2020 2020  ull=True,.      
-00013970: 2020 626c 616e 6b3d 5472 7565 2c0a 2020    blank=True,.  
-00013980: 2020 2020 2020 6865 6c70 5f74 6578 743d        help_text=
-00013990: 280a 2020 2020 2020 2020 2020 2020 2245  (.            "E
-000139a0: 6163 6820 656c 656d 656e 7420 7265 7072  ach element repr
-000139b0: 6573 656e 7473 2061 2070 7269 6369 6e67  esents a pricing
-000139c0: 2074 6965 722e 2022 0a20 2020 2020 2020   tier. ".       
-000139d0: 2020 2020 2022 5468 6973 2070 6172 616d       "This param
-000139e0: 6574 6572 2072 6571 7569 7265 7320 6062  eter requires `b
-000139f0: 696c 6c69 6e67 5f73 6368 656d 6560 2074  illing_scheme` t
-00013a00: 6f20 6265 2073 6574 2074 6f20 6074 6965  o be set to `tie
-00013a10: 7265 6460 2e22 0a20 2020 2020 2020 2029  red`.".        )
-00013a20: 2c0a 2020 2020 290a 2020 2020 7469 6572  ,.    ).    tier
-00013a30: 735f 6d6f 6465 203d 2053 7472 6970 6545  s_mode = StripeE
-00013a40: 6e75 6d46 6965 6c64 280a 2020 2020 2020  numField(.      
-00013a50: 2020 656e 756d 3d65 6e75 6d73 2e50 7269    enum=enums.Pri
-00013a60: 6365 5469 6572 734d 6f64 652c 0a20 2020  ceTiersMode,.   
-00013a70: 2020 2020 206e 756c 6c3d 5472 7565 2c0a       null=True,.
-00013a80: 2020 2020 2020 2020 626c 616e 6b3d 5472          blank=Tr
-00013a90: 7565 2c0a 2020 2020 2020 2020 6865 6c70  ue,.        help
-00013aa0: 5f74 6578 743d 280a 2020 2020 2020 2020  _text=(.        
-00013ab0: 2020 2020 2244 6566 696e 6573 2069 6620      "Defines if 
-00013ac0: 7468 6520 7469 6572 696e 6720 7072 6963  the tiering pric
-00013ad0: 6520 7368 6f75 6c64 2062 6520 6067 7261  e should be `gra
-00013ae0: 6475 6174 6564 6020 6f72 2060 766f 6c75  duated` or `volu
-00013af0: 6d65 6020 6261 7365 642e 2022 0a20 2020  me` based. ".   
-00013b00: 2020 2020 2020 2020 2022 496e 2060 766f           "In `vo
-00013b10: 6c75 6d65 602d 6261 7365 6420 7469 6572  lume`-based tier
-00013b20: 696e 672c 2074 6865 206d 6178 696d 756d  ing, the maximum
-00013b30: 2071 7561 6e74 6974 7920 7769 7468 696e   quantity within
-00013b40: 2061 2070 6572 696f 6420 220a 2020 2020   a period ".    
-00013b50: 2020 2020 2020 2020 2264 6574 6572 6d69          "determi
-00013b60: 6e65 7320 7468 6520 7065 7220 756e 6974  nes the per unit
-00013b70: 2070 7269 6365 2c20 696e 2060 6772 6164   price, in `grad
-00013b80: 7561 7465 6460 2074 6965 7269 6e67 2070  uated` tiering p
-00013b90: 7269 6369 6e67 2063 616e 2022 0a20 2020  ricing can ".   
-00013ba0: 2020 2020 2020 2020 2022 7375 6363 6573           "succes
-00013bb0: 7369 7665 6c79 2063 6861 6e67 6520 6173  sively change as
-00013bc0: 2074 6865 2071 7561 6e74 6974 7920 6772   the quantity gr
-00013bd0: 6f77 732e 220a 2020 2020 2020 2020 292c  ows.".        ),
-00013be0: 0a20 2020 2029 0a20 2020 2074 7261 6e73  .    ).    trans
-00013bf0: 666f 726d 5f71 7561 6e74 6974 7920 3d20  form_quantity = 
-00013c00: 4a53 4f4e 4669 656c 6428 0a20 2020 2020  JSONField(.     
-00013c10: 2020 206e 756c 6c3d 5472 7565 2c0a 2020     null=True,.  
-00013c20: 2020 2020 2020 626c 616e 6b3d 5472 7565        blank=True
-00013c30: 2c0a 2020 2020 2020 2020 6865 6c70 5f74  ,.        help_t
-00013c40: 6578 743d 280a 2020 2020 2020 2020 2020  ext=(.          
-00013c50: 2020 2241 7070 6c79 2061 2074 7261 6e73    "Apply a trans
-00013c60: 666f 726d 6174 696f 6e20 746f 2074 6865  formation to the
-00013c70: 2072 6570 6f72 7465 6420 7573 6167 6520   reported usage 
-00013c80: 6f72 2073 6574 2071 7561 6e74 6974 7920  or set quantity 
-00013c90: 220a 2020 2020 2020 2020 2020 2020 2262  ".            "b
-00013ca0: 6566 6f72 6520 636f 6d70 7574 696e 6720  efore computing 
-00013cb0: 7468 6520 616d 6f75 6e74 2062 696c 6c65  the amount bille
-00013cc0: 642e 2043 616e 6e6f 7420 6265 2063 6f6d  d. Cannot be com
-00013cd0: 6269 6e65 6420 7769 7468 2060 7469 6572  bined with `tier
-00013ce0: 7360 2e22 0a20 2020 2020 2020 2029 2c0a  s`.".        ),.
-00013cf0: 2020 2020 290a 0a20 2020 2063 6c61 7373      )..    class
-00013d00: 204d 6574 6128 6f62 6a65 6374 293a 0a20   Meta(object):. 
-00013d10: 2020 2020 2020 206f 7264 6572 696e 6720         ordering 
-00013d20: 3d20 5b22 756e 6974 5f61 6d6f 756e 7422  = ["unit_amount"
-00013d30: 5d0a 0a20 2020 2040 636c 6173 736d 6574  ]..    @classmet
-00013d40: 686f 640a 2020 2020 6465 6620 6765 745f  hod.    def get_
-00013d50: 6f72 5f63 7265 6174 6528 636c 732c 202a  or_create(cls, *
-00013d60: 2a6b 7761 7267 7329 3a0a 2020 2020 2020  *kwargs):.      
-00013d70: 2020 2222 2247 6574 206f 7220 6372 6561    """Get or crea
-00013d80: 7465 2061 2050 7269 6365 2e22 2222 0a0a  te a Price."""..
-00013d90: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-00013da0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00013db0: 5072 6963 652e 6f62 6a65 6374 732e 6765  Price.objects.ge
-00013dc0: 7428 6964 3d6b 7761 7267 735b 2269 6422  t(id=kwargs["id"
-00013dd0: 5d29 2c20 4661 6c73 650a 2020 2020 2020  ]), False.      
-00013de0: 2020 6578 6365 7074 2050 7269 6365 2e44    except Price.D
-00013df0: 6f65 734e 6f74 4578 6973 743a 0a20 2020  oesNotExist:.   
-00013e00: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00013e10: 636c 732e 6372 6561 7465 282a 2a6b 7761  cls.create(**kwa
-00013e20: 7267 7329 2c20 5472 7565 0a0a 2020 2020  rgs), True..    
-00013e30: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
-00013e40: 2064 6566 2063 7265 6174 6528 636c 732c   def create(cls,
-00013e50: 202a 2a6b 7761 7267 7329 3a0a 2020 2020   **kwargs):.    
-00013e60: 2020 2020 2320 4120 6665 7720 6d69 6e6f      # A few mino
-00013e70: 7220 7468 696e 6773 2061 7265 2063 6861  r things are cha
-00013e80: 6e67 6564 2069 6e20 7468 6520 6170 692d  nged in the api-
-00013e90: 7665 7273 696f 6e20 6f66 2074 6865 2063  version of the c
-00013ea0: 7265 6174 6520 6361 6c6c 0a20 2020 2020  reate call.     
-00013eb0: 2020 2061 7069 5f6b 7761 7267 7320 3d20     api_kwargs = 
-00013ec0: 6469 6374 286b 7761 7267 7329 0a20 2020  dict(kwargs).   
-00013ed0: 2020 2020 2069 6620 6170 695f 6b77 6172       if api_kwar
-00013ee0: 6773 5b22 756e 6974 5f61 6d6f 756e 7422  gs["unit_amount"
-00013ef0: 5d3a 0a20 2020 2020 2020 2020 2020 2061  ]:.            a
-00013f00: 7069 5f6b 7761 7267 735b 2275 6e69 745f  pi_kwargs["unit_
-00013f10: 616d 6f75 6e74 225d 203d 2069 6e74 2861  amount"] = int(a
-00013f20: 7069 5f6b 7761 7267 735b 2275 6e69 745f  pi_kwargs["unit_
-00013f30: 616d 6f75 6e74 225d 202a 2031 3030 290a  amount"] * 100).
-00013f40: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
-00013f50: 7374 616e 6365 2861 7069 5f6b 7761 7267  stance(api_kwarg
-00013f60: 732e 6765 7428 2270 726f 6475 6374 2229  s.get("product")
-00013f70: 2c20 5374 7269 7065 4d6f 6465 6c29 3a0a  , StripeModel):.
-00013f80: 2020 2020 2020 2020 2020 2020 6170 695f              api_
-00013f90: 6b77 6172 6773 5b22 7072 6f64 7563 7422  kwargs["product"
-00013fa0: 5d20 3d20 6170 695f 6b77 6172 6773 5b22  ] = api_kwargs["
-00013fb0: 7072 6f64 7563 7422 5d2e 6964 0a0a 2020  product"].id..  
-00013fc0: 2020 2020 2020 7374 7269 7065 5f70 7269        stripe_pri
-00013fd0: 6365 203d 2063 6c73 2e5f 6170 695f 6372  ce = cls._api_cr
-00013fe0: 6561 7465 282a 2a61 7069 5f6b 7761 7267  eate(**api_kwarg
-00013ff0: 7329 0a0a 2020 2020 2020 2020 6170 695f  s)..        api_
-00014000: 6b65 7920 3d20 6170 695f 6b77 6172 6773  key = api_kwargs
-00014010: 2e67 6574 2822 6170 695f 6b65 7922 2920  .get("api_key") 
-00014020: 6f72 2064 6a73 7472 6970 655f 7365 7474  or djstripe_sett
-00014030: 696e 6773 2e53 5452 4950 455f 5345 4352  ings.STRIPE_SECR
-00014040: 4554 5f4b 4559 0a20 2020 2020 2020 2070  ET_KEY.        p
-00014050: 7269 6365 203d 2063 6c73 2e73 796e 635f  rice = cls.sync_
-00014060: 6672 6f6d 5f73 7472 6970 655f 6461 7461  from_stripe_data
-00014070: 2873 7472 6970 655f 7072 6963 652c 2061  (stripe_price, a
-00014080: 7069 5f6b 6579 3d61 7069 5f6b 6579 290a  pi_key=api_key).
-00014090: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000140a0: 7072 6963 650a 0a20 2020 2064 6566 205f  price..    def _
-000140b0: 5f73 7472 5f5f 2873 656c 6629 3a0a 2020  _str__(self):.  
-000140c0: 2020 2020 2020 7265 7475 726e 2066 227b        return f"{
-000140d0: 7365 6c66 2e68 756d 616e 5f72 6561 6461  self.human_reada
-000140e0: 626c 655f 7072 6963 657d 2066 6f72 207b  ble_price} for {
-000140f0: 7365 6c66 2e70 726f 6475 6374 2e6e 616d  self.product.nam
-00014100: 657d 220a 0a20 2020 2040 7072 6f70 6572  e}"..    @proper
-00014110: 7479 0a20 2020 2064 6566 2068 756d 616e  ty.    def human
-00014120: 5f72 6561 6461 626c 655f 7072 6963 6528  _readable_price(
-00014130: 7365 6c66 293a 0a20 2020 2020 2020 2069  self):.        i
-00014140: 6620 7365 6c66 2e62 696c 6c69 6e67 5f73  f self.billing_s
-00014150: 6368 656d 6520 3d3d 2022 7065 725f 756e  cheme == "per_un
-00014160: 6974 223a 0a20 2020 2020 2020 2020 2020  it":.           
-00014170: 2075 6e69 745f 616d 6f75 6e74 203d 2028   unit_amount = (
-00014180: 7365 6c66 2e75 6e69 745f 616d 6f75 6e74  self.unit_amount
-00014190: 206f 7220 3029 202f 2031 3030 0a20 2020   or 0) / 100.   
-000141a0: 2020 2020 2020 2020 2061 6d6f 756e 7420           amount 
-000141b0: 3d20 6765 745f 6672 6965 6e64 6c79 5f63  = get_friendly_c
-000141c0: 7572 7265 6e63 795f 616d 6f75 6e74 2875  urrency_amount(u
-000141d0: 6e69 745f 616d 6f75 6e74 2c20 7365 6c66  nit_amount, self
-000141e0: 2e63 7572 7265 6e63 7929 0a20 2020 2020  .currency).     
-000141f0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00014200: 2020 2020 2023 2074 6965 7265 6420 6269       # tiered bi
-00014210: 6c6c 696e 6720 7363 6865 6d65 0a20 2020  lling scheme.   
-00014220: 2020 2020 2020 2020 2074 6965 725f 3120           tier_1 
-00014230: 3d20 7365 6c66 2e74 6965 7273 5b30 5d0a  = self.tiers[0].
-00014240: 2020 2020 2020 2020 2020 2020 666f 726d              form
-00014250: 6174 7465 645f 756e 6974 5f61 6d6f 756e  atted_unit_amoun
-00014260: 745f 7469 6572 5f31 203d 2067 6574 5f66  t_tier_1 = get_f
-00014270: 7269 656e 646c 795f 6375 7272 656e 6379  riendly_currency
-00014280: 5f61 6d6f 756e 7428 0a20 2020 2020 2020  _amount(.       
-00014290: 2020 2020 2020 2020 2028 7469 6572 5f31           (tier_1
-000142a0: 5b22 756e 6974 5f61 6d6f 756e 7422 5d20  ["unit_amount"] 
-000142b0: 6f72 2030 2920 2f20 3130 302c 2073 656c  or 0) / 100, sel
-000142c0: 662e 6375 7272 656e 6379 0a20 2020 2020  f.currency.     
-000142d0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-000142e0: 2020 2020 2061 6d6f 756e 7420 3d20 6622       amount = f"
-000142f0: 5374 6172 7473 2061 7420 7b66 6f72 6d61  Starts at {forma
-00014300: 7474 6564 5f75 6e69 745f 616d 6f75 6e74  tted_unit_amount
-00014310: 5f74 6965 725f 317d 2070 6572 2075 6e69  _tier_1} per uni
-00014320: 7422 0a0a 2020 2020 2020 2020 2020 2020  t"..            
-00014330: 2320 7374 7269 7065 2073 686f 7773 2066  # stripe shows f
-00014340: 6c61 7420 6665 6520 6576 656e 2069 6620  lat fee even if 
-00014350: 6974 2069 7320 7365 7420 746f 2030 2e30  it is set to 0.0
-00014360: 300a 2020 2020 2020 2020 2020 2020 666c  0.            fl
-00014370: 6174 5f61 6d6f 756e 745f 7469 6572 5f31  at_amount_tier_1
-00014380: 203d 2074 6965 725f 315b 2266 6c61 745f   = tier_1["flat_
-00014390: 616d 6f75 6e74 225d 0a20 2020 2020 2020  amount"].       
-000143a0: 2020 2020 2069 6620 666c 6174 5f61 6d6f       if flat_amo
-000143b0: 756e 745f 7469 6572 5f31 2069 7320 6e6f  unt_tier_1 is no
-000143c0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-000143d0: 2020 2020 2020 2020 666f 726d 6174 7465          formatte
-000143e0: 645f 666c 6174 5f61 6d6f 756e 745f 7469  d_flat_amount_ti
-000143f0: 6572 5f31 203d 2067 6574 5f66 7269 656e  er_1 = get_frien
-00014400: 646c 795f 6375 7272 656e 6379 5f61 6d6f  dly_currency_amo
-00014410: 756e 7428 0a20 2020 2020 2020 2020 2020  unt(.           
-00014420: 2020 2020 2020 2020 2066 6c61 745f 616d           flat_am
-00014430: 6f75 6e74 5f74 6965 725f 3120 2f20 3130  ount_tier_1 / 10
-00014440: 302c 2073 656c 662e 6375 7272 656e 6379  0, self.currency
-00014450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014460: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-00014470: 2020 2061 6d6f 756e 7420 3d20 6622 7b61     amount = f"{a
-00014480: 6d6f 756e 747d 202b 207b 666f 726d 6174  mount} + {format
-00014490: 7465 645f 666c 6174 5f61 6d6f 756e 745f  ted_flat_amount_
-000144a0: 7469 6572 5f31 7d22 0a0a 2020 2020 2020  tier_1}"..      
-000144b0: 2020 666f 726d 6174 5f61 7267 7320 3d20    format_args = 
-000144c0: 7b22 616d 6f75 6e74 223a 2061 6d6f 756e  {"amount": amoun
-000144d0: 747d 0a0a 2020 2020 2020 2020 6966 2073  t}..        if s
-000144e0: 656c 662e 7265 6375 7272 696e 673a 0a20  elf.recurring:. 
-000144f0: 2020 2020 2020 2020 2020 2069 6e74 6572             inter
-00014500: 7661 6c5f 636f 756e 7420 3d20 7365 6c66  val_count = self
-00014510: 2e72 6563 7572 7269 6e67 5b22 696e 7465  .recurring["inte
-00014520: 7276 616c 5f63 6f75 6e74 225d 0a20 2020  rval_count"].   
-00014530: 2020 2020 2020 2020 2069 6620 696e 7465           if inte
-00014540: 7276 616c 5f63 6f75 6e74 203d 3d20 313a  rval_count == 1:
-00014550: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014560: 2069 6e74 6572 7661 6c20 3d20 7b0a 2020   interval = {.  
-00014570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014580: 2020 2264 6179 223a 205f 2822 6461 7922    "day": _("day"
-00014590: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-000145a0: 2020 2020 2020 2022 7765 656b 223a 205f         "week": _
-000145b0: 2822 7765 656b 2229 2c0a 2020 2020 2020  ("week"),.      
-000145c0: 2020 2020 2020 2020 2020 2020 2020 226d                "m
-000145d0: 6f6e 7468 223a 205f 2822 6d6f 6e74 6822  onth": _("month"
-000145e0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-000145f0: 2020 2020 2020 2022 7965 6172 223a 205f         "year": _
-00014600: 2822 7965 6172 2229 2c0a 2020 2020 2020  ("year"),.      
-00014610: 2020 2020 2020 2020 2020 7d5b 7365 6c66            }[self
-00014620: 2e72 6563 7572 7269 6e67 5b22 696e 7465  .recurring["inte
-00014630: 7276 616c 225d 5d0a 2020 2020 2020 2020  rval"]].        
-00014640: 2020 2020 2020 2020 7465 6d70 6c61 7465          template
-00014650: 203d 205f 2822 7b61 6d6f 756e 747d 2f7b   = _("{amount}/{
-00014660: 696e 7465 7276 616c 7d22 290a 2020 2020  interval}").    
-00014670: 2020 2020 2020 2020 2020 2020 666f 726d              form
-00014680: 6174 5f61 7267 735b 2269 6e74 6572 7661  at_args["interva
-00014690: 6c22 5d20 3d20 696e 7465 7276 616c 0a20  l"] = interval. 
-000146a0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-000146b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000146c0: 2069 6e74 6572 7661 6c20 3d20 7b0a 2020   interval = {.  
-000146d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000146e0: 2020 2264 6179 223a 205f 2822 6461 7973    "day": _("days
-000146f0: 2229 2c0a 2020 2020 2020 2020 2020 2020  "),.            
-00014700: 2020 2020 2020 2020 2277 6565 6b22 3a20          "week": 
-00014710: 5f28 2277 6565 6b73 2229 2c0a 2020 2020  _("weeks"),.    
-00014720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014730: 226d 6f6e 7468 223a 205f 2822 6d6f 6e74  "month": _("mont
-00014740: 6873 2229 2c0a 2020 2020 2020 2020 2020  hs"),.          
-00014750: 2020 2020 2020 2020 2020 2279 6561 7222            "year"
-00014760: 3a20 5f28 2279 6561 7273 2229 2c0a 2020  : _("years"),.  
-00014770: 2020 2020 2020 2020 2020 2020 2020 7d5b                }[
-00014780: 7365 6c66 2e72 6563 7572 7269 6e67 5b22  self.recurring["
-00014790: 696e 7465 7276 616c 225d 5d0a 2020 2020  interval"]].    
-000147a0: 2020 2020 2020 2020 2020 2020 7465 6d70              temp
-000147b0: 6c61 7465 203d 205f 2822 7b61 6d6f 756e  late = _("{amoun
-000147c0: 747d 202f 2065 7665 7279 207b 696e 7465  t} / every {inte
-000147d0: 7276 616c 5f63 6f75 6e74 7d20 7b69 6e74  rval_count} {int
-000147e0: 6572 7661 6c7d 2229 0a20 2020 2020 2020  erval}").       
-000147f0: 2020 2020 2020 2020 2066 6f72 6d61 745f           format_
-00014800: 6172 6773 5b22 696e 7465 7276 616c 225d  args["interval"]
-00014810: 203d 2069 6e74 6572 7661 6c0a 2020 2020   = interval.    
-00014820: 2020 2020 2020 2020 2020 2020 666f 726d              form
-00014830: 6174 5f61 7267 735b 2269 6e74 6572 7661  at_args["interva
-00014840: 6c5f 636f 756e 7422 5d20 3d20 696e 7465  l_count"] = inte
-00014850: 7276 616c 5f63 6f75 6e74 0a0a 2020 2020  rval_count..    
-00014860: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00014870: 2020 2020 2020 7465 6d70 6c61 7465 203d        template =
-00014880: 205f 2822 7b61 6d6f 756e 747d 2028 6f6e   _("{amount} (on
-00014890: 6520 7469 6d65 2922 290a 0a20 2020 2020  e time)")..     
-000148a0: 2020 2072 6574 7572 6e20 666f 726d 6174     return format
-000148b0: 5f6c 617a 7928 7465 6d70 6c61 7465 2c20  _lazy(template, 
-000148c0: 2a2a 666f 726d 6174 5f61 7267 7329 0a0a  **format_args)..
-000148d0: 0a63 6c61 7373 2052 6566 756e 6428 5374  .class Refund(St
-000148e0: 7269 7065 4d6f 6465 6c29 3a0a 2020 2020  ripeModel):.    
-000148f0: 2222 220a 2020 2020 5265 6675 6e64 206f  """.    Refund o
-00014900: 626a 6563 7473 2061 6c6c 6f77 2079 6f75  bjects allow you
-00014910: 2074 6f20 7265 6675 6e64 2061 2063 6861   to refund a cha
-00014920: 7267 6520 7468 6174 2068 6173 2070 7265  rge that has pre
-00014930: 7669 6f75 736c 7920 6265 656e 2063 7265  viously been cre
-00014940: 6174 6564 0a20 2020 2062 7574 206e 6f74  ated.    but not
-00014950: 2079 6574 2072 6566 756e 6465 642e 2046   yet refunded. F
-00014960: 756e 6473 2077 696c 6c20 6265 2072 6566  unds will be ref
-00014970: 756e 6465 6420 746f 2074 6865 2063 7265  unded to the cre
-00014980: 6469 7420 6f72 2064 6562 6974 2063 6172  dit or debit car
-00014990: 640a 2020 2020 7468 6174 2077 6173 206f  d.    that was o
-000149a0: 7269 6769 6e61 6c6c 7920 6368 6172 6765  riginally charge
-000149b0: 642e 0a0a 2020 2020 5374 7269 7065 2064  d...    Stripe d
-000149c0: 6f63 756d 656e 7461 7469 6f6e 3a20 6874  ocumentation: ht
-000149d0: 7470 733a 2f2f 7374 7269 7065 2e63 6f6d  tps://stripe.com
-000149e0: 2f64 6f63 732f 6170 693f 6c61 6e67 3d70  /docs/api?lang=p
-000149f0: 7974 686f 6e23 7265 6675 6e64 5f6f 626a  ython#refund_obj
-00014a00: 6563 740a 2020 2020 2222 220a 0a20 2020  ect.    """..   
-00014a10: 2073 7472 6970 655f 636c 6173 7320 3d20   stripe_class = 
-00014a20: 7374 7269 7065 2e52 6566 756e 640a 0a20  stripe.Refund.. 
-00014a30: 2020 2061 6d6f 756e 7420 3d20 5374 7269     amount = Stri
-00014a40: 7065 5175 616e 7475 6d43 7572 7265 6e63  peQuantumCurrenc
-00014a50: 7941 6d6f 756e 7446 6965 6c64 2868 656c  yAmountField(hel
-00014a60: 705f 7465 7874 3d22 416d 6f75 6e74 2c20  p_text="Amount, 
-00014a70: 696e 2063 656e 7473 2e22 290a 2020 2020  in cents.").    
-00014a80: 6261 6c61 6e63 655f 7472 616e 7361 6374  balance_transact
-00014a90: 696f 6e20 3d20 5374 7269 7065 466f 7265  ion = StripeFore
-00014aa0: 6967 6e4b 6579 280a 2020 2020 2020 2020  ignKey(.        
-00014ab0: 2242 616c 616e 6365 5472 616e 7361 6374  "BalanceTransact
-00014ac0: 696f 6e22 2c0a 2020 2020 2020 2020 6f6e  ion",.        on
-00014ad0: 5f64 656c 6574 653d 6d6f 6465 6c73 2e53  _delete=models.S
-00014ae0: 4554 5f4e 554c 4c2c 0a20 2020 2020 2020  ET_NULL,.       
-00014af0: 206e 756c 6c3d 5472 7565 2c0a 2020 2020   null=True,.    
-00014b00: 2020 2020 6865 6c70 5f74 6578 743d 2242      help_text="B
-00014b10: 616c 616e 6365 2074 7261 6e73 6163 7469  alance transacti
-00014b20: 6f6e 2074 6861 7420 6465 7363 7269 6265  on that describe
-00014b30: 7320 7468 6520 696d 7061 6374 206f 6e20  s the impact on 
-00014b40: 796f 7572 2061 6363 6f75 6e74 2022 0a20  your account ". 
-00014b50: 2020 2020 2020 2022 6261 6c61 6e63 652e         "balance.
-00014b60: 222c 0a20 2020 2029 0a20 2020 2063 6861  ",.    ).    cha
-00014b70: 7267 6520 3d20 5374 7269 7065 466f 7265  rge = StripeFore
-00014b80: 6967 6e4b 6579 280a 2020 2020 2020 2020  ignKey(.        
-00014b90: 2243 6861 7267 6522 2c0a 2020 2020 2020  "Charge",.      
-00014ba0: 2020 6f6e 5f64 656c 6574 653d 6d6f 6465    on_delete=mode
-00014bb0: 6c73 2e43 4153 4341 4445 2c0a 2020 2020  ls.CASCADE,.    
-00014bc0: 2020 2020 7265 6c61 7465 645f 6e61 6d65      related_name
-00014bd0: 3d22 7265 6675 6e64 7322 2c0a 2020 2020  ="refunds",.    
-00014be0: 2020 2020 6865 6c70 5f74 6578 743d 2254      help_text="T
-00014bf0: 6865 2063 6861 7267 6520 7468 6174 2077  he charge that w
-00014c00: 6173 2072 6566 756e 6465 6422 2c0a 2020  as refunded",.  
-00014c10: 2020 290a 2020 2020 6375 7272 656e 6379    ).    currency
-00014c20: 203d 2053 7472 6970 6543 7572 7265 6e63   = StripeCurrenc
-00014c30: 7943 6f64 6546 6965 6c64 2829 0a20 2020  yCodeField().   
-00014c40: 2066 6169 6c75 7265 5f62 616c 616e 6365   failure_balance
-00014c50: 5f74 7261 6e73 6163 7469 6f6e 203d 2053  _transaction = S
-00014c60: 7472 6970 6546 6f72 6569 676e 4b65 7928  tripeForeignKey(
-00014c70: 0a20 2020 2020 2020 2022 4261 6c61 6e63  .        "Balanc
-00014c80: 6554 7261 6e73 6163 7469 6f6e 222c 0a20  eTransaction",. 
-00014c90: 2020 2020 2020 206f 6e5f 6465 6c65 7465         on_delete
-00014ca0: 3d6d 6f64 656c 732e 5345 545f 4e55 4c4c  =models.SET_NULL
-00014cb0: 2c0a 2020 2020 2020 2020 7265 6c61 7465  ,.        relate
-00014cc0: 645f 6e61 6d65 3d22 6661 696c 7572 655f  d_name="failure_
-00014cd0: 7265 6675 6e64 7322 2c0a 2020 2020 2020  refunds",.      
-00014ce0: 2020 6e75 6c6c 3d54 7275 652c 0a20 2020    null=True,.   
-00014cf0: 2020 2020 2062 6c61 6e6b 3d54 7275 652c       blank=True,
-00014d00: 0a20 2020 2020 2020 2068 656c 705f 7465  .        help_te
-00014d10: 7874 3d22 4966 2074 6865 2072 6566 756e  xt="If the refun
-00014d20: 6420 6661 696c 6564 2c20 7468 6973 2062  d failed, this b
-00014d30: 616c 616e 6365 2074 7261 6e73 6163 7469  alance transacti
-00014d40: 6f6e 2064 6573 6372 6962 6573 2074 6865  on describes the
-00014d50: 2022 0a20 2020 2020 2020 2022 6164 6a75   ".        "adju
-00014d60: 7374 6d65 6e74 206d 6164 6520 6f6e 2079  stment made on y
-00014d70: 6f75 7220 6163 636f 756e 7420 6261 6c61  our account bala
-00014d80: 6e63 6520 7468 6174 2072 6576 6572 7365  nce that reverse
-00014d90: 7320 7468 6520 696e 6974 6961 6c20 220a  s the initial ".
-00014da0: 2020 2020 2020 2020 2262 616c 616e 6365          "balance
-00014db0: 2074 7261 6e73 6163 7469 6f6e 2e22 2c0a   transaction.",.
-00014dc0: 2020 2020 290a 2020 2020 6661 696c 7572      ).    failur
-00014dd0: 655f 7265 6173 6f6e 203d 2053 7472 6970  e_reason = Strip
-00014de0: 6545 6e75 6d46 6965 6c64 280a 2020 2020  eEnumField(.    
-00014df0: 2020 2020 656e 756d 3d65 6e75 6d73 2e52      enum=enums.R
-00014e00: 6566 756e 6446 6169 6c75 7265 5265 6173  efundFailureReas
-00014e10: 6f6e 2c0a 2020 2020 2020 2020 6465 6661  on,.        defa
-00014e20: 756c 743d 2222 2c0a 2020 2020 2020 2020  ult="",.        
-00014e30: 626c 616e 6b3d 5472 7565 2c0a 2020 2020  blank=True,.    
-00014e40: 2020 2020 6865 6c70 5f74 6578 743d 2249      help_text="I
-00014e50: 6620 7468 6520 7265 6675 6e64 2066 6169  f the refund fai
-00014e60: 6c65 642c 2074 6865 2072 6561 736f 6e20  led, the reason 
-00014e70: 666f 7220 7265 6675 6e64 2066 6169 6c75  for refund failu
-00014e80: 7265 2069 6620 6b6e 6f77 6e2e 222c 0a20  re if known.",. 
-00014e90: 2020 2029 0a20 2020 2072 6561 736f 6e20     ).    reason 
-00014ea0: 3d20 5374 7269 7065 456e 756d 4669 656c  = StripeEnumFiel
-00014eb0: 6428 0a20 2020 2020 2020 2065 6e75 6d3d  d(.        enum=
-00014ec0: 656e 756d 732e 5265 6675 6e64 5265 6173  enums.RefundReas
-00014ed0: 6f6e 2c0a 2020 2020 2020 2020 626c 616e  on,.        blan
-00014ee0: 6b3d 5472 7565 2c0a 2020 2020 2020 2020  k=True,.        
-00014ef0: 6465 6661 756c 743d 2222 2c0a 2020 2020  default="",.    
-00014f00: 2020 2020 6865 6c70 5f74 6578 743d 2252      help_text="R
-00014f10: 6561 736f 6e20 666f 7220 7468 6520 7265  eason for the re
-00014f20: 6675 6e64 2e22 2c0a 2020 2020 290a 2020  fund.",.    ).  
-00014f30: 2020 7265 6365 6970 745f 6e75 6d62 6572    receipt_number
-00014f40: 203d 206d 6f64 656c 732e 4368 6172 4669   = models.CharFi
-00014f50: 656c 6428 0a20 2020 2020 2020 206d 6178  eld(.        max
-00014f60: 5f6c 656e 6774 683d 392c 0a20 2020 2020  _length=9,.     
-00014f70: 2020 2064 6566 6175 6c74 3d22 222c 0a20     default="",. 
-00014f80: 2020 2020 2020 2062 6c61 6e6b 3d54 7275         blank=Tru
-00014f90: 652c 0a20 2020 2020 2020 2068 656c 705f  e,.        help_
-00014fa0: 7465 7874 3d22 5468 6520 7472 616e 7361  text="The transa
-00014fb0: 6374 696f 6e20 6e75 6d62 6572 2074 6861  ction number tha
-00014fc0: 7420 6170 7065 6172 7320 6f6e 2065 6d61  t appears on ema
-00014fd0: 696c 2072 6563 6569 7074 7320 7365 6e74  il receipts sent
-00014fe0: 2022 0a20 2020 2020 2020 2022 666f 7220   ".        "for 
-00014ff0: 7468 6973 2063 6861 7267 652e 222c 0a20  this charge.",. 
-00015000: 2020 2029 0a20 2020 2073 7461 7475 7320     ).    status 
-00015010: 3d20 5374 7269 7065 456e 756d 4669 656c  = StripeEnumFiel
-00015020: 6428 0a20 2020 2020 2020 2062 6c61 6e6b  d(.        blank
-00015030: 3d54 7275 652c 2065 6e75 6d3d 656e 756d  =True, enum=enum
-00015040: 732e 5265 6675 6e64 5374 6174 7573 2c20  s.RefundStatus, 
-00015050: 6865 6c70 5f74 6578 743d 2253 7461 7475  help_text="Statu
-00015060: 7320 6f66 2074 6865 2072 6566 756e 642e  s of the refund.
-00015070: 220a 2020 2020 290a 2020 2020 2320 746f  ".    ).    # to
-00015080: 646f 2069 6d70 6c65 6d65 6e74 2073 6f75  do implement sou
-00015090: 7263 655f 7472 616e 7366 6572 5f72 6576  rce_transfer_rev
-000150a0: 6572 7361 6c20 616e 6420 7472 616e 7366  ersal and transf
-000150b0: 6572 5f72 6576 6572 7361 6c0a 0a20 2020  er_reversal..   
-000150c0: 2064 6566 2067 6574 5f73 7472 6970 655f   def get_stripe_
-000150d0: 6461 7368 626f 6172 645f 7572 6c28 7365  dashboard_url(se
-000150e0: 6c66 293a 0a20 2020 2020 2020 2072 6574  lf):.        ret
-000150f0: 7572 6e20 7365 6c66 2e63 6861 7267 652e  urn self.charge.
-00015100: 6765 745f 7374 7269 7065 5f64 6173 6862  get_stripe_dashb
-00015110: 6f61 7264 5f75 726c 2829 0a0a 2020 2020  oard_url()..    
-00015120: 6465 6620 5f5f 7374 725f 5f28 7365 6c66  def __str__(self
-00015130: 293a 0a20 2020 2020 2020 2061 6d6f 756e  ):.        amoun
-00015140: 7420 3d20 6765 745f 6672 6965 6e64 6c79  t = get_friendly
-00015150: 5f63 7572 7265 6e63 795f 616d 6f75 6e74  _currency_amount
-00015160: 2873 656c 662e 616d 6f75 6e74 202f 2031  (self.amount / 1
-00015170: 3030 2c20 7365 6c66 2e63 7572 7265 6e63  00, self.currenc
-00015180: 7929 0a20 2020 2020 2020 2073 7461 7475  y).        statu
-00015190: 7320 3d20 656e 756d 732e 5265 6675 6e64  s = enums.Refund
-000151a0: 5374 6174 7573 2e68 756d 616e 697a 6528  Status.humanize(
-000151b0: 7365 6c66 2e73 7461 7475 7329 0a20 2020  self.status).   
-000151c0: 2020 2020 2072 6574 7572 6e20 6622 7b61       return f"{a
-000151d0: 6d6f 756e 747d 2028 7b73 7461 7475 737d  mount} ({status}
-000151e0: 2922 0a                                  )".
+000062c0: 2020 2020 2020 626c 616e 6b3d 5472 7565        blank=True
+000062d0: 2c0a 2020 2020 2020 2020 6d61 785f 6c65  ,.        max_le
+000062e0: 6e67 7468 3d32 3535 2c0a 2020 2020 2020  ngth=255,.      
+000062f0: 2020 6865 6c70 5f74 6578 743d 280a 2020    help_text=(.  
+00006300: 2020 2020 2020 2020 2020 2254 6865 2070            "The p
+00006310: 7265 6669 7820 666f 7220 7468 6520 6375  refix for the cu
+00006320: 7374 6f6d 6572 2075 7365 6420 746f 2067  stomer used to g
+00006330: 656e 6572 6174 6520 756e 6971 7565 2069  enerate unique i
+00006340: 6e76 6f69 6365 206e 756d 6265 7273 2e22  nvoice numbers."
+00006350: 0a20 2020 2020 2020 2029 2c0a 2020 2020  .        ),.    
+00006360: 290a 2020 2020 696e 766f 6963 655f 7365  ).    invoice_se
+00006370: 7474 696e 6773 203d 204a 534f 4e46 6965  ttings = JSONFie
+00006380: 6c64 280a 2020 2020 2020 2020 6e75 6c6c  ld(.        null
+00006390: 3d54 7275 652c 2062 6c61 6e6b 3d54 7275  =True, blank=Tru
+000063a0: 652c 2068 656c 705f 7465 7874 3d22 5468  e, help_text="Th
+000063b0: 6520 6375 7374 6f6d 6572 2773 2064 6566  e customer's def
+000063c0: 6175 6c74 2069 6e76 6f69 6365 2073 6574  ault invoice set
+000063d0: 7469 6e67 732e 220a 2020 2020 290a 2020  tings.".    ).  
+000063e0: 2020 2320 6465 6661 756c 745f 7061 796d    # default_paym
+000063f0: 656e 745f 6d65 7468 6f64 2069 7320 6163  ent_method is ac
+00006400: 7475 616c 6c79 206e 6573 7465 6420 696e  tually nested in
+00006410: 7369 6465 2069 6e76 6f69 6365 5f73 6574  side invoice_set
+00006420: 7469 6e67 730a 2020 2020 2320 7468 6973  tings.    # this
+00006430: 2066 6965 6c64 2069 7320 6120 636f 6e76   field is a conv
+00006440: 656e 6965 6e63 6520 746f 2070 726f 7669  enience to provi
+00006450: 6465 2074 6865 2066 6f72 6569 676e 206b  de the foreign k
+00006460: 6579 0a20 2020 2064 6566 6175 6c74 5f70  ey.    default_p
+00006470: 6179 6d65 6e74 5f6d 6574 686f 6420 3d20  ayment_method = 
+00006480: 5374 7269 7065 466f 7265 6967 6e4b 6579  StripeForeignKey
+00006490: 280a 2020 2020 2020 2020 2250 6179 6d65  (.        "Payme
+000064a0: 6e74 4d65 7468 6f64 222c 0a20 2020 2020  ntMethod",.     
+000064b0: 2020 206e 756c 6c3d 5472 7565 2c0a 2020     null=True,.  
+000064c0: 2020 2020 2020 626c 616e 6b3d 5472 7565        blank=True
+000064d0: 2c0a 2020 2020 2020 2020 6f6e 5f64 656c  ,.        on_del
+000064e0: 6574 653d 6d6f 6465 6c73 2e53 4554 5f4e  ete=models.SET_N
+000064f0: 554c 4c2c 0a20 2020 2020 2020 2072 656c  ULL,.        rel
+00006500: 6174 6564 5f6e 616d 653d 222b 222c 0a20  ated_name="+",. 
+00006510: 2020 2020 2020 2068 656c 705f 7465 7874         help_text
+00006520: 3d28 0a20 2020 2020 2020 2020 2020 2022  =(.            "
+00006530: 6465 6661 756c 7420 7061 796d 656e 7420  default payment 
+00006540: 6d65 7468 6f64 2075 7365 6420 666f 7220  method used for 
+00006550: 7375 6273 6372 6970 7469 6f6e 7320 616e  subscriptions an
+00006560: 6420 696e 766f 6963 6573 2022 0a20 2020  d invoices ".   
+00006570: 2020 2020 2020 2020 2022 666f 7220 7468           "for th
+00006580: 6520 6375 7374 6f6d 6572 2e22 0a20 2020  e customer.".   
+00006590: 2020 2020 2029 2c0a 2020 2020 290a 2020       ),.    ).  
+000065a0: 2020 6e61 6d65 203d 206d 6f64 656c 732e    name = models.
+000065b0: 5465 7874 4669 656c 6428 0a20 2020 2020  TextField(.     
+000065c0: 2020 206d 6178 5f6c 656e 6774 683d 3530     max_length=50
+000065d0: 3030 2c0a 2020 2020 2020 2020 6465 6661  00,.        defa
+000065e0: 756c 743d 2222 2c0a 2020 2020 2020 2020  ult="",.        
+000065f0: 626c 616e 6b3d 5472 7565 2c0a 2020 2020  blank=True,.    
+00006600: 2020 2020 6865 6c70 5f74 6578 743d 2254      help_text="T
+00006610: 6865 2063 7573 746f 6d65 7227 7320 6675  he customer's fu
+00006620: 6c6c 206e 616d 6520 6f72 2062 7573 696e  ll name or busin
+00006630: 6573 7320 6e61 6d65 2e22 2c0a 2020 2020  ess name.",.    
+00006640: 290a 2020 2020 7068 6f6e 6520 3d20 6d6f  ).    phone = mo
+00006650: 6465 6c73 2e54 6578 7446 6965 6c64 280a  dels.TextField(.
+00006660: 2020 2020 2020 2020 6d61 785f 6c65 6e67          max_leng
+00006670: 7468 3d35 3030 302c 0a20 2020 2020 2020  th=5000,.       
+00006680: 2064 6566 6175 6c74 3d22 222c 0a20 2020   default="",.   
+00006690: 2020 2020 2062 6c61 6e6b 3d54 7275 652c       blank=True,
+000066a0: 0a20 2020 2020 2020 2068 656c 705f 7465  .        help_te
+000066b0: 7874 3d22 5468 6520 6375 7374 6f6d 6572  xt="The customer
+000066c0: 2773 2070 686f 6e65 206e 756d 6265 722e  's phone number.
+000066d0: 222c 0a20 2020 2029 0a20 2020 2070 7265  ",.    ).    pre
+000066e0: 6665 7272 6564 5f6c 6f63 616c 6573 203d  ferred_locales =
+000066f0: 204a 534f 4e46 6965 6c64 280a 2020 2020   JSONField(.    
+00006700: 2020 2020 6e75 6c6c 3d54 7275 652c 0a20      null=True,. 
+00006710: 2020 2020 2020 2062 6c61 6e6b 3d54 7275         blank=Tru
+00006720: 652c 0a20 2020 2020 2020 2068 656c 705f  e,.        help_
+00006730: 7465 7874 3d28 0a20 2020 2020 2020 2020  text=(.         
+00006740: 2020 2022 5468 6520 6375 7374 6f6d 6572     "The customer
+00006750: 2773 2070 7265 6665 7272 6564 206c 6f63  's preferred loc
+00006760: 616c 6573 2028 6c61 6e67 7561 6765 7329  ales (languages)
+00006770: 2c20 6f72 6465 7265 6420 6279 2070 7265  , ordered by pre
+00006780: 6665 7265 6e63 652e 220a 2020 2020 2020  ference.".      
+00006790: 2020 292c 0a20 2020 2029 0a20 2020 2073    ),.    ).    s
+000067a0: 6869 7070 696e 6720 3d20 4a53 4f4e 4669  hipping = JSONFi
+000067b0: 656c 6428 0a20 2020 2020 2020 206e 756c  eld(.        nul
+000067c0: 6c3d 5472 7565 2c0a 2020 2020 2020 2020  l=True,.        
+000067d0: 626c 616e 6b3d 5472 7565 2c0a 2020 2020  blank=True,.    
+000067e0: 2020 2020 6865 6c70 5f74 6578 743d 2253      help_text="S
+000067f0: 6869 7070 696e 6720 696e 666f 726d 6174  hipping informat
+00006800: 696f 6e20 6173 736f 6369 6174 6564 2077  ion associated w
+00006810: 6974 6820 7468 6520 6375 7374 6f6d 6572  ith the customer
+00006820: 2e22 2c0a 2020 2020 290a 2020 2020 7461  .",.    ).    ta
+00006830: 785f 6578 656d 7074 203d 2053 7472 6970  x_exempt = Strip
+00006840: 6545 6e75 6d46 6965 6c64 280a 2020 2020  eEnumField(.    
+00006850: 2020 2020 656e 756d 3d65 6e75 6d73 2e43      enum=enums.C
+00006860: 7573 746f 6d65 7254 6178 4578 656d 7074  ustomerTaxExempt
+00006870: 2c0a 2020 2020 2020 2020 6465 6661 756c  ,.        defaul
+00006880: 743d 2222 2c0a 2020 2020 2020 2020 6865  t="",.        he
+00006890: 6c70 5f74 6578 743d 280a 2020 2020 2020  lp_text=(.      
+000068a0: 2020 2020 2020 2244 6573 6372 6962 6573        "Describes
+000068b0: 2074 6865 2063 7573 746f 6d65 7227 7320   the customer's 
+000068c0: 7461 7820 6578 656d 7074 696f 6e20 7374  tax exemption st
+000068d0: 6174 7573 2e20 5768 656e 2073 6574 2074  atus. When set t
+000068e0: 6f20 7265 7665 7273 652c 2022 0a20 2020  o reverse, ".   
+000068f0: 2020 2020 2020 2020 2027 696e 766f 6963           'invoic
+00006900: 6520 616e 6420 7265 6365 6970 7420 5044  e and receipt PD
+00006910: 4673 2069 6e63 6c75 6465 2074 6865 2074  Fs include the t
+00006920: 6578 7420 2252 6576 6572 7365 2063 6861  ext "Reverse cha
+00006930: 7267 6522 2e27 0a20 2020 2020 2020 2029  rge".'.        )
+00006940: 2c0a 2020 2020 290a 0a20 2020 2023 2064  ,.    )..    # d
+00006950: 6a2d 7374 7269 7065 2066 6965 6c64 730a  j-stripe fields.
+00006960: 2020 2020 7375 6273 6372 6962 6572 203d      subscriber =
+00006970: 206d 6f64 656c 732e 466f 7265 6967 6e4b   models.ForeignK
+00006980: 6579 280a 2020 2020 2020 2020 646a 7374  ey(.        djst
+00006990: 7269 7065 5f73 6574 7469 6e67 732e 6765  ripe_settings.ge
+000069a0: 745f 7375 6273 6372 6962 6572 5f6d 6f64  t_subscriber_mod
+000069b0: 656c 5f73 7472 696e 6728 292c 0a20 2020  el_string(),.   
+000069c0: 2020 2020 2062 6c61 6e6b 3d54 7275 652c       blank=True,
+000069d0: 0a20 2020 2020 2020 206e 756c 6c3d 5472  .        null=Tr
+000069e0: 7565 2c0a 2020 2020 2020 2020 6f6e 5f64  ue,.        on_d
+000069f0: 656c 6574 653d 6d6f 6465 6c73 2e53 4554  elete=models.SET
+00006a00: 5f4e 554c 4c2c 0a20 2020 2020 2020 2072  _NULL,.        r
+00006a10: 656c 6174 6564 5f6e 616d 653d 2264 6a73  elated_name="djs
+00006a20: 7472 6970 655f 6375 7374 6f6d 6572 7322  tripe_customers"
+00006a30: 2c0a 2020 2020 290a 2020 2020 6461 7465  ,.    ).    date
+00006a40: 5f70 7572 6765 6420 3d20 6d6f 6465 6c73  _purged = models
+00006a50: 2e44 6174 6554 696d 6546 6965 6c64 286e  .DateTimeField(n
+00006a60: 756c 6c3d 5472 7565 2c20 6564 6974 6162  ull=True, editab
+00006a70: 6c65 3d46 616c 7365 290a 0a20 2020 2063  le=False)..    c
+00006a80: 6c61 7373 204d 6574 6128 5374 7269 7065  lass Meta(Stripe
+00006a90: 4d6f 6465 6c2e 4d65 7461 293a 0a20 2020  Model.Meta):.   
+00006aa0: 2020 2020 2075 6e69 7175 655f 746f 6765       unique_toge
+00006ab0: 7468 6572 203d 2028 2273 7562 7363 7269  ther = ("subscri
+00006ac0: 6265 7222 2c20 226c 6976 656d 6f64 6522  ber", "livemode"
+00006ad0: 2c20 2264 6a73 7472 6970 655f 6f77 6e65  , "djstripe_owne
+00006ae0: 725f 6163 636f 756e 7422 290a 0a20 2020  r_account")..   
+00006af0: 2064 6566 205f 5f73 7472 5f5f 2873 656c   def __str__(sel
+00006b00: 6629 3a0a 2020 2020 2020 2020 6966 2073  f):.        if s
+00006b10: 656c 662e 7375 6273 6372 6962 6572 3a0a  elf.subscriber:.
+00006b20: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00006b30: 726e 2073 7472 2873 656c 662e 7375 6273  rn str(self.subs
+00006b40: 6372 6962 6572 290a 0a20 2020 2020 2020  criber)..       
+00006b50: 2072 6574 7572 6e20 7365 6c66 2e6e 616d   return self.nam
+00006b60: 6520 6f72 2073 656c 662e 6465 7363 7269  e or self.descri
+00006b70: 7074 696f 6e20 6f72 2073 656c 662e 6964  ption or self.id
+00006b80: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
+00006b90: 6f64 0a20 2020 2064 6566 205f 6d61 6e69  od.    def _mani
+00006ba0: 7075 6c61 7465 5f73 7472 6970 655f 6f62  pulate_stripe_ob
+00006bb0: 6a65 6374 5f68 6f6f 6b28 636c 732c 2064  ject_hook(cls, d
+00006bc0: 6174 6129 3a0a 2020 2020 2020 2020 2320  ata):.        # 
+00006bd0: 7374 7269 7065 2061 6464 7320 6120 6465  stripe adds a de
+00006be0: 6c65 7465 6420 6174 7472 6962 7574 6520  leted attribute 
+00006bf0: 6966 2074 6865 2043 7573 746f 6d65 7220  if the Customer 
+00006c00: 6861 7320 6265 656e 2064 656c 6574 6564  has been deleted
+00006c10: 2075 7073 7472 6561 6d0a 2020 2020 2020   upstream.      
+00006c20: 2020 6966 2064 6174 612e 6765 7428 2264    if data.get("d
+00006c30: 656c 6574 6564 2229 3a0a 2020 2020 2020  eleted"):.      
+00006c40: 2020 2020 2020 6c6f 6767 6572 2e77 6172        logger.war
+00006c50: 6e69 6e67 280a 2020 2020 2020 2020 2020  ning(.          
+00006c60: 2020 2020 2020 6622 5468 6973 2063 7573        f"This cus
+00006c70: 746f 6d65 7220 287b 6461 7461 2e67 6574  tomer ({data.get
+00006c80: 2827 6964 2729 7d29 2068 6173 2062 6565  ('id')}) has bee
+00006c90: 6e20 6465 6c65 7465 6420 7570 7374 7265  n deleted upstre
+00006ca0: 616d 2c20 696e 2053 7472 6970 6522 0a20  am, in Stripe". 
+00006cb0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+00006cc0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00006cd0: 2020 2020 2020 2020 2320 7365 7420 2264          # set "d
+00006ce0: 656c 6574 6564 2220 6b65 7920 746f 2046  eleted" key to F
+00006cf0: 616c 7365 2028 6465 6661 756c 7429 0a20  alse (default). 
+00006d00: 2020 2020 2020 2020 2020 2064 6174 615b             data[
+00006d10: 2264 656c 6574 6564 225d 203d 2046 616c  "deleted"] = Fal
+00006d20: 7365 0a0a 2020 2020 2020 2020 6469 7363  se..        disc
+00006d30: 6f75 6e74 203d 2064 6174 612e 6765 7428  ount = data.get(
+00006d40: 2264 6973 636f 756e 7422 290a 2020 2020  "discount").    
+00006d50: 2020 2020 6966 2064 6973 636f 756e 743a      if discount:
+00006d60: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
+00006d70: 615b 2263 6f75 706f 6e5f 7374 6172 7422  a["coupon_start"
+00006d80: 5d20 3d20 6469 7363 6f75 6e74 5b22 7374  ] = discount["st
+00006d90: 6172 7422 5d0a 2020 2020 2020 2020 2020  art"].          
+00006da0: 2020 6461 7461 5b22 636f 7570 6f6e 5f65    data["coupon_e
+00006db0: 6e64 225d 203d 2064 6973 636f 756e 745b  nd"] = discount[
+00006dc0: 2265 6e64 225d 0a0a 2020 2020 2020 2020  "end"]..        
+00006dd0: 2320 506f 7075 6c61 7465 2074 6865 206f  # Populate the o
+00006de0: 626a 6563 7420 6964 2066 6f72 206f 7572  bject id for our
+00006df0: 2064 6566 6175 6c74 5f70 6179 6d65 6e74   default_payment
+00006e00: 5f6d 6574 686f 6420 6669 656c 6420 286f  _method field (o
+00006e10: 7220 7365 7420 6974 204e 6f6e 6529 0a20  r set it None). 
+00006e20: 2020 2020 2020 2064 6174 615b 2264 6566         data["def
+00006e30: 6175 6c74 5f70 6179 6d65 6e74 5f6d 6574  ault_payment_met
+00006e40: 686f 6422 5d20 3d20 6461 7461 2e67 6574  hod"] = data.get
+00006e50: 2822 696e 766f 6963 655f 7365 7474 696e  ("invoice_settin
+00006e60: 6773 222c 207b 7d29 2e67 6574 280a 2020  gs", {}).get(.  
+00006e70: 2020 2020 2020 2020 2020 2264 6566 6175            "defau
+00006e80: 6c74 5f70 6179 6d65 6e74 5f6d 6574 686f  lt_payment_metho
+00006e90: 6422 0a20 2020 2020 2020 2029 0a0a 2020  d".        )..  
+00006ea0: 2020 2020 2020 7265 7475 726e 2064 6174        return dat
+00006eb0: 610a 0a20 2020 2040 636c 6173 736d 6574  a..    @classmet
+00006ec0: 686f 640a 2020 2020 6465 6620 6765 745f  hod.    def get_
+00006ed0: 6f72 5f63 7265 6174 6528 0a20 2020 2020  or_create(.     
+00006ee0: 2020 2063 6c73 2c0a 2020 2020 2020 2020     cls,.        
+00006ef0: 7375 6273 6372 6962 6572 2c0a 2020 2020  subscriber,.    
+00006f00: 2020 2020 6c69 7665 6d6f 6465 3d64 6a73      livemode=djs
+00006f10: 7472 6970 655f 7365 7474 696e 6773 2e53  tripe_settings.S
+00006f20: 5452 4950 455f 4c49 5645 5f4d 4f44 452c  TRIPE_LIVE_MODE,
+00006f30: 0a20 2020 2020 2020 2073 7472 6970 655f  .        stripe_
+00006f40: 6163 636f 756e 743d 4e6f 6e65 2c0a 2020  account=None,.  
+00006f50: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
+00006f60: 0a20 2020 2020 2020 2047 6574 206f 7220  .        Get or 
+00006f70: 6372 6561 7465 2061 2064 6a2d 7374 7269  create a dj-stri
+00006f80: 7065 2063 7573 746f 6d65 722e 0a0a 2020  pe customer...  
+00006f90: 2020 2020 2020 3a70 6172 616d 2073 7562        :param sub
+00006fa0: 7363 7269 6265 723a 2054 6865 2073 7562  scriber: The sub
+00006fb0: 7363 7269 6265 7220 6d6f 6465 6c20 696e  scriber model in
+00006fc0: 7374 616e 6365 2066 6f72 2077 6869 6368  stance for which
+00006fd0: 2074 6f20 6765 7420 6f72 0a20 2020 2020   to get or.     
+00006fe0: 2020 2020 2020 2063 7265 6174 6520 6120         create a 
+00006ff0: 6375 7374 6f6d 6572 2e0a 2020 2020 2020  customer..      
+00007000: 2020 3a74 7970 6520 7375 6273 6372 6962    :type subscrib
+00007010: 6572 3a20 5573 6572 0a0a 2020 2020 2020  er: User..      
+00007020: 2020 3a70 6172 616d 206c 6976 656d 6f64    :param livemod
+00007030: 653a 2057 6865 7468 6572 2074 6f20 6765  e: Whether to ge
+00007040: 7420 7468 6520 7375 6273 6372 6962 6572  t the subscriber
+00007050: 2069 6e20 6c69 7665 206f 7220 7465 7374   in live or test
+00007060: 206d 6f64 652e 0a20 2020 2020 2020 203a   mode..        :
+00007070: 7479 7065 206c 6976 656d 6f64 653a 2062  type livemode: b
+00007080: 6f6f 6c0a 2020 2020 2020 2020 2222 220a  ool.        """.
+00007090: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+000070a0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+000070b0: 2063 6c73 2e6f 626a 6563 7473 2e67 6574   cls.objects.get
+000070c0: 2873 7562 7363 7269 6265 723d 7375 6273  (subscriber=subs
+000070d0: 6372 6962 6572 2c20 6c69 7665 6d6f 6465  criber, livemode
+000070e0: 3d6c 6976 656d 6f64 6529 2c20 4661 6c73  =livemode), Fals
+000070f0: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
+00007100: 2063 6c73 2e44 6f65 734e 6f74 4578 6973   cls.DoesNotExis
+00007110: 743a 0a20 2020 2020 2020 2020 2020 2061  t:.            a
+00007120: 6374 696f 6e20 3d20 6622 6372 6561 7465  ction = f"create
+00007130: 3a7b 7375 6273 6372 6962 6572 2e70 6b7d  :{subscriber.pk}
+00007140: 220a 2020 2020 2020 2020 2020 2020 6964  ".            id
+00007150: 656d 706f 7465 6e63 795f 6b65 7920 3d20  empotency_key = 
+00007160: 646a 7374 7269 7065 5f73 6574 7469 6e67  djstripe_setting
+00007170: 732e 6765 745f 6964 656d 706f 7465 6e63  s.get_idempotenc
+00007180: 795f 6b65 7928 0a20 2020 2020 2020 2020  y_key(.         
+00007190: 2020 2020 2020 2022 6375 7374 6f6d 6572         "customer
+000071a0: 222c 2061 6374 696f 6e2c 206c 6976 656d  ", action, livem
+000071b0: 6f64 650a 2020 2020 2020 2020 2020 2020  ode.            
+000071c0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+000071d0: 7475 726e 2028 0a20 2020 2020 2020 2020  turn (.         
+000071e0: 2020 2020 2020 2063 6c73 2e63 7265 6174         cls.creat
+000071f0: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
+00007200: 2020 2020 2020 2073 7562 7363 7269 6265         subscribe
+00007210: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
+00007220: 2020 2020 2020 2069 6465 6d70 6f74 656e         idempoten
+00007230: 6379 5f6b 6579 3d69 6465 6d70 6f74 656e  cy_key=idempoten
+00007240: 6379 5f6b 6579 2c0a 2020 2020 2020 2020  cy_key,.        
+00007250: 2020 2020 2020 2020 2020 2020 7374 7269              stri
+00007260: 7065 5f61 6363 6f75 6e74 3d73 7472 6970  pe_account=strip
+00007270: 655f 6163 636f 756e 742c 0a20 2020 2020  e_account,.     
+00007280: 2020 2020 2020 2020 2020 2029 2c0a 2020             ),.  
+00007290: 2020 2020 2020 2020 2020 2020 2020 5472                Tr
+000072a0: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
+000072b0: 290a 0a20 2020 2040 636c 6173 736d 6574  )..    @classmet
+000072c0: 686f 640a 2020 2020 6465 6620 6372 6561  hod.    def crea
+000072d0: 7465 2863 6c73 2c20 7375 6273 6372 6962  te(cls, subscrib
+000072e0: 6572 2c20 6964 656d 706f 7465 6e63 795f  er, idempotency_
+000072f0: 6b65 793d 4e6f 6e65 2c20 7374 7269 7065  key=None, stripe
+00007300: 5f61 6363 6f75 6e74 3d4e 6f6e 6529 3a0a  _account=None):.
+00007310: 2020 2020 2020 2020 6d65 7461 6461 7461          metadata
+00007320: 203d 207b 7d0a 2020 2020 2020 2020 7375   = {}.        su
+00007330: 6273 6372 6962 6572 5f6b 6579 203d 2064  bscriber_key = d
+00007340: 6a73 7472 6970 655f 7365 7474 696e 6773  jstripe_settings
+00007350: 2e53 5542 5343 5249 4245 525f 4355 5354  .SUBSCRIBER_CUST
+00007360: 4f4d 4552 5f4b 4559 0a20 2020 2020 2020  OMER_KEY.       
+00007370: 2069 6620 7375 6273 6372 6962 6572 5f6b   if subscriber_k
+00007380: 6579 206e 6f74 2069 6e20 2822 222c 204e  ey not in ("", N
+00007390: 6f6e 6529 3a0a 2020 2020 2020 2020 2020  one):.          
+000073a0: 2020 6d65 7461 6461 7461 5b73 7562 7363    metadata[subsc
+000073b0: 7269 6265 725f 6b65 795d 203d 2073 7562  riber_key] = sub
+000073c0: 7363 7269 6265 722e 706b 0a0a 2020 2020  scriber.pk..    
+000073d0: 2020 2020 7374 7269 7065 5f63 7573 746f      stripe_custo
+000073e0: 6d65 7220 3d20 636c 732e 5f61 7069 5f63  mer = cls._api_c
+000073f0: 7265 6174 6528 0a20 2020 2020 2020 2020  reate(.         
+00007400: 2020 2065 6d61 696c 3d73 7562 7363 7269     email=subscri
+00007410: 6265 722e 656d 6169 6c2c 0a20 2020 2020  ber.email,.     
+00007420: 2020 2020 2020 2069 6465 6d70 6f74 656e         idempoten
+00007430: 6379 5f6b 6579 3d69 6465 6d70 6f74 656e  cy_key=idempoten
+00007440: 6379 5f6b 6579 2c0a 2020 2020 2020 2020  cy_key,.        
+00007450: 2020 2020 6d65 7461 6461 7461 3d6d 6574      metadata=met
+00007460: 6164 6174 612c 0a20 2020 2020 2020 2020  adata,.         
+00007470: 2020 2073 7472 6970 655f 6163 636f 756e     stripe_accoun
+00007480: 743d 7374 7269 7065 5f61 6363 6f75 6e74  t=stripe_account
+00007490: 2c0a 2020 2020 2020 2020 290a 2020 2020  ,.        ).    
+000074a0: 2020 2020 6375 7374 6f6d 6572 2c20 6372      customer, cr
+000074b0: 6561 7465 6420 3d20 636c 732e 6f62 6a65  eated = cls.obje
+000074c0: 6374 732e 6765 745f 6f72 5f63 7265 6174  cts.get_or_creat
+000074d0: 6528 0a20 2020 2020 2020 2020 2020 2069  e(.            i
+000074e0: 643d 7374 7269 7065 5f63 7573 746f 6d65  d=stripe_custome
+000074f0: 725b 2269 6422 5d2c 0a20 2020 2020 2020  r["id"],.       
+00007500: 2020 2020 2064 6566 6175 6c74 733d 7b0a       defaults={.
+00007510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007520: 2273 7562 7363 7269 6265 7222 3a20 7375  "subscriber": su
+00007530: 6273 6372 6962 6572 2c0a 2020 2020 2020  bscriber,.      
+00007540: 2020 2020 2020 2020 2020 226c 6976 656d            "livem
+00007550: 6f64 6522 3a20 7374 7269 7065 5f63 7573  ode": stripe_cus
+00007560: 746f 6d65 725b 226c 6976 656d 6f64 6522  tomer["livemode"
+00007570: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+00007580: 2020 2022 6261 6c61 6e63 6522 3a20 7374     "balance": st
+00007590: 7269 7065 5f63 7573 746f 6d65 722e 6765  ripe_customer.ge
+000075a0: 7428 2262 616c 616e 6365 222c 2030 292c  t("balance", 0),
+000075b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000075c0: 2022 6465 6c69 6e71 7565 6e74 223a 2073   "delinquent": s
+000075d0: 7472 6970 655f 6375 7374 6f6d 6572 2e67  tripe_customer.g
+000075e0: 6574 2822 6465 6c69 6e71 7565 6e74 222c  et("delinquent",
+000075f0: 2046 616c 7365 292c 0a20 2020 2020 2020   False),.       
+00007600: 2020 2020 207d 2c0a 2020 2020 2020 2020       },.        
+00007610: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+00007620: 6e20 6375 7374 6f6d 6572 0a0a 2020 2020  n customer..    
+00007630: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
+00007640: 6620 6372 6564 6974 7328 7365 6c66 293a  f credits(self):
+00007650: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00007660: 2020 2020 2054 6865 2063 7573 746f 6d65       The custome
+00007670: 7220 6973 2063 6f6e 7369 6465 7265 6420  r is considered 
+00007680: 746f 2068 6176 6520 6372 6564 6974 7320  to have credits 
+00007690: 6966 2074 6865 6972 2062 616c 616e 6365  if their balance
+000076a0: 2069 7320 6265 6c6f 7720 302e 0a20 2020   is below 0..   
+000076b0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+000076c0: 2072 6574 7572 6e20 6162 7328 6d69 6e28   return abs(min(
+000076d0: 7365 6c66 2e62 616c 616e 6365 2c20 3029  self.balance, 0)
+000076e0: 290a 0a20 2020 2040 7072 6f70 6572 7479  )..    @property
+000076f0: 0a20 2020 2064 6566 2063 7573 746f 6d65  .    def custome
+00007700: 725f 7061 796d 656e 745f 6d65 7468 6f64  r_payment_method
+00007710: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
+00007720: 2022 2222 0a20 2020 2020 2020 2041 6e20   """.        An 
+00007730: 6974 6572 6162 6c65 206f 6620 616c 6c20  iterable of all 
+00007740: 6f66 2074 6865 2063 7573 746f 6d65 7227  of the customer'
+00007750: 7320 7061 796d 656e 7420 6d65 7468 6f64  s payment method
+00007760: 730a 2020 2020 2020 2020 2873 6f75 7263  s.        (sourc
+00007770: 6573 2c20 7468 656e 206c 6567 6163 7920  es, then legacy 
+00007780: 6361 7264 7329 0a20 2020 2020 2020 2022  cards).        "
+00007790: 2222 0a20 2020 2020 2020 2066 6f72 2073  "".        for s
+000077a0: 6f75 7263 6520 696e 2073 656c 662e 736f  ource in self.so
+000077b0: 7572 6365 732e 6974 6572 6174 6f72 2829  urces.iterator()
+000077c0: 3a0a 2020 2020 2020 2020 2020 2020 7969  :.            yi
+000077d0: 656c 6420 736f 7572 6365 0a0a 2020 2020  eld source..    
+000077e0: 2020 2020 666f 7220 6361 7264 2069 6e20      for card in 
+000077f0: 7365 6c66 2e6c 6567 6163 795f 6361 7264  self.legacy_card
+00007800: 732e 6974 6572 6174 6f72 2829 3a0a 2020  s.iterator():.  
+00007810: 2020 2020 2020 2020 2020 7969 656c 6420            yield 
+00007820: 6361 7264 0a0a 2020 2020 4070 726f 7065  card..    @prope
+00007830: 7274 790a 2020 2020 6465 6620 7065 6e64  rty.    def pend
+00007840: 696e 675f 6368 6172 6765 7328 7365 6c66  ing_charges(self
+00007850: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+00007860: 2020 2020 2020 2054 6865 2063 7573 746f         The custo
+00007870: 6d65 7220 6973 2063 6f6e 7369 6465 7265  mer is considere
+00007880: 6420 746f 2068 6176 6520 7065 6e64 696e  d to have pendin
+00007890: 6720 6368 6172 6765 7320 6966 2074 6865  g charges if the
+000078a0: 6972 2062 616c 616e 6365 2069 7320 6162  ir balance is ab
+000078b0: 6f76 6520 302e 0a20 2020 2020 2020 2022  ove 0..        "
+000078c0: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
+000078d0: 6e20 6d61 7828 7365 6c66 2e62 616c 616e  n max(self.balan
+000078e0: 6365 2c20 3029 0a0a 2020 2020 6465 6620  ce, 0)..    def 
+000078f0: 7375 6273 6372 6962 6528 7365 6c66 2c20  subscribe(self, 
+00007900: 2a2c 2069 7465 6d73 3d4e 6f6e 652c 2070  *, items=None, p
+00007910: 7269 6365 3d4e 6f6e 652c 2070 6c61 6e3d  rice=None, plan=
+00007920: 4e6f 6e65 2c20 2a2a 6b77 6172 6773 293a  None, **kwargs):
+00007930: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00007940: 2020 2020 2053 7562 7363 7269 6265 7320       Subscribes 
+00007950: 7468 6973 2063 7573 746f 6d65 7220 746f  this customer to
+00007960: 2061 6c6c 2074 6865 2070 7269 6365 7320   all the prices 
+00007970: 6f72 2070 6c61 6e73 2069 6e20 7468 6520  or plans in the 
+00007980: 6974 656d 7320 6469 6374 2028 5265 636f  items dict (Reco
+00007990: 6d6d 656e 6465 6429 2e0a 0a20 2020 2020  mmended)...     
+000079a0: 2020 203a 7061 7261 6d20 6974 656d 733a     :param items:
+000079b0: 2041 206c 6973 7420 6f66 2075 7020 746f   A list of up to
+000079c0: 2032 3020 7375 6273 6372 6970 7469 6f6e   20 subscription
+000079d0: 2069 7465 6d73 2c20 6561 6368 2077 6974   items, each wit
+000079e0: 6820 616e 2061 7474 6163 6865 6420 7072  h an attached pr
+000079f0: 6963 650a 2020 2020 2020 2020 3a74 7970  ice.        :typ
+00007a00: 6520 6c69 7374 3a0a 2020 2020 2020 2020  e list:.        
+00007a10: 2020 2020 3a70 6172 616d 2069 7465 6d73      :param items
+00007a20: 3a20 4120 6469 6374 696f 6e61 7279 206f  : A dictionary o
+00007a30: 6620 506c 616e 2028 6f72 2050 6c61 6e20  f Plan (or Plan 
+00007a40: 4944 2920 6f72 2050 7269 6365 2028 6f72  ID) or Price (or
+00007a50: 2050 7269 6365 2049 4429 0a20 2020 2020   Price ID).     
+00007a60: 2020 2020 2020 203a 7479 7065 2064 6963         :type dic
+00007a70: 743a 2020 5468 6520 7072 6963 6520 6f72  t:  The price or
+00007a80: 2070 6c61 6e20 746f 2077 6869 6368 2074   plan to which t
+00007a90: 6f20 7375 6273 6372 6962 6520 7468 6520  o subscribe the 
+00007aa0: 6375 7374 6f6d 6572 2e0a 0a20 2020 2020  customer...     
+00007ab0: 2020 203a 7061 7261 6d20 7072 6963 653a     :param price:
+00007ac0: 2054 6865 2070 7269 6365 2074 6f20 7768   The price to wh
+00007ad0: 6963 6820 746f 2073 7562 7363 7269 6265  ich to subscribe
+00007ae0: 2074 6865 2063 7573 746f 6d65 722e 0a20   the customer.. 
+00007af0: 2020 2020 2020 203a 7479 7065 2070 7269         :type pri
+00007b00: 6365 3a20 5072 6963 6520 6f72 2073 7472  ce: Price or str
+00007b10: 696e 6720 2870 7269 6365 2049 4429 0a0a  ing (price ID)..
+00007b20: 2020 2020 2020 2020 3a70 6172 616d 2070          :param p
+00007b30: 6c61 6e3a 2054 6865 2070 6c61 6e20 746f  lan: The plan to
+00007b40: 2077 6869 6368 2074 6f20 7375 6273 6372   which to subscr
+00007b50: 6962 6520 7468 6520 6375 7374 6f6d 6572  ibe the customer
+00007b60: 2e0a 2020 2020 2020 2020 3a74 7970 6520  ..        :type 
+00007b70: 706c 616e 3a20 506c 616e 206f 7220 7374  plan: Plan or st
+00007b80: 7269 6e67 2028 706c 616e 2049 4429 0a20  ring (plan ID). 
+00007b90: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00007ba0: 2020 2066 726f 6d20 2e62 696c 6c69 6e67     from .billing
+00007bb0: 2069 6d70 6f72 7420 5375 6273 6372 6970   import Subscrip
+00007bc0: 7469 6f6e 0a0a 2020 2020 2020 2020 6966  tion..        if
+00007bd0: 2028 6974 656d 7320 616e 6420 7072 6963   (items and pric
+00007be0: 6529 206f 7220 2869 7465 6d73 2061 6e64  e) or (items and
+00007bf0: 2070 6c61 6e29 206f 7220 2870 7269 6365   plan) or (price
+00007c00: 2061 6e64 2070 6c61 6e29 3a0a 2020 2020   and plan):.    
+00007c10: 2020 2020 2020 2020 7261 6973 6520 5479          raise Ty
+00007c20: 7065 4572 726f 7228 2250 6c65 6173 6520  peError("Please 
+00007c30: 6465 6669 6e65 206f 6e6c 7920 6f6e 6520  define only one 
+00007c40: 6f66 2069 7465 6d73 2c20 7072 6963 6520  of items, price 
+00007c50: 6f72 2070 6c61 6e20 6172 6775 6d65 6e74  or plan argument
+00007c60: 732e 2229 0a0a 2020 2020 2020 2020 6966  s.")..        if
+00007c70: 2069 7465 6d73 2069 7320 4e6f 6e65 3a0a   items is None:.
+00007c80: 2020 2020 2020 2020 2020 2020 5f69 7465              _ite
+00007c90: 6d73 203d 205b 7b22 7072 6963 6522 3a20  ms = [{"price": 
+00007ca0: 7072 6963 657d 5d0a 2020 2020 2020 2020  price}].        
+00007cb0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00007cc0: 2020 5f69 7465 6d73 203d 205b 5d0a 2020    _items = [].  
+00007cd0: 2020 2020 2020 2020 2020 666f 7220 6974            for it
+00007ce0: 656d 2069 6e20 6974 656d 733a 0a20 2020  em in items:.   
+00007cf0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+00007d00: 6365 203d 2069 7465 6d2e 6765 7428 2270  ce = item.get("p
+00007d10: 7269 6365 222c 2022 2229 0a20 2020 2020  rice", "").     
+00007d20: 2020 2020 2020 2020 2020 2070 6c61 6e20             plan 
+00007d30: 3d20 6974 656d 2e67 6574 2822 706c 616e  = item.get("plan
+00007d40: 222c 2022 2229 0a20 2020 2020 2020 2020  ", "").         
+00007d50: 2020 2020 2020 2070 7269 6365 2c20 6b77         price, kw
+00007d60: 6172 6773 203d 205f 7361 6e69 7469 7365  args = _sanitise
+00007d70: 5f70 7269 6365 2870 7269 6365 2c20 706c  _price(price, pl
+00007d80: 616e 2c20 2a2a 6b77 6172 6773 290a 2020  an, **kwargs).  
+00007d90: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00007da0: 2022 7072 6963 6522 2069 6e20 6974 656d   "price" in item
+00007db0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00007dc0: 2020 2020 2020 5f69 7465 6d73 2e61 7070        _items.app
+00007dd0: 656e 6428 7b22 7072 6963 6522 3a20 7072  end({"price": pr
+00007de0: 6963 657d 290a 2020 2020 2020 2020 2020  ice}).          
+00007df0: 2020 2020 2020 6966 2022 706c 616e 2220        if "plan" 
+00007e00: 696e 2069 7465 6d3a 0a20 2020 2020 2020  in item:.       
+00007e10: 2020 2020 2020 2020 2020 2020 205f 6974               _it
+00007e20: 656d 732e 6170 7065 6e64 287b 2270 6c61  ems.append({"pla
+00007e30: 6e22 3a20 7072 6963 657d 290a 0a20 2020  n": price})..   
+00007e40: 2020 2020 2073 7472 6970 655f 7375 6273       stripe_subs
+00007e50: 6372 6970 7469 6f6e 203d 2053 7562 7363  cription = Subsc
+00007e60: 7269 7074 696f 6e2e 5f61 7069 5f63 7265  ription._api_cre
+00007e70: 6174 6528 0a20 2020 2020 2020 2020 2020  ate(.           
+00007e80: 2069 7465 6d73 3d5f 6974 656d 732c 2063   items=_items, c
+00007e90: 7573 746f 6d65 723d 7365 6c66 2e69 642c  ustomer=self.id,
+00007ea0: 202a 2a6b 7761 7267 730a 2020 2020 2020   **kwargs.      
+00007eb0: 2020 290a 0a20 2020 2020 2020 2061 7069    )..        api
+00007ec0: 5f6b 6579 203d 206b 7761 7267 732e 6765  _key = kwargs.ge
+00007ed0: 7428 2261 7069 5f6b 6579 2229 206f 7220  t("api_key") or 
+00007ee0: 7365 6c66 2e64 6566 6175 6c74 5f61 7069  self.default_api
+00007ef0: 5f6b 6579 0a20 2020 2020 2020 2072 6574  _key.        ret
+00007f00: 7572 6e20 5375 6273 6372 6970 7469 6f6e  urn Subscription
+00007f10: 2e73 796e 635f 6672 6f6d 5f73 7472 6970  .sync_from_strip
+00007f20: 655f 6461 7461 2873 7472 6970 655f 7375  e_data(stripe_su
+00007f30: 6273 6372 6970 7469 6f6e 2c20 6170 695f  bscription, api_
+00007f40: 6b65 793d 6170 695f 6b65 7929 0a0a 2020  key=api_key)..  
+00007f50: 2020 6465 6620 6368 6172 6765 280a 2020    def charge(.  
+00007f60: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+00007f70: 2020 2020 616d 6f75 6e74 3a20 4465 6369      amount: Deci
+00007f80: 6d61 6c2c 0a20 2020 2020 2020 202a 2c0a  mal,.        *,.
+00007f90: 2020 2020 2020 2020 6170 706c 6963 6174          applicat
+00007fa0: 696f 6e5f 6665 653a 2044 6563 696d 616c  ion_fee: Decimal
+00007fb0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+00007fc0: 2073 6f75 7263 653a 2055 6e69 6f6e 5b73   source: Union[s
+00007fd0: 7472 2c20 5374 7269 7065 4d6f 6465 6c5d  tr, StripeModel]
+00007fe0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+00007ff0: 202a 2a6b 7761 7267 732c 0a20 2020 2029   **kwargs,.    )
+00008000: 202d 3e20 4368 6172 6765 3a0a 2020 2020   -> Charge:.    
+00008010: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00008020: 4372 6561 7465 7320 6120 6368 6172 6765  Creates a charge
+00008030: 2066 6f72 2074 6869 7320 6375 7374 6f6d   for this custom
+00008040: 6572 2e0a 0a20 2020 2020 2020 203a 7061  er...        :pa
+00008050: 7261 6d20 616d 6f75 6e74 3a20 5468 6520  ram amount: The 
+00008060: 616d 6f75 6e74 2074 6f20 6368 6172 6765  amount to charge
+00008070: 2e0a 2020 2020 2020 2020 3a74 7970 6520  ..        :type 
+00008080: 616d 6f75 6e74 3a20 4465 6369 6d61 6c2e  amount: Decimal.
+00008090: 2050 7265 6369 7369 6f6e 2069 7320 323b   Precision is 2;
+000080a0: 2061 6e79 7468 696e 6720 6d6f 7265 2077   anything more w
+000080b0: 696c 6c20 6265 2069 676e 6f72 6564 2e0a  ill be ignored..
+000080c0: 2020 2020 2020 2020 3a70 6172 616d 2073          :param s
+000080d0: 6f75 7263 653a 2054 6865 2073 6f75 7263  ource: The sourc
+000080e0: 6520 746f 2075 7365 2066 6f72 2074 6869  e to use for thi
+000080f0: 7320 6368 6172 6765 2e0a 2020 2020 2020  s charge..      
+00008100: 2020 2020 2020 4d75 7374 2062 6520 6120        Must be a 
+00008110: 736f 7572 6365 2061 7474 7269 6275 7465  source attribute
+00008120: 6420 746f 2074 6869 7320 6375 7374 6f6d  d to this custom
+00008130: 6572 2e20 4966 204e 6f6e 652c 2074 6865  er. If None, the
+00008140: 2063 7573 746f 6d65 7227 730a 2020 2020   customer's.    
+00008150: 2020 2020 2020 2020 6465 6661 756c 7420          default 
+00008160: 736f 7572 6365 2069 7320 7573 6564 2e20  source is used. 
+00008170: 4361 6e20 6265 2065 6974 6865 7220 7468  Can be either th
+00008180: 6520 6964 206f 6620 7468 6520 736f 7572  e id of the sour
+00008190: 6365 206f 720a 2020 2020 2020 2020 2020  ce or.          
+000081a0: 2020 7468 6520 736f 7572 6365 206f 626a    the source obj
+000081b0: 6563 7420 6974 7365 6c66 2e0a 2020 2020  ect itself..    
+000081c0: 2020 2020 3a74 7970 6520 736f 7572 6365      :type source
+000081d0: 3a20 7374 7269 6e67 2c20 536f 7572 6365  : string, Source
+000081e0: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
+000081f0: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
+00008200: 6e73 7461 6e63 6528 616d 6f75 6e74 2c20  nstance(amount, 
+00008210: 4465 6369 6d61 6c29 3a0a 2020 2020 2020  Decimal):.      
+00008220: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00008230: 6545 7272 6f72 2822 596f 7520 6d75 7374  eError("You must
+00008240: 2073 7570 706c 7920 6120 6465 6369 6d61   supply a decima
+00008250: 6c20 7661 6c75 6520 7265 7072 6573 656e  l value represen
+00008260: 7469 6e67 2064 6f6c 6c61 7273 2e22 290a  ting dollars.").
+00008270: 0a20 2020 2020 2020 2023 2043 6f6e 7665  .        # Conve
+00008280: 7274 2053 6f75 7263 6520 746f 2069 640a  rt Source to id.
+00008290: 2020 2020 2020 2020 6966 2073 6f75 7263          if sourc
+000082a0: 6520 616e 6420 6973 696e 7374 616e 6365  e and isinstance
+000082b0: 2873 6f75 7263 652c 2053 7472 6970 654d  (source, StripeM
+000082c0: 6f64 656c 293a 0a20 2020 2020 2020 2020  odel):.         
+000082d0: 2020 2073 6f75 7263 6520 3d20 736f 7572     source = sour
+000082e0: 6365 2e69 640a 0a20 2020 2020 2020 2073  ce.id..        s
+000082f0: 7472 6970 655f 6368 6172 6765 203d 2043  tripe_charge = C
+00008300: 6861 7267 652e 5f61 7069 5f63 7265 6174  harge._api_creat
+00008310: 6528 0a20 2020 2020 2020 2020 2020 2063  e(.            c
+00008320: 7573 746f 6d65 723d 7365 6c66 2e69 642c  ustomer=self.id,
+00008330: 0a20 2020 2020 2020 2020 2020 2061 6d6f  .            amo
+00008340: 756e 743d 696e 7428 616d 6f75 6e74 202a  unt=int(amount *
+00008350: 2031 3030 292c 2020 2320 436f 6e76 6572   100),  # Conver
+00008360: 7420 646f 6c6c 6172 7320 696e 746f 2063  t dollars into c
+00008370: 656e 7473 0a20 2020 2020 2020 2020 2020  ents.           
+00008380: 2061 7070 6c69 6361 7469 6f6e 5f66 6565   application_fee
+00008390: 3d28 0a20 2020 2020 2020 2020 2020 2020  =(.             
+000083a0: 2020 2069 6e74 2861 7070 6c69 6361 7469     int(applicati
+000083b0: 6f6e 5f66 6565 202a 2031 3030 2920 6966  on_fee * 100) if
+000083c0: 2061 7070 6c69 6361 7469 6f6e 5f66 6565   application_fee
+000083d0: 2065 6c73 6520 4e6f 6e65 0a20 2020 2020   else None.     
+000083e0: 2020 2020 2020 2029 2c20 2023 2043 6f6e         ),  # Con
+000083f0: 7665 7274 2064 6f6c 6c61 7273 2069 6e74  vert dollars int
+00008400: 6f20 6365 6e74 730a 2020 2020 2020 2020  o cents.        
+00008410: 2020 2020 736f 7572 6365 3d73 6f75 7263      source=sourc
+00008420: 652c 0a20 2020 2020 2020 2020 2020 202a  e,.            *
+00008430: 2a6b 7761 7267 732c 0a20 2020 2020 2020  *kwargs,.       
+00008440: 2029 0a0a 2020 2020 2020 2020 6170 695f   )..        api_
+00008450: 6b65 7920 3d20 6b77 6172 6773 2e67 6574  key = kwargs.get
+00008460: 2822 6170 695f 6b65 7922 2920 6f72 2073  ("api_key") or s
+00008470: 656c 662e 6465 6661 756c 745f 6170 695f  elf.default_api_
+00008480: 6b65 790a 2020 2020 2020 2020 7265 7475  key.        retu
+00008490: 726e 2043 6861 7267 652e 7379 6e63 5f66  rn Charge.sync_f
+000084a0: 726f 6d5f 7374 7269 7065 5f64 6174 6128  rom_stripe_data(
+000084b0: 7374 7269 7065 5f63 6861 7267 652c 2061  stripe_charge, a
+000084c0: 7069 5f6b 6579 3d61 7069 5f6b 6579 290a  pi_key=api_key).
+000084d0: 0a20 2020 2064 6566 2061 6464 5f69 6e76  .    def add_inv
+000084e0: 6f69 6365 5f69 7465 6d28 0a20 2020 2020  oice_item(.     
+000084f0: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
+00008500: 2061 6d6f 756e 742c 0a20 2020 2020 2020   amount,.       
+00008510: 2063 7572 7265 6e63 792c 0a20 2020 2020   currency,.     
+00008520: 2020 2064 6573 6372 6970 7469 6f6e 3d4e     description=N
+00008530: 6f6e 652c 0a20 2020 2020 2020 2064 6973  one,.        dis
+00008540: 636f 756e 7461 626c 653d 4e6f 6e65 2c0a  countable=None,.
+00008550: 2020 2020 2020 2020 696e 766f 6963 653d          invoice=
+00008560: 4e6f 6e65 2c0a 2020 2020 2020 2020 6d65  None,.        me
+00008570: 7461 6461 7461 3d4e 6f6e 652c 0a20 2020  tadata=None,.   
+00008580: 2020 2020 2073 7562 7363 7269 7074 696f       subscriptio
+00008590: 6e3d 4e6f 6e65 2c0a 2020 2020 293a 0a20  n=None,.    ):. 
+000085a0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000085b0: 2020 2041 6464 7320 616e 2061 7262 6974     Adds an arbit
+000085c0: 7261 7279 2063 6861 7267 6520 6f72 2063  rary charge or c
+000085d0: 7265 6469 7420 746f 2074 6865 2063 7573  redit to the cus
+000085e0: 746f 6d65 7227 7320 7570 636f 6d69 6e67  tomer's upcoming
+000085f0: 2069 6e76 6f69 6365 2e0a 2020 2020 2020   invoice..      
+00008600: 2020 4469 6666 6572 656e 7420 7468 616e    Different than
+00008610: 2063 7265 6174 696e 6720 6120 6368 6172   creating a char
+00008620: 6765 2e20 4368 6172 6765 7320 6172 6520  ge. Charges are 
+00008630: 7365 7061 7261 7465 2062 696c 6c73 2074  separate bills t
+00008640: 6861 7420 6765 740a 2020 2020 2020 2020  hat get.        
+00008650: 7072 6f63 6573 7365 6420 696d 6d65 6469  processed immedi
+00008660: 6174 656c 792e 2049 6e76 6f69 6365 2069  ately. Invoice i
+00008670: 7465 6d73 2061 7265 2061 7070 656e 6465  tems are appende
+00008680: 6420 746f 2074 6865 2063 7573 746f 6d65  d to the custome
+00008690: 7227 7320 6e65 7874 0a20 2020 2020 2020  r's next.       
+000086a0: 2069 6e76 6f69 6365 2e20 5468 6973 2069   invoice. This i
+000086b0: 7320 6578 7472 656d 656c 7920 7573 6566  s extremely usef
+000086c0: 756c 2077 6865 6e20 6164 6469 6e67 2073  ul when adding s
+000086d0: 7572 6368 6172 6765 7320 746f 2073 7562  urcharges to sub
+000086e0: 7363 7269 7074 696f 6e73 2e0a 0a20 2020  scriptions...   
+000086f0: 2020 2020 203a 7061 7261 6d20 616d 6f75       :param amou
+00008700: 6e74 3a20 5468 6520 616d 6f75 6e74 2074  nt: The amount t
+00008710: 6f20 6368 6172 6765 2e0a 2020 2020 2020  o charge..      
+00008720: 2020 3a74 7970 6520 616d 6f75 6e74 3a20    :type amount: 
+00008730: 4465 6369 6d61 6c2e 2050 7265 6369 7369  Decimal. Precisi
+00008740: 6f6e 2069 7320 323b 2061 6e79 7468 696e  on is 2; anythin
+00008750: 6720 6d6f 7265 2077 696c 6c20 6265 2069  g more will be i
+00008760: 676e 6f72 6564 2e0a 2020 2020 2020 2020  gnored..        
+00008770: 3a70 6172 616d 2063 7572 7265 6e63 793a  :param currency:
+00008780: 2033 2d6c 6574 7465 7220 4953 4f20 636f   3-letter ISO co
+00008790: 6465 2066 6f72 2063 7572 7265 6e63 790a  de for currency.
+000087a0: 2020 2020 2020 2020 3a74 7970 6520 6375          :type cu
+000087b0: 7272 656e 6379 3a20 7374 7269 6e67 0a20  rrency: string. 
+000087c0: 2020 2020 2020 203a 7061 7261 6d20 6465         :param de
+000087d0: 7363 7269 7074 696f 6e3a 2041 6e20 6172  scription: An ar
+000087e0: 6269 7472 6172 7920 7374 7269 6e67 2e0a  bitrary string..
+000087f0: 2020 2020 2020 2020 3a74 7970 6520 6465          :type de
+00008800: 7363 7269 7074 696f 6e3a 2073 7472 696e  scription: strin
+00008810: 670a 2020 2020 2020 2020 3a70 6172 616d  g.        :param
+00008820: 2064 6973 636f 756e 7461 626c 653a 2043   discountable: C
+00008830: 6f6e 7472 6f6c 7320 7768 6574 6865 7220  ontrols whether 
+00008840: 6469 7363 6f75 6e74 7320 6170 706c 7920  discounts apply 
+00008850: 746f 2074 6869 7320 696e 766f 6963 6520  to this invoice 
+00008860: 6974 656d 2e0a 2020 2020 2020 2020 2020  item..          
+00008870: 2020 4465 6661 756c 7473 2074 6f20 4661    Defaults to Fa
+00008880: 6c73 6520 666f 7220 7072 6f72 6174 696f  lse for proratio
+00008890: 6e73 206f 7220 6e65 6761 7469 7665 2069  ns or negative i
+000088a0: 6e76 6f69 6365 2069 7465 6d73 2c0a 2020  nvoice items,.  
+000088b0: 2020 2020 2020 2020 2020 616e 6420 5472            and Tr
+000088c0: 7565 2066 6f72 2061 6c6c 206f 7468 6572  ue for all other
+000088d0: 2069 6e76 6f69 6365 2069 7465 6d73 2e0a   invoice items..
+000088e0: 2020 2020 2020 2020 3a74 7970 6520 6469          :type di
+000088f0: 7363 6f75 6e74 6162 6c65 3a20 626f 6f6c  scountable: bool
+00008900: 6561 6e0a 2020 2020 2020 2020 3a70 6172  ean.        :par
+00008910: 616d 2069 6e76 6f69 6365 3a20 416e 2065  am invoice: An e
+00008920: 7869 7374 696e 6720 696e 766f 6963 6520  xisting invoice 
+00008930: 746f 2061 6464 2074 6869 7320 696e 766f  to add this invo
+00008940: 6963 6520 6974 656d 2074 6f2e 0a20 2020  ice item to..   
+00008950: 2020 2020 2020 2020 2057 6865 6e20 6c65           When le
+00008960: 6674 2062 6c61 6e6b 2c20 7468 6520 696e  ft blank, the in
+00008970: 766f 6963 6520 6974 656d 2077 696c 6c20  voice item will 
+00008980: 6265 2061 6464 6564 2074 6f20 7468 6520  be added to the 
+00008990: 6e65 7874 2075 7063 6f6d 696e 6720 5c0a  next upcoming \.
+000089a0: 2020 2020 2020 2020 2020 2020 2073 6368               sch
+000089b0: 6564 756c 6564 2069 6e76 6f69 6365 2e20  eduled invoice. 
+000089c0: 5c0a 2020 2020 2020 2020 2020 2020 2055  \.             U
+000089d0: 7365 2074 6869 7320 7768 656e 2061 6464  se this when add
+000089e0: 696e 6720 696e 766f 6963 6520 6974 656d  ing invoice item
+000089f0: 7320 696e 2072 6573 706f 6e73 6520 746f  s in response to
+00008a00: 2061 6e20 5c0a 2020 2020 2020 2020 2020   an \.          
+00008a10: 2020 2060 6069 6e76 6f69 6365 2e63 7265     ``invoice.cre
+00008a20: 6174 6564 6060 2077 6562 686f 6f6b 2e20  ated`` webhook. 
+00008a30: 596f 7520 6361 6e6e 6f74 2061 6464 2061  You cannot add a
+00008a40: 6e20 696e 766f 6963 6520 5c0a 2020 2020  n invoice \.    
+00008a50: 2020 2020 2020 2020 6974 656d 2074 6f20          item to 
+00008a60: 616e 2069 6e76 6f69 6365 2074 6861 7420  an invoice that 
+00008a70: 6861 7320 616c 7265 6164 7920 6265 656e  has already been
+00008a80: 2070 6169 642c 2061 7474 656d 7074 6564   paid, attempted
+00008a90: 206f 7220 636c 6f73 6564 2e0a 2020 2020   or closed..    
+00008aa0: 2020 2020 3a74 7970 6520 696e 766f 6963      :type invoic
+00008ab0: 653a 2049 6e76 6f69 6365 206f 7220 7374  e: Invoice or st
+00008ac0: 7269 6e67 2028 696e 766f 6963 6520 4944  ring (invoice ID
+00008ad0: 290a 2020 2020 2020 2020 3a70 6172 616d  ).        :param
+00008ae0: 206d 6574 6164 6174 613a 2041 2073 6574   metadata: A set
+00008af0: 206f 6620 6b65 792f 7661 6c75 6520 7061   of key/value pa
+00008b00: 6972 7320 7573 6566 756c 2066 6f72 2073  irs useful for s
+00008b10: 746f 7269 6e67 0a20 2020 2020 2020 2020  toring.         
+00008b20: 2020 2061 6464 6974 696f 6e61 6c20 696e     additional in
+00008b30: 666f 726d 6174 696f 6e2e 0a20 2020 2020  formation..     
+00008b40: 2020 203a 7479 7065 206d 6574 6164 6174     :type metadat
+00008b50: 613a 2064 6963 740a 2020 2020 2020 2020  a: dict.        
+00008b60: 3a70 6172 616d 2073 7562 7363 7269 7074  :param subscript
+00008b70: 696f 6e3a 2041 2073 7562 7363 7269 7074  ion: A subscript
+00008b80: 696f 6e20 746f 2061 6464 2074 6869 7320  ion to add this 
+00008b90: 696e 766f 6963 6520 6974 656d 2074 6f2e  invoice item to.
+00008ba0: 0a20 2020 2020 2020 2020 2020 2057 6865  .            Whe
+00008bb0: 6e20 6c65 6674 2062 6c61 6e6b 2c20 7468  n left blank, th
+00008bc0: 6520 696e 766f 6963 6520 6974 656d 2077  e invoice item w
+00008bd0: 696c 6c20 6265 2062 6520 6164 6465 6420  ill be be added 
+00008be0: 746f 2074 6865 206e 6578 7420 7570 636f  to the next upco
+00008bf0: 6d69 6e67 205c 0a20 2020 2020 2020 2020  ming \.         
+00008c00: 2020 2073 6368 6564 756c 6564 2069 6e76     scheduled inv
+00008c10: 6f69 6365 2e20 5768 656e 2073 6574 2c20  oice. When set, 
+00008c20: 7363 6865 6475 6c65 6420 696e 766f 6963  scheduled invoic
+00008c30: 6573 2066 6f72 2073 7562 7363 7269 7074  es for subscript
+00008c40: 696f 6e73 206f 7468 6572 205c 0a20 2020  ions other \.   
+00008c50: 2020 2020 2020 2020 2074 6861 6e20 7468           than th
+00008c60: 6520 7370 6563 6966 6965 6420 7375 6273  e specified subs
+00008c70: 6372 6970 7469 6f6e 2077 696c 6c20 6967  cription will ig
+00008c80: 6e6f 7265 2074 6865 2069 6e76 6f69 6365  nore the invoice
+00008c90: 2069 7465 6d2e 205c 0a20 2020 2020 2020   item. \.       
+00008ca0: 2020 2020 2055 7365 2074 6869 7320 7768       Use this wh
+00008cb0: 656e 2079 6f75 2077 616e 7420 746f 2065  en you want to e
+00008cc0: 7870 7265 7373 2074 6861 7420 616e 2069  xpress that an i
+00008cd0: 6e76 6f69 6365 2069 7465 6d20 6861 7320  nvoice item has 
+00008ce0: 6265 656e 2061 6363 7275 6564 205c 0a20  been accrued \. 
+00008cf0: 2020 2020 2020 2020 2020 2077 6974 6869             withi
+00008d00: 6e20 7468 6520 636f 6e74 6578 7420 6f66  n the context of
+00008d10: 2061 2070 6172 7469 6375 6c61 7220 7375   a particular su
+00008d20: 6273 6372 6970 7469 6f6e 2e0a 2020 2020  bscription..    
+00008d30: 2020 2020 3a74 7970 6520 7375 6273 6372      :type subscr
+00008d40: 6970 7469 6f6e 3a20 5375 6273 6372 6970  iption: Subscrip
+00008d50: 7469 6f6e 206f 7220 7374 7269 6e67 2028  tion or string (
+00008d60: 7375 6273 6372 6970 7469 6f6e 2049 4429  subscription ID)
+00008d70: 0a0a 2020 2020 2020 2020 2e2e 204e 6f74  ..        .. Not
+00008d80: 6573 3a0a 2020 2020 2020 2020 2e2e 2069  es:.        .. i
+00008d90: 6620 796f 7527 7265 2075 7369 6e67 2060  f you're using `
+00008da0: 6043 7573 746f 6d65 722e 6164 645f 696e  `Customer.add_in
+00008db0: 766f 6963 655f 6974 656d 2829 6060 2069  voice_item()`` i
+00008dc0: 6e73 7465 6164 206f 660a 2020 2020 2020  nstead of.      
+00008dd0: 2020 2e2e 2060 6043 7573 746f 6d65 722e    .. ``Customer.
+00008de0: 6164 645f 696e 766f 6963 655f 6974 656d  add_invoice_item
+00008df0: 2829 6060 2c20 6060 696e 766f 6963 6560  ()``, ``invoice`
+00008e00: 6020 616e 6420 6060 7375 6273 6372 6970  ` and ``subscrip
+00008e10: 7469 6f6e 7360 600a 2020 2020 2020 2020  tions``.        
+00008e20: 2e2e 2063 616e 206f 6e6c 7920 6265 2073  .. can only be s
+00008e30: 7472 696e 6773 0a20 2020 2020 2020 2022  trings.        "
+00008e40: 2222 0a20 2020 2020 2020 2066 726f 6d20  "".        from 
+00008e50: 2e62 696c 6c69 6e67 2069 6d70 6f72 7420  .billing import 
+00008e60: 496e 766f 6963 6549 7465 6d0a 0a20 2020  InvoiceItem..   
+00008e70: 2020 2020 2069 6620 6e6f 7420 6973 696e       if not isin
+00008e80: 7374 616e 6365 2861 6d6f 756e 742c 2044  stance(amount, D
+00008e90: 6563 696d 616c 293a 0a20 2020 2020 2020  ecimal):.       
+00008ea0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00008eb0: 4572 726f 7228 2259 6f75 206d 7573 7420  Error("You must 
+00008ec0: 7375 7070 6c79 2061 2064 6563 696d 616c  supply a decimal
+00008ed0: 2076 616c 7565 2072 6570 7265 7365 6e74   value represent
+00008ee0: 696e 6720 646f 6c6c 6172 732e 2229 0a0a  ing dollars.")..
+00008ef0: 2020 2020 2020 2020 2320 436f 6e76 6572          # Conver
+00008f00: 7420 496e 766f 6963 6520 746f 2069 640a  t Invoice to id.
+00008f10: 2020 2020 2020 2020 6966 2069 6e76 6f69          if invoi
+00008f20: 6365 2069 7320 6e6f 7420 4e6f 6e65 2061  ce is not None a
+00008f30: 6e64 2069 7369 6e73 7461 6e63 6528 696e  nd isinstance(in
+00008f40: 766f 6963 652c 2053 7472 6970 654d 6f64  voice, StripeMod
+00008f50: 656c 293a 0a20 2020 2020 2020 2020 2020  el):.           
+00008f60: 2069 6e76 6f69 6365 203d 2069 6e76 6f69   invoice = invoi
+00008f70: 6365 2e69 640a 0a20 2020 2020 2020 2023  ce.id..        #
+00008f80: 2043 6f6e 7665 7274 2053 7562 7363 7269   Convert Subscri
+00008f90: 7074 696f 6e20 746f 2069 640a 2020 2020  ption to id.    
+00008fa0: 2020 2020 6966 2073 7562 7363 7269 7074      if subscript
+00008fb0: 696f 6e20 6973 206e 6f74 204e 6f6e 6520  ion is not None 
+00008fc0: 616e 6420 6973 696e 7374 616e 6365 2873  and isinstance(s
+00008fd0: 7562 7363 7269 7074 696f 6e2c 2053 7472  ubscription, Str
+00008fe0: 6970 654d 6f64 656c 293a 0a20 2020 2020  ipeModel):.     
+00008ff0: 2020 2020 2020 2073 7562 7363 7269 7074         subscript
+00009000: 696f 6e20 3d20 7375 6273 6372 6970 7469  ion = subscripti
+00009010: 6f6e 2e69 640a 0a20 2020 2020 2020 2073  on.id..        s
+00009020: 7472 6970 655f 696e 766f 6963 6569 7465  tripe_invoiceite
+00009030: 6d20 3d20 496e 766f 6963 6549 7465 6d2e  m = InvoiceItem.
+00009040: 5f61 7069 5f63 7265 6174 6528 0a20 2020  _api_create(.   
+00009050: 2020 2020 2020 2020 2061 6d6f 756e 743d           amount=
+00009060: 696e 7428 616d 6f75 6e74 202a 2031 3030  int(amount * 100
+00009070: 292c 2020 2320 436f 6e76 6572 7420 646f  ),  # Convert do
+00009080: 6c6c 6172 7320 696e 746f 2063 656e 7473  llars into cents
+00009090: 0a20 2020 2020 2020 2020 2020 2063 7572  .            cur
+000090a0: 7265 6e63 793d 6375 7272 656e 6379 2c0a  rency=currency,.
+000090b0: 2020 2020 2020 2020 2020 2020 6375 7374              cust
+000090c0: 6f6d 6572 3d73 656c 662e 6964 2c0a 2020  omer=self.id,.  
+000090d0: 2020 2020 2020 2020 2020 6465 7363 7269            descri
+000090e0: 7074 696f 6e3d 6465 7363 7269 7074 696f  ption=descriptio
+000090f0: 6e2c 0a20 2020 2020 2020 2020 2020 2064  n,.            d
+00009100: 6973 636f 756e 7461 626c 653d 6469 7363  iscountable=disc
+00009110: 6f75 6e74 6162 6c65 2c0a 2020 2020 2020  ountable,.      
+00009120: 2020 2020 2020 696e 766f 6963 653d 696e        invoice=in
+00009130: 766f 6963 652c 0a20 2020 2020 2020 2020  voice,.         
+00009140: 2020 206d 6574 6164 6174 613d 6d65 7461     metadata=meta
+00009150: 6461 7461 2c0a 2020 2020 2020 2020 2020  data,.          
+00009160: 2020 7375 6273 6372 6970 7469 6f6e 3d73    subscription=s
+00009170: 7562 7363 7269 7074 696f 6e2c 0a20 2020  ubscription,.   
+00009180: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00009190: 7265 7475 726e 2049 6e76 6f69 6365 4974  return InvoiceIt
+000091a0: 656d 2e73 796e 635f 6672 6f6d 5f73 7472  em.sync_from_str
+000091b0: 6970 655f 6461 7461 280a 2020 2020 2020  ipe_data(.      
+000091c0: 2020 2020 2020 7374 7269 7065 5f69 6e76        stripe_inv
+000091d0: 6f69 6365 6974 656d 2c20 6170 695f 6b65  oiceitem, api_ke
+000091e0: 793d 7365 6c66 2e64 6566 6175 6c74 5f61  y=self.default_a
+000091f0: 7069 5f6b 6579 0a20 2020 2020 2020 2029  pi_key.        )
+00009200: 0a0a 2020 2020 6465 6620 6164 645f 6361  ..    def add_ca
+00009210: 7264 2873 656c 662c 2073 6f75 7263 652c  rd(self, source,
+00009220: 2073 6574 5f64 6566 6175 6c74 3d54 7275   set_default=Tru
+00009230: 6529 3a0a 2020 2020 2020 2020 2222 220a  e):.        """.
+00009240: 2020 2020 2020 2020 4164 6473 2061 2063          Adds a c
+00009250: 6172 6420 746f 2074 6869 7320 6375 7374  ard to this cust
+00009260: 6f6d 6572 2773 2061 6363 6f75 6e74 2e0a  omer's account..
+00009270: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00009280: 736f 7572 6365 3a20 4569 7468 6572 2061  source: Either a
+00009290: 2074 6f6b 656e 2c20 6c69 6b65 2074 6865   token, like the
+000092a0: 206f 6e65 7320 7265 7475 726e 6564 2062   ones returned b
+000092b0: 7920 6f75 7220 5374 7269 7065 2e6a 732c  y our Stripe.js,
+000092c0: 206f 7220 610a 2020 2020 2020 2020 2020   or a.          
+000092d0: 2020 6469 6374 696f 6e61 7279 2063 6f6e    dictionary con
+000092e0: 7461 696e 696e 6720 6120 7573 6572 2773  taining a user's
+000092f0: 2063 7265 6469 7420 6361 7264 2064 6574   credit card det
+00009300: 6169 6c73 2e0a 2020 2020 2020 2020 2020  ails..          
+00009310: 2020 5374 7269 7065 2077 696c 6c20 6175    Stripe will au
+00009320: 746f 6d61 7469 6361 6c6c 7920 7661 6c69  tomatically vali
+00009330: 6461 7465 2074 6865 2063 6172 642e 0a20  date the card.. 
+00009340: 2020 2020 2020 203a 7479 7065 2073 6f75         :type sou
+00009350: 7263 653a 2073 7472 696e 672c 2064 6963  rce: string, dic
+00009360: 740a 2020 2020 2020 2020 3a70 6172 616d  t.        :param
+00009370: 2073 6574 5f64 6566 6175 6c74 3a20 5768   set_default: Wh
+00009380: 6574 6865 7220 6f72 206e 6f74 2074 6f20  ether or not to 
+00009390: 7365 7420 7468 6520 736f 7572 6365 2061  set the source a
+000093a0: 7320 7468 6520 6375 7374 6f6d 6572 2773  s the customer's
+000093b0: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
+000093c0: 6175 6c74 2073 6f75 7263 650a 2020 2020  ault source.    
+000093d0: 2020 2020 3a74 7970 6520 7365 745f 6465      :type set_de
+000093e0: 6661 756c 743a 2062 6f6f 6c65 616e 0a0a  fault: boolean..
+000093f0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00009400: 2020 2020 6672 6f6d 202e 7061 796d 656e      from .paymen
+00009410: 745f 6d65 7468 6f64 7320 696d 706f 7274  t_methods import
+00009420: 2044 6a73 7472 6970 6550 6179 6d65 6e74   DjstripePayment
+00009430: 4d65 7468 6f64 0a0a 2020 2020 2020 2020  Method..        
+00009440: 7374 7269 7065 5f63 7573 746f 6d65 7220  stripe_customer 
+00009450: 3d20 7365 6c66 2e61 7069 5f72 6574 7269  = self.api_retri
+00009460: 6576 6528 290a 2020 2020 2020 2020 6e65  eve().        ne
+00009470: 775f 7374 7269 7065 5f70 6179 6d65 6e74  w_stripe_payment
+00009480: 5f6d 6574 686f 6420 3d20 7374 7269 7065  _method = stripe
+00009490: 5f63 7573 746f 6d65 722e 736f 7572 6365  _customer.source
+000094a0: 732e 6372 6561 7465 2873 6f75 7263 653d  s.create(source=
+000094b0: 736f 7572 6365 290a 0a20 2020 2020 2020  source)..       
+000094c0: 2069 6620 7365 745f 6465 6661 756c 743a   if set_default:
+000094d0: 0a20 2020 2020 2020 2020 2020 2073 7472  .            str
+000094e0: 6970 655f 6375 7374 6f6d 6572 2e64 6566  ipe_customer.def
+000094f0: 6175 6c74 5f73 6f75 7263 6520 3d20 6e65  ault_source = ne
+00009500: 775f 7374 7269 7065 5f70 6179 6d65 6e74  w_stripe_payment
+00009510: 5f6d 6574 686f 645b 2269 6422 5d0a 2020  _method["id"].  
+00009520: 2020 2020 2020 2020 2020 7374 7269 7065            stripe
+00009530: 5f63 7573 746f 6d65 722e 7361 7665 2829  _customer.save()
+00009540: 0a0a 2020 2020 2020 2020 6e65 775f 7061  ..        new_pa
+00009550: 796d 656e 745f 6d65 7468 6f64 203d 2044  yment_method = D
+00009560: 6a73 7472 6970 6550 6179 6d65 6e74 4d65  jstripePaymentMe
+00009570: 7468 6f64 2e66 726f 6d5f 7374 7269 7065  thod.from_stripe
+00009580: 5f6f 626a 6563 7428 0a20 2020 2020 2020  _object(.       
+00009590: 2020 2020 206e 6577 5f73 7472 6970 655f       new_stripe_
+000095a0: 7061 796d 656e 745f 6d65 7468 6f64 0a20  payment_method. 
+000095b0: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+000095c0: 2020 2320 4368 616e 6765 2074 6865 2064    # Change the d
+000095d0: 6566 6175 6c74 2073 6f75 7263 650a 2020  efault source.  
+000095e0: 2020 2020 2020 6966 2073 6574 5f64 6566        if set_def
+000095f0: 6175 6c74 3a0a 2020 2020 2020 2020 2020  ault:.          
+00009600: 2020 7365 6c66 2e64 6566 6175 6c74 5f73    self.default_s
+00009610: 6f75 7263 6520 3d20 6e65 775f 7061 796d  ource = new_paym
+00009620: 656e 745f 6d65 7468 6f64 0a20 2020 2020  ent_method.     
+00009630: 2020 2020 2020 2073 656c 662e 7361 7665         self.save
+00009640: 2829 0a0a 2020 2020 2020 2020 7265 7475  ()..        retu
+00009650: 726e 206e 6577 5f70 6179 6d65 6e74 5f6d  rn new_payment_m
+00009660: 6574 686f 642e 7265 736f 6c76 6528 290a  ethod.resolve().
+00009670: 0a20 2020 2064 6566 2061 6464 5f70 6179  .    def add_pay
+00009680: 6d65 6e74 5f6d 6574 686f 6428 7365 6c66  ment_method(self
+00009690: 2c20 7061 796d 656e 745f 6d65 7468 6f64  , payment_method
+000096a0: 2c20 7365 745f 6465 6661 756c 743d 5472  , set_default=Tr
+000096b0: 7565 293a 0a20 2020 2020 2020 2022 2222  ue):.        """
+000096c0: 0a20 2020 2020 2020 2041 6464 7320 616e  .        Adds an
+000096d0: 2061 6c72 6561 6479 2065 7869 7374 696e   already existin
+000096e0: 6720 7061 796d 656e 7420 6d65 7468 6f64  g payment method
+000096f0: 2074 6f20 7468 6973 2063 7573 746f 6d65   to this custome
+00009700: 7227 7320 6163 636f 756e 740a 0a20 2020  r's account..   
+00009710: 2020 2020 203a 7061 7261 6d20 7061 796d       :param paym
+00009720: 656e 745f 6d65 7468 6f64 3a20 5061 796d  ent_method: Paym
+00009730: 656e 744d 6574 686f 6420 746f 2062 6520  entMethod to be 
+00009740: 6174 7461 6368 6564 2074 6f20 7468 6520  attached to the 
+00009750: 6375 7374 6f6d 6572 0a20 2020 2020 2020  customer.       
+00009760: 203a 7479 7065 2070 6179 6d65 6e74 5f6d   :type payment_m
+00009770: 6574 686f 643a 2073 7472 2c20 5061 796d  ethod: str, Paym
+00009780: 656e 744d 6574 686f 640a 2020 2020 2020  entMethod.      
+00009790: 2020 3a70 6172 616d 2073 6574 5f64 6566    :param set_def
+000097a0: 6175 6c74 3a20 4966 2074 7275 652c 2074  ault: If true, t
+000097b0: 6869 7320 7769 6c6c 2062 6520 7365 7420  his will be set 
+000097c0: 6173 2074 6865 2064 6566 6175 6c74 5f70  as the default_p
+000097d0: 6179 6d65 6e74 5f6d 6574 686f 640a 2020  ayment_method.  
+000097e0: 2020 2020 2020 3a74 7970 6520 7365 745f        :type set_
+000097f0: 6465 6661 756c 743a 2062 6f6f 6c0a 2020  default: bool.  
+00009800: 2020 2020 2020 3a72 7479 7065 3a20 5061        :rtype: Pa
+00009810: 796d 656e 744d 6574 686f 640a 2020 2020  ymentMethod.    
+00009820: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00009830: 6672 6f6d 202e 7061 796d 656e 745f 6d65  from .payment_me
+00009840: 7468 6f64 7320 696d 706f 7274 2050 6179  thods import Pay
+00009850: 6d65 6e74 4d65 7468 6f64 0a0a 2020 2020  mentMethod..    
+00009860: 2020 2020 7374 7269 7065 5f63 7573 746f      stripe_custo
+00009870: 6d65 7220 3d20 7365 6c66 2e61 7069 5f72  mer = self.api_r
+00009880: 6574 7269 6576 6528 290a 2020 2020 2020  etrieve().      
+00009890: 2020 7061 796d 656e 745f 6d65 7468 6f64    payment_method
+000098a0: 203d 2050 6179 6d65 6e74 4d65 7468 6f64   = PaymentMethod
+000098b0: 2e61 7474 6163 6828 7061 796d 656e 745f  .attach(payment_
+000098c0: 6d65 7468 6f64 2c20 7374 7269 7065 5f63  method, stripe_c
+000098d0: 7573 746f 6d65 7229 0a0a 2020 2020 2020  ustomer)..      
+000098e0: 2020 6966 2073 6574 5f64 6566 6175 6c74    if set_default
+000098f0: 3a0a 2020 2020 2020 2020 2020 2020 7374  :.            st
+00009900: 7269 7065 5f63 7573 746f 6d65 725b 2269  ripe_customer["i
+00009910: 6e76 6f69 6365 5f73 6574 7469 6e67 7322  nvoice_settings"
+00009920: 5d5b 0a20 2020 2020 2020 2020 2020 2020  ][.             
+00009930: 2020 2022 6465 6661 756c 745f 7061 796d     "default_paym
+00009940: 656e 745f 6d65 7468 6f64 220a 2020 2020  ent_method".    
+00009950: 2020 2020 2020 2020 5d20 3d20 7061 796d          ] = paym
+00009960: 656e 745f 6d65 7468 6f64 2e69 640a 2020  ent_method.id.  
+00009970: 2020 2020 2020 2020 2020 7374 7269 7065            stripe
+00009980: 5f63 7573 746f 6d65 722e 7361 7665 2829  _customer.save()
+00009990: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+000099a0: 5265 6672 6573 6820 7365 6c66 2066 726f  Refresh self fro
+000099b0: 6d20 7468 6520 7374 7269 7065 2063 7573  m the stripe cus
+000099c0: 746f 6d65 722c 2074 6869 7320 7368 6f75  tomer, this shou
+000099d0: 6c64 2068 6176 6520 7477 6f20 6566 6665  ld have two effe
+000099e0: 6374 733a 0a20 2020 2020 2020 2020 2020  cts:.           
+000099f0: 2023 2031 2920 7365 7473 2073 656c 662e   # 1) sets self.
+00009a00: 6465 6661 756c 745f 7061 796d 656e 745f  default_payment_
+00009a10: 6d65 7468 6f64 2028 7765 2072 656c 7920  method (we rely 
+00009a20: 6f6e 206c 6f67 6963 2069 6e0a 2020 2020  on logic in.    
+00009a30: 2020 2020 2020 2020 2320 4375 7374 6f6d          # Custom
+00009a40: 6572 2e5f 6d61 6e69 7075 6c61 7465 5f73  er._manipulate_s
+00009a50: 7472 6970 655f 6f62 6a65 6374 5f68 6f6f  tripe_object_hoo
+00009a60: 6b20 746f 2064 6f20 7468 6973 290a 2020  k to do this).  
+00009a70: 2020 2020 2020 2020 2020 2320 3229 2075            # 2) u
+00009a80: 7064 6174 6573 2073 656c 662e 696e 766f  pdates self.invo
+00009a90: 6963 655f 7365 7474 696e 6773 2e64 6566  ice_settings.def
+00009aa0: 6175 6c74 5f70 6179 6d65 6e74 5f6d 6574  ault_payment_met
+00009ab0: 686f 6473 0a20 2020 2020 2020 2020 2020  hods.           
+00009ac0: 2073 656c 662e 7379 6e63 5f66 726f 6d5f   self.sync_from_
+00009ad0: 7374 7269 7065 5f64 6174 6128 7374 7269  stripe_data(stri
+00009ae0: 7065 5f63 7573 746f 6d65 722c 2061 7069  pe_customer, api
+00009af0: 5f6b 6579 3d73 656c 662e 6465 6661 756c  _key=self.defaul
+00009b00: 745f 6170 695f 6b65 7929 0a20 2020 2020  t_api_key).     
+00009b10: 2020 2020 2020 2073 656c 662e 7265 6672         self.refr
+00009b20: 6573 685f 6672 6f6d 5f64 6228 290a 0a20  esh_from_db().. 
+00009b30: 2020 2020 2020 2072 6574 7572 6e20 7061         return pa
+00009b40: 796d 656e 745f 6d65 7468 6f64 0a0a 2020  yment_method..  
+00009b50: 2020 6465 6620 7075 7267 6528 7365 6c66    def purge(self
+00009b60: 293a 0a20 2020 2020 2020 2022 2222 4375  ):.        """Cu
+00009b70: 7374 6f6d 6572 7320 6172 6520 736f 6674  stomers are soft
+00009b80: 2064 656c 6574 6564 2061 7320 6465 6c65   deleted as dele
+00009b90: 7465 6420 6375 7374 6f6d 6572 7320 6172  ted customers ar
+00009ba0: 6520 7374 696c 6c20 6163 6365 7373 6962  e still accessib
+00009bb0: 6c65 2062 7920 7468 650a 2020 2020 2020  le by the.      
+00009bc0: 2020 5374 7269 7065 2041 5049 2061 6e64    Stripe API and
+00009bd0: 2073 796e 6320 666f 7220 616c 6c20 5265   sync for all Re
+00009be0: 6c61 7465 644d 6f64 656c 7320 776f 756c  latedModels woul
+00009bf0: 6420 6661 696c 2222 220a 2020 2020 2020  d fail""".      
+00009c00: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+00009c10: 2020 2073 656c 662e 5f61 7069 5f64 656c     self._api_del
+00009c20: 6574 6528 290a 2020 2020 2020 2020 6578  ete().        ex
+00009c30: 6365 7074 2049 6e76 616c 6964 5265 7175  cept InvalidRequ
+00009c40: 6573 7445 7272 6f72 2061 7320 6578 633a  estError as exc:
+00009c50: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00009c60: 224e 6f20 7375 6368 2063 7573 746f 6d65  "No such custome
+00009c70: 723a 2220 696e 2073 7472 2865 7863 293a  r:" in str(exc):
+00009c80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009c90: 2023 2054 6865 2065 7863 6570 7469 6f6e   # The exception
+00009ca0: 2077 6173 2074 6872 6f77 6e20 6265 6361   was thrown beca
+00009cb0: 7573 6520 7468 6520 7374 7269 7065 2063  use the stripe c
+00009cc0: 7573 746f 6d65 7220 7761 7320 616c 7265  ustomer was alre
+00009cd0: 6164 790a 2020 2020 2020 2020 2020 2020  ady.            
+00009ce0: 2020 2020 2320 6465 6c65 7465 6420 6f6e      # deleted on
+00009cf0: 2074 6865 2073 7472 6970 6520 7369 6465   the stripe side
+00009d00: 2c20 6967 6e6f 7265 2074 6865 2065 7863  , ignore the exc
+00009d10: 6570 7469 6f6e 0a20 2020 2020 2020 2020  eption.         
+00009d20: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
+00009d30: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00009d40: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00009d50: 5468 6520 6578 6365 7074 696f 6e20 7761  The exception wa
+00009d60: 7320 7261 6973 6564 2066 6f72 2061 6e6f  s raised for ano
+00009d70: 7468 6572 2072 6561 736f 6e2c 2072 652d  ther reason, re-
+00009d80: 7261 6973 6520 6974 0a20 2020 2020 2020  raise it.       
+00009d90: 2020 2020 2020 2020 2072 6169 7365 0a0a           raise..
+00009da0: 2020 2020 2020 2020 2320 746f 6767 6c65          # toggle
+00009db0: 2074 6865 2064 656c 6574 6564 2066 6c61   the deleted fla
+00009dc0: 6720 6f6e 2043 7573 746f 6d65 7220 746f  g on Customer to
+00009dd0: 2069 6e64 6963 6174 6520 6974 2068 6173   indicate it has
+00009de0: 2062 6565 6e0a 2020 2020 2020 2020 2320   been.        # 
+00009df0: 6465 6c65 7465 6420 7570 7374 7265 616d  deleted upstream
+00009e00: 2069 6e20 5374 7269 7065 0a20 2020 2020   in Stripe.     
+00009e10: 2020 2073 656c 662e 6465 6c65 7465 6420     self.deleted 
+00009e20: 3d20 5472 7565 0a0a 2020 2020 2020 2020  = True..        
+00009e30: 6966 2073 656c 662e 7375 6273 6372 6962  if self.subscrib
+00009e40: 6572 3a0a 2020 2020 2020 2020 2020 2020  er:.            
+00009e50: 2320 4465 6c65 7465 2074 6865 2069 6465  # Delete the ide
+00009e60: 6d70 6f74 656e 6379 206b 6579 2075 7365  mpotency key use
+00009e70: 6420 6279 2043 7573 746f 6d65 722e 6372  d by Customer.cr
+00009e80: 6561 7465 2829 0a20 2020 2020 2020 2020  eate().         
+00009e90: 2020 2023 2053 6f20 7265 2d63 7265 6174     # So re-creat
+00009ea0: 696e 6720 6120 6375 7374 6f6d 6572 2066  ing a customer f
+00009eb0: 6f72 2074 6869 7320 7375 6273 6372 6962  or this subscrib
+00009ec0: 6572 2062 6566 6f72 6520 7468 6520 6b65  er before the ke
+00009ed0: 7920 6578 7069 7265 730a 2020 2020 2020  y expires.      
+00009ee0: 2020 2020 2020 2320 646f 6573 6e27 7420        # doesn't 
+00009ef0: 7265 7475 726e 2074 6865 206f 6c64 6572  return the older
+00009f00: 2043 7573 746f 6d65 7220 6461 7461 0a20   Customer data. 
+00009f10: 2020 2020 2020 2020 2020 2069 6465 6d70             idemp
+00009f20: 6f74 656e 6379 5f6b 6579 5f61 6374 696f  otency_key_actio
+00009f30: 6e20 3d20 6622 6375 7374 6f6d 6572 3a63  n = f"customer:c
+00009f40: 7265 6174 653a 7b73 656c 662e 7375 6273  reate:{self.subs
+00009f50: 6372 6962 6572 2e70 6b7d 220a 2020 2020  criber.pk}".    
+00009f60: 2020 2020 2020 2020 4964 656d 706f 7465          Idempote
+00009f70: 6e63 794b 6579 2e6f 626a 6563 7473 2e66  ncyKey.objects.f
+00009f80: 696c 7465 7228 6163 7469 6f6e 3d69 6465  ilter(action=ide
+00009f90: 6d70 6f74 656e 6379 5f6b 6579 5f61 6374  mpotency_key_act
+00009fa0: 696f 6e29 2e64 656c 6574 6528 290a 0a20  ion).delete().. 
+00009fb0: 2020 2020 2020 2073 656c 662e 7375 6273         self.subs
+00009fc0: 6372 6962 6572 203d 204e 6f6e 650a 0a20  criber = None.. 
+00009fd0: 2020 2020 2020 2023 2052 656d 6f76 6520         # Remove 
+00009fe0: 736f 7572 6365 730a 2020 2020 2020 2020  sources.        
+00009ff0: 7365 6c66 2e64 6566 6175 6c74 5f73 6f75  self.default_sou
+0000a000: 7263 6520 3d20 4e6f 6e65 0a20 2020 2020  rce = None.     
+0000a010: 2020 2066 6f72 2073 6f75 7263 6520 696e     for source in
+0000a020: 2073 656c 662e 6c65 6761 6379 5f63 6172   self.legacy_car
+0000a030: 6473 2e61 6c6c 2829 3a0a 2020 2020 2020  ds.all():.      
+0000a040: 2020 2020 2020 736f 7572 6365 2e72 656d        source.rem
+0000a050: 6f76 6528 290a 0a20 2020 2020 2020 2066  ove()..        f
+0000a060: 6f72 2073 6f75 7263 6520 696e 2073 656c  or source in sel
+0000a070: 662e 736f 7572 6365 732e 616c 6c28 293a  f.sources.all():
+0000a080: 0a20 2020 2020 2020 2020 2020 2073 6f75  .            sou
+0000a090: 7263 652e 6465 7461 6368 2829 0a0a 2020  rce.detach()..  
+0000a0a0: 2020 2020 2020 7365 6c66 2e64 6174 655f        self.date_
+0000a0b0: 7075 7267 6564 203d 2074 696d 657a 6f6e  purged = timezon
+0000a0c0: 652e 6e6f 7728 290a 2020 2020 2020 2020  e.now().        
+0000a0d0: 7365 6c66 2e73 6176 6528 290a 0a20 2020  self.save()..   
+0000a0e0: 2064 6566 205f 6765 745f 7661 6c69 645f   def _get_valid_
+0000a0f0: 7375 6273 6372 6970 7469 6f6e 7328 7365  subscriptions(se
+0000a100: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
+0000a110: 4765 7420 6120 6c69 7374 206f 6620 7468  Get a list of th
+0000a120: 6973 2063 7573 746f 6d65 7227 7320 7661  is customer's va
+0000a130: 6c69 6420 7375 6273 6372 6970 7469 6f6e  lid subscription
+0000a140: 732e 2222 220a 0a20 2020 2020 2020 2072  s."""..        r
+0000a150: 6574 7572 6e20 5b0a 2020 2020 2020 2020  eturn [.        
+0000a160: 2020 2020 7375 6273 6372 6970 7469 6f6e      subscription
+0000a170: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0000a180: 2073 7562 7363 7269 7074 696f 6e20 696e   subscription in
+0000a190: 2073 656c 662e 7375 6273 6372 6970 7469   self.subscripti
+0000a1a0: 6f6e 732e 616c 6c28 290a 2020 2020 2020  ons.all().      
+0000a1b0: 2020 2020 2020 6966 2073 7562 7363 7269        if subscri
+0000a1c0: 7074 696f 6e2e 6973 5f76 616c 6964 2829  ption.is_valid()
+0000a1d0: 0a20 2020 2020 2020 205d 0a0a 2020 2020  .        ]..    
+0000a1e0: 6465 6620 6973 5f73 7562 7363 7269 6265  def is_subscribe
+0000a1f0: 645f 746f 2873 656c 662c 2070 726f 6475  d_to(self, produ
+0000a200: 6374 3a20 556e 696f 6e5b 5072 6f64 7563  ct: Union[Produc
+0000a210: 742c 2073 7472 5d29 202d 3e20 626f 6f6c  t, str]) -> bool
+0000a220: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+0000a230: 2020 2020 2020 4368 6563 6b73 2074 6f20        Checks to 
+0000a240: 7365 6520 6966 2074 6869 7320 6375 7374  see if this cust
+0000a250: 6f6d 6572 2068 6173 2061 6e20 6163 7469  omer has an acti
+0000a260: 7665 2073 7562 7363 7269 7074 696f 6e20  ve subscription 
+0000a270: 746f 2074 6865 2067 6976 656e 2070 726f  to the given pro
+0000a280: 6475 6374 2e0a 0a20 2020 2020 2020 203a  duct...        :
+0000a290: 7061 7261 6d20 7072 6f64 7563 743a 2054  param product: T
+0000a2a0: 6865 2070 726f 6475 6374 2066 6f72 2077  he product for w
+0000a2b0: 6869 6368 2074 6f20 6368 6563 6b20 666f  hich to check fo
+0000a2c0: 7220 616e 2061 6374 6976 6520 7375 6273  r an active subs
+0000a2d0: 6372 6970 7469 6f6e 2e0a 2020 2020 2020  cription..      
+0000a2e0: 2020 3a74 7970 6520 7072 6f64 7563 743a    :type product:
+0000a2f0: 2050 726f 6475 6374 206f 7220 7374 7269   Product or stri
+0000a300: 6e67 2028 7072 6f64 7563 7420 4944 290a  ng (product ID).
+0000a310: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
+0000a320: 733a 2054 7275 6520 6966 2074 6865 7265  s: True if there
+0000a330: 2065 7869 7374 7320 616e 2061 6374 6976   exists an activ
+0000a340: 6520 7375 6273 6372 6970 7469 6f6e 2c20  e subscription, 
+0000a350: 4661 6c73 6520 6f74 6865 7277 6973 652e  False otherwise.
+0000a360: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
+0000a370: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+0000a380: 6e63 6528 7072 6f64 7563 742c 2053 7472  nce(product, Str
+0000a390: 6970 654d 6f64 656c 293a 0a20 2020 2020  ipeModel):.     
+0000a3a0: 2020 2020 2020 2070 726f 6475 6374 203d         product =
+0000a3b0: 2070 726f 6475 6374 2e69 640a 0a20 2020   product.id..   
+0000a3c0: 2020 2020 2066 6f72 2073 7562 7363 7269       for subscri
+0000a3d0: 7074 696f 6e20 696e 2073 656c 662e 5f67  ption in self._g
+0000a3e0: 6574 5f76 616c 6964 5f73 7562 7363 7269  et_valid_subscri
+0000a3f0: 7074 696f 6e73 2829 3a0a 2020 2020 2020  ptions():.      
+0000a400: 2020 2020 2020 666f 7220 6974 656d 2069        for item i
+0000a410: 6e20 7375 6273 6372 6970 7469 6f6e 2e69  n subscription.i
+0000a420: 7465 6d73 2e61 6c6c 2829 3a0a 2020 2020  tems.all():.    
+0000a430: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+0000a440: 7465 6d2e 7072 6963 6520 616e 6420 6974  tem.price and it
+0000a450: 656d 2e70 7269 6365 2e70 726f 6475 6374  em.price.product
+0000a460: 2e69 6420 3d3d 2070 726f 6475 6374 3a0a  .id == product:.
+0000a470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a480: 2020 2020 7265 7475 726e 2054 7275 650a      return True.
+0000a490: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+0000a4a0: 616c 7365 0a0a 2020 2020 6465 6620 6861  alse..    def ha
+0000a4b0: 735f 616e 795f 6163 7469 7665 5f73 7562  s_any_active_sub
+0000a4c0: 7363 7269 7074 696f 6e28 7365 6c66 293a  scription(self):
+0000a4d0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0000a4e0: 2020 2020 2043 6865 636b 7320 746f 2073       Checks to s
+0000a4f0: 6565 2069 6620 7468 6973 2063 7573 746f  ee if this custo
+0000a500: 6d65 7220 6861 7320 616e 2061 6374 6976  mer has an activ
+0000a510: 6520 7375 6273 6372 6970 7469 6f6e 2074  e subscription t
+0000a520: 6f20 616e 7920 706c 616e 2e0a 0a20 2020  o any plan...   
+0000a530: 2020 2020 203a 7265 7475 726e 733a 2054       :returns: T
+0000a540: 7275 6520 6966 2074 6865 7265 2065 7869  rue if there exi
+0000a550: 7374 7320 616e 2061 6374 6976 6520 7375  sts an active su
+0000a560: 6273 6372 6970 7469 6f6e 2c20 4661 6c73  bscription, Fals
+0000a570: 6520 6f74 6865 7277 6973 652e 0a20 2020  e otherwise..   
+0000a580: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
+0000a590: 2020 7265 7475 726e 206c 656e 2873 656c    return len(sel
+0000a5a0: 662e 5f67 6574 5f76 616c 6964 5f73 7562  f._get_valid_sub
+0000a5b0: 7363 7269 7074 696f 6e73 2829 2920 213d  scriptions()) !=
+0000a5c0: 2030 0a0a 2020 2020 4070 726f 7065 7274   0..    @propert
+0000a5d0: 790a 2020 2020 6465 6620 6163 7469 7665  y.    def active
+0000a5e0: 5f73 7562 7363 7269 7074 696f 6e73 2873  _subscriptions(s
+0000a5f0: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
+0000a600: 220a 2020 2020 2020 2020 5265 7475 726e  ".        Return
+0000a610: 7320 6163 7469 7665 2073 7562 7363 7269  s active subscri
+0000a620: 7074 696f 6e73 0a20 2020 2020 2020 2028  ptions.        (
+0000a630: 7375 6273 6372 6970 7469 6f6e 7320 7769  subscriptions wi
+0000a640: 7468 2061 6e20 6163 7469 7665 2073 7461  th an active sta
+0000a650: 7475 7320 7468 6174 2065 6e64 2069 6e20  tus that end in 
+0000a660: 7468 6520 6675 7475 7265 292e 0a20 2020  the future)..   
+0000a670: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000a680: 2072 6574 7572 6e20 7365 6c66 2e73 7562   return self.sub
+0000a690: 7363 7269 7074 696f 6e73 2e66 696c 7465  scriptions.filte
+0000a6a0: 7228 0a20 2020 2020 2020 2020 2020 2073  r(.            s
+0000a6b0: 7461 7475 733d 656e 756d 732e 5375 6273  tatus=enums.Subs
+0000a6c0: 6372 6970 7469 6f6e 5374 6174 7573 2e61  criptionStatus.a
+0000a6d0: 6374 6976 652c 0a20 2020 2020 2020 2020  ctive,.         
+0000a6e0: 2020 2063 7572 7265 6e74 5f70 6572 696f     current_perio
+0000a6f0: 645f 656e 645f 5f67 743d 7469 6d65 7a6f  d_end__gt=timezo
+0000a700: 6e65 2e6e 6f77 2829 2c0a 2020 2020 2020  ne.now(),.      
+0000a710: 2020 290a 0a20 2020 2040 7072 6f70 6572    )..    @proper
+0000a720: 7479 0a20 2020 2064 6566 2076 616c 6964  ty.    def valid
+0000a730: 5f73 7562 7363 7269 7074 696f 6e73 2873  _subscriptions(s
+0000a740: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
+0000a750: 220a 2020 2020 2020 2020 5265 7475 726e  ".        Return
+0000a760: 7320 7468 6973 2063 7573 746f 6d65 7227  s this customer'
+0000a770: 7320 7661 6c69 6420 7375 6273 6372 6970  s valid subscrip
+0000a780: 7469 6f6e 730a 2020 2020 2020 2020 2873  tions.        (s
+0000a790: 7562 7363 7269 7074 696f 6e73 2074 6861  ubscriptions tha
+0000a7a0: 7420 6172 656e 2774 2063 616e 6365 6c65  t aren't cancele
+0000a7b0: 6420 6f72 2069 6e63 6f6d 706c 6574 655f  d or incomplete_
+0000a7c0: 6578 7069 7265 6429 2e0a 2020 2020 2020  expired)..      
+0000a7d0: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
+0000a7e0: 7475 726e 2073 656c 662e 7375 6273 6372  turn self.subscr
+0000a7f0: 6970 7469 6f6e 732e 6578 636c 7564 6528  iptions.exclude(
+0000a800: 0a20 2020 2020 2020 2020 2020 2073 7461  .            sta
+0000a810: 7475 735f 5f69 6e3d 5b0a 2020 2020 2020  tus__in=[.      
+0000a820: 2020 2020 2020 2020 2020 656e 756d 732e            enums.
+0000a830: 5375 6273 6372 6970 7469 6f6e 5374 6174  SubscriptionStat
+0000a840: 7573 2e63 616e 6365 6c65 642c 0a20 2020  us.canceled,.   
+0000a850: 2020 2020 2020 2020 2020 2020 2065 6e75               enu
+0000a860: 6d73 2e53 7562 7363 7269 7074 696f 6e53  ms.SubscriptionS
+0000a870: 7461 7475 732e 696e 636f 6d70 6c65 7465  tatus.incomplete
+0000a880: 5f65 7870 6972 6564 2c0a 2020 2020 2020  _expired,.      
+0000a890: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
+0000a8a0: 290a 0a20 2020 2040 7072 6f70 6572 7479  )..    @property
+0000a8b0: 0a20 2020 2064 6566 2073 7562 7363 7269  .    def subscri
+0000a8c0: 7074 696f 6e28 7365 6c66 293a 0a20 2020  ption(self):.   
+0000a8d0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000a8e0: 2053 686f 7274 6375 7420 746f 2067 6574   Shortcut to get
+0000a8f0: 2074 6869 7320 6375 7374 6f6d 6572 2773   this customer's
+0000a900: 2073 7562 7363 7269 7074 696f 6e2e 0a0a   subscription...
+0000a910: 2020 2020 2020 2020 3a72 6574 7572 6e73          :returns
+0000a920: 3a20 4e6f 6e65 2069 6620 7468 6520 6375  : None if the cu
+0000a930: 7374 6f6d 6572 2068 6173 206e 6f20 7375  stomer has no su
+0000a940: 6273 6372 6970 7469 6f6e 732c 2074 6865  bscriptions, the
+0000a950: 2073 7562 7363 7269 7074 696f 6e20 6966   subscription if
+0000a960: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
+0000a970: 2063 7573 746f 6d65 7220 6861 7320 6120   customer has a 
+0000a980: 7375 6273 6372 6970 7469 6f6e 2e0a 2020  subscription..  
+0000a990: 2020 2020 2020 3a72 6169 7365 7320 4d75        :raises Mu
+0000a9a0: 6c74 6970 6c65 5375 6273 6372 6970 7469  ltipleSubscripti
+0000a9b0: 6f6e 4578 6365 7074 696f 6e3a 2052 6169  onException: Rai
+0000a9c0: 7365 6420 6966 2074 6865 2063 7573 746f  sed if the custo
+0000a9d0: 6d65 7220 6861 7320 6d75 6c74 6970 6c65  mer has multiple
+0000a9e0: 0a20 2020 2020 2020 2020 2020 2073 7562  .            sub
+0000a9f0: 7363 7269 7074 696f 6e73 2e0a 2020 2020  scriptions..    
+0000aa00: 2020 2020 2020 2020 496e 2074 6869 7320          In this 
+0000aa10: 6361 7365 2c20 7573 6520 6060 4375 7374  case, use ``Cust
+0000aa20: 6f6d 6572 2e73 7562 7363 7269 7074 696f  omer.subscriptio
+0000aa30: 6e73 6060 2069 6e73 7465 6164 2e0a 2020  ns`` instead..  
+0000aa40: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
+0000aa50: 2020 2073 7562 7363 7269 7074 696f 6e73     subscriptions
+0000aa60: 203d 2073 656c 662e 7661 6c69 645f 7375   = self.valid_su
+0000aa70: 6273 6372 6970 7469 6f6e 730a 0a20 2020  bscriptions..   
+0000aa80: 2020 2020 2069 6620 7375 6273 6372 6970       if subscrip
+0000aa90: 7469 6f6e 732e 636f 756e 7428 2920 3e20  tions.count() > 
+0000aaa0: 313a 0a20 2020 2020 2020 2020 2020 2072  1:.            r
+0000aab0: 6169 7365 204d 756c 7469 706c 6553 7562  aise MultipleSub
+0000aac0: 7363 7269 7074 696f 6e45 7863 6570 7469  scriptionExcepti
+0000aad0: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
+0000aae0: 2020 2020 2254 6869 7320 6375 7374 6f6d      "This custom
+0000aaf0: 6572 2068 6173 206d 756c 7469 706c 6520  er has multiple 
+0000ab00: 7375 6273 6372 6970 7469 6f6e 732e 2055  subscriptions. U
+0000ab10: 7365 2043 7573 746f 6d65 722e 7375 6273  se Customer.subs
+0000ab20: 6372 6970 7469 6f6e 7320 220a 2020 2020  criptions ".    
+0000ab30: 2020 2020 2020 2020 2020 2020 2274 6f20              "to 
+0000ab40: 6163 6365 7373 2074 6865 6d2e 220a 2020  access them.".  
+0000ab50: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0000ab60: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000ab70: 2020 2020 2020 7265 7475 726e 2073 7562        return sub
+0000ab80: 7363 7269 7074 696f 6e73 2e66 6972 7374  scriptions.first
+0000ab90: 2829 0a0a 2020 2020 6465 6620 7365 6e64  ()..    def send
+0000aba0: 5f69 6e76 6f69 6365 2873 656c 6629 3a0a  _invoice(self):.
+0000abb0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000abc0: 2020 2020 5061 7920 616e 6420 7365 6e64      Pay and send
+0000abd0: 2074 6865 2063 7573 746f 6d65 7227 7320   the customer's 
+0000abe0: 6c61 7465 7374 2069 6e76 6f69 6365 2e0a  latest invoice..
+0000abf0: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
+0000ac00: 733a 2054 7275 6520 6966 2061 6e20 696e  s: True if an in
+0000ac10: 766f 6963 6520 7761 7320 6162 6c65 2074  voice was able t
+0000ac20: 6f20 6265 2063 7265 6174 6564 2061 6e64  o be created and
+0000ac30: 2070 6169 642c 2046 616c 7365 206f 7468   paid, False oth
+0000ac40: 6572 7769 7365 0a20 2020 2020 2020 2020  erwise.         
+0000ac50: 2020 2028 7479 7069 6361 6c6c 7920 6966     (typically if
+0000ac60: 2074 6865 7265 2077 6173 206e 6f74 6869   there was nothi
+0000ac70: 6e67 2074 6f20 696e 766f 6963 6529 2e0a  ng to invoice)..
+0000ac80: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000ac90: 2020 2020 6672 6f6d 202e 6269 6c6c 696e      from .billin
+0000aca0: 6720 696d 706f 7274 2049 6e76 6f69 6365  g import Invoice
+0000acb0: 0a0a 2020 2020 2020 2020 7472 793a 0a20  ..        try:. 
+0000acc0: 2020 2020 2020 2020 2020 2069 6e76 6f69             invoi
+0000acd0: 6365 203d 2049 6e76 6f69 6365 2e5f 6170  ce = Invoice._ap
+0000ace0: 695f 6372 6561 7465 2863 7573 746f 6d65  i_create(custome
+0000acf0: 723d 7365 6c66 2e69 6429 0a20 2020 2020  r=self.id).     
+0000ad00: 2020 2020 2020 2069 6e76 6f69 6365 2e70         invoice.p
+0000ad10: 6179 2829 0a20 2020 2020 2020 2020 2020  ay().           
+0000ad20: 2072 6574 7572 6e20 5472 7565 0a20 2020   return True.   
+0000ad30: 2020 2020 2065 7863 6570 7420 496e 7661       except Inva
+0000ad40: 6c69 6452 6571 7565 7374 4572 726f 723a  lidRequestError:
+0000ad50: 2020 2320 544f 444f 3a20 4368 6563 6b20    # TODO: Check 
+0000ad60: 7468 6973 2066 6f72 2061 206d 6f72 650a  this for a more.
+0000ad70: 2020 2020 2020 2020 2020 2020 2320 2020              #   
+0000ad80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ad90: 2020 2020 2020 2020 7370 6563 6966 6963          specific
+0000ada0: 2065 7272 6f72 206d 6573 7361 6765 2e0a   error message..
+0000adb0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000adc0: 726e 2046 616c 7365 2020 2320 5468 6572  rn False  # Ther
+0000add0: 6520 7761 7320 6e6f 7468 696e 6720 746f  e was nothing to
+0000ade0: 2069 6e76 6f69 6365 0a0a 2020 2020 6465   invoice..    de
+0000adf0: 6620 7265 7472 795f 756e 7061 6964 5f69  f retry_unpaid_i
+0000ae00: 6e76 6f69 6365 7328 7365 6c66 293a 0a20  nvoices(self):. 
+0000ae10: 2020 2020 2020 2022 2222 4174 7465 6d70         """Attemp
+0000ae20: 7420 746f 2072 6574 7279 2063 6f6c 6c65  t to retry colle
+0000ae30: 6374 696e 6720 7061 796d 656e 7420 6f6e  cting payment on
+0000ae40: 2074 6865 2063 7573 746f 6d65 7227 7320   the customer's 
+0000ae50: 756e 7061 6964 2069 6e76 6f69 6365 732e  unpaid invoices.
+0000ae60: 2222 220a 0a20 2020 2020 2020 2073 656c  """..        sel
+0000ae70: 662e 5f73 796e 635f 696e 766f 6963 6573  f._sync_invoices
+0000ae80: 2829 0a20 2020 2020 2020 2066 6f72 2069  ().        for i
+0000ae90: 6e76 6f69 6365 2069 6e20 7365 6c66 2e69  nvoice in self.i
+0000aea0: 6e76 6f69 6365 732e 6669 6c74 6572 2861  nvoices.filter(a
+0000aeb0: 7574 6f5f 6164 7661 6e63 653d 5472 7565  uto_advance=True
+0000aec0: 292e 6578 636c 7564 6528 7374 6174 7573  ).exclude(status
+0000aed0: 3d22 7061 6964 2229 3a0a 2020 2020 2020  ="paid"):.      
+0000aee0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+0000aef0: 2020 2020 2020 2020 2020 2069 6e76 6f69             invoi
+0000af00: 6365 2e72 6574 7279 2829 2020 2320 416c  ce.retry()  # Al
+0000af10: 7761 7973 2072 6574 7279 2075 6e70 6169  ways retry unpai
+0000af20: 6420 696e 766f 6963 6573 0a20 2020 2020  d invoices.     
+0000af30: 2020 2020 2020 2065 7863 6570 7420 496e         except In
+0000af40: 7661 6c69 6452 6571 7565 7374 4572 726f  validRequestErro
+0000af50: 7220 6173 2065 7863 3a0a 2020 2020 2020  r as exc:.      
+0000af60: 2020 2020 2020 2020 2020 6966 2073 7472            if str
+0000af70: 2865 7863 2920 213d 2022 496e 766f 6963  (exc) != "Invoic
+0000af80: 6520 6973 2061 6c72 6561 6479 2070 6169  e is already pai
+0000af90: 6422 3a0a 2020 2020 2020 2020 2020 2020  d":.            
+0000afa0: 2020 2020 2020 2020 7261 6973 650a 0a20          raise.. 
+0000afb0: 2020 2064 6566 2061 6464 5f63 6f75 706f     def add_coupo
+0000afc0: 6e28 7365 6c66 2c20 636f 7570 6f6e 2c20  n(self, coupon, 
+0000afd0: 6964 656d 706f 7465 6e63 795f 6b65 793d  idempotency_key=
+0000afe0: 4e6f 6e65 293a 0a20 2020 2020 2020 2022  None):.        "
+0000aff0: 2222 0a20 2020 2020 2020 2041 6464 2061  "".        Add a
+0000b000: 2063 6f75 706f 6e20 746f 2061 2043 7573   coupon to a Cus
+0000b010: 746f 6d65 722e 0a0a 2020 2020 2020 2020  tomer...        
+0000b020: 5468 6520 636f 7570 6f6e 2063 616e 2062  The coupon can b
+0000b030: 6520 6120 436f 7570 6f6e 206f 626a 6563  e a Coupon objec
+0000b040: 742c 206f 7220 6120 7661 6c69 6420 5374  t, or a valid St
+0000b050: 7269 7065 2043 6f75 706f 6e20 4944 2e0a  ripe Coupon ID..
+0000b060: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000b070: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+0000b080: 6528 636f 7570 6f6e 2c20 5374 7269 7065  e(coupon, Stripe
+0000b090: 4d6f 6465 6c29 3a0a 2020 2020 2020 2020  Model):.        
+0000b0a0: 2020 2020 636f 7570 6f6e 203d 2063 6f75      coupon = cou
+0000b0b0: 706f 6e2e 6964 0a0a 2020 2020 2020 2020  pon.id..        
+0000b0c0: 7374 7269 7065 5f63 7573 746f 6d65 7220  stripe_customer 
+0000b0d0: 3d20 7365 6c66 2e61 7069 5f72 6574 7269  = self.api_retri
+0000b0e0: 6576 6528 290a 2020 2020 2020 2020 7374  eve().        st
+0000b0f0: 7269 7065 5f63 7573 746f 6d65 725b 2263  ripe_customer["c
+0000b100: 6f75 706f 6e22 5d20 3d20 636f 7570 6f6e  oupon"] = coupon
+0000b110: 0a20 2020 2020 2020 2073 7472 6970 655f  .        stripe_
+0000b120: 6375 7374 6f6d 6572 2e73 6176 6528 6964  customer.save(id
+0000b130: 656d 706f 7465 6e63 795f 6b65 793d 6964  empotency_key=id
+0000b140: 656d 706f 7465 6e63 795f 6b65 7929 0a20  empotency_key). 
+0000b150: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0000b160: 6c66 2e5f 5f63 6c61 7373 5f5f 2e73 796e  lf.__class__.syn
+0000b170: 635f 6672 6f6d 5f73 7472 6970 655f 6461  c_from_stripe_da
+0000b180: 7461 280a 2020 2020 2020 2020 2020 2020  ta(.            
+0000b190: 7374 7269 7065 5f63 7573 746f 6d65 722c  stripe_customer,
+0000b1a0: 2061 7069 5f6b 6579 3d73 656c 662e 6465   api_key=self.de
+0000b1b0: 6661 756c 745f 6170 695f 6b65 790a 2020  fault_api_key.  
+0000b1c0: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
+0000b1d0: 2075 7063 6f6d 696e 675f 696e 766f 6963   upcoming_invoic
+0000b1e0: 6528 7365 6c66 2c20 2a2a 6b77 6172 6773  e(self, **kwargs
+0000b1f0: 293a 0a20 2020 2020 2020 2022 2222 4765  ):.        """Ge
+0000b200: 7473 2074 6865 2075 7063 6f6d 696e 6720  ts the upcoming 
+0000b210: 7072 6576 6965 7720 696e 766f 6963 6520  preview invoice 
+0000b220: 2873 696e 6775 6c61 7229 2066 6f72 2074  (singular) for t
+0000b230: 6869 7320 6375 7374 6f6d 6572 2e0a 0a20  his customer... 
+0000b240: 2020 2020 2020 2053 6565 2060 496e 766f         See `Invo
+0000b250: 6963 652e 7570 636f 6d69 6e67 2829 203c  ice.upcoming() <
+0000b260: 2364 6a73 7472 6970 652e 496e 766f 6963  #djstripe.Invoic
+0000b270: 652e 7570 636f 6d69 6e67 3e60 5f5f 2e0a  e.upcoming>`__..
+0000b280: 0a20 2020 2020 2020 2054 6865 2060 6063  .        The ``c
+0000b290: 7573 746f 6d65 7260 6020 6172 6775 6d65  ustomer`` argume
+0000b2a0: 6e74 2074 6f20 7468 6520 6060 7570 636f  nt to the ``upco
+0000b2b0: 6d69 6e67 2829 6060 2063 616c 6c20 6973  ming()`` call is
+0000b2c0: 2061 7574 6f6d 6174 6963 616c 6c79 2073   automatically s
+0000b2d0: 6574 0a20 2020 2020 2020 2020 6279 2074  et.         by t
+0000b2e0: 6869 7320 6d65 7468 6f64 2e0a 2020 2020  his method..    
+0000b2f0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000b300: 6672 6f6d 202e 6269 6c6c 696e 6720 696d  from .billing im
+0000b310: 706f 7274 2049 6e76 6f69 6365 0a0a 2020  port Invoice..  
+0000b320: 2020 2020 2020 6b77 6172 6773 5b22 6375        kwargs["cu
+0000b330: 7374 6f6d 6572 225d 203d 2073 656c 660a  stomer"] = self.
+0000b340: 2020 2020 2020 2020 7265 7475 726e 2049          return I
+0000b350: 6e76 6f69 6365 2e75 7063 6f6d 696e 6728  nvoice.upcoming(
+0000b360: 2a2a 6b77 6172 6773 290a 0a20 2020 2064  **kwargs)..    d
+0000b370: 6566 205f 6174 7461 6368 5f6f 626a 6563  ef _attach_objec
+0000b380: 7473 5f70 6f73 745f 7361 7665 5f68 6f6f  ts_post_save_hoo
+0000b390: 6b28 0a20 2020 2020 2020 2073 656c 662c  k(.        self,
+0000b3a0: 0a20 2020 2020 2020 2063 6c73 2c0a 2020  .        cls,.  
+0000b3b0: 2020 2020 2020 6461 7461 2c0a 2020 2020        data,.    
+0000b3c0: 2020 2020 7065 6e64 696e 675f 7265 6c61      pending_rela
+0000b3d0: 7469 6f6e 733d 4e6f 6e65 2c0a 2020 2020  tions=None,.    
+0000b3e0: 2020 2020 6170 695f 6b65 793d 646a 7374      api_key=djst
+0000b3f0: 7269 7065 5f73 6574 7469 6e67 732e 5354  ripe_settings.ST
+0000b400: 5249 5045 5f53 4543 5245 545f 4b45 592c  RIPE_SECRET_KEY,
+0000b410: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
+0000b420: 6672 6f6d 202e 6269 6c6c 696e 6720 696d  from .billing im
+0000b430: 706f 7274 2043 6f75 706f 6e0a 2020 2020  port Coupon.    
+0000b440: 2020 2020 6672 6f6d 202e 7061 796d 656e      from .paymen
+0000b450: 745f 6d65 7468 6f64 7320 696d 706f 7274  t_methods import
+0000b460: 2044 6a73 7472 6970 6550 6179 6d65 6e74   DjstripePayment
+0000b470: 4d65 7468 6f64 0a0a 2020 2020 2020 2020  Method..        
+0000b480: 7375 7065 7228 292e 5f61 7474 6163 685f  super()._attach_
+0000b490: 6f62 6a65 6374 735f 706f 7374 5f73 6176  objects_post_sav
+0000b4a0: 655f 686f 6f6b 280a 2020 2020 2020 2020  e_hook(.        
+0000b4b0: 2020 2020 636c 732c 2064 6174 612c 2070      cls, data, p
+0000b4c0: 656e 6469 6e67 5f72 656c 6174 696f 6e73  ending_relations
+0000b4d0: 3d70 656e 6469 6e67 5f72 656c 6174 696f  =pending_relatio
+0000b4e0: 6e73 2c20 6170 695f 6b65 793d 6170 695f  ns, api_key=api_
+0000b4f0: 6b65 790a 2020 2020 2020 2020 290a 0a20  key.        ).. 
+0000b500: 2020 2020 2020 2073 6176 6520 3d20 4661         save = Fa
+0000b510: 6c73 650a 0a20 2020 2020 2020 2063 7573  lse..        cus
+0000b520: 746f 6d65 725f 736f 7572 6365 7320 3d20  tomer_sources = 
+0000b530: 6461 7461 2e67 6574 2822 736f 7572 6365  data.get("source
+0000b540: 7322 290a 2020 2020 2020 2020 736f 7572  s").        sour
+0000b550: 6365 7320 3d20 7b7d 0a20 2020 2020 2020  ces = {}.       
+0000b560: 2069 6620 6375 7374 6f6d 6572 5f73 6f75   if customer_sou
+0000b570: 7263 6573 3a0a 2020 2020 2020 2020 2020  rces:.          
+0000b580: 2020 2320 4861 7665 2074 6f20 6372 6561    # Have to crea
+0000b590: 7465 2073 6f75 7263 6573 2062 6566 6f72  te sources befor
+0000b5a0: 6520 7765 2068 616e 646c 6520 7468 6520  e we handle the 
+0000b5b0: 6465 6661 756c 745f 736f 7572 6365 0a20  default_source. 
+0000b5c0: 2020 2020 2020 2020 2020 2023 2057 6520             # We 
+0000b5d0: 7361 7665 2061 6c6c 206f 6620 7468 656d  save all of them
+0000b5e0: 2069 6e20 7468 6520 6073 6f75 7263 6573   in the `sources
+0000b5f0: 6020 6469 6374 2c20 736f 2074 6861 7420  ` dict, so that 
+0000b600: 7765 2063 616e 2066 696e 6420 7468 656d  we can find them
+0000b610: 0a20 2020 2020 2020 2020 2020 2023 2062  .            # b
+0000b620: 7920 6964 2077 6865 6e20 7765 206c 6f6f  y id when we loo
+0000b630: 6b20 6174 2074 6865 2064 6566 6175 6c74  k at the default
+0000b640: 5f73 6f75 7263 6520 2877 6520 6e65 6564  _source (we need
+0000b650: 2074 6865 2073 6f75 7263 6520 7479 7065   the source type
+0000b660: 292e 0a20 2020 2020 2020 2020 2020 2066  )..            f
+0000b670: 6f72 2073 6f75 7263 6520 696e 2063 7573  or source in cus
+0000b680: 746f 6d65 725f 736f 7572 6365 735b 2264  tomer_sources["d
+0000b690: 6174 6122 5d3a 0a20 2020 2020 2020 2020  ata"]:.         
+0000b6a0: 2020 2020 2020 206f 626a 2c20 5f20 3d20         obj, _ = 
+0000b6b0: 446a 7374 7269 7065 5061 796d 656e 744d  DjstripePaymentM
+0000b6c0: 6574 686f 642e 5f67 6574 5f6f 725f 6372  ethod._get_or_cr
+0000b6d0: 6561 7465 5f73 6f75 7263 6528 0a20 2020  eate_source(.   
+0000b6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b6f0: 2073 6f75 7263 652c 2073 6f75 7263 655b   source, source[
+0000b700: 226f 626a 6563 7422 5d2c 2061 7069 5f6b  "object"], api_k
+0000b710: 6579 3d61 7069 5f6b 6579 0a20 2020 2020  ey=api_key.     
+0000b720: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0000b730: 2020 2020 2020 2020 2020 2020 2073 6f75               sou
+0000b740: 7263 6573 5b73 6f75 7263 655b 2269 6422  rces[source["id"
+0000b750: 5d5d 203d 206f 626a 0a0a 2020 2020 2020  ]] = obj..      
+0000b760: 2020 6469 7363 6f75 6e74 203d 2064 6174    discount = dat
+0000b770: 612e 6765 7428 2264 6973 636f 756e 7422  a.get("discount"
+0000b780: 290a 2020 2020 2020 2020 6966 2064 6973  ).        if dis
+0000b790: 636f 756e 743a 0a20 2020 2020 2020 2020  count:.         
+0000b7a0: 2020 2063 6f75 706f 6e2c 205f 6372 6561     coupon, _crea
+0000b7b0: 7465 6420 3d20 436f 7570 6f6e 2e5f 6765  ted = Coupon._ge
+0000b7c0: 745f 6f72 5f63 7265 6174 655f 6672 6f6d  t_or_create_from
+0000b7d0: 5f73 7472 6970 655f 6f62 6a65 6374 280a  _stripe_object(.
+0000b7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b7f0: 6469 7363 6f75 6e74 2c20 2263 6f75 706f  discount, "coupo
+0000b800: 6e22 2c20 6170 695f 6b65 793d 6170 695f  n", api_key=api_
+0000b810: 6b65 790a 2020 2020 2020 2020 2020 2020  key.            
+0000b820: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+0000b830: 2063 6f75 706f 6e20 616e 6420 636f 7570   coupon and coup
+0000b840: 6f6e 2021 3d20 7365 6c66 2e63 6f75 706f  on != self.coupo
+0000b850: 6e3a 0a20 2020 2020 2020 2020 2020 2020  n:.             
+0000b860: 2020 2073 656c 662e 636f 7570 6f6e 203d     self.coupon =
+0000b870: 2063 6f75 706f 6e0a 2020 2020 2020 2020   coupon.        
+0000b880: 2020 2020 2020 2020 7361 7665 203d 2054          save = T
+0000b890: 7275 650a 2020 2020 2020 2020 656c 6966  rue.        elif
+0000b8a0: 2073 656c 662e 636f 7570 6f6e 3a0a 2020   self.coupon:.  
+0000b8b0: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
+0000b8c0: 6f75 706f 6e20 3d20 4e6f 6e65 0a20 2020  oupon = None.   
+0000b8d0: 2020 2020 2020 2020 2073 6176 6520 3d20           save = 
+0000b8e0: 5472 7565 0a0a 2020 2020 2020 2020 6966  True..        if
+0000b8f0: 2073 6176 653a 0a20 2020 2020 2020 2020   save:.         
+0000b900: 2020 2073 656c 662e 7361 7665 2829 0a0a     self.save()..
+0000b910: 2020 2020 6465 6620 5f61 7474 6163 685f      def _attach_
+0000b920: 6f62 6a65 6374 735f 686f 6f6b 280a 2020  objects_hook(.  
+0000b930: 2020 2020 2020 7365 6c66 2c20 636c 732c        self, cls,
+0000b940: 2064 6174 612c 2063 7572 7265 6e74 5f69   data, current_i
+0000b950: 6473 3d4e 6f6e 652c 2061 7069 5f6b 6579  ds=None, api_key
+0000b960: 3d64 6a73 7472 6970 655f 7365 7474 696e  =djstripe_settin
+0000b970: 6773 2e53 5452 4950 455f 5345 4352 4554  gs.STRIPE_SECRET
+0000b980: 5f4b 4559 0a20 2020 2029 3a0a 2020 2020  _KEY.    ):.    
+0000b990: 2020 2020 2320 5768 656e 2077 6520 7361      # When we sa
+0000b9a0: 7665 2061 2063 7573 746f 6d65 7220 746f  ve a customer to
+0000b9b0: 2053 7472 6970 652c 2077 6520 6164 6420   Stripe, we add 
+0000b9c0: 6120 7265 6665 7265 6e63 6520 746f 2069  a reference to i
+0000b9d0: 7473 2044 6a61 6e67 6f20 504b 0a20 2020  ts Django PK.   
+0000b9e0: 2020 2020 2023 2069 6e20 7468 6520 6064       # in the `d
+0000b9f0: 6a61 6e67 6f5f 6163 636f 756e 7460 206b  jango_account` k
+0000ba00: 6579 2e20 4966 2077 6520 6669 6e64 2074  ey. If we find t
+0000ba10: 6861 742c 2077 6520 7265 2d61 7474 6163  hat, we re-attac
+0000ba20: 6820 7468 6174 2050 4b2e 0a20 2020 2020  h that PK..     
+0000ba30: 2020 2073 7562 7363 7269 6265 725f 6b65     subscriber_ke
+0000ba40: 7920 3d20 646a 7374 7269 7065 5f73 6574  y = djstripe_set
+0000ba50: 7469 6e67 732e 5355 4253 4352 4942 4552  tings.SUBSCRIBER
+0000ba60: 5f43 5553 544f 4d45 525f 4b45 590a 2020  _CUSTOMER_KEY.  
+0000ba70: 2020 2020 2020 6966 2073 7562 7363 7269        if subscri
+0000ba80: 6265 725f 6b65 7920 696e 2028 2222 2c20  ber_key in ("", 
+0000ba90: 4e6f 6e65 293a 0a20 2020 2020 2020 2020  None):.         
+0000baa0: 2020 2023 2044 6973 6162 6c65 642e 204e     # Disabled. N
+0000bab0: 6f74 6869 6e67 2065 6c73 6520 746f 2064  othing else to d
+0000bac0: 6f2e 0a20 2020 2020 2020 2020 2020 2072  o..            r
+0000bad0: 6574 7572 6e0a 0a20 2020 2020 2020 2073  eturn..        s
+0000bae0: 7562 7363 7269 6265 725f 6964 203d 2064  ubscriber_id = d
+0000baf0: 6174 612e 6765 7428 226d 6574 6164 6174  ata.get("metadat
+0000bb00: 6122 2c20 7b7d 292e 6765 7428 7375 6273  a", {}).get(subs
+0000bb10: 6372 6962 6572 5f6b 6579 290a 2020 2020  criber_key).    
+0000bb20: 2020 2020 6966 2073 7562 7363 7269 6265      if subscribe
+0000bb30: 725f 6964 3a0a 2020 2020 2020 2020 2020  r_id:.          
+0000bb40: 2020 636c 7320 3d20 646a 7374 7269 7065    cls = djstripe
+0000bb50: 5f73 6574 7469 6e67 732e 6765 745f 7375  _settings.get_su
+0000bb60: 6273 6372 6962 6572 5f6d 6f64 656c 2829  bscriber_model()
+0000bb70: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
+0000bb80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000bb90: 2020 2320 5765 2068 6176 6520 746f 2070    # We have to p
+0000bba0: 6572 666f 726d 2061 2067 6574 2829 2c20  erform a get(), 
+0000bbb0: 696e 7374 6561 6420 6f66 206a 7573 7420  instead of just 
+0000bbc0: 6174 7461 6368 696e 6720 7468 6520 504b  attaching the PK
+0000bbd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000bbe0: 2023 2062 6c69 6e64 6c79 2061 7320 7468   # blindly as th
+0000bbf0: 6520 6f62 6a65 6374 206d 6179 2068 6176  e object may hav
+0000bc00: 6520 6265 656e 2064 656c 6574 6564 206f  e been deleted o
+0000bc10: 7220 6e6f 7420 6578 6973 742e 0a20 2020  r not exist..   
+0000bc20: 2020 2020 2020 2020 2020 2020 2023 2041               # A
+0000bc30: 7474 656d 7074 696e 6720 746f 2073 6176  ttempting to sav
+0000bc40: 6520 7468 6174 2077 6f75 6c64 2063 6175  e that would cau
+0000bc50: 7365 2061 6e20 496e 7465 6772 6974 7945  se an IntegrityE
+0000bc60: 7272 6f72 2e0a 2020 2020 2020 2020 2020  rror..          
+0000bc70: 2020 2020 2020 7365 6c66 2e73 7562 7363        self.subsc
+0000bc80: 7269 6265 7220 3d20 636c 732e 6f62 6a65  riber = cls.obje
+0000bc90: 6374 732e 6765 7428 706b 3d73 7562 7363  cts.get(pk=subsc
+0000bca0: 7269 6265 725f 6964 290a 2020 2020 2020  riber_id).      
+0000bcb0: 2020 2020 2020 6578 6365 7074 2028 636c        except (cl
+0000bcc0: 732e 446f 6573 4e6f 7445 7869 7374 2c20  s.DoesNotExist, 
+0000bcd0: 5661 6c75 6545 7272 6f72 293a 0a20 2020  ValueError):.   
+0000bce0: 2020 2020 2020 2020 2020 2020 206c 6f67               log
+0000bcf0: 6765 722e 7761 726e 696e 6728 0a20 2020  ger.warning(.   
+0000bd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bd10: 2022 436f 756c 6420 6e6f 7420 6669 6e64   "Could not find
+0000bd20: 2073 7562 7363 7269 6265 7220 2572 206d   subscriber %r m
+0000bd30: 6174 6368 696e 6720 6375 7374 6f6d 6572  atching customer
+0000bd40: 2025 7222 2c0a 2020 2020 2020 2020 2020   %r",.          
+0000bd50: 2020 2020 2020 2020 2020 7375 6273 6372            subscr
+0000bd60: 6962 6572 5f69 642c 0a20 2020 2020 2020  iber_id,.       
+0000bd70: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0000bd80: 662e 6964 2c0a 2020 2020 2020 2020 2020  f.id,.          
+0000bd90: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0000bda0: 2020 2020 2020 2020 7365 6c66 2e73 7562          self.sub
+0000bdb0: 7363 7269 6265 7220 3d20 4e6f 6e65 0a0a  scriber = None..
+0000bdc0: 2020 2020 2320 5359 4e43 206d 6574 686f      # SYNC metho
+0000bdd0: 6473 2073 686f 756c 6420 6265 2064 726f  ds should be dro
+0000bde0: 7070 6564 2069 6e20 6661 766f 7220 6f66  pped in favor of
+0000bdf0: 2074 6865 206d 6173 7465 7220 7379 6e63   the master sync
+0000be00: 2069 6e66 7261 7374 7275 6374 7572 6520   infrastructure 
+0000be10: 7072 6f70 6f73 6564 0a20 2020 2064 6566  proposed.    def
+0000be20: 205f 7379 6e63 5f69 6e76 6f69 6365 7328   _sync_invoices(
+0000be30: 7365 6c66 2c20 2a2a 6b77 6172 6773 293a  self, **kwargs):
+0000be40: 0a20 2020 2020 2020 2066 726f 6d20 2e62  .        from .b
+0000be50: 696c 6c69 6e67 2069 6d70 6f72 7420 496e  illing import In
+0000be60: 766f 6963 650a 0a20 2020 2020 2020 2061  voice..        a
+0000be70: 7069 5f6b 6579 203d 206b 7761 7267 732e  pi_key = kwargs.
+0000be80: 6765 7428 2261 7069 5f6b 6579 2229 206f  get("api_key") o
+0000be90: 7220 7365 6c66 2e64 6566 6175 6c74 5f61  r self.default_a
+0000bea0: 7069 5f6b 6579 0a20 2020 2020 2020 2066  pi_key.        f
+0000beb0: 6f72 2073 7472 6970 655f 696e 766f 6963  or stripe_invoic
+0000bec0: 6520 696e 2049 6e76 6f69 6365 2e61 7069  e in Invoice.api
+0000bed0: 5f6c 6973 7428 6375 7374 6f6d 6572 3d73  _list(customer=s
+0000bee0: 656c 662e 6964 2c20 2a2a 6b77 6172 6773  elf.id, **kwargs
+0000bef0: 293a 0a20 2020 2020 2020 2020 2020 2049  ):.            I
+0000bf00: 6e76 6f69 6365 2e73 796e 635f 6672 6f6d  nvoice.sync_from
+0000bf10: 5f73 7472 6970 655f 6461 7461 2873 7472  _stripe_data(str
+0000bf20: 6970 655f 696e 766f 6963 652c 2061 7069  ipe_invoice, api
+0000bf30: 5f6b 6579 3d61 7069 5f6b 6579 290a 0a20  _key=api_key).. 
+0000bf40: 2020 2064 6566 205f 7379 6e63 5f63 6861     def _sync_cha
+0000bf50: 7267 6573 2873 656c 662c 202a 2a6b 7761  rges(self, **kwa
+0000bf60: 7267 7329 3a0a 2020 2020 2020 2020 6170  rgs):.        ap
+0000bf70: 695f 6b65 7920 3d20 6b77 6172 6773 2e67  i_key = kwargs.g
+0000bf80: 6574 2822 6170 695f 6b65 7922 2920 6f72  et("api_key") or
+0000bf90: 2073 656c 662e 6465 6661 756c 745f 6170   self.default_ap
+0000bfa0: 695f 6b65 790a 2020 2020 2020 2020 666f  i_key.        fo
+0000bfb0: 7220 7374 7269 7065 5f63 6861 7267 6520  r stripe_charge 
+0000bfc0: 696e 2043 6861 7267 652e 6170 695f 6c69  in Charge.api_li
+0000bfd0: 7374 2863 7573 746f 6d65 723d 7365 6c66  st(customer=self
+0000bfe0: 2e69 642c 202a 2a6b 7761 7267 7329 3a0a  .id, **kwargs):.
+0000bff0: 2020 2020 2020 2020 2020 2020 4368 6172              Char
+0000c000: 6765 2e73 796e 635f 6672 6f6d 5f73 7472  ge.sync_from_str
+0000c010: 6970 655f 6461 7461 2873 7472 6970 655f  ipe_data(stripe_
+0000c020: 6368 6172 6765 2c20 6170 695f 6b65 793d  charge, api_key=
+0000c030: 6170 695f 6b65 7929 0a0a 2020 2020 6465  api_key)..    de
+0000c040: 6620 5f73 796e 635f 6361 7264 7328 7365  f _sync_cards(se
+0000c050: 6c66 2c20 2a2a 6b77 6172 6773 293a 0a20  lf, **kwargs):. 
+0000c060: 2020 2020 2020 2066 726f 6d20 2e70 6179         from .pay
+0000c070: 6d65 6e74 5f6d 6574 686f 6473 2069 6d70  ment_methods imp
+0000c080: 6f72 7420 4361 7264 0a0a 2020 2020 2020  ort Card..      
+0000c090: 2020 6170 695f 6b65 7920 3d20 6b77 6172    api_key = kwar
+0000c0a0: 6773 2e67 6574 2822 6170 695f 6b65 7922  gs.get("api_key"
+0000c0b0: 2920 6f72 2073 656c 662e 6465 6661 756c  ) or self.defaul
+0000c0c0: 745f 6170 695f 6b65 790a 2020 2020 2020  t_api_key.      
+0000c0d0: 2020 666f 7220 7374 7269 7065 5f63 6172    for stripe_car
+0000c0e0: 6420 696e 2043 6172 642e 6170 695f 6c69  d in Card.api_li
+0000c0f0: 7374 2863 7573 746f 6d65 723d 7365 6c66  st(customer=self
+0000c100: 2c20 2a2a 6b77 6172 6773 293a 0a20 2020  , **kwargs):.   
+0000c110: 2020 2020 2020 2020 2043 6172 642e 7379           Card.sy
+0000c120: 6e63 5f66 726f 6d5f 7374 7269 7065 5f64  nc_from_stripe_d
+0000c130: 6174 6128 7374 7269 7065 5f63 6172 642c  ata(stripe_card,
+0000c140: 2061 7069 5f6b 6579 3d61 7069 5f6b 6579   api_key=api_key
+0000c150: 290a 0a20 2020 2064 6566 205f 7379 6e63  )..    def _sync
+0000c160: 5f73 7562 7363 7269 7074 696f 6e73 2873  _subscriptions(s
+0000c170: 656c 662c 202a 2a6b 7761 7267 7329 3a0a  elf, **kwargs):.
+0000c180: 2020 2020 2020 2020 6672 6f6d 202e 6269          from .bi
+0000c190: 6c6c 696e 6720 696d 706f 7274 2053 7562  lling import Sub
+0000c1a0: 7363 7269 7074 696f 6e0a 0a20 2020 2020  scription..     
+0000c1b0: 2020 2061 7069 5f6b 6579 203d 206b 7761     api_key = kwa
+0000c1c0: 7267 732e 6765 7428 2261 7069 5f6b 6579  rgs.get("api_key
+0000c1d0: 2229 206f 7220 7365 6c66 2e64 6566 6175  ") or self.defau
+0000c1e0: 6c74 5f61 7069 5f6b 6579 0a20 2020 2020  lt_api_key.     
+0000c1f0: 2020 2066 6f72 2073 7472 6970 655f 7375     for stripe_su
+0000c200: 6273 6372 6970 7469 6f6e 2069 6e20 5375  bscription in Su
+0000c210: 6273 6372 6970 7469 6f6e 2e61 7069 5f6c  bscription.api_l
+0000c220: 6973 7428 0a20 2020 2020 2020 2020 2020  ist(.           
+0000c230: 2063 7573 746f 6d65 723d 7365 6c66 2e69   customer=self.i
+0000c240: 642c 2073 7461 7475 733d 2261 6c6c 222c  d, status="all",
+0000c250: 202a 2a6b 7761 7267 730a 2020 2020 2020   **kwargs.      
+0000c260: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
+0000c270: 2053 7562 7363 7269 7074 696f 6e2e 7379   Subscription.sy
+0000c280: 6e63 5f66 726f 6d5f 7374 7269 7065 5f64  nc_from_stripe_d
+0000c290: 6174 6128 7374 7269 7065 5f73 7562 7363  ata(stripe_subsc
+0000c2a0: 7269 7074 696f 6e2c 2061 7069 5f6b 6579  ription, api_key
+0000c2b0: 3d61 7069 5f6b 6579 290a 0a0a 636c 6173  =api_key)...clas
+0000c2c0: 7320 4469 7370 7574 6528 5374 7269 7065  s Dispute(Stripe
+0000c2d0: 4d6f 6465 6c29 3a0a 2020 2020 2222 220a  Model):.    """.
+0000c2e0: 2020 2020 4120 6469 7370 7574 6520 6f63      A dispute oc
+0000c2f0: 6375 7273 2077 6865 6e20 6120 6375 7374  curs when a cust
+0000c300: 6f6d 6572 2071 7565 7374 696f 6e73 2079  omer questions y
+0000c310: 6f75 7220 6368 6172 6765 2077 6974 6820  our charge with 
+0000c320: 7468 6569 720a 2020 2020 6361 7264 2069  their.    card i
+0000c330: 7373 7565 722e 2057 6865 6e20 7468 6973  ssuer. When this
+0000c340: 2068 6170 7065 6e73 2c20 796f 7527 7265   happens, you're
+0000c350: 2067 6976 656e 2074 6865 206f 7070 6f72   given the oppor
+0000c360: 7475 6e69 7479 2074 6f0a 2020 2020 7265  tunity to.    re
+0000c370: 7370 6f6e 6420 746f 2074 6865 2064 6973  spond to the dis
+0000c380: 7075 7465 2077 6974 6820 6576 6964 656e  pute with eviden
+0000c390: 6365 2074 6861 7420 7368 6f77 7320 7468  ce that shows th
+0000c3a0: 6174 2074 6865 2063 6861 7267 6520 6973  at the charge is
+0000c3b0: 206c 6567 6974 696d 6174 650a 0a20 2020   legitimate..   
+0000c3c0: 2053 7472 6970 6520 646f 6375 6d65 6e74   Stripe document
+0000c3d0: 6174 696f 6e3a 2068 7474 7073 3a2f 2f73  ation: https://s
+0000c3e0: 7472 6970 652e 636f 6d2f 646f 6373 2f61  tripe.com/docs/a
+0000c3f0: 7069 3f6c 616e 673d 7079 7468 6f6e 2364  pi?lang=python#d
+0000c400: 6973 7075 7465 730a 2020 2020 2222 220a  isputes.    """.
+0000c410: 0a20 2020 2073 7472 6970 655f 636c 6173  .    stripe_clas
+0000c420: 7320 3d20 7374 7269 7065 2e44 6973 7075  s = stripe.Dispu
+0000c430: 7465 0a20 2020 2073 7472 6970 655f 6461  te.    stripe_da
+0000c440: 7368 626f 6172 645f 6974 656d 5f6e 616d  shboard_item_nam
+0000c450: 6520 3d20 2270 6179 6d65 6e74 7322 0a0a  e = "payments"..
+0000c460: 2020 2020 616d 6f75 6e74 203d 2053 7472      amount = Str
+0000c470: 6970 6551 7561 6e74 756d 4375 7272 656e  ipeQuantumCurren
+0000c480: 6379 416d 6f75 6e74 4669 656c 6428 0a20  cyAmountField(. 
+0000c490: 2020 2020 2020 2068 656c 705f 7465 7874         help_text
+0000c4a0: 3d28 0a20 2020 2020 2020 2020 2020 2022  =(.            "
+0000c4b0: 4469 7370 7574 6564 2061 6d6f 756e 7420  Disputed amount 
+0000c4c0: 2869 6e20 6365 6e74 7329 2e20 5573 7561  (in cents). Usua
+0000c4d0: 6c6c 7920 7468 6520 616d 6f75 6e74 206f  lly the amount o
+0000c4e0: 6620 7468 6520 6368 6172 6765 2c20 220a  f the charge, ".
+0000c4f0: 2020 2020 2020 2020 2020 2020 2262 7574              "but
+0000c500: 2063 616e 2064 6966 6665 7220 220a 2020   can differ ".  
+0000c510: 2020 2020 2020 2020 2020 2228 7573 7561            "(usua
+0000c520: 6c6c 7920 6265 6361 7573 6520 6f66 2063  lly because of c
+0000c530: 7572 7265 6e63 7920 666c 7563 7475 6174  urrency fluctuat
+0000c540: 696f 6e20 6f72 2062 6563 6175 7365 206f  ion or because o
+0000c550: 6e6c 7920 7061 7274 206f 6620 220a 2020  nly part of ".  
+0000c560: 2020 2020 2020 2020 2020 2274 6865 206f            "the o
+0000c570: 7264 6572 2069 7320 6469 7370 7574 6564  rder is disputed
+0000c580: 292e 220a 2020 2020 2020 2020 290a 2020  ).".        ).  
+0000c590: 2020 290a 2020 2020 6261 6c61 6e63 655f    ).    balance_
+0000c5a0: 7472 616e 7361 6374 696f 6e20 3d20 5374  transaction = St
+0000c5b0: 7269 7065 466f 7265 6967 6e4b 6579 280a  ripeForeignKey(.
+0000c5c0: 2020 2020 2020 2020 2242 616c 616e 6365          "Balance
+0000c5d0: 5472 616e 7361 6374 696f 6e22 2c0a 2020  Transaction",.  
+0000c5e0: 2020 2020 2020 6e75 6c6c 3d54 7275 652c        null=True,
+0000c5f0: 0a20 2020 2020 2020 206f 6e5f 6465 6c65  .        on_dele
+0000c600: 7465 3d6d 6f64 656c 732e 4341 5343 4144  te=models.CASCAD
+0000c610: 452c 0a20 2020 2020 2020 2072 656c 6174  E,.        relat
+0000c620: 6564 5f6e 616d 653d 2264 6973 7075 7465  ed_name="dispute
+0000c630: 7322 2c0a 2020 2020 2020 2020 6865 6c70  s",.        help
+0000c640: 5f74 6578 743d 280a 2020 2020 2020 2020  _text=(.        
+0000c650: 2020 2020 2242 616c 616e 6365 2074 7261      "Balance tra
+0000c660: 6e73 6163 7469 6f6e 2074 6861 7420 6465  nsaction that de
+0000c670: 7363 7269 6265 7320 7468 6520 696d 7061  scribes the impa
+0000c680: 6374 206f 6e20 796f 7572 2061 6363 6f75  ct on your accou
+0000c690: 6e74 2062 616c 616e 6365 2e22 0a20 2020  nt balance.".   
+0000c6a0: 2020 2020 2029 2c0a 2020 2020 290a 2020       ),.    ).  
+0000c6b0: 2020 6261 6c61 6e63 655f 7472 616e 7361    balance_transa
+0000c6c0: 6374 696f 6e73 203d 204a 534f 4e46 6965  ctions = JSONFie
+0000c6d0: 6c64 280a 2020 2020 2020 2020 6465 6661  ld(.        defa
+0000c6e0: 756c 743d 6c69 7374 2c0a 2020 2020 2020  ult=list,.      
+0000c6f0: 2020 6865 6c70 5f74 6578 743d 280a 2020    help_text=(.  
+0000c700: 2020 2020 2020 2020 2020 224c 6973 7420            "List 
+0000c710: 6f66 2030 2c20 3120 6f72 2032 2042 616c  of 0, 1 or 2 Bal
+0000c720: 616e 6365 2054 7261 6e73 6163 7469 6f6e  ance Transaction
+0000c730: 7320 7468 6174 2073 686f 7720 6675 6e64  s that show fund
+0000c740: 7320 7769 7468 6472 6177 6e20 616e 6422  s withdrawn and"
+0000c750: 0a20 2020 2020 2020 2020 2020 2022 2072  .            " r
+0000c760: 6569 6e73 7461 7465 6420 746f 2079 6f75  einstated to you
+0000c770: 7220 5374 7269 7065 2061 6363 6f75 6e74  r Stripe account
+0000c780: 2061 7320 6120 7265 7375 6c74 206f 6620   as a result of 
+0000c790: 7468 6973 2064 6973 7075 7465 2e22 0a20  this dispute.". 
+0000c7a0: 2020 2020 2020 2029 2c0a 2020 2020 290a         ),.    ).
+0000c7b0: 2020 2020 2320 6368 6172 6765 2069 7320      # charge is 
+0000c7c0: 6e75 6c6c 6162 6c65 2074 6f20 6176 6f69  nullable to avoi
+0000c7d0: 6420 696e 6669 6e69 7465 2073 796e 6320  d infinite sync 
+0000c7e0: 6173 2043 6861 7267 6520 6d6f 6465 6c20  as Charge model 
+0000c7f0: 6861 7320 6120 6469 7370 7574 6520 6669  has a dispute fi
+0000c800: 656c 6420 6173 2077 656c 6c0a 2020 2020  eld as well.    
+0000c810: 6368 6172 6765 203d 2053 7472 6970 6546  charge = StripeF
+0000c820: 6f72 6569 676e 4b65 7928 0a20 2020 2020  oreignKey(.     
+0000c830: 2020 2022 4368 6172 6765 222c 0a20 2020     "Charge",.   
+0000c840: 2020 2020 206e 756c 6c3d 5472 7565 2c0a       null=True,.
+0000c850: 2020 2020 2020 2020 6f6e 5f64 656c 6574          on_delet
+0000c860: 653d 6d6f 6465 6c73 2e43 4153 4341 4445  e=models.CASCADE
+0000c870: 2c0a 2020 2020 2020 2020 7265 6c61 7465  ,.        relate
+0000c880: 645f 6e61 6d65 3d22 6469 7370 7574 6573  d_name="disputes
+0000c890: 222c 0a20 2020 2020 2020 2068 656c 705f  ",.        help_
+0000c8a0: 7465 7874 3d22 5468 6520 6368 6172 6765  text="The charge
+0000c8b0: 2074 6861 7420 7761 7320 6469 7370 7574   that was disput
+0000c8c0: 6564 222c 0a20 2020 2029 0a20 2020 2063  ed",.    ).    c
+0000c8d0: 7572 7265 6e63 7920 3d20 5374 7269 7065  urrency = Stripe
+0000c8e0: 4375 7272 656e 6379 436f 6465 4669 656c  CurrencyCodeFiel
+0000c8f0: 6428 290a 2020 2020 6576 6964 656e 6365  d().    evidence
+0000c900: 203d 204a 534f 4e46 6965 6c64 2868 656c   = JSONField(hel
+0000c910: 705f 7465 7874 3d22 4576 6964 656e 6365  p_text="Evidence
+0000c920: 2070 726f 7669 6465 6420 746f 2072 6573   provided to res
+0000c930: 706f 6e64 2074 6f20 6120 6469 7370 7574  pond to a disput
+0000c940: 652e 2229 0a20 2020 2065 7669 6465 6e63  e.").    evidenc
+0000c950: 655f 6465 7461 696c 7320 3d20 4a53 4f4e  e_details = JSON
+0000c960: 4669 656c 6428 6865 6c70 5f74 6578 743d  Field(help_text=
+0000c970: 2249 6e66 6f72 6d61 7469 6f6e 2061 626f  "Information abo
+0000c980: 7574 2074 6865 2065 7669 6465 6e63 6520  ut the evidence 
+0000c990: 7375 626d 6973 7369 6f6e 2e22 290a 2020  submission.").  
+0000c9a0: 2020 6973 5f63 6861 7267 655f 7265 6675    is_charge_refu
+0000c9b0: 6e64 6162 6c65 203d 206d 6f64 656c 732e  ndable = models.
+0000c9c0: 426f 6f6c 6561 6e46 6965 6c64 280a 2020  BooleanField(.  
+0000c9d0: 2020 2020 2020 6865 6c70 5f74 6578 743d        help_text=
+0000c9e0: 280a 2020 2020 2020 2020 2020 2020 2249  (.            "I
+0000c9f0: 6620 7472 7565 2c20 6974 2069 7320 7374  f true, it is st
+0000ca00: 696c 6c20 706f 7373 6962 6c65 2074 6f20  ill possible to 
+0000ca10: 7265 6675 6e64 2074 6865 2064 6973 7075  refund the dispu
+0000ca20: 7465 6420 7061 796d 656e 742e 2022 0a20  ted payment. ". 
+0000ca30: 2020 2020 2020 2020 2020 2022 4f6e 6365             "Once
+0000ca40: 2074 6865 2070 6179 6d65 6e74 2068 6173   the payment has
+0000ca50: 2062 6565 6e20 6675 6c6c 7920 7265 6675   been fully refu
+0000ca60: 6e64 6564 2c20 6e6f 2066 7572 7468 6572  nded, no further
+0000ca70: 2066 756e 6473 2077 696c 6c20 220a 2020   funds will ".  
+0000ca80: 2020 2020 2020 2020 2020 2262 6520 7769            "be wi
+0000ca90: 7468 6472 6177 6e20 6672 6f6d 2079 6f75  thdrawn from you
+0000caa0: 7220 5374 7269 7065 2061 6363 6f75 6e74  r Stripe account
+0000cab0: 2061 7320 6120 7265 7375 6c74 206f 6620   as a result of 
+0000cac0: 7468 6973 2064 6973 7075 7465 2e22 0a20  this dispute.". 
+0000cad0: 2020 2020 2020 2029 0a20 2020 2029 0a20         ).    ). 
+0000cae0: 2020 2070 6179 6d65 6e74 5f69 6e74 656e     payment_inten
+0000caf0: 7420 3d20 5374 7269 7065 466f 7265 6967  t = StripeForeig
+0000cb00: 6e4b 6579 280a 2020 2020 2020 2020 2250  nKey(.        "P
+0000cb10: 6179 6d65 6e74 496e 7465 6e74 222c 0a20  aymentIntent",. 
+0000cb20: 2020 2020 2020 206e 756c 6c3d 5472 7565         null=True
+0000cb30: 2c0a 2020 2020 2020 2020 6f6e 5f64 656c  ,.        on_del
+0000cb40: 6574 653d 6d6f 6465 6c73 2e43 4153 4341  ete=models.CASCA
+0000cb50: 4445 2c0a 2020 2020 2020 2020 7265 6c61  DE,.        rela
+0000cb60: 7465 645f 6e61 6d65 3d22 6469 7370 7574  ted_name="disput
+0000cb70: 6573 222c 0a20 2020 2020 2020 2068 656c  es",.        hel
+0000cb80: 705f 7465 7874 3d22 5468 6520 5061 796d  p_text="The Paym
+0000cb90: 656e 7449 6e74 656e 7420 7468 6174 2077  entIntent that w
+0000cba0: 6173 2064 6973 7075 7465 6422 2c0a 2020  as disputed",.  
+0000cbb0: 2020 290a 2020 2020 7265 6173 6f6e 203d    ).    reason =
+0000cbc0: 2053 7472 6970 6545 6e75 6d46 6965 6c64   StripeEnumField
+0000cbd0: 2865 6e75 6d3d 656e 756d 732e 4469 7370  (enum=enums.Disp
+0000cbe0: 7574 6552 6561 736f 6e29 0a20 2020 2073  uteReason).    s
+0000cbf0: 7461 7475 7320 3d20 5374 7269 7065 456e  tatus = StripeEn
+0000cc00: 756d 4669 656c 6428 656e 756d 3d65 6e75  umField(enum=enu
+0000cc10: 6d73 2e44 6973 7075 7465 5374 6174 7573  ms.DisputeStatus
+0000cc20: 290a 0a20 2020 2064 6566 205f 5f73 7472  )..    def __str
+0000cc30: 5f5f 2873 656c 6629 3a0a 2020 2020 2020  __(self):.      
+0000cc40: 2020 616d 6f75 6e74 203d 2067 6574 5f66    amount = get_f
+0000cc50: 7269 656e 646c 795f 6375 7272 656e 6379  riendly_currency
+0000cc60: 5f61 6d6f 756e 7428 7365 6c66 2e61 6d6f  _amount(self.amo
+0000cc70: 756e 7420 2f20 3130 302c 2073 656c 662e  unt / 100, self.
+0000cc80: 6375 7272 656e 6379 290a 2020 2020 2020  currency).      
+0000cc90: 2020 7374 6174 7573 203d 2065 6e75 6d73    status = enums
+0000cca0: 2e44 6973 7075 7465 5374 6174 7573 2e68  .DisputeStatus.h
+0000ccb0: 756d 616e 697a 6528 7365 6c66 2e73 7461  umanize(self.sta
+0000ccc0: 7475 7329 0a20 2020 2020 2020 2072 6574  tus).        ret
+0000ccd0: 7572 6e20 6622 7b61 6d6f 756e 747d 2028  urn f"{amount} (
+0000cce0: 7b73 7461 7475 737d 2920 220a 0a20 2020  {status}) "..   
+0000ccf0: 2064 6566 2067 6574 5f73 7472 6970 655f   def get_stripe_
+0000cd00: 6461 7368 626f 6172 645f 7572 6c28 7365  dashboard_url(se
+0000cd10: 6c66 2920 2d3e 2073 7472 3a0a 2020 2020  lf) -> str:.    
+0000cd20: 2020 2020 2222 2247 6574 2074 6865 2073      """Get the s
+0000cd30: 7472 6970 6520 6461 7368 626f 6172 6420  tripe dashboard 
+0000cd40: 7572 6c20 666f 7220 7468 6973 206f 626a  url for this obj
+0000cd50: 6563 742e 2222 220a 2020 2020 2020 2020  ect.""".        
+0000cd60: 7265 7475 726e 2028 0a20 2020 2020 2020  return (.       
+0000cd70: 2020 2020 2066 227b 7365 6c66 2e5f 6765       f"{self._ge
+0000cd80: 745f 6261 7365 5f73 7472 6970 655f 6461  t_base_stripe_da
+0000cd90: 7368 626f 6172 645f 7572 6c28 297d 220a  shboard_url()}".
+0000cda0: 2020 2020 2020 2020 2020 2020 6622 7b73              f"{s
+0000cdb0: 656c 662e 7374 7269 7065 5f64 6173 6862  elf.stripe_dashb
+0000cdc0: 6f61 7264 5f69 7465 6d5f 6e61 6d65 7d2f  oard_item_name}/
+0000cdd0: 7b73 656c 662e 7061 796d 656e 745f 696e  {self.payment_in
+0000cde0: 7465 6e74 2e69 647d 220a 2020 2020 2020  tent.id}".      
+0000cdf0: 2020 290a 0a20 2020 2064 6566 205f 6174    )..    def _at
+0000ce00: 7461 6368 5f6f 626a 6563 7473 5f70 6f73  tach_objects_pos
+0000ce10: 745f 7361 7665 5f68 6f6f 6b28 0a20 2020  t_save_hook(.   
+0000ce20: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+0000ce30: 2020 2063 6c73 2c0a 2020 2020 2020 2020     cls,.        
+0000ce40: 6461 7461 2c0a 2020 2020 2020 2020 7065  data,.        pe
+0000ce50: 6e64 696e 675f 7265 6c61 7469 6f6e 733d  nding_relations=
+0000ce60: 4e6f 6e65 2c0a 2020 2020 2020 2020 6170  None,.        ap
+0000ce70: 695f 6b65 793d 646a 7374 7269 7065 5f73  i_key=djstripe_s
+0000ce80: 6574 7469 6e67 732e 5354 5249 5045 5f53  ettings.STRIPE_S
+0000ce90: 4543 5245 545f 4b45 592c 0a20 2020 2029  ECRET_KEY,.    )
+0000cea0: 3a0a 2020 2020 2020 2020 7375 7065 7228  :.        super(
+0000ceb0: 292e 5f61 7474 6163 685f 6f62 6a65 6374  )._attach_object
+0000cec0: 735f 706f 7374 5f73 6176 655f 686f 6f6b  s_post_save_hook
+0000ced0: 280a 2020 2020 2020 2020 2020 2020 636c  (.            cl
+0000cee0: 732c 2064 6174 612c 2070 656e 6469 6e67  s, data, pending
+0000cef0: 5f72 656c 6174 696f 6e73 3d70 656e 6469  _relations=pendi
+0000cf00: 6e67 5f72 656c 6174 696f 6e73 2c20 6170  ng_relations, ap
+0000cf10: 695f 6b65 793d 6170 695f 6b65 790a 2020  i_key=api_key.  
+0000cf20: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+0000cf30: 2023 2052 6574 7269 6576 6520 616e 6420   # Retrieve and 
+0000cf40: 7361 7665 2066 696c 6573 2066 726f 6d20  save files from 
+0000cf50: 7468 6520 6469 7370 7574 652e 6576 6964  the dispute.evid
+0000cf60: 656e 6365 206f 626a 6563 742e 0a20 2020  ence object..   
+0000cf70: 2020 2020 2023 2074 6f64 6f20 6669 6e64       # todo find
+0000cf80: 2061 2062 6574 7465 7220 7761 7920 6f66   a better way of
+0000cf90: 2072 6574 7269 6576 696e 6720 616e 6420   retrieving and 
+0000cfa0: 7379 6e63 696e 6720 4669 6c65 2054 7970  syncing File Typ
+0000cfb0: 6520 6669 656c 6473 2066 726f 6d20 4469  e fields from Di
+0000cfc0: 7370 7574 6520 6f62 6a65 6374 0a20 2020  spute object.   
+0000cfd0: 2020 2020 2066 6f72 2066 6965 6c64 2069       for field i
+0000cfe0: 6e20 280a 2020 2020 2020 2020 2020 2020  n (.            
+0000cff0: 2263 616e 6365 6c6c 6174 696f 6e5f 706f  "cancellation_po
+0000d000: 6c69 6379 222c 0a20 2020 2020 2020 2020  licy",.         
+0000d010: 2020 2022 6375 7374 6f6d 6572 5f63 6f6d     "customer_com
+0000d020: 6d75 6e69 6361 7469 6f6e 222c 0a20 2020  munication",.   
+0000d030: 2020 2020 2020 2020 2022 6375 7374 6f6d           "custom
+0000d040: 6572 5f73 6967 6e61 7475 7265 222c 0a20  er_signature",. 
+0000d050: 2020 2020 2020 2020 2020 2022 6475 706c             "dupl
+0000d060: 6963 6174 655f 6368 6172 6765 5f64 6f63  icate_charge_doc
+0000d070: 756d 656e 7461 7469 6f6e 222c 0a20 2020  umentation",.   
+0000d080: 2020 2020 2020 2020 2022 7265 6365 6970           "receip
+0000d090: 7422 2c0a 2020 2020 2020 2020 2020 2020  t",.            
+0000d0a0: 2272 6566 756e 645f 706f 6c69 6379 222c  "refund_policy",
+0000d0b0: 0a20 2020 2020 2020 2020 2020 2022 7365  .            "se
+0000d0c0: 7276 6963 655f 646f 6375 6d65 6e74 6174  rvice_documentat
+0000d0d0: 696f 6e22 2c0a 2020 2020 2020 2020 2020  ion",.          
+0000d0e0: 2020 2273 6869 7070 696e 675f 646f 6375    "shipping_docu
+0000d0f0: 6d65 6e74 6174 696f 6e22 2c0a 2020 2020  mentation",.    
+0000d100: 2020 2020 2020 2020 2275 6e63 6174 6567          "uncateg
+0000d110: 6f72 697a 6564 5f66 696c 6522 2c0a 2020  orized_file",.  
+0000d120: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
+0000d130: 2020 2020 2066 696c 655f 7570 6c6f 6164       file_upload
+0000d140: 5f69 6420 3d20 7365 6c66 2e65 7669 6465  _id = self.evide
+0000d150: 6e63 652e 6765 7428 6669 656c 642c 204e  nce.get(field, N
+0000d160: 6f6e 6529 0a20 2020 2020 2020 2020 2020  one).           
+0000d170: 2069 6620 6669 6c65 5f75 706c 6f61 645f   if file_upload_
+0000d180: 6964 3a0a 2020 2020 2020 2020 2020 2020  id:.            
+0000d190: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0000d1a0: 2020 2020 2020 2020 2020 2020 2046 696c               Fil
+0000d1b0: 652e 7379 6e63 5f66 726f 6d5f 7374 7269  e.sync_from_stri
+0000d1c0: 7065 5f64 6174 6128 0a20 2020 2020 2020  pe_data(.       
+0000d1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d1e0: 2046 696c 6528 6964 3d66 696c 655f 7570   File(id=file_up
+0000d1f0: 6c6f 6164 5f69 6429 2e61 7069 5f72 6574  load_id).api_ret
+0000d200: 7269 6576 6528 6170 695f 6b65 793d 6170  rieve(api_key=ap
+0000d210: 695f 6b65 7929 2c0a 2020 2020 2020 2020  i_key),.        
+0000d220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d230: 6170 695f 6b65 793d 6170 695f 6b65 792c  api_key=api_key,
+0000d240: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d250: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+0000d260: 2020 2020 2020 2065 7863 6570 7420 7374         except st
+0000d270: 7269 7065 2e65 7272 6f72 2e50 6572 6d69  ripe.error.Permi
+0000d280: 7373 696f 6e45 7272 6f72 3a0a 2020 2020  ssionError:.    
+0000d290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d2a0: 2320 4e6f 2070 6572 6d69 7373 696f 6e20  # No permission 
+0000d2b0: 746f 2072 6574 7269 6576 6520 7468 6520  to retrieve the 
+0000d2c0: 6461 7461 2077 6974 6820 7468 6520 6b65  data with the ke
+0000d2d0: 790a 2020 2020 2020 2020 2020 2020 2020  y.              
+0000d2e0: 2020 2020 2020 2320 4c6f 6720 6120 7761        # Log a wa
+0000d2f0: 726e 696e 6720 6d65 7373 6167 650a 2020  rning message.  
+0000d300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d310: 2020 6c6f 6767 6572 2e77 6172 6e69 6e67    logger.warning
+0000d320: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000d330: 2020 2020 2020 2020 2020 224e 6f20 7065            "No pe
+0000d340: 726d 6973 7369 6f6e 2074 6f20 7265 7472  rmission to retr
+0000d350: 6965 7665 2074 6865 2046 696c 6520 4576  ieve the File Ev
+0000d360: 6964 656e 6365 204f 626a 6563 742e 220a  idence Object.".
+0000d370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d380: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+0000d390: 2020 2020 2020 6578 6365 7074 2073 7472        except str
+0000d3a0: 6970 652e 6572 726f 722e 496e 7661 6c69  ipe.error.Invali
+0000d3b0: 6452 6571 7565 7374 4572 726f 723a 0a20  dRequestError:. 
+0000d3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d3d0: 2020 2072 6169 7365 0a0a 2020 2020 2020     raise..      
+0000d3e0: 2020 2320 6974 6572 6174 6520 616e 6420    # iterate and 
+0000d3f0: 7379 6e63 2065 7665 7279 2062 616c 616e  sync every balan
+0000d400: 6365 2074 7261 6e73 6163 7469 6f6e 0a20  ce transaction. 
+0000d410: 2020 2020 2020 2066 6f72 2073 7472 6970         for strip
+0000d420: 655f 6261 6c61 6e63 655f 7472 616e 7361  e_balance_transa
+0000d430: 6374 696f 6e20 696e 2073 656c 662e 6261  ction in self.ba
+0000d440: 6c61 6e63 655f 7472 616e 7361 6374 696f  lance_transactio
+0000d450: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
+0000d460: 4261 6c61 6e63 6554 7261 6e73 6163 7469  BalanceTransacti
+0000d470: 6f6e 2e73 796e 635f 6672 6f6d 5f73 7472  on.sync_from_str
+0000d480: 6970 655f 6461 7461 280a 2020 2020 2020  ipe_data(.      
+0000d490: 2020 2020 2020 2020 2020 7374 7269 7065            stripe
+0000d4a0: 5f62 616c 616e 6365 5f74 7261 6e73 6163  _balance_transac
+0000d4b0: 7469 6f6e 2c20 6170 695f 6b65 793d 6170  tion, api_key=ap
+0000d4c0: 695f 6b65 790a 2020 2020 2020 2020 2020  i_key.          
+0000d4d0: 2020 290a 0a0a 636c 6173 7320 4576 656e    )...class Even
+0000d4e0: 7428 5374 7269 7065 4d6f 6465 6c29 3a0a  t(StripeModel):.
+0000d4f0: 2020 2020 2222 220a 2020 2020 4576 656e      """.    Even
+0000d500: 7473 2061 7265 2053 7472 6970 6527 7320  ts are Stripe's 
+0000d510: 7761 7920 6f66 206c 6574 7469 6e67 2079  way of letting y
+0000d520: 6f75 206b 6e6f 7720 7768 656e 2073 6f6d  ou know when som
+0000d530: 6574 6869 6e67 2069 6e74 6572 6573 7469  ething interesti
+0000d540: 6e67 0a20 2020 2068 6170 7065 6e73 2069  ng.    happens i
+0000d550: 6e20 796f 7572 2061 6363 6f75 6e74 2e0a  n your account..
+0000d560: 2020 2020 5768 656e 2061 6e20 696e 7465      When an inte
+0000d570: 7265 7374 696e 6720 6576 656e 7420 6f63  resting event oc
+0000d580: 6375 7273 2c20 6120 6e65 7720 4576 656e  curs, a new Even
+0000d590: 7420 6f62 6a65 6374 2069 7320 6372 6561  t object is crea
+0000d5a0: 7465 6420 616e 6420 504f 5354 6564 0a20  ted and POSTed. 
+0000d5b0: 2020 2074 6f20 7468 6520 636f 6e66 6967     to the config
+0000d5c0: 7572 6564 2077 6562 686f 6f6b 2055 524c  ured webhook URL
+0000d5d0: 2069 6620 7468 6520 4576 656e 7420 7479   if the Event ty
+0000d5e0: 7065 206d 6174 6368 6573 2e0a 0a20 2020  pe matches...   
+0000d5f0: 2053 7472 6970 6520 646f 6375 6d65 6e74   Stripe document
+0000d600: 6174 696f 6e3a 2068 7474 7073 3a2f 2f73  ation: https://s
+0000d610: 7472 6970 652e 636f 6d2f 646f 6373 2f61  tripe.com/docs/a
+0000d620: 7069 2f65 7665 6e74 733f 6c61 6e67 3d70  pi/events?lang=p
+0000d630: 7974 686f 6e0a 2020 2020 2222 220a 0a20  ython.    """.. 
+0000d640: 2020 2073 7472 6970 655f 636c 6173 7320     stripe_class 
+0000d650: 3d20 7374 7269 7065 2e45 7665 6e74 0a20  = stripe.Event. 
+0000d660: 2020 2073 7472 6970 655f 6461 7368 626f     stripe_dashbo
+0000d670: 6172 645f 6974 656d 5f6e 616d 6520 3d20  ard_item_name = 
+0000d680: 2265 7665 6e74 7322 0a0a 2020 2020 6170  "events"..    ap
+0000d690: 695f 7665 7273 696f 6e20 3d20 6d6f 6465  i_version = mode
+0000d6a0: 6c73 2e43 6861 7246 6965 6c64 280a 2020  ls.CharField(.  
+0000d6b0: 2020 2020 2020 6d61 785f 6c65 6e67 7468        max_length
+0000d6c0: 3d36 342c 0a20 2020 2020 2020 2062 6c61  =64,.        bla
+0000d6d0: 6e6b 3d54 7275 652c 0a20 2020 2020 2020  nk=True,.       
+0000d6e0: 2068 656c 705f 7465 7874 3d28 0a20 2020   help_text=(.   
+0000d6f0: 2020 2020 2020 2020 2022 7468 6520 4150           "the AP
+0000d700: 4920 7665 7273 696f 6e20 6174 2077 6869  I version at whi
+0000d710: 6368 2074 6865 2065 7665 6e74 2064 6174  ch the event dat
+0000d720: 6120 7761 7320 220a 2020 2020 2020 2020  a was ".        
+0000d730: 2020 2020 2272 656e 6465 7265 642e 2042      "rendered. B
+0000d740: 6c61 6e6b 2066 6f72 206f 6c64 2065 6e74  lank for old ent
+0000d750: 7269 6573 206f 6e6c 792c 2061 6c6c 206e  ries only, all n
+0000d760: 6577 2065 6e74 7269 6573 2077 696c 6c20  ew entries will 
+0000d770: 6861 7665 2074 6869 7320 7661 6c75 6522  have this value"
+0000d780: 0a20 2020 2020 2020 2029 2c0a 2020 2020  .        ),.    
+0000d790: 290a 2020 2020 6461 7461 203d 204a 534f  ).    data = JSO
+0000d7a0: 4e46 6965 6c64 280a 2020 2020 2020 2020  NField(.        
+0000d7b0: 6865 6c70 5f74 6578 743d 280a 2020 2020  help_text=(.    
+0000d7c0: 2020 2020 2020 2020 2264 6174 6120 7265          "data re
+0000d7d0: 6365 6976 6564 2061 7420 7765 6268 6f6f  ceived at webhoo
+0000d7e0: 6b2e 2064 6174 6120 7368 6f75 6c64 2062  k. data should b
+0000d7f0: 6520 636f 6e73 6964 6572 6564 2074 6f20  e considered to 
+0000d800: 6265 2067 6172 6261 6765 2022 0a20 2020  be garbage ".   
+0000d810: 2020 2020 2020 2020 2022 756e 7469 6c20           "until 
+0000d820: 7661 6c69 6469 7479 2063 6865 636b 2069  validity check i
+0000d830: 7320 7275 6e20 616e 6420 7661 6c69 6420  s run and valid 
+0000d840: 666c 6167 2069 7320 7365 7422 0a20 2020  flag is set".   
+0000d850: 2020 2020 2029 0a20 2020 2029 0a20 2020       ).    ).   
+0000d860: 2072 6571 7565 7374 5f69 6420 3d20 6d6f   request_id = mo
+0000d870: 6465 6c73 2e43 6861 7246 6965 6c64 280a  dels.CharField(.
+0000d880: 2020 2020 2020 2020 6d61 785f 6c65 6e67          max_leng
+0000d890: 7468 3d35 302c 0a20 2020 2020 2020 2068  th=50,.        h
+0000d8a0: 656c 705f 7465 7874 3d28 0a20 2020 2020  elp_text=(.     
+0000d8b0: 2020 2020 2020 2022 496e 666f 726d 6174         "Informat
+0000d8c0: 696f 6e20 6162 6f75 7420 7468 6520 7265  ion about the re
+0000d8d0: 7175 6573 7420 7468 6174 2074 7269 6767  quest that trigg
+0000d8e0: 6572 6564 2074 6869 7320 6576 656e 742c  ered this event,
+0000d8f0: 2022 0a20 2020 2020 2020 2020 2020 2022   ".            "
+0000d900: 666f 7220 7472 6163 6561 6269 6c69 7479  for traceability
+0000d910: 2070 7572 706f 7365 732e 2049 6620 656d   purposes. If em
+0000d920: 7074 7920 7374 7269 6e67 2074 6865 6e20  pty string then 
+0000d930: 7468 6973 2069 7320 616e 206f 6c64 2065  this is an old e
+0000d940: 6e74 7279 2022 0a20 2020 2020 2020 2020  ntry ".         
+0000d950: 2020 2022 7769 7468 6f75 7420 7468 6174     "without that
+0000d960: 2064 6174 612e 2049 6620 4e75 6c6c 2074   data. If Null t
+0000d970: 6865 6e20 7468 6973 2069 7320 6e6f 7420  hen this is not 
+0000d980: 616e 206f 6c64 2065 6e74 7279 2c20 6275  an old entry, bu
+0000d990: 7420 6120 5374 7269 7065 2022 0a20 2020  t a Stripe ".   
+0000d9a0: 2020 2020 2020 2020 2022 2761 7574 6f6d           "'autom
+0000d9b0: 6174 6564 2720 6576 656e 7420 7769 7468  ated' event with
+0000d9c0: 206e 6f20 6173 736f 6369 6174 6564 2072   no associated r
+0000d9d0: 6571 7565 7374 2e22 0a20 2020 2020 2020  equest.".       
+0000d9e0: 2029 2c0a 2020 2020 2020 2020 6465 6661   ),.        defa
+0000d9f0: 756c 743d 2222 2c0a 2020 2020 2020 2020  ult="",.        
+0000da00: 626c 616e 6b3d 5472 7565 2c0a 2020 2020  blank=True,.    
+0000da10: 290a 2020 2020 6964 656d 706f 7465 6e63  ).    idempotenc
+0000da20: 795f 6b65 7920 3d20 6d6f 6465 6c73 2e54  y_key = models.T
+0000da30: 6578 7446 6965 6c64 2864 6566 6175 6c74  extField(default
+0000da40: 3d22 222c 2062 6c61 6e6b 3d54 7275 6529  ="", blank=True)
+0000da50: 0a20 2020 2074 7970 6520 3d20 6d6f 6465  .    type = mode
+0000da60: 6c73 2e43 6861 7246 6965 6c64 286d 6178  ls.CharField(max
+0000da70: 5f6c 656e 6774 683d 3235 302c 2068 656c  _length=250, hel
+0000da80: 705f 7465 7874 3d22 5374 7269 7065 2773  p_text="Stripe's
+0000da90: 2065 7665 6e74 2064 6573 6372 6970 7469   event descripti
+0000daa0: 6f6e 2063 6f64 6522 290a 0a20 2020 2064  on code")..    d
+0000dab0: 6566 205f 5f73 7472 5f5f 2873 656c 6629  ef __str__(self)
+0000dac0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+0000dad0: 2066 2274 7970 653d 7b73 656c 662e 7479   f"type={self.ty
+0000dae0: 7065 7d2c 2069 643d 7b73 656c 662e 6964  pe}, id={self.id
+0000daf0: 7d22 0a0a 2020 2020 6465 6620 5f61 7474  }"..    def _att
+0000db00: 6163 685f 6f62 6a65 6374 735f 686f 6f6b  ach_objects_hook
+0000db10: 280a 2020 2020 2020 2020 7365 6c66 2c20  (.        self, 
+0000db20: 636c 732c 2064 6174 612c 2063 7572 7265  cls, data, curre
+0000db30: 6e74 5f69 6473 3d4e 6f6e 652c 2061 7069  nt_ids=None, api
+0000db40: 5f6b 6579 3d64 6a73 7472 6970 655f 7365  _key=djstripe_se
+0000db50: 7474 696e 6773 2e53 5452 4950 455f 5345  ttings.STRIPE_SE
+0000db60: 4352 4554 5f4b 4559 0a20 2020 2029 3a0a  CRET_KEY.    ):.
+0000db70: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0000db80: 6170 695f 7665 7273 696f 6e20 6973 204e  api_version is N
+0000db90: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0000dba0: 2023 2061 7320 6f66 2061 7069 2076 6572   # as of api ver
+0000dbb0: 7369 6f6e 2032 3031 372d 3032 2d31 342c  sion 2017-02-14,
+0000dbc0: 2074 6865 2061 6363 6f75 6e74 2e61 7070   the account.app
+0000dbd0: 6c69 6361 7469 6f6e 2e64 6561 7574 686f  lication.deautho
+0000dbe0: 7269 7a65 640a 2020 2020 2020 2020 2020  rized.          
+0000dbf0: 2020 2320 6576 656e 7420 7365 6e64 7320    # event sends 
+0000dc00: 4e6f 6e65 2061 7320 6170 695f 7665 7273  None as api_vers
+0000dc10: 696f 6e2e 0a20 2020 2020 2020 2020 2020  ion..           
+0000dc20: 2023 2049 6620 7765 2072 6563 6569 7665   # If we receive
+0000dc30: 2074 6861 742c 2073 746f 7265 2061 6e20   that, store an 
+0000dc40: 656d 7074 7920 7374 7269 6e67 2069 6e73  empty string ins
+0000dc50: 7465 6164 2e0a 2020 2020 2020 2020 2020  tead..          
+0000dc60: 2020 2320 5265 6d6f 7665 2074 6869 7320    # Remove this 
+0000dc70: 6861 636b 2069 6620 7468 6973 2067 6574  hack if this get
+0000dc80: 7320 6669 7865 6420 7570 7374 7265 616d  s fixed upstream
+0000dc90: 2e0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+0000dca0: 6c66 2e61 7069 5f76 6572 7369 6f6e 203d  lf.api_version =
+0000dcb0: 2022 220a 0a20 2020 2020 2020 2072 6571   ""..        req
+0000dcc0: 7565 7374 5f6f 626a 203d 2064 6174 612e  uest_obj = data.
+0000dcd0: 6765 7428 2272 6571 7565 7374 222c 204e  get("request", N
+0000dce0: 6f6e 6529 0a20 2020 2020 2020 2069 6620  one).        if 
+0000dcf0: 6973 696e 7374 616e 6365 2872 6571 7565  isinstance(reque
+0000dd00: 7374 5f6f 626a 2c20 6469 6374 293a 0a20  st_obj, dict):. 
+0000dd10: 2020 2020 2020 2020 2020 2023 2046 6f72             # For
+0000dd20: 6d61 7420 6173 206f 6620 3230 3137 2d30  mat as of 2017-0
+0000dd30: 352d 3235 0a20 2020 2020 2020 2020 2020  5-25.           
+0000dd40: 2073 656c 662e 7265 7175 6573 745f 6964   self.request_id
+0000dd50: 203d 2072 6571 7565 7374 5f6f 626a 2e67   = request_obj.g
+0000dd60: 6574 2822 6964 2229 206f 7220 2222 0a20  et("id") or "". 
+0000dd70: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000dd80: 6964 656d 706f 7465 6e63 795f 6b65 7920  idempotency_key 
+0000dd90: 3d20 7265 7175 6573 745f 6f62 6a2e 6765  = request_obj.ge
+0000dda0: 7428 2269 6465 6d70 6f74 656e 6379 5f6b  t("idempotency_k
+0000ddb0: 6579 2229 206f 7220 2222 0a20 2020 2020  ey") or "".     
+0000ddc0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000ddd0: 2020 2020 2023 2046 6f72 6d61 7420 6265       # Format be
+0000dde0: 666f 7265 2032 3031 372d 3035 2d32 350a  fore 2017-05-25.
+0000ddf0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000de00: 2e72 6571 7565 7374 5f69 6420 3d20 7265  .request_id = re
+0000de10: 7175 6573 745f 6f62 6a20 6f72 2022 220a  quest_obj or "".
+0000de20: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
+0000de30: 640a 2020 2020 6465 6620 7072 6f63 6573  d.    def proces
+0000de40: 7328 636c 732c 2064 6174 612c 2061 7069  s(cls, data, api
+0000de50: 5f6b 6579 3d64 6a73 7472 6970 655f 7365  _key=djstripe_se
+0000de60: 7474 696e 6773 2e53 5452 4950 455f 5345  ttings.STRIPE_SE
+0000de70: 4352 4554 5f4b 4559 293a 0a20 2020 2020  CRET_KEY):.     
+0000de80: 2020 2071 7320 3d20 636c 732e 6f62 6a65     qs = cls.obje
+0000de90: 6374 732e 6669 6c74 6572 2869 643d 6461  cts.filter(id=da
+0000dea0: 7461 5b22 6964 225d 290a 2020 2020 2020  ta["id"]).      
+0000deb0: 2020 6966 2071 732e 6578 6973 7473 2829    if qs.exists()
+0000dec0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0000ded0: 7475 726e 2071 732e 6669 7273 7428 290a  turn qs.first().
+0000dee0: 0a20 2020 2020 2020 2023 2052 6f6c 6c62  .        # Rollb
+0000def0: 6163 6b20 616e 7920 4442 206f 7065 7261  ack any DB opera
+0000df00: 7469 6f6e 7320 696e 2074 6865 2063 6173  tions in the cas
+0000df10: 6520 6f66 2066 6169 6c75 7265 2073 6f0a  e of failure so.
+0000df20: 2020 2020 2020 2020 2320 7765 2077 696c          # we wil
+0000df30: 6c20 7265 7472 7920 6372 6561 7469 6e67  l retry creating
+0000df40: 2061 6e64 2070 726f 6365 7373 696e 6720   and processing 
+0000df50: 7468 6520 6576 656e 7420 7468 650a 2020  the event the.  
+0000df60: 2020 2020 2020 2320 6e65 7874 2074 696d        # next tim
+0000df70: 6520 7468 6520 7765 6268 6f6f 6b20 6669  e the webhook fi
+0000df80: 7265 732e 0a20 2020 2020 2020 2077 6974  res..        wit
+0000df90: 6820 7472 616e 7361 6374 696f 6e2e 6174  h transaction.at
+0000dfa0: 6f6d 6963 2829 3a0a 2020 2020 2020 2020  omic():.        
+0000dfb0: 2020 2020 2320 7072 6f63 6573 7320 7468      # process th
+0000dfc0: 6520 6576 656e 7420 616e 6420 6372 6561  e event and crea
+0000dfd0: 7465 2061 6e20 4576 656e 7420 4f62 6a65  te an Event Obje
+0000dfe0: 6374 0a20 2020 2020 2020 2020 2020 2072  ct.            r
+0000dff0: 6574 203d 2063 6c73 2e5f 6372 6561 7465  et = cls._create
+0000e000: 5f66 726f 6d5f 7374 7269 7065 5f6f 626a  _from_stripe_obj
+0000e010: 6563 7428 6461 7461 2c20 6170 695f 6b65  ect(data, api_ke
+0000e020: 793d 6170 695f 6b65 7929 0a20 2020 2020  y=api_key).     
+0000e030: 2020 2020 2020 2072 6574 2e69 6e76 6f6b         ret.invok
+0000e040: 655f 7765 6268 6f6f 6b5f 6861 6e64 6c65  e_webhook_handle
+0000e050: 7273 2829 0a20 2020 2020 2020 2020 2020  rs().           
+0000e060: 2072 6574 7572 6e20 7265 740a 0a20 2020   return ret..   
+0000e070: 2064 6566 2069 6e76 6f6b 655f 7765 6268   def invoke_webh
+0000e080: 6f6f 6b5f 6861 6e64 6c65 7273 2873 656c  ook_handlers(sel
+0000e090: 6629 3a0a 2020 2020 2020 2020 2222 220a  f):.        """.
+0000e0a0: 2020 2020 2020 2020 496e 766f 6b65 7320          Invokes 
+0000e0b0: 616e 7920 7765 6268 6f6f 6b20 6861 6e64  any webhook hand
+0000e0c0: 6c65 7273 2074 6861 7420 6861 7665 2062  lers that have b
+0000e0d0: 6565 6e20 7265 6769 7374 6572 6564 2066  een registered f
+0000e0e0: 6f72 2074 6869 7320 6576 656e 740a 2020  or this event.  
+0000e0f0: 2020 2020 2020 6261 7365 6420 6f6e 2065        based on e
+0000e100: 7665 6e74 2074 7970 6520 6f72 2065 7665  vent type or eve
+0000e110: 6e74 2073 7562 2d74 7970 652e 0a0a 2020  nt sub-type...  
+0000e120: 2020 2020 2020 5365 6520 6576 656e 7420        See event 
+0000e130: 6861 6e64 6c65 7273 2072 6567 6973 7465  handlers registe
+0000e140: 7265 6420 696e 2074 6865 2060 6064 6a73  red in the ``djs
+0000e150: 7472 6970 652e 6576 656e 745f 6861 6e64  tripe.event_hand
+0000e160: 6c65 7273 6060 206d 6f64 756c 650a 2020  lers`` module.  
+0000e170: 2020 2020 2020 286f 7220 6861 6e64 6c65        (or handle
+0000e180: 7273 2072 6567 6973 7465 7265 6420 696e  rs registered in
+0000e190: 2064 6a73 7472 6970 6520 706c 7567 696e   djstripe plugin
+0000e1a0: 7320 6f72 2063 6f6e 7472 6962 2070 6163  s or contrib pac
+0000e1b0: 6b61 6765 7329 2e0a 2020 2020 2020 2020  kages)..        
+0000e1c0: 2222 220a 0a20 2020 2020 2020 2077 6562  """..        web
+0000e1d0: 686f 6f6b 732e 6361 6c6c 5f68 616e 646c  hooks.call_handl
+0000e1e0: 6572 7328 6576 656e 743d 7365 6c66 290a  ers(event=self).
+0000e1f0: 0a20 2020 2020 2020 2073 6967 6e61 6c20  .        signal 
+0000e200: 3d20 5745 4248 4f4f 4b5f 5349 474e 414c  = WEBHOOK_SIGNAL
+0000e210: 532e 6765 7428 7365 6c66 2e74 7970 6529  S.get(self.type)
+0000e220: 0a20 2020 2020 2020 2069 6620 7369 676e  .        if sign
+0000e230: 616c 3a0a 2020 2020 2020 2020 2020 2020  al:.            
+0000e240: 7265 7475 726e 2073 6967 6e61 6c2e 7365  return signal.se
+0000e250: 6e64 2873 656e 6465 723d 4576 656e 742c  nd(sender=Event,
+0000e260: 2065 7665 6e74 3d73 656c 6629 0a0a 2020   event=self)..  
+0000e270: 2020 4063 6163 6865 645f 7072 6f70 6572    @cached_proper
+0000e280: 7479 0a20 2020 2064 6566 2070 6172 7473  ty.    def parts
+0000e290: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+0000e2a0: 2222 2247 6574 7320 7468 6520 6576 656e  """Gets the even
+0000e2b0: 7420 6361 7465 676f 7279 2f76 6572 6220  t category/verb 
+0000e2c0: 6173 2061 206c 6973 7420 6f66 2070 6172  as a list of par
+0000e2d0: 7473 2e22 2222 0a20 2020 2020 2020 2072  ts.""".        r
+0000e2e0: 6574 7572 6e20 7374 7228 7365 6c66 2e74  eturn str(self.t
+0000e2f0: 7970 6529 2e73 706c 6974 2822 2e22 290a  ype).split(".").
+0000e300: 0a20 2020 2040 6361 6368 6564 5f70 726f  .    @cached_pro
+0000e310: 7065 7274 790a 2020 2020 6465 6620 6361  perty.    def ca
+0000e320: 7465 676f 7279 2873 656c 6629 3a0a 2020  tegory(self):.  
+0000e330: 2020 2020 2020 2222 2247 6574 7320 7468        """Gets th
+0000e340: 6520 6576 656e 7420 6361 7465 676f 7279  e event category
+0000e350: 2073 7472 696e 6720 2865 2e67 2e20 2763   string (e.g. 'c
+0000e360: 7573 746f 6d65 7227 292e 2222 220a 2020  ustomer').""".  
+0000e370: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0000e380: 662e 7061 7274 735b 305d 0a0a 2020 2020  f.parts[0]..    
+0000e390: 4063 6163 6865 645f 7072 6f70 6572 7479  @cached_property
+0000e3a0: 0a20 2020 2064 6566 2076 6572 6228 7365  .    def verb(se
+0000e3b0: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
+0000e3c0: 4765 7473 2074 6865 2065 7665 6e74 2070  Gets the event p
+0000e3d0: 6173 742d 7465 6e73 6520 7665 7262 2073  ast-tense verb s
+0000e3e0: 7472 696e 6720 2865 2e67 2e20 2775 7064  tring (e.g. 'upd
+0000e3f0: 6174 6564 2729 2e22 2222 0a20 2020 2020  ated').""".     
+0000e400: 2020 2072 6574 7572 6e20 222e 222e 6a6f     return ".".jo
+0000e410: 696e 2873 656c 662e 7061 7274 735b 313a  in(self.parts[1:
+0000e420: 5d29 0a0a 2020 2020 4070 726f 7065 7274  ])..    @propert
+0000e430: 790a 2020 2020 6465 6620 6375 7374 6f6d  y.    def custom
+0000e440: 6572 2873 656c 6629 3a0a 2020 2020 2020  er(self):.      
+0000e450: 2020 6461 7461 203d 2073 656c 662e 6461    data = self.da
+0000e460: 7461 5b22 6f62 6a65 6374 225d 0a20 2020  ta["object"].   
+0000e470: 2020 2020 2069 6620 6461 7461 5b22 6f62       if data["ob
+0000e480: 6a65 6374 225d 203d 3d20 2263 7573 746f  ject"] == "custo
+0000e490: 6d65 7222 3a0a 2020 2020 2020 2020 2020  mer":.          
+0000e4a0: 2020 6375 7374 6f6d 6572 5f69 6420 3d20    customer_id = 
+0000e4b0: 6765 745f 6964 5f66 726f 6d5f 7374 7269  get_id_from_stri
+0000e4c0: 7065 5f64 6174 6128 6461 7461 2e67 6574  pe_data(data.get
+0000e4d0: 2822 6964 2229 290a 2020 2020 2020 2020  ("id")).        
+0000e4e0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0000e4f0: 2020 6375 7374 6f6d 6572 5f69 6420 3d20    customer_id = 
+0000e500: 6765 745f 6964 5f66 726f 6d5f 7374 7269  get_id_from_stri
+0000e510: 7065 5f64 6174 6128 6461 7461 2e67 6574  pe_data(data.get
+0000e520: 2822 6375 7374 6f6d 6572 2229 290a 0a20  ("customer")).. 
+0000e530: 2020 2020 2020 2069 6620 6375 7374 6f6d         if custom
+0000e540: 6572 5f69 643a 0a20 2020 2020 2020 2020  er_id:.         
+0000e550: 2020 2072 6574 7572 6e20 4375 7374 6f6d     return Custom
+0000e560: 6572 2e5f 6765 745f 6f72 5f72 6574 7269  er._get_or_retri
+0000e570: 6576 6528 0a20 2020 2020 2020 2020 2020  eve(.           
+0000e580: 2020 2020 2069 643d 6375 7374 6f6d 6572       id=customer
+0000e590: 5f69 642c 0a20 2020 2020 2020 2020 2020  _id,.           
+0000e5a0: 2020 2020 2073 7472 6970 655f 6163 636f       stripe_acco
+0000e5b0: 756e 743d 6765 7461 7474 7228 7365 6c66  unt=getattr(self
+0000e5c0: 2e64 6a73 7472 6970 655f 6f77 6e65 725f  .djstripe_owner_
+0000e5d0: 6163 636f 756e 742c 2022 6964 222c 204e  account, "id", N
+0000e5e0: 6f6e 6529 2c0a 2020 2020 2020 2020 2020  one),.          
+0000e5f0: 2020 2020 2020 6170 695f 6b65 793d 7365        api_key=se
+0000e600: 6c66 2e64 6566 6175 6c74 5f61 7069 5f6b  lf.default_api_k
+0000e610: 6579 2c0a 2020 2020 2020 2020 2020 2020  ey,.            
+0000e620: 290a 0a0a 636c 6173 7320 4669 6c65 2853  )...class File(S
+0000e630: 7472 6970 654d 6f64 656c 293a 0a20 2020  tripeModel):.   
+0000e640: 2022 2222 0a20 2020 2054 6869 7320 6973   """.    This is
+0000e650: 2061 6e20 6f62 6a65 6374 2072 6570 7265   an object repre
+0000e660: 7365 6e74 696e 6720 6120 6669 6c65 2068  senting a file h
+0000e670: 6f73 7465 6420 6f6e 2053 7472 6970 6527  osted on Stripe'
+0000e680: 7320 7365 7276 6572 732e 0a20 2020 2054  s servers..    T
+0000e690: 6865 2066 696c 6520 6d61 7920 6861 7665  he file may have
+0000e6a0: 2062 6565 6e20 7570 6c6f 6164 6564 2062   been uploaded b
+0000e6b0: 7920 796f 7572 7365 6c66 2075 7369 6e67  y yourself using
+0000e6c0: 2074 6865 2063 7265 6174 6520 6669 6c65   the create file
+0000e6d0: 2072 6571 7565 7374 0a20 2020 2028 666f   request.    (fo
+0000e6e0: 7220 6578 616d 706c 652c 2077 6865 6e20  r example, when 
+0000e6f0: 7570 6c6f 6164 696e 6720 6469 7370 7574  uploading disput
+0000e700: 6520 6576 6964 656e 6365 2920 6f72 2069  e evidence) or i
+0000e710: 7420 6d61 7920 6861 7665 2062 6565 6e20  t may have been 
+0000e720: 6372 6561 7465 6420 6279 0a20 2020 2053  created by.    S
+0000e730: 7472 6970 6520 2866 6f72 2065 7861 6d70  tripe (for examp
+0000e740: 6c65 2c20 7468 6520 7265 7375 6c74 7320  le, the results 
+0000e750: 6f66 2061 2053 6967 6d61 2073 6368 6564  of a Sigma sched
+0000e760: 756c 6564 2071 7565 7279 292e 0a0a 2020  uled query)...  
+0000e770: 2020 5374 7269 7065 2064 6f63 756d 656e    Stripe documen
+0000e780: 7461 7469 6f6e 3a20 6874 7470 733a 2f2f  tation: https://
+0000e790: 7374 7269 7065 2e63 6f6d 2f64 6f63 732f  stripe.com/docs/
+0000e7a0: 6170 692f 6669 6c65 733f 6c61 6e67 3d70  api/files?lang=p
+0000e7b0: 7974 686f 6e0a 2020 2020 2222 220a 0a20  ython.    """.. 
+0000e7c0: 2020 2073 7472 6970 655f 636c 6173 7320     stripe_class 
+0000e7d0: 3d20 7374 7269 7065 2e46 696c 650a 0a20  = stripe.File.. 
+0000e7e0: 2020 2066 696c 656e 616d 6520 3d20 6d6f     filename = mo
+0000e7f0: 6465 6c73 2e43 6861 7246 6965 6c64 280a  dels.CharField(.
+0000e800: 2020 2020 2020 2020 6d61 785f 6c65 6e67          max_leng
+0000e810: 7468 3d32 3535 2c0a 2020 2020 2020 2020  th=255,.        
+0000e820: 6865 6c70 5f74 6578 743d 2241 2066 696c  help_text="A fil
+0000e830: 656e 616d 6520 666f 7220 7468 6520 6669  ename for the fi
+0000e840: 6c65 2c20 7375 6974 6162 6c65 2066 6f72  le, suitable for
+0000e850: 2073 6176 696e 6720 746f 2061 2066 696c   saving to a fil
+0000e860: 6573 7973 7465 6d2e 222c 0a20 2020 2029  esystem.",.    )
+0000e870: 0a20 2020 2070 7572 706f 7365 203d 2053  .    purpose = S
+0000e880: 7472 6970 6545 6e75 6d46 6965 6c64 280a  tripeEnumField(.
+0000e890: 2020 2020 2020 2020 656e 756d 3d65 6e75          enum=enu
+0000e8a0: 6d73 2e46 696c 6550 7572 706f 7365 2c20  ms.FilePurpose, 
+0000e8b0: 6865 6c70 5f74 6578 743d 2254 6865 2070  help_text="The p
+0000e8c0: 7572 706f 7365 206f 6620 7468 6520 7570  urpose of the up
+0000e8d0: 6c6f 6164 6564 2066 696c 652e 220a 2020  loaded file.".  
+0000e8e0: 2020 290a 2020 2020 7369 7a65 203d 206d    ).    size = m
+0000e8f0: 6f64 656c 732e 496e 7465 6765 7246 6965  odels.IntegerFie
+0000e900: 6c64 2868 656c 705f 7465 7874 3d22 5468  ld(help_text="Th
+0000e910: 6520 7369 7a65 2069 6e20 6279 7465 7320  e size in bytes 
+0000e920: 6f66 2074 6865 2066 696c 6520 7570 6c6f  of the file uplo
+0000e930: 6164 206f 626a 6563 742e 2229 0a20 2020  ad object.").   
+0000e940: 2074 7970 6520 3d20 5374 7269 7065 456e   type = StripeEn
+0000e950: 756d 4669 656c 6428 0a20 2020 2020 2020  umField(.       
+0000e960: 2065 6e75 6d3d 656e 756d 732e 4669 6c65   enum=enums.File
+0000e970: 5479 7065 2c20 6865 6c70 5f74 6578 743d  Type, help_text=
+0000e980: 2254 6865 2074 7970 6520 6f66 2074 6865  "The type of the
+0000e990: 2066 696c 6520 7265 7475 726e 6564 2e22   file returned."
+0000e9a0: 0a20 2020 2029 0a20 2020 2075 726c 203d  .    ).    url =
+0000e9b0: 206d 6f64 656c 732e 4368 6172 4669 656c   models.CharFiel
+0000e9c0: 6428 0a20 2020 2020 2020 206d 6178 5f6c  d(.        max_l
+0000e9d0: 656e 6774 683d 3230 302c 0a20 2020 2020  ength=200,.     
+0000e9e0: 2020 2068 656c 705f 7465 7874 3d22 4120     help_text="A 
+0000e9f0: 7265 6164 2d6f 6e6c 7920 5552 4c20 7768  read-only URL wh
+0000ea00: 6572 6520 7468 6520 7570 6c6f 6164 6564  ere the uploaded
+0000ea10: 2066 696c 6520 6361 6e20 6265 2061 6363   file can be acc
+0000ea20: 6573 7365 642e 222c 0a20 2020 2029 0a0a  essed.",.    )..
+0000ea30: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
+0000ea40: 0a20 2020 2064 6566 2069 735f 7661 6c69  .    def is_vali
+0000ea50: 645f 6f62 6a65 6374 2863 6c73 2c20 6461  d_object(cls, da
+0000ea60: 7461 293a 0a20 2020 2020 2020 2072 6574  ta):.        ret
+0000ea70: 7572 6e20 6461 7461 2061 6e64 2064 6174  urn data and dat
+0000ea80: 612e 6765 7428 226f 626a 6563 7422 2920  a.get("object") 
+0000ea90: 696e 2028 2266 696c 6522 2c20 2266 696c  in ("file", "fil
+0000eaa0: 655f 7570 6c6f 6164 2229 0a0a 2020 2020  e_upload")..    
+0000eab0: 6465 6620 5f5f 7374 725f 5f28 7365 6c66  def __str__(self
+0000eac0: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
+0000ead0: 6e20 6622 7b73 656c 662e 6669 6c65 6e61  n f"{self.filena
+0000eae0: 6d65 7d2c 207b 656e 756d 732e 4669 6c65  me}, {enums.File
+0000eaf0: 5075 7270 6f73 652e 6875 6d61 6e69 7a65  Purpose.humanize
+0000eb00: 2873 656c 662e 7075 7270 6f73 6529 7d22  (self.purpose)}"
+0000eb10: 0a0a 0a23 2041 6c69 6173 2066 6f72 2063  ...# Alias for c
+0000eb20: 6f6d 7061 7469 6269 6c69 7479 0a23 2053  ompatibility.# S
+0000eb30: 7472 6970 6527 7320 5344 4b20 6861 7320  tripe's SDK has 
+0000eb40: 7468 6520 7361 6d65 2061 6c69 6173 2e0a  the same alias..
+0000eb50: 2320 446f 206e 6f74 2072 656d 6f76 652f  # Do not remove/
+0000eb60: 6465 7072 6563 6174 6520 6173 206c 6f6e  deprecate as lon
+0000eb70: 6720 6173 2069 7427 7320 7072 6573 656e  g as it's presen
+0000eb80: 7420 7468 6572 652e 0a46 696c 6555 706c  t there..FileUpl
+0000eb90: 6f61 6420 3d20 4669 6c65 0a0a 0a63 6c61  oad = File...cla
+0000eba0: 7373 2046 696c 654c 696e 6b28 5374 7269  ss FileLink(Stri
+0000ebb0: 7065 4d6f 6465 6c29 3a0a 2020 2020 2222  peModel):.    ""
+0000ebc0: 220a 2020 2020 546f 2073 6861 7265 2074  ".    To share t
+0000ebd0: 6865 2063 6f6e 7465 6e74 7320 6f66 2061  he contents of a
+0000ebe0: 2046 696c 6520 6f62 6a65 6374 2077 6974   File object wit
+0000ebf0: 6820 6e6f 6e2d 5374 7269 7065 2075 7365  h non-Stripe use
+0000ec00: 7273 2c0a 2020 2020 796f 7520 6361 6e20  rs,.    you can 
+0000ec10: 6372 6561 7465 2061 2046 696c 654c 696e  create a FileLin
+0000ec20: 6b2e 2046 696c 654c 696e 6b73 2063 6f6e  k. FileLinks con
+0000ec30: 7461 696e 2061 2055 524c 2074 6861 7420  tain a URL that 
+0000ec40: 6361 6e20 6265 2075 7365 640a 2020 2020  can be used.    
+0000ec50: 746f 2072 6574 7269 6576 6520 7468 6520  to retrieve the 
+0000ec60: 636f 6e74 656e 7473 206f 6620 7468 6520  contents of the 
+0000ec70: 6669 6c65 2077 6974 686f 7574 2061 7574  file without aut
+0000ec80: 6865 6e74 6963 6174 696f 6e2e 0a0a 2020  hentication...  
+0000ec90: 2020 5374 7269 7065 2064 6f63 756d 656e    Stripe documen
+0000eca0: 7461 7469 6f6e 3a20 6874 7470 733a 2f2f  tation: https://
+0000ecb0: 7374 7269 7065 2e63 6f6d 2f64 6f63 732f  stripe.com/docs/
+0000ecc0: 6170 692f 6669 6c65 5f6c 696e 6b73 3f6c  api/file_links?l
+0000ecd0: 616e 673d 7079 7468 6f6e 0a20 2020 2022  ang=python.    "
+0000ece0: 2222 0a0a 2020 2020 7374 7269 7065 5f63  ""..    stripe_c
+0000ecf0: 6c61 7373 203d 2073 7472 6970 652e 4669  lass = stripe.Fi
+0000ed00: 6c65 4c69 6e6b 0a0a 2020 2020 6578 7069  leLink..    expi
+0000ed10: 7265 735f 6174 203d 2053 7472 6970 6544  res_at = StripeD
+0000ed20: 6174 6554 696d 6546 6965 6c64 280a 2020  ateTimeField(.  
+0000ed30: 2020 2020 2020 6e75 6c6c 3d54 7275 652c        null=True,
+0000ed40: 2062 6c61 6e6b 3d54 7275 652c 2068 656c   blank=True, hel
+0000ed50: 705f 7465 7874 3d22 5469 6d65 2061 7420  p_text="Time at 
+0000ed60: 7768 6963 6820 7468 6520 6c69 6e6b 2065  which the link e
+0000ed70: 7870 6972 6573 2e22 0a20 2020 2029 0a20  xpires.".    ). 
+0000ed80: 2020 2066 696c 6520 3d20 5374 7269 7065     file = Stripe
+0000ed90: 466f 7265 6967 6e4b 6579 2822 4669 6c65  ForeignKey("File
+0000eda0: 222c 206f 6e5f 6465 6c65 7465 3d6d 6f64  ", on_delete=mod
+0000edb0: 656c 732e 4341 5343 4144 4529 0a20 2020  els.CASCADE).   
+0000edc0: 2075 726c 203d 206d 6f64 656c 732e 5552   url = models.UR
+0000edd0: 4c46 6965 6c64 2868 656c 705f 7465 7874  LField(help_text
+0000ede0: 3d22 5468 6520 7075 626c 6963 6c79 2061  ="The publicly a
+0000edf0: 6363 6573 7369 626c 6520 5552 4c20 746f  ccessible URL to
+0000ee00: 2064 6f77 6e6c 6f61 6420 7468 6520 6669   download the fi
+0000ee10: 6c65 2e22 290a 0a20 2020 2064 6566 205f  le.")..    def _
+0000ee20: 5f73 7472 5f5f 2873 656c 6629 3a0a 2020  _str__(self):.  
+0000ee30: 2020 2020 2020 7265 7475 726e 2066 227b        return f"{
+0000ee40: 7365 6c66 2e66 696c 652e 6669 6c65 6e61  self.file.filena
+0000ee50: 6d65 7d2c 207b 7365 6c66 2e75 726c 7d22  me}, {self.url}"
+0000ee60: 0a0a 0a63 6c61 7373 2050 6179 6d65 6e74  ...class Payment
+0000ee70: 496e 7465 6e74 2853 7472 6970 654d 6f64  Intent(StripeMod
+0000ee80: 656c 293a 0a20 2020 2022 2222 0a20 2020  el):.    """.   
+0000ee90: 2041 2050 6179 6d65 6e74 496e 7465 6e74   A PaymentIntent
+0000eea0: 2067 7569 6465 7320 796f 7520 7468 726f   guides you thro
+0000eeb0: 7567 6820 7468 6520 7072 6f63 6573 7320  ugh the process 
+0000eec0: 6f66 2063 6f6c 6c65 6374 696e 6720 6120  of collecting a 
+0000eed0: 7061 796d 656e 740a 2020 2020 6672 6f6d  payment.    from
+0000eee0: 2079 6f75 7220 6375 7374 6f6d 6572 2e20   your customer. 
+0000eef0: 5765 2072 6563 6f6d 6d65 6e64 2074 6861  We recommend tha
+0000ef00: 7420 796f 7520 6372 6561 7465 2065 7861  t you create exa
+0000ef10: 6374 6c79 206f 6e65 2050 6179 6d65 6e74  ctly one Payment
+0000ef20: 496e 7465 6e74 2066 6f72 2065 6163 6820  Intent for each 
+0000ef30: 6f72 6465 720a 2020 2020 6f72 2063 7573  order.    or cus
+0000ef40: 746f 6d65 7220 7365 7373 696f 6e20 696e  tomer session in
+0000ef50: 2079 6f75 7220 7379 7374 656d 2e20 596f   your system. Yo
+0000ef60: 7520 6361 6e20 7265 6665 7265 6e63 6520  u can reference 
+0000ef70: 7468 6520 5061 796d 656e 7449 6e74 656e  the PaymentInten
+0000ef80: 7420 6c61 7465 7220 746f 0a20 2020 2073  t later to.    s
+0000ef90: 6565 2074 6865 2068 6973 746f 7279 206f  ee the history o
+0000efa0: 6620 7061 796d 656e 7420 6174 7465 6d70  f payment attemp
+0000efb0: 7473 2066 6f72 2061 2070 6172 7469 6375  ts for a particu
+0000efc0: 6c61 7220 7365 7373 696f 6e2e 0a0a 2020  lar session...  
+0000efd0: 2020 4120 5061 796d 656e 7449 6e74 656e    A PaymentInten
+0000efe0: 7420 7472 616e 7369 7469 6f6e 7320 7468  t transitions th
+0000eff0: 726f 7567 6820 6d75 6c74 6970 6c65 2073  rough multiple s
+0000f000: 7461 7475 7365 7320 7468 726f 7567 686f  tatuses througho
+0000f010: 7574 2069 7473 206c 6966 6574 696d 6520  ut its lifetime 
+0000f020: 6173 0a20 2020 2069 7420 696e 7465 7266  as.    it interf
+0000f030: 6163 6573 2077 6974 6820 5374 7269 7065  aces with Stripe
+0000f040: 2e6a 7320 746f 2070 6572 666f 726d 2061  .js to perform a
+0000f050: 7574 6865 6e74 6963 6174 696f 6e20 666c  uthentication fl
+0000f060: 6f77 7320 616e 6420 756c 7469 6d61 7465  ows and ultimate
+0000f070: 6c79 0a20 2020 2063 7265 6174 6573 2061  ly.    creates a
+0000f080: 7420 6d6f 7374 206f 6e65 2073 7563 6365  t most one succe
+0000f090: 7373 6675 6c20 6368 6172 6765 2e0a 0a20  ssful charge... 
+0000f0a0: 2020 2053 7472 6970 6520 646f 6375 6d65     Stripe docume
+0000f0b0: 6e74 6174 696f 6e3a 2068 7474 7073 3a2f  ntation: https:/
+0000f0c0: 2f73 7472 6970 652e 636f 6d2f 646f 6373  /stripe.com/docs
+0000f0d0: 2f61 7069 3f6c 616e 673d 7079 7468 6f6e  /api?lang=python
+0000f0e0: 2370 6179 6d65 6e74 5f69 6e74 656e 7473  #payment_intents
+0000f0f0: 0a20 2020 2022 2222 0a0a 2020 2020 7374  .    """..    st
+0000f100: 7269 7065 5f63 6c61 7373 203d 2073 7472  ripe_class = str
+0000f110: 6970 652e 5061 796d 656e 7449 6e74 656e  ipe.PaymentInten
+0000f120: 740a 2020 2020 7374 7269 7065 5f64 6173  t.    stripe_das
+0000f130: 6862 6f61 7264 5f69 7465 6d5f 6e61 6d65  hboard_item_name
+0000f140: 203d 2022 7061 796d 656e 7473 220a 0a20   = "payments".. 
+0000f150: 2020 2061 6d6f 756e 7420 3d20 5374 7269     amount = Stri
+0000f160: 7065 5175 616e 7475 6d43 7572 7265 6e63  peQuantumCurrenc
+0000f170: 7941 6d6f 756e 7446 6965 6c64 280a 2020  yAmountField(.  
+0000f180: 2020 2020 2020 6865 6c70 5f74 6578 743d        help_text=
+0000f190: 2241 6d6f 756e 7420 2869 6e20 6365 6e74  "Amount (in cent
+0000f1a0: 7329 2069 6e74 656e 6465 6420 746f 2062  s) intended to b
+0000f1b0: 6520 636f 6c6c 6563 7465 6420 6279 2074  e collected by t
+0000f1c0: 6869 7320 5061 796d 656e 7449 6e74 656e  his PaymentInten
+0000f1d0: 742e 220a 2020 2020 290a 2020 2020 616d  t.".    ).    am
+0000f1e0: 6f75 6e74 5f63 6170 7475 7261 626c 6520  ount_capturable 
+0000f1f0: 3d20 5374 7269 7065 5175 616e 7475 6d43  = StripeQuantumC
+0000f200: 7572 7265 6e63 7941 6d6f 756e 7446 6965  urrencyAmountFie
+0000f210: 6c64 280a 2020 2020 2020 2020 6865 6c70  ld(.        help
+0000f220: 5f74 6578 743d 2241 6d6f 756e 7420 2869  _text="Amount (i
+0000f230: 6e20 6365 6e74 7329 2074 6861 7420 6361  n cents) that ca
+0000f240: 6e20 6265 2063 6170 7475 7265 6420 6672  n be captured fr
+0000f250: 6f6d 2074 6869 7320 5061 796d 656e 7449  om this PaymentI
+0000f260: 6e74 656e 742e 220a 2020 2020 290a 2020  ntent.".    ).  
+0000f270: 2020 616d 6f75 6e74 5f72 6563 6569 7665    amount_receive
+0000f280: 6420 3d20 5374 7269 7065 5175 616e 7475  d = StripeQuantu
+0000f290: 6d43 7572 7265 6e63 7941 6d6f 756e 7446  mCurrencyAmountF
+0000f2a0: 6965 6c64 280a 2020 2020 2020 2020 6865  ield(.        he
+0000f2b0: 6c70 5f74 6578 743d 2241 6d6f 756e 7420  lp_text="Amount 
+0000f2c0: 2869 6e20 6365 6e74 7329 2074 6861 7420  (in cents) that 
+0000f2d0: 7761 7320 636f 6c6c 6563 7465 6420 6279  was collected by
+0000f2e0: 2074 6869 7320 5061 796d 656e 7449 6e74   this PaymentInt
+0000f2f0: 656e 742e 220a 2020 2020 290a 2020 2020  ent.".    ).    
+0000f300: 2320 6170 706c 6963 6174 696f 6e0a 2020  # application.  
+0000f310: 2020 2320 6170 706c 6963 6174 696f 6e5f    # application_
+0000f320: 6665 655f 616d 6f75 6e74 0a20 2020 2063  fee_amount.    c
+0000f330: 616e 6365 6c65 645f 6174 203d 2053 7472  anceled_at = Str
+0000f340: 6970 6544 6174 6554 696d 6546 6965 6c64  ipeDateTimeField
+0000f350: 280a 2020 2020 2020 2020 6e75 6c6c 3d54  (.        null=T
+0000f360: 7275 652c 0a20 2020 2020 2020 2062 6c61  rue,.        bla
+0000f370: 6e6b 3d54 7275 652c 0a20 2020 2020 2020  nk=True,.       
+0000f380: 2064 6566 6175 6c74 3d4e 6f6e 652c 0a20   default=None,. 
+0000f390: 2020 2020 2020 2068 656c 705f 7465 7874         help_text
+0000f3a0: 3d28 0a20 2020 2020 2020 2020 2020 2022  =(.            "
+0000f3b0: 506f 7075 6c61 7465 6420 7768 656e 2073  Populated when s
+0000f3c0: 7461 7475 7320 6973 2063 616e 6365 6c65  tatus is cancele
+0000f3d0: 642c 2074 6869 7320 6973 2074 6865 2074  d, this is the t
+0000f3e0: 696d 6520 6174 2077 6869 6368 2074 6865  ime at which the
+0000f3f0: 2022 0a20 2020 2020 2020 2020 2020 2022   ".            "
+0000f400: 5061 796d 656e 7449 6e74 656e 7420 7761  PaymentIntent wa
+0000f410: 7320 6361 6e63 656c 6564 2e20 4d65 6173  s canceled. Meas
+0000f420: 7572 6564 2069 6e20 7365 636f 6e64 7320  ured in seconds 
+0000f430: 7369 6e63 6520 7468 6520 556e 6978 2065  since the Unix e
+0000f440: 706f 6368 2e22 0a20 2020 2020 2020 2029  poch.".        )
+0000f450: 2c0a 2020 2020 290a 0a20 2020 2063 616e  ,.    )..    can
+0000f460: 6365 6c6c 6174 696f 6e5f 7265 6173 6f6e  cellation_reason
+0000f470: 203d 2053 7472 6970 6545 6e75 6d46 6965   = StripeEnumFie
+0000f480: 6c64 280a 2020 2020 2020 2020 656e 756d  ld(.        enum
+0000f490: 3d65 6e75 6d73 2e50 6179 6d65 6e74 496e  =enums.PaymentIn
+0000f4a0: 7465 6e74 4361 6e63 656c 6c61 7469 6f6e  tentCancellation
+0000f4b0: 5265 6173 6f6e 2c0a 2020 2020 2020 2020  Reason,.        
+0000f4c0: 626c 616e 6b3d 5472 7565 2c0a 2020 2020  blank=True,.    
+0000f4d0: 2020 2020 6865 6c70 5f74 6578 743d 280a      help_text=(.
+0000f4e0: 2020 2020 2020 2020 2020 2020 2252 6561              "Rea
+0000f4f0: 736f 6e20 666f 7220 6361 6e63 656c 6c61  son for cancella
+0000f500: 7469 6f6e 206f 6620 7468 6973 2050 6179  tion of this Pay
+0000f510: 6d65 6e74 496e 7465 6e74 2c20 6569 7468  mentIntent, eith
+0000f520: 6572 2075 7365 722d 7072 6f76 6964 6564  er user-provided
+0000f530: 2022 0a20 2020 2020 2020 2020 2020 2022   ".            "
+0000f540: 2864 7570 6c69 6361 7465 2c20 6672 6175  (duplicate, frau
+0000f550: 6475 6c65 6e74 2c20 7265 7175 6573 7465  dulent, requeste
+0000f560: 645f 6279 5f63 7573 746f 6d65 722c 206f  d_by_customer, o
+0000f570: 7220 6162 616e 646f 6e65 6429 206f 7220  r abandoned) or 
+0000f580: 220a 2020 2020 2020 2020 2020 2020 2267  ".            "g
+0000f590: 656e 6572 6174 6564 2062 7920 5374 7269  enerated by Stri
+0000f5a0: 7065 2069 6e74 6572 6e61 6c6c 7920 2866  pe internally (f
+0000f5b0: 6169 6c65 645f 696e 766f 6963 652c 2076  ailed_invoice, v
+0000f5c0: 6f69 645f 696e 766f 6963 652c 2022 0a20  oid_invoice, ". 
+0000f5d0: 2020 2020 2020 2020 2020 2022 6f72 2061             "or a
+0000f5e0: 7574 6f6d 6174 6963 292e 220a 2020 2020  utomatic).".    
+0000f5f0: 2020 2020 292c 0a20 2020 2029 0a20 2020      ),.    ).   
+0000f600: 2063 6170 7475 7265 5f6d 6574 686f 6420   capture_method 
+0000f610: 3d20 5374 7269 7065 456e 756d 4669 656c  = StripeEnumFiel
+0000f620: 6428 0a20 2020 2020 2020 2065 6e75 6d3d  d(.        enum=
+0000f630: 656e 756d 732e 4361 7074 7572 654d 6574  enums.CaptureMet
+0000f640: 686f 642c 0a20 2020 2020 2020 2068 656c  hod,.        hel
+0000f650: 705f 7465 7874 3d22 4361 7074 7572 6520  p_text="Capture 
+0000f660: 6d65 7468 6f64 206f 6620 7468 6973 2050  method of this P
+0000f670: 6179 6d65 6e74 496e 7465 6e74 2c20 6f6e  aymentIntent, on
+0000f680: 6520 6f66 2061 7574 6f6d 6174 6963 206f  e of automatic o
+0000f690: 7220 6d61 6e75 616c 2e22 2c0a 2020 2020  r manual.",.    
+0000f6a0: 290a 2020 2020 636c 6965 6e74 5f73 6563  ).    client_sec
+0000f6b0: 7265 7420 3d20 6d6f 6465 6c73 2e54 6578  ret = models.Tex
+0000f6c0: 7446 6965 6c64 280a 2020 2020 2020 2020  tField(.        
+0000f6d0: 6d61 785f 6c65 6e67 7468 3d35 3030 302c  max_length=5000,
+0000f6e0: 0a20 2020 2020 2020 2068 656c 705f 7465  .        help_te
+0000f6f0: 7874 3d28 0a20 2020 2020 2020 2020 2020  xt=(.           
+0000f700: 2022 5468 6520 636c 6965 6e74 2073 6563   "The client sec
+0000f710: 7265 7420 6f66 2074 6869 7320 5061 796d  ret of this Paym
+0000f720: 656e 7449 6e74 656e 742e 2022 0a20 2020  entIntent. ".   
+0000f730: 2020 2020 2020 2020 2022 5573 6564 2066           "Used f
+0000f740: 6f72 2063 6c69 656e 742d 7369 6465 2072  or client-side r
+0000f750: 6574 7269 6576 616c 2075 7369 6e67 2061  etrieval using a
+0000f760: 2070 7562 6c69 7368 6162 6c65 206b 6579   publishable key
+0000f770: 2e22 0a20 2020 2020 2020 2029 2c0a 2020  .".        ),.  
+0000f780: 2020 290a 2020 2020 636f 6e66 6972 6d61    ).    confirma
+0000f790: 7469 6f6e 5f6d 6574 686f 6420 3d20 5374  tion_method = St
+0000f7a0: 7269 7065 456e 756d 4669 656c 6428 0a20  ripeEnumField(. 
+0000f7b0: 2020 2020 2020 2065 6e75 6d3d 656e 756d         enum=enum
+0000f7c0: 732e 436f 6e66 6972 6d61 7469 6f6e 4d65  s.ConfirmationMe
+0000f7d0: 7468 6f64 2c0a 2020 2020 2020 2020 6865  thod,.        he
+0000f7e0: 6c70 5f74 6578 743d 280a 2020 2020 2020  lp_text=(.      
+0000f7f0: 2020 2020 2020 2243 6f6e 6669 726d 6174        "Confirmat
+0000f800: 696f 6e20 6d65 7468 6f64 206f 6620 7468  ion method of th
+0000f810: 6973 2050 6179 6d65 6e74 496e 7465 6e74  is PaymentIntent
+0000f820: 2c20 6f6e 6520 6f66 206d 616e 7561 6c20  , one of manual 
+0000f830: 6f72 2061 7574 6f6d 6174 6963 2e22 0a20  or automatic.". 
+0000f840: 2020 2020 2020 2029 2c0a 2020 2020 290a         ),.    ).
+0000f850: 2020 2020 6375 7272 656e 6379 203d 2053      currency = S
+0000f860: 7472 6970 6543 7572 7265 6e63 7943 6f64  tripeCurrencyCod
+0000f870: 6546 6965 6c64 2829 0a20 2020 2063 7573  eField().    cus
+0000f880: 746f 6d65 7220 3d20 5374 7269 7065 466f  tomer = StripeFo
+0000f890: 7265 6967 6e4b 6579 280a 2020 2020 2020  reignKey(.      
+0000f8a0: 2020 2243 7573 746f 6d65 7222 2c0a 2020    "Customer",.  
+0000f8b0: 2020 2020 2020 6e75 6c6c 3d54 7275 652c        null=True,
+0000f8c0: 0a20 2020 2020 2020 206f 6e5f 6465 6c65  .        on_dele
+0000f8d0: 7465 3d6d 6f64 656c 732e 4341 5343 4144  te=models.CASCAD
+0000f8e0: 452c 0a20 2020 2020 2020 2068 656c 705f  E,.        help_
+0000f8f0: 7465 7874 3d22 4375 7374 6f6d 6572 2074  text="Customer t
+0000f900: 6869 7320 5061 796d 656e 7449 6e74 656e  his PaymentInten
+0000f910: 7420 6973 2066 6f72 2069 6620 6f6e 6520  t is for if one 
+0000f920: 6578 6973 7473 2e22 2c0a 2020 2020 290a  exists.",.    ).
+0000f930: 2020 2020 6465 7363 7269 7074 696f 6e20      description 
+0000f940: 3d20 6d6f 6465 6c73 2e54 6578 7446 6965  = models.TextFie
+0000f950: 6c64 280a 2020 2020 2020 2020 6d61 785f  ld(.        max_
+0000f960: 6c65 6e67 7468 3d31 3030 302c 0a20 2020  length=1000,.   
+0000f970: 2020 2020 2064 6566 6175 6c74 3d22 222c       default="",
+0000f980: 0a20 2020 2020 2020 2062 6c61 6e6b 3d54  .        blank=T
+0000f990: 7275 652c 0a20 2020 2020 2020 2068 656c  rue,.        hel
+0000f9a0: 705f 7465 7874 3d28 0a20 2020 2020 2020  p_text=(.       
+0000f9b0: 2020 2020 2022 416e 2061 7262 6974 7261       "An arbitra
+0000f9c0: 7279 2073 7472 696e 6720 6174 7461 6368  ry string attach
+0000f9d0: 6564 2074 6f20 7468 6520 6f62 6a65 6374  ed to the object
+0000f9e0: 2e20 220a 2020 2020 2020 2020 2020 2020  . ".            
+0000f9f0: 224f 6674 656e 2075 7365 6675 6c20 666f  "Often useful fo
+0000fa00: 7220 6469 7370 6c61 7969 6e67 2074 6f20  r displaying to 
+0000fa10: 7573 6572 732e 220a 2020 2020 2020 2020  users.".        
+0000fa20: 292c 0a20 2020 2029 0a20 2020 206c 6173  ),.    ).    las
+0000fa30: 745f 7061 796d 656e 745f 6572 726f 7220  t_payment_error 
+0000fa40: 3d20 4a53 4f4e 4669 656c 6428 0a20 2020  = JSONField(.   
+0000fa50: 2020 2020 206e 756c 6c3d 5472 7565 2c0a       null=True,.
+0000fa60: 2020 2020 2020 2020 626c 616e 6b3d 5472          blank=Tr
+0000fa70: 7565 2c0a 2020 2020 2020 2020 6865 6c70  ue,.        help
+0000fa80: 5f74 6578 743d 280a 2020 2020 2020 2020  _text=(.        
+0000fa90: 2020 2020 2254 6865 2070 6179 6d65 6e74      "The payment
+0000faa0: 2065 7272 6f72 2065 6e63 6f75 6e74 6572   error encounter
+0000fab0: 6564 2069 6e20 7468 6520 7072 6576 696f  ed in the previo
+0000fac0: 7573 2050 6179 6d65 6e74 496e 7465 6e74  us PaymentIntent
+0000fad0: 2063 6f6e 6669 726d 6174 696f 6e2e 220a   confirmation.".
+0000fae0: 2020 2020 2020 2020 292c 0a20 2020 2029          ),.    )
+0000faf0: 0a20 2020 206e 6578 745f 6163 7469 6f6e  .    next_action
+0000fb00: 203d 204a 534f 4e46 6965 6c64 280a 2020   = JSONField(.  
+0000fb10: 2020 2020 2020 6e75 6c6c 3d54 7275 652c        null=True,
+0000fb20: 0a20 2020 2020 2020 2062 6c61 6e6b 3d54  .        blank=T
+0000fb30: 7275 652c 0a20 2020 2020 2020 2068 656c  rue,.        hel
+0000fb40: 705f 7465 7874 3d28 0a20 2020 2020 2020  p_text=(.       
+0000fb50: 2020 2020 2022 4966 2070 7265 7365 6e74       "If present
+0000fb60: 2c20 7468 6973 2070 726f 7065 7274 7920  , this property 
+0000fb70: 7465 6c6c 7320 796f 7520 7768 6174 2061  tells you what a
+0000fb80: 6374 696f 6e73 2079 6f75 206e 6565 6420  ctions you need 
+0000fb90: 746f 2074 616b 6520 220a 2020 2020 2020  to take ".      
+0000fba0: 2020 2020 2020 2269 6e20 6f72 6465 7220        "in order 
+0000fbb0: 666f 7220 796f 7572 2063 7573 746f 6d65  for your custome
+0000fbc0: 7220 746f 2066 756c 6669 6c6c 2061 2070  r to fulfill a p
+0000fbd0: 6179 6d65 6e74 2075 7369 6e67 2074 6865  ayment using the
+0000fbe0: 2070 726f 7669 6465 6420 736f 7572 6365   provided source
+0000fbf0: 2e22 0a20 2020 2020 2020 2029 2c0a 2020  .".        ),.  
+0000fc00: 2020 290a 2020 2020 6f6e 5f62 6568 616c    ).    on_behal
+0000fc10: 665f 6f66 203d 2053 7472 6970 6546 6f72  f_of = StripeFor
+0000fc20: 6569 676e 4b65 7928 0a20 2020 2020 2020  eignKey(.       
+0000fc30: 2022 4163 636f 756e 7422 2c0a 2020 2020   "Account",.    
+0000fc40: 2020 2020 6f6e 5f64 656c 6574 653d 6d6f      on_delete=mo
+0000fc50: 6465 6c73 2e43 4153 4341 4445 2c0a 2020  dels.CASCADE,.  
+0000fc60: 2020 2020 2020 6e75 6c6c 3d54 7275 652c        null=True,
+0000fc70: 0a20 2020 2020 2020 2062 6c61 6e6b 3d54  .        blank=T
+0000fc80: 7275 652c 0a20 2020 2020 2020 2068 656c  rue,.        hel
+0000fc90: 705f 7465 7874 3d28 0a20 2020 2020 2020  p_text=(.       
+0000fca0: 2020 2020 2022 5468 6520 6163 636f 756e       "The accoun
+0000fcb0: 7420 2869 6620 616e 7929 2066 6f72 2077  t (if any) for w
+0000fcc0: 6869 6368 2074 6865 2066 756e 6473 206f  hich the funds o
+0000fcd0: 6620 7468 6520 220a 2020 2020 2020 2020  f the ".        
+0000fce0: 2020 2020 2250 6179 6d65 6e74 496e 7465      "PaymentInte
+0000fcf0: 6e74 2061 7265 2069 6e74 656e 6465 642e  nt are intended.
+0000fd00: 220a 2020 2020 2020 2020 292c 0a20 2020  ".        ),.   
+0000fd10: 2020 2020 2072 656c 6174 6564 5f6e 616d       related_nam
+0000fd20: 653d 2270 6179 6d65 6e74 5f69 6e74 656e  e="payment_inten
+0000fd30: 7473 222c 0a20 2020 2029 0a20 2020 2070  ts",.    ).    p
+0000fd40: 6179 6d65 6e74 5f6d 6574 686f 6420 3d20  ayment_method = 
+0000fd50: 5374 7269 7065 466f 7265 6967 6e4b 6579  StripeForeignKey
+0000fd60: 280a 2020 2020 2020 2020 2250 6179 6d65  (.        "Payme
+0000fd70: 6e74 4d65 7468 6f64 222c 0a20 2020 2020  ntMethod",.     
+0000fd80: 2020 206f 6e5f 6465 6c65 7465 3d6d 6f64     on_delete=mod
+0000fd90: 656c 732e 5345 545f 4e55 4c4c 2c0a 2020  els.SET_NULL,.  
+0000fda0: 2020 2020 2020 6e75 6c6c 3d54 7275 652c        null=True,
+0000fdb0: 0a20 2020 2020 2020 2062 6c61 6e6b 3d54  .        blank=T
+0000fdc0: 7275 652c 0a20 2020 2020 2020 2068 656c  rue,.        hel
+0000fdd0: 705f 7465 7874 3d22 5061 796d 656e 7420  p_text="Payment 
+0000fde0: 6d65 7468 6f64 2075 7365 6420 696e 2074  method used in t
+0000fdf0: 6869 7320 5061 796d 656e 7449 6e74 656e  his PaymentInten
+0000fe00: 742e 222c 0a20 2020 2029 0a20 2020 2070  t.",.    ).    p
+0000fe10: 6179 6d65 6e74 5f6d 6574 686f 645f 7479  ayment_method_ty
+0000fe20: 7065 7320 3d20 4a53 4f4e 4669 656c 6428  pes = JSONField(
+0000fe30: 0a20 2020 2020 2020 2068 656c 705f 7465  .        help_te
+0000fe40: 7874 3d28 0a20 2020 2020 2020 2020 2020  xt=(.           
+0000fe50: 2022 5468 6520 6c69 7374 206f 6620 7061   "The list of pa
+0000fe60: 796d 656e 7420 6d65 7468 6f64 2074 7970  yment method typ
+0000fe70: 6573 2028 652e 672e 2063 6172 6429 2074  es (e.g. card) t
+0000fe80: 6861 7420 7468 6973 2022 0a20 2020 2020  hat this ".     
+0000fe90: 2020 2020 2020 2022 5061 796d 656e 7449         "PaymentI
+0000fea0: 6e74 656e 7420 6973 2061 6c6c 6f77 6564  ntent is allowed
+0000feb0: 2074 6f20 7573 652e 220a 2020 2020 2020   to use.".      
+0000fec0: 2020 290a 2020 2020 290a 2020 2020 7265    ).    ).    re
+0000fed0: 6365 6970 745f 656d 6169 6c20 3d20 6d6f  ceipt_email = mo
+0000fee0: 6465 6c73 2e43 6861 7246 6965 6c64 280a  dels.CharField(.
+0000fef0: 2020 2020 2020 2020 626c 616e 6b3d 5472          blank=Tr
+0000ff00: 7565 2c0a 2020 2020 2020 2020 6d61 785f  ue,.        max_
+0000ff10: 6c65 6e67 7468 3d32 3535 2c0a 2020 2020  length=255,.    
+0000ff20: 2020 2020 6865 6c70 5f74 6578 743d 280a      help_text=(.
+0000ff30: 2020 2020 2020 2020 2020 2020 2245 6d61              "Ema
+0000ff40: 696c 2061 6464 7265 7373 2074 6861 7420  il address that 
+0000ff50: 7468 6520 7265 6365 6970 7420 666f 7220  the receipt for 
+0000ff60: 7468 6520 7265 7375 6c74 696e 6720 7061  the resulting pa
+0000ff70: 796d 656e 7420 7769 6c6c 2062 6520 7365  yment will be se
+0000ff80: 6e74 2074 6f2e 220a 2020 2020 2020 2020  nt to.".        
+0000ff90: 292c 0a20 2020 2029 0a20 2020 2023 2054  ),.    ).    # T
+0000ffa0: 4f44 4f3a 2041 6464 2060 7265 7669 6577  ODO: Add `review
+0000ffb0: 6020 6669 656c 6420 6166 7465 7220 7765  ` field after we
+0000ffc0: 2061 6464 2052 6576 6965 7720 6d6f 6465   add Review mode
+0000ffd0: 6c2e 0a20 2020 2073 6574 7570 5f66 7574  l..    setup_fut
+0000ffe0: 7572 655f 7573 6167 6520 3d20 5374 7269  ure_usage = Stri
+0000fff0: 7065 456e 756d 4669 656c 6428 0a20 2020  peEnumField(.   
+00010000: 2020 2020 2065 6e75 6d3d 656e 756d 732e       enum=enums.
+00010010: 496e 7465 6e74 5573 6167 652c 0a20 2020  IntentUsage,.   
+00010020: 2020 2020 206e 756c 6c3d 5472 7565 2c0a       null=True,.
+00010030: 2020 2020 2020 2020 626c 616e 6b3d 5472          blank=Tr
+00010040: 7565 2c0a 2020 2020 2020 2020 6865 6c70  ue,.        help
+00010050: 5f74 6578 743d 280a 2020 2020 2020 2020  _text=(.        
+00010060: 2020 2020 2249 6e64 6963 6174 6573 2074      "Indicates t
+00010070: 6861 7420 796f 7520 696e 7465 6e64 2074  hat you intend t
+00010080: 6f20 6d61 6b65 2066 7574 7572 6520 7061  o make future pa
+00010090: 796d 656e 7473 2077 6974 6820 7468 6973  yments with this
+000100a0: 2022 0a20 2020 2020 2020 2020 2020 2022   ".            "
+000100b0: 5061 796d 656e 7449 6e74 656e 7427 7320  PaymentIntent's 
+000100c0: 7061 796d 656e 7420 6d65 7468 6f64 2e20  payment method. 
+000100d0: 220a 2020 2020 2020 2020 2020 2020 2249  ".            "I
+000100e0: 6620 7072 6573 656e 742c 2074 6865 2070  f present, the p
+000100f0: 6179 6d65 6e74 206d 6574 686f 6420 7573  ayment method us
+00010100: 6564 2077 6974 6820 7468 6973 2050 6179  ed with this Pay
+00010110: 6d65 6e74 496e 7465 6e74 2063 616e 2022  mentIntent can "
+00010120: 0a20 2020 2020 2020 2020 2020 2022 6265  .            "be
+00010130: 2061 7474 6163 6865 6420 746f 2061 2043   attached to a C
+00010140: 7573 746f 6d65 722c 2065 7665 6e20 6166  ustomer, even af
+00010150: 7465 7220 7468 6520 7472 616e 7361 6374  ter the transact
+00010160: 696f 6e20 636f 6d70 6c65 7465 732e 2022  ion completes. "
+00010170: 0a20 2020 2020 2020 2020 2020 2022 5573  .            "Us
+00010180: 6520 606f 6e5f 7365 7373 696f 6e60 2069  e `on_session` i
+00010190: 6620 796f 7520 696e 7465 6e64 2074 6f20  f you intend to 
+000101a0: 6f6e 6c79 2072 6575 7365 2074 6865 2070  only reuse the p
+000101b0: 6179 6d65 6e74 206d 6574 686f 6420 220a  ayment method ".
+000101c0: 2020 2020 2020 2020 2020 2020 2277 6865              "whe
+000101d0: 6e20 796f 7572 2063 7573 746f 6d65 7220  n your customer 
+000101e0: 6973 2070 7265 7365 6e74 2069 6e20 796f  is present in yo
+000101f0: 7572 2063 6865 636b 6f75 7420 666c 6f77  ur checkout flow
+00010200: 2e20 5573 6520 606f 6666 5f73 6573 7369  . Use `off_sessi
+00010210: 6f6e 6020 220a 2020 2020 2020 2020 2020  on` ".          
+00010220: 2020 2269 6620 796f 7572 2063 7573 746f    "if your custo
+00010230: 6d65 7220 6d61 7920 6f72 206d 6179 206e  mer may or may n
+00010240: 6f74 2062 6520 696e 2079 6f75 7220 6368  ot be in your ch
+00010250: 6563 6b6f 7574 2066 6c6f 772e 2022 0a20  eckout flow. ". 
+00010260: 2020 2020 2020 2020 2020 2022 5374 7269             "Stri
+00010270: 7065 2075 7365 7320 6073 6574 7570 5f66  pe uses `setup_f
+00010280: 7574 7572 655f 7573 6167 6560 2074 6f20  uture_usage` to 
+00010290: 6479 6e61 6d69 6361 6c6c 7920 6f70 7469  dynamically opti
+000102a0: 6d69 7a65 2022 0a20 2020 2020 2020 2020  mize ".         
+000102b0: 2020 2022 796f 7572 2070 6179 6d65 6e74     "your payment
+000102c0: 2066 6c6f 7720 616e 6420 636f 6d70 6c79   flow and comply
+000102d0: 2077 6974 6820 7265 6769 6f6e 616c 206c   with regional l
+000102e0: 6567 6973 6c61 7469 6f6e 2061 6e64 206e  egislation and n
+000102f0: 6574 776f 726b 2072 756c 6573 2e20 220a  etwork rules. ".
+00010300: 2020 2020 2020 2020 2020 2020 2246 6f72              "For
+00010310: 2065 7861 6d70 6c65 2c20 6966 2079 6f75   example, if you
+00010320: 7220 6375 7374 6f6d 6572 2069 7320 696d  r customer is im
+00010330: 7061 6374 6564 2062 7920 5343 412c 2075  pacted by SCA, u
+00010340: 7369 6e67 2060 6f66 665f 7365 7373 696f  sing `off_sessio
+00010350: 6e60 2022 0a20 2020 2020 2020 2020 2020  n` ".           
+00010360: 2022 7769 6c6c 2065 6e73 7572 6520 7468   "will ensure th
+00010370: 6174 2074 6865 7920 6172 6520 6175 7468  at they are auth
+00010380: 656e 7469 6361 7465 6420 7768 696c 6520  enticated while 
+00010390: 7072 6f63 6573 7369 6e67 2074 6869 7320  processing this 
+000103a0: 220a 2020 2020 2020 2020 2020 2020 2250  ".            "P
+000103b0: 6179 6d65 6e74 496e 7465 6e74 2e20 596f  aymentIntent. Yo
+000103c0: 7520 7769 6c6c 2074 6865 6e20 6265 2061  u will then be a
+000103d0: 626c 6520 746f 206d 616b 6520 6c61 7465  ble to make late
+000103e0: 7220 6f66 662d 7365 7373 696f 6e20 7061  r off-session pa
+000103f0: 796d 656e 7473 2022 0a20 2020 2020 2020  yments ".       
+00010400: 2020 2020 2022 666f 7220 7468 6973 2063       "for this c
+00010410: 7573 746f 6d65 722e 220a 2020 2020 2020  ustomer.".      
+00010420: 2020 292c 0a20 2020 2029 0a20 2020 2073    ),.    ).    s
+00010430: 6869 7070 696e 6720 3d20 4a53 4f4e 4669  hipping = JSONFi
+00010440: 656c 6428 0a20 2020 2020 2020 206e 756c  eld(.        nul
+00010450: 6c3d 5472 7565 2c20 626c 616e 6b3d 5472  l=True, blank=Tr
+00010460: 7565 2c20 6865 6c70 5f74 6578 743d 2253  ue, help_text="S
+00010470: 6869 7070 696e 6720 696e 666f 726d 6174  hipping informat
+00010480: 696f 6e20 666f 7220 7468 6973 2050 6179  ion for this Pay
+00010490: 6d65 6e74 496e 7465 6e74 2e22 0a20 2020  mentIntent.".   
+000104a0: 2029 0a20 2020 2073 7461 7465 6d65 6e74   ).    statement
+000104b0: 5f64 6573 6372 6970 746f 7220 3d20 6d6f  _descriptor = mo
+000104c0: 6465 6c73 2e43 6861 7246 6965 6c64 280a  dels.CharField(.
+000104d0: 2020 2020 2020 2020 6d61 785f 6c65 6e67          max_leng
+000104e0: 7468 3d32 322c 0a20 2020 2020 2020 2062  th=22,.        b
+000104f0: 6c61 6e6b 3d54 7275 652c 0a20 2020 2020  lank=True,.     
+00010500: 2020 2068 656c 705f 7465 7874 3d28 0a20     help_text=(. 
+00010510: 2020 2020 2020 2020 2020 2022 466f 7220             "For 
+00010520: 6e6f 6e2d 6361 7264 2063 6861 7267 6573  non-card charges
+00010530: 2c20 796f 7520 6361 6e20 7573 6520 7468  , you can use th
+00010540: 6973 2076 616c 7565 2061 7320 7468 6520  is value as the 
+00010550: 636f 6d70 6c65 7465 2064 6573 6372 6970  complete descrip
+00010560: 7469 6f6e 2022 0a20 2020 2020 2020 2020  tion ".         
+00010570: 2020 2022 7468 6174 2061 7070 6561 7273     "that appears
+00010580: 206f 6e20 796f 7572 2063 7573 746f 6d65   on your custome
+00010590: 7273 2720 7374 6174 656d 656e 7473 2e20  rs' statements. 
+000105a0: 4d75 7374 2063 6f6e 7461 696e 2061 7420  Must contain at 
+000105b0: 6c65 6173 7420 6f6e 6520 220a 2020 2020  least one ".    
+000105c0: 2020 2020 2020 2020 226c 6574 7465 722c          "letter,
+000105d0: 206d 6178 696d 756d 2032 3220 6368 6172   maximum 22 char
+000105e0: 6163 7465 7273 2e22 0a20 2020 2020 2020  acters.".       
+000105f0: 2029 2c0a 2020 2020 290a 2020 2020 7374   ),.    ).    st
+00010600: 6174 7573 203d 2053 7472 6970 6545 6e75  atus = StripeEnu
+00010610: 6d46 6965 6c64 280a 2020 2020 2020 2020  mField(.        
+00010620: 656e 756d 3d65 6e75 6d73 2e50 6179 6d65  enum=enums.Payme
+00010630: 6e74 496e 7465 6e74 5374 6174 7573 2c0a  ntIntentStatus,.
+00010640: 2020 2020 2020 2020 6865 6c70 5f74 6578          help_tex
+00010650: 743d 280a 2020 2020 2020 2020 2020 2020  t=(.            
+00010660: 2253 7461 7475 7320 6f66 2074 6869 7320  "Status of this 
+00010670: 5061 796d 656e 7449 6e74 656e 742c 206f  PaymentIntent, o
+00010680: 6e65 206f 6620 7265 7175 6972 6573 5f70  ne of requires_p
+00010690: 6179 6d65 6e74 5f6d 6574 686f 642c 2022  ayment_method, "
+000106a0: 0a20 2020 2020 2020 2020 2020 2022 7265  .            "re
+000106b0: 7175 6972 6573 5f63 6f6e 6669 726d 6174  quires_confirmat
+000106c0: 696f 6e2c 2072 6571 7569 7265 735f 6163  ion, requires_ac
+000106d0: 7469 6f6e 2c20 7072 6f63 6573 7369 6e67  tion, processing
+000106e0: 2c20 7265 7175 6972 6573 5f63 6170 7475  , requires_captu
+000106f0: 7265 2c20 220a 2020 2020 2020 2020 2020  re, ".          
+00010700: 2020 2263 616e 6365 6c65 642c 206f 7220    "canceled, or 
+00010710: 7375 6363 6565 6465 642e 2022 0a20 2020  succeeded. ".   
+00010720: 2020 2020 2020 2020 2022 596f 7520 6361           "You ca
+00010730: 6e20 7265 6164 206d 6f72 6520 6162 6f75  n read more abou
+00010740: 7420 5061 796d 656e 7449 6e74 656e 7420  t PaymentIntent 
+00010750: 7374 6174 7573 6573 2068 6572 652e 220a  statuses here.".
+00010760: 2020 2020 2020 2020 292c 0a20 2020 2029          ),.    )
+00010770: 0a20 2020 2074 7261 6e73 6665 725f 6461  .    transfer_da
+00010780: 7461 203d 204a 534f 4e46 6965 6c64 280a  ta = JSONField(.
+00010790: 2020 2020 2020 2020 6e75 6c6c 3d54 7275          null=Tru
+000107a0: 652c 0a20 2020 2020 2020 2062 6c61 6e6b  e,.        blank
+000107b0: 3d54 7275 652c 0a20 2020 2020 2020 2068  =True,.        h
+000107c0: 656c 705f 7465 7874 3d28 0a20 2020 2020  elp_text=(.     
+000107d0: 2020 2020 2020 2022 5468 6520 6461 7461         "The data
+000107e0: 2077 6974 6820 7768 6963 6820 746f 2061   with which to a
+000107f0: 7574 6f6d 6174 6963 616c 6c79 2063 7265  utomatically cre
+00010800: 6174 6520 6120 5472 616e 7366 6572 2077  ate a Transfer w
+00010810: 6865 6e20 7468 6520 7061 796d 656e 7420  hen the payment 
+00010820: 220a 2020 2020 2020 2020 2020 2020 2269  ".            "i
+00010830: 7320 6669 6e61 6c69 7a65 642e 2022 0a20  s finalized. ". 
+00010840: 2020 2020 2020 2020 2020 2022 5365 6520             "See 
+00010850: 7468 6520 5061 796d 656e 7449 6e74 656e  the PaymentInten
+00010860: 7473 2043 6f6e 6e65 6374 2075 7361 6765  ts Connect usage
+00010870: 2067 7569 6465 2066 6f72 2064 6574 6169   guide for detai
+00010880: 6c73 2e22 0a20 2020 2020 2020 2029 2c0a  ls.".        ),.
+00010890: 2020 2020 290a 2020 2020 7472 616e 7366      ).    transf
+000108a0: 6572 5f67 726f 7570 203d 206d 6f64 656c  er_group = model
+000108b0: 732e 4368 6172 4669 656c 6428 0a20 2020  s.CharField(.   
+000108c0: 2020 2020 2062 6c61 6e6b 3d54 7275 652c       blank=True,
+000108d0: 0a20 2020 2020 2020 206d 6178 5f6c 656e  .        max_len
+000108e0: 6774 683d 3235 352c 0a20 2020 2020 2020  gth=255,.       
+000108f0: 2068 656c 705f 7465 7874 3d28 0a20 2020   help_text=(.   
+00010900: 2020 2020 2020 2020 2022 4120 7374 7269           "A stri
+00010910: 6e67 2074 6861 7420 6964 656e 7469 6669  ng that identifi
+00010920: 6573 2074 6865 2072 6573 756c 7469 6e67  es the resulting
+00010930: 2070 6179 6d65 6e74 2061 7320 7061 7274   payment as part
+00010940: 206f 6620 6120 6772 6f75 702e 2022 0a20   of a group. ". 
+00010950: 2020 2020 2020 2020 2020 2022 5365 6520             "See 
+00010960: 7468 6520 5061 796d 656e 7449 6e74 656e  the PaymentInten
+00010970: 7473 2043 6f6e 6e65 6374 2075 7361 6765  ts Connect usage
+00010980: 2067 7569 6465 2066 6f72 2064 6574 6169   guide for detai
+00010990: 6c73 2e22 0a20 2020 2020 2020 2029 2c0a  ls.".        ),.
+000109a0: 2020 2020 290a 0a20 2020 2064 6566 205f      )..    def _
+000109b0: 5f73 7472 5f5f 2873 656c 6629 3a0a 2020  _str__(self):.  
+000109c0: 2020 2020 2020 6163 636f 756e 7420 3d20        account = 
+000109d0: 7365 6c66 2e6f 6e5f 6265 6861 6c66 5f6f  self.on_behalf_o
+000109e0: 660a 2020 2020 2020 2020 6375 7374 6f6d  f.        custom
+000109f0: 6572 203d 2073 656c 662e 6375 7374 6f6d  er = self.custom
+00010a00: 6572 0a20 2020 2020 2020 2061 6d6f 756e  er.        amoun
+00010a10: 7420 3d20 6765 745f 6672 6965 6e64 6c79  t = get_friendly
+00010a20: 5f63 7572 7265 6e63 795f 616d 6f75 6e74  _currency_amount
+00010a30: 2873 656c 662e 616d 6f75 6e74 202f 2031  (self.amount / 1
+00010a40: 3030 2c20 7365 6c66 2e63 7572 7265 6e63  00, self.currenc
+00010a50: 7929 0a20 2020 2020 2020 2073 7461 7475  y).        statu
+00010a60: 7320 3d20 656e 756d 732e 5061 796d 656e  s = enums.Paymen
+00010a70: 7449 6e74 656e 7453 7461 7475 732e 6875  tIntentStatus.hu
+00010a80: 6d61 6e69 7a65 2873 656c 662e 7374 6174  manize(self.stat
+00010a90: 7573 290a 0a20 2020 2020 2020 2069 6620  us)..        if 
+00010aa0: 6163 636f 756e 7420 616e 6420 6375 7374  account and cust
+00010ab0: 6f6d 6572 3a0a 2020 2020 2020 2020 2020  omer:.          
+00010ac0: 2020 7265 7475 726e 2066 227b 616d 6f75    return f"{amou
+00010ad0: 6e74 7d20 287b 7374 6174 7573 7d29 2066  nt} ({status}) f
+00010ae0: 6f72 207b 6163 636f 756e 747d 2062 7920  or {account} by 
+00010af0: 7b63 7573 746f 6d65 727d 220a 2020 2020  {customer}".    
+00010b00: 2020 2020 6966 2061 6363 6f75 6e74 3a0a      if account:.
+00010b10: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00010b20: 726e 2066 227b 616d 6f75 6e74 7d20 666f  rn f"{amount} fo
+00010b30: 7220 7b61 6363 6f75 6e74 7d2e 207b 7374  r {account}. {st
+00010b40: 6174 7573 7d22 0a20 2020 2020 2020 2069  atus}".        i
+00010b50: 6620 6375 7374 6f6d 6572 3a0a 2020 2020  f customer:.    
+00010b60: 2020 2020 2020 2020 7265 7475 726e 2066          return f
+00010b70: 227b 616d 6f75 6e74 7d20 6279 207b 6375  "{amount} by {cu
+00010b80: 7374 6f6d 6572 7d2e 207b 7374 6174 7573  stomer}. {status
+00010b90: 7d22 0a0a 2020 2020 2020 2020 7265 7475  }"..        retu
+00010ba0: 726e 2066 227b 616d 6f75 6e74 7d20 287b  rn f"{amount} ({
+00010bb0: 7374 6174 7573 7d29 220a 0a20 2020 2064  status})"..    d
+00010bc0: 6566 2075 7064 6174 6528 7365 6c66 2c20  ef update(self, 
+00010bd0: 6170 695f 6b65 793d 4e6f 6e65 2c20 2a2a  api_key=None, **
+00010be0: 6b77 6172 6773 293a 0a20 2020 2020 2020  kwargs):.       
+00010bf0: 2022 2222 0a20 2020 2020 2020 2043 616c   """.        Cal
+00010c00: 6c20 7468 6520 7374 7269 7065 2041 5049  l the stripe API
+00010c10: 2773 206d 6f64 6966 7920 6f70 6572 6174  's modify operat
+00010c20: 696f 6e20 666f 7220 7468 6973 206d 6f64  ion for this mod
+00010c30: 656c 0a0a 2020 2020 2020 2020 3a70 6172  el..        :par
+00010c40: 616d 2061 7069 5f6b 6579 3a20 5468 6520  am api_key: The 
+00010c50: 6170 6920 6b65 7920 746f 2075 7365 2066  api key to use f
+00010c60: 6f72 2074 6869 7320 7265 7175 6573 742e  or this request.
+00010c70: 0a20 2020 2020 2020 2020 2020 2044 6566  .            Def
+00010c80: 6175 6c74 7320 746f 2064 6a73 7472 6970  aults to djstrip
+00010c90: 655f 7365 7474 696e 6773 2e53 5452 4950  e_settings.STRIP
+00010ca0: 455f 5345 4352 4554 5f4b 4559 2e0a 2020  E_SECRET_KEY..  
+00010cb0: 2020 2020 2020 3a74 7970 6520 6170 695f        :type api_
+00010cc0: 6b65 793a 2073 7472 696e 670a 2020 2020  key: string.    
+00010cd0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00010ce0: 6170 695f 6b65 7920 3d20 6170 695f 6b65  api_key = api_ke
+00010cf0: 7920 6f72 2073 656c 662e 6465 6661 756c  y or self.defaul
+00010d00: 745f 6170 695f 6b65 790a 2020 2020 2020  t_api_key.      
+00010d10: 2020 7265 7370 6f6e 7365 203d 2073 656c    response = sel
+00010d20: 662e 6170 695f 7265 7472 6965 7665 2861  f.api_retrieve(a
+00010d30: 7069 5f6b 6579 3d61 7069 5f6b 6579 290a  pi_key=api_key).
+00010d40: 2020 2020 2020 2020 7265 7475 726e 2072          return r
+00010d50: 6573 706f 6e73 652e 6d6f 6469 6679 2872  esponse.modify(r
+00010d60: 6573 706f 6e73 652e 7374 7269 7065 5f69  esponse.stripe_i
+00010d70: 642c 2061 7069 5f6b 6579 3d61 7069 5f6b  d, api_key=api_k
+00010d80: 6579 2c20 2a2a 6b77 6172 6773 290a 0a20  ey, **kwargs).. 
+00010d90: 2020 2064 6566 205f 6170 695f 6361 6e63     def _api_canc
+00010da0: 656c 2873 656c 662c 2061 7069 5f6b 6579  el(self, api_key
+00010db0: 3d4e 6f6e 652c 202a 2a6b 7761 7267 7329  =None, **kwargs)
+00010dc0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00010dd0: 2020 2020 2020 4361 6c6c 2074 6865 2073        Call the s
+00010de0: 7472 6970 6520 4150 4927 7320 6361 6e63  tripe API's canc
+00010df0: 656c 206f 7065 7261 7469 6f6e 2066 6f72  el operation for
+00010e00: 2074 6869 7320 6d6f 6465 6c0a 0a20 2020   this model..   
+00010e10: 2020 2020 203a 7061 7261 6d20 6170 695f       :param api_
+00010e20: 6b65 793a 2054 6865 2061 7069 206b 6579  key: The api key
+00010e30: 2074 6f20 7573 6520 666f 7220 7468 6973   to use for this
+00010e40: 2072 6571 7565 7374 2e0a 2020 2020 2020   request..      
+00010e50: 2020 2020 2020 4465 6661 756c 7473 2074        Defaults t
+00010e60: 6f20 646a 7374 7269 7065 5f73 6574 7469  o djstripe_setti
+00010e70: 6e67 732e 5354 5249 5045 5f53 4543 5245  ngs.STRIPE_SECRE
+00010e80: 545f 4b45 592e 0a20 2020 2020 2020 203a  T_KEY..        :
+00010e90: 7479 7065 2061 7069 5f6b 6579 3a20 7374  type api_key: st
+00010ea0: 7269 6e67 0a20 2020 2020 2020 2022 2222  ring.        """
+00010eb0: 0a20 2020 2020 2020 2061 7069 5f6b 6579  .        api_key
+00010ec0: 203d 2061 7069 5f6b 6579 206f 7220 7365   = api_key or se
+00010ed0: 6c66 2e64 6566 6175 6c74 5f61 7069 5f6b  lf.default_api_k
+00010ee0: 6579 0a0a 2020 2020 2020 2020 7265 7475  ey..        retu
+00010ef0: 726e 2073 656c 662e 6170 695f 7265 7472  rn self.api_retr
+00010f00: 6965 7665 2861 7069 5f6b 6579 3d61 7069  ieve(api_key=api
+00010f10: 5f6b 6579 292e 6361 6e63 656c 282a 2a6b  _key).cancel(**k
+00010f20: 7761 7267 7329 0a0a 2020 2020 6465 6620  wargs)..    def 
+00010f30: 5f61 7069 5f63 6f6e 6669 726d 2873 656c  _api_confirm(sel
+00010f40: 662c 2061 7069 5f6b 6579 3d4e 6f6e 652c  f, api_key=None,
+00010f50: 202a 2a6b 7761 7267 7329 3a0a 2020 2020   **kwargs):.    
+00010f60: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00010f70: 4361 6c6c 2074 6865 2073 7472 6970 6520  Call the stripe 
+00010f80: 4150 4927 7320 636f 6e66 6972 6d20 6f70  API's confirm op
+00010f90: 6572 6174 696f 6e20 666f 7220 7468 6973  eration for this
+00010fa0: 206d 6f64 656c 2e0a 0a20 2020 2020 2020   model...       
+00010fb0: 2043 6f6e 6669 726d 2074 6861 7420 796f   Confirm that yo
+00010fc0: 7572 2063 7573 746f 6d65 7220 696e 7465  ur customer inte
+00010fd0: 6e64 7320 746f 2070 6179 2077 6974 6820  nds to pay with 
+00010fe0: 6375 7272 656e 7420 6f72 0a20 2020 2020  current or.     
+00010ff0: 2020 2070 726f 7669 6465 6420 7061 796d     provided paym
+00011000: 656e 7420 6d65 7468 6f64 2e20 5570 6f6e  ent method. Upon
+00011010: 2063 6f6e 6669 726d 6174 696f 6e2c 2074   confirmation, t
+00011020: 6865 2050 6179 6d65 6e74 496e 7465 6e74  he PaymentIntent
+00011030: 0a20 2020 2020 2020 2077 696c 6c20 6174  .        will at
+00011040: 7465 6d70 7420 746f 2069 6e69 7469 6174  tempt to initiat
+00011050: 6520 6120 7061 796d 656e 742e 0a0a 2020  e a payment...  
+00011060: 2020 2020 2020 3a70 6172 616d 2061 7069        :param api
+00011070: 5f6b 6579 3a20 5468 6520 6170 6920 6b65  _key: The api ke
+00011080: 7920 746f 2075 7365 2066 6f72 2074 6869  y to use for thi
+00011090: 7320 7265 7175 6573 742e 0a20 2020 2020  s request..     
+000110a0: 2020 2020 2020 2044 6566 6175 6c74 7320         Defaults 
+000110b0: 746f 2064 6a73 7472 6970 655f 7365 7474  to djstripe_sett
+000110c0: 696e 6773 2e53 5452 4950 455f 5345 4352  ings.STRIPE_SECR
+000110d0: 4554 5f4b 4559 2e0a 2020 2020 2020 2020  ET_KEY..        
+000110e0: 3a74 7970 6520 6170 695f 6b65 793a 2073  :type api_key: s
+000110f0: 7472 696e 670a 2020 2020 2020 2020 2222  tring.        ""
+00011100: 220a 2020 2020 2020 2020 6170 695f 6b65  ".        api_ke
+00011110: 7920 3d20 6170 695f 6b65 7920 6f72 2073  y = api_key or s
+00011120: 656c 662e 6465 6661 756c 745f 6170 695f  elf.default_api_
+00011130: 6b65 790a 0a20 2020 2020 2020 2072 6574  key..        ret
+00011140: 7572 6e20 7365 6c66 2e61 7069 5f72 6574  urn self.api_ret
+00011150: 7269 6576 6528 6170 695f 6b65 793d 6170  rieve(api_key=ap
+00011160: 695f 6b65 7929 2e63 6f6e 6669 726d 282a  i_key).confirm(*
+00011170: 2a6b 7761 7267 7329 0a0a 0a63 6c61 7373  *kwargs)...class
+00011180: 2053 6574 7570 496e 7465 6e74 2853 7472   SetupIntent(Str
+00011190: 6970 654d 6f64 656c 293a 0a20 2020 2022  ipeModel):.    "
+000111a0: 2222 0a20 2020 2041 2053 6574 7570 496e  "".    A SetupIn
+000111b0: 7465 6e74 2067 7569 6465 7320 796f 7520  tent guides you 
+000111c0: 7468 726f 7567 6820 7468 6520 7072 6f63  through the proc
+000111d0: 6573 7320 6f66 2073 6574 7469 6e67 2075  ess of setting u
+000111e0: 7020 6120 6375 7374 6f6d 6572 2773 0a20  p a customer's. 
+000111f0: 2020 2070 6179 6d65 6e74 2063 7265 6465     payment crede
+00011200: 6e74 6961 6c73 2066 6f72 2066 7574 7572  ntials for futur
+00011210: 6520 7061 796d 656e 7473 2e20 466f 7220  e payments. For 
+00011220: 6578 616d 706c 652c 2079 6f75 2063 6f75  example, you cou
+00011230: 6c64 2075 7365 2061 2053 6574 7570 496e  ld use a SetupIn
+00011240: 7465 6e74 0a20 2020 2074 6f20 7365 7420  tent.    to set 
+00011250: 7570 2079 6f75 7220 6375 7374 6f6d 6572  up your customer
+00011260: 2773 2063 6172 6420 7769 7468 6f75 7420  's card without 
+00011270: 696d 6d65 6469 6174 656c 7920 636f 6c6c  immediately coll
+00011280: 6563 7469 6e67 2061 2070 6179 6d65 6e74  ecting a payment
+00011290: 2e0a 2020 2020 4c61 7465 722c 2079 6f75  ..    Later, you
+000112a0: 2063 616e 2075 7365 2050 6179 6d65 6e74   can use Payment
+000112b0: 496e 7465 6e74 7320 746f 2064 7269 7665  Intents to drive
+000112c0: 2074 6865 2070 6179 6d65 6e74 2066 6c6f   the payment flo
+000112d0: 772e 0a0a 2020 2020 4e4f 5445 3a20 596f  w...    NOTE: Yo
+000112e0: 7520 7368 6f75 6c64 206e 6f74 206d 6169  u should not mai
+000112f0: 6e74 6169 6e20 6c6f 6e67 2d6c 6976 6564  ntain long-lived
+00011300: 2c20 756e 636f 6e66 6972 6d65 6420 5365  , unconfirmed Se
+00011310: 7475 7049 6e74 656e 7473 2e0a 2020 2020  tupIntents..    
+00011320: 466f 7220 7365 6375 7269 7479 2070 7572  For security pur
+00011330: 706f 7365 732c 2053 6574 7570 496e 7465  poses, SetupInte
+00011340: 6e74 7320 6f6c 6465 7220 7468 616e 2032  nts older than 2
+00011350: 3420 686f 7572 7320 6d61 7920 6e6f 206c  4 hours may no l
+00011360: 6f6e 6765 7220 6265 2076 616c 6964 2e0a  onger be valid..
+00011370: 0a20 2020 2053 7472 6970 6520 646f 6375  .    Stripe docu
+00011380: 6d65 6e74 6174 696f 6e3a 2068 7474 7073  mentation: https
+00011390: 3a2f 2f73 7472 6970 652e 636f 6d2f 646f  ://stripe.com/do
+000113a0: 6373 2f61 7069 3f6c 616e 673d 7079 7468  cs/api?lang=pyth
+000113b0: 6f6e 2373 6574 7570 5f69 6e74 656e 7473  on#setup_intents
+000113c0: 0a20 2020 2022 2222 0a0a 2020 2020 7374  .    """..    st
+000113d0: 7269 7065 5f63 6c61 7373 203d 2073 7472  ripe_class = str
+000113e0: 6970 652e 5365 7475 7049 6e74 656e 740a  ipe.SetupIntent.
+000113f0: 0a20 2020 2061 7070 6c69 6361 7469 6f6e  .    application
+00011400: 203d 206d 6f64 656c 732e 4368 6172 4669   = models.CharFi
+00011410: 656c 6428 0a20 2020 2020 2020 206d 6178  eld(.        max
+00011420: 5f6c 656e 6774 683d 3235 352c 0a20 2020  _length=255,.   
+00011430: 2020 2020 2062 6c61 6e6b 3d54 7275 652c       blank=True,
+00011440: 0a20 2020 2020 2020 2068 656c 705f 7465  .        help_te
+00011450: 7874 3d22 4944 206f 6620 7468 6520 436f  xt="ID of the Co
+00011460: 6e6e 6563 7420 6170 706c 6963 6174 696f  nnect applicatio
+00011470: 6e20 7468 6174 2063 7265 6174 6564 2074  n that created t
+00011480: 6865 2053 6574 7570 496e 7465 6e74 2e22  he SetupIntent."
+00011490: 2c0a 2020 2020 290a 2020 2020 6361 6e63  ,.    ).    canc
+000114a0: 656c 6c61 7469 6f6e 5f72 6561 736f 6e20  ellation_reason 
+000114b0: 3d20 5374 7269 7065 456e 756d 4669 656c  = StripeEnumFiel
+000114c0: 6428 0a20 2020 2020 2020 2065 6e75 6d3d  d(.        enum=
+000114d0: 656e 756d 732e 5365 7475 7049 6e74 656e  enums.SetupInten
+000114e0: 7443 616e 6365 6c6c 6174 696f 6e52 6561  tCancellationRea
+000114f0: 736f 6e2c 0a20 2020 2020 2020 2062 6c61  son,.        bla
+00011500: 6e6b 3d54 7275 652c 0a20 2020 2020 2020  nk=True,.       
+00011510: 2068 656c 705f 7465 7874 3d28 0a20 2020   help_text=(.   
+00011520: 2020 2020 2020 2020 2022 5265 6173 6f6e           "Reason
+00011530: 2066 6f72 2063 616e 6365 6c6c 6174 696f   for cancellatio
+00011540: 6e20 6f66 2074 6869 7320 5365 7475 7049  n of this SetupI
+00011550: 6e74 656e 742c 206f 6e65 206f 6620 6162  ntent, one of ab
+00011560: 616e 646f 6e65 642c 2022 0a20 2020 2020  andoned, ".     
+00011570: 2020 2020 2020 2022 7265 7175 6573 7465         "requeste
+00011580: 645f 6279 5f63 7573 746f 6d65 722c 206f  d_by_customer, o
+00011590: 7220 6475 706c 6963 6174 6522 0a20 2020  r duplicate".   
+000115a0: 2020 2020 2029 2c0a 2020 2020 290a 2020       ),.    ).  
+000115b0: 2020 636c 6965 6e74 5f73 6563 7265 7420    client_secret 
+000115c0: 3d20 6d6f 6465 6c73 2e54 6578 7446 6965  = models.TextFie
+000115d0: 6c64 280a 2020 2020 2020 2020 6d61 785f  ld(.        max_
+000115e0: 6c65 6e67 7468 3d35 3030 302c 0a20 2020  length=5000,.   
+000115f0: 2020 2020 2062 6c61 6e6b 3d54 7275 652c       blank=True,
+00011600: 0a20 2020 2020 2020 2068 656c 705f 7465  .        help_te
+00011610: 7874 3d28 0a20 2020 2020 2020 2020 2020  xt=(.           
+00011620: 2022 5468 6520 636c 6965 6e74 2073 6563   "The client sec
+00011630: 7265 7420 6f66 2074 6869 7320 5365 7475  ret of this Setu
+00011640: 7049 6e74 656e 742e 2022 0a20 2020 2020  pIntent. ".     
+00011650: 2020 2020 2020 2022 5573 6564 2066 6f72         "Used for
+00011660: 2063 6c69 656e 742d 7369 6465 2072 6574   client-side ret
+00011670: 7269 6576 616c 2075 7369 6e67 2061 2070  rieval using a p
+00011680: 7562 6c69 7368 6162 6c65 206b 6579 2e22  ublishable key."
+00011690: 0a20 2020 2020 2020 2029 2c0a 2020 2020  .        ),.    
+000116a0: 290a 2020 2020 6375 7374 6f6d 6572 203d  ).    customer =
+000116b0: 2053 7472 6970 6546 6f72 6569 676e 4b65   StripeForeignKe
+000116c0: 7928 0a20 2020 2020 2020 2022 4375 7374  y(.        "Cust
+000116d0: 6f6d 6572 222c 0a20 2020 2020 2020 206e  omer",.        n
+000116e0: 756c 6c3d 5472 7565 2c0a 2020 2020 2020  ull=True,.      
+000116f0: 2020 626c 616e 6b3d 5472 7565 2c0a 2020    blank=True,.  
+00011700: 2020 2020 2020 6f6e 5f64 656c 6574 653d        on_delete=
+00011710: 6d6f 6465 6c73 2e53 4554 5f4e 554c 4c2c  models.SET_NULL,
+00011720: 0a20 2020 2020 2020 2068 656c 705f 7465  .        help_te
+00011730: 7874 3d22 4375 7374 6f6d 6572 2074 6869  xt="Customer thi
+00011740: 7320 5365 7475 7049 6e74 656e 7420 6265  s SetupIntent be
+00011750: 6c6f 6e67 7320 746f 2c20 6966 206f 6e65  longs to, if one
+00011760: 2065 7869 7374 732e 222c 0a20 2020 2029   exists.",.    )
+00011770: 0a20 2020 206c 6173 745f 7365 7475 705f  .    last_setup_
+00011780: 6572 726f 7220 3d20 4a53 4f4e 4669 656c  error = JSONFiel
+00011790: 6428 0a20 2020 2020 2020 206e 756c 6c3d  d(.        null=
+000117a0: 5472 7565 2c0a 2020 2020 2020 2020 626c  True,.        bl
+000117b0: 616e 6b3d 5472 7565 2c0a 2020 2020 2020  ank=True,.      
+000117c0: 2020 6865 6c70 5f74 6578 743d 2254 6865    help_text="The
+000117d0: 2065 7272 6f72 2065 6e63 6f75 6e74 6572   error encounter
+000117e0: 6564 2069 6e20 7468 6520 7072 6576 696f  ed in the previo
+000117f0: 7573 2053 6574 7570 496e 7465 6e74 2063  us SetupIntent c
+00011800: 6f6e 6669 726d 6174 696f 6e2e 222c 0a20  onfirmation.",. 
+00011810: 2020 2029 0a20 2020 206e 6578 745f 6163     ).    next_ac
+00011820: 7469 6f6e 203d 204a 534f 4e46 6965 6c64  tion = JSONField
+00011830: 280a 2020 2020 2020 2020 6e75 6c6c 3d54  (.        null=T
+00011840: 7275 652c 0a20 2020 2020 2020 2062 6c61  rue,.        bla
+00011850: 6e6b 3d54 7275 652c 0a20 2020 2020 2020  nk=True,.       
+00011860: 2068 656c 705f 7465 7874 3d28 0a20 2020   help_text=(.   
+00011870: 2020 2020 2020 2020 2022 4966 2070 7265           "If pre
+00011880: 7365 6e74 2c20 7468 6973 2070 726f 7065  sent, this prope
+00011890: 7274 7920 7465 6c6c 7320 796f 7520 7768  rty tells you wh
+000118a0: 6174 2061 6374 696f 6e73 2079 6f75 206e  at actions you n
+000118b0: 6565 6420 746f 2074 616b 6520 696e 220a  eed to take in".
+000118c0: 2020 2020 2020 2020 2020 2020 226f 7264              "ord
+000118d0: 6572 2066 6f72 2079 6f75 7220 6375 7374  er for your cust
+000118e0: 6f6d 6572 2074 6f20 636f 6e74 696e 7565  omer to continue
+000118f0: 2070 6179 6d65 6e74 2073 6574 7570 2e22   payment setup."
+00011900: 0a20 2020 2020 2020 2029 2c0a 2020 2020  .        ),.    
+00011910: 290a 2020 2020 6f6e 5f62 6568 616c 665f  ).    on_behalf_
+00011920: 6f66 203d 2053 7472 6970 6546 6f72 6569  of = StripeForei
+00011930: 676e 4b65 7928 0a20 2020 2020 2020 2022  gnKey(.        "
+00011940: 4163 636f 756e 7422 2c0a 2020 2020 2020  Account",.      
+00011950: 2020 6f6e 5f64 656c 6574 653d 6d6f 6465    on_delete=mode
+00011960: 6c73 2e53 4554 5f4e 554c 4c2c 0a20 2020  ls.SET_NULL,.   
+00011970: 2020 2020 206e 756c 6c3d 5472 7565 2c0a       null=True,.
+00011980: 2020 2020 2020 2020 626c 616e 6b3d 5472          blank=Tr
+00011990: 7565 2c0a 2020 2020 2020 2020 6865 6c70  ue,.        help
+000119a0: 5f74 6578 743d 2254 6865 2061 6363 6f75  _text="The accou
+000119b0: 6e74 2028 6966 2061 6e79 2920 666f 7220  nt (if any) for 
+000119c0: 7768 6963 6820 7468 6520 7365 7475 7020  which the setup 
+000119d0: 6973 2069 6e74 656e 6465 642e 222c 0a20  is intended.",. 
+000119e0: 2020 2020 2020 2072 656c 6174 6564 5f6e         related_n
+000119f0: 616d 653d 2273 6574 7570 5f69 6e74 656e  ame="setup_inten
+00011a00: 7473 222c 0a20 2020 2029 0a20 2020 2070  ts",.    ).    p
+00011a10: 6179 6d65 6e74 5f6d 6574 686f 6420 3d20  ayment_method = 
+00011a20: 5374 7269 7065 466f 7265 6967 6e4b 6579  StripeForeignKey
+00011a30: 280a 2020 2020 2020 2020 2250 6179 6d65  (.        "Payme
+00011a40: 6e74 4d65 7468 6f64 222c 0a20 2020 2020  ntMethod",.     
+00011a50: 2020 206f 6e5f 6465 6c65 7465 3d6d 6f64     on_delete=mod
+00011a60: 656c 732e 5345 545f 4e55 4c4c 2c0a 2020  els.SET_NULL,.  
+00011a70: 2020 2020 2020 6e75 6c6c 3d54 7275 652c        null=True,
+00011a80: 0a20 2020 2020 2020 2062 6c61 6e6b 3d54  .        blank=T
+00011a90: 7275 652c 0a20 2020 2020 2020 2068 656c  rue,.        hel
+00011aa0: 705f 7465 7874 3d22 5061 796d 656e 7420  p_text="Payment 
+00011ab0: 6d65 7468 6f64 2075 7365 6420 696e 2074  method used in t
+00011ac0: 6869 7320 5061 796d 656e 7449 6e74 656e  his PaymentInten
+00011ad0: 742e 222c 0a20 2020 2029 0a20 2020 2070  t.",.    ).    p
+00011ae0: 6179 6d65 6e74 5f6d 6574 686f 645f 7479  ayment_method_ty
+00011af0: 7065 7320 3d20 4a53 4f4e 4669 656c 6428  pes = JSONField(
+00011b00: 0a20 2020 2020 2020 2068 656c 705f 7465  .        help_te
+00011b10: 7874 3d28 0a20 2020 2020 2020 2020 2020  xt=(.           
+00011b20: 2022 5468 6520 6c69 7374 206f 6620 7061   "The list of pa
+00011b30: 796d 656e 7420 6d65 7468 6f64 2074 7970  yment method typ
+00011b40: 6573 2028 652e 672e 2063 6172 6429 2074  es (e.g. card) t
+00011b50: 6861 7420 7468 6973 2050 6179 6d65 6e74  hat this Payment
+00011b60: 496e 7465 6e74 2069 7320 220a 2020 2020  Intent is ".    
+00011b70: 2020 2020 2020 2020 2261 6c6c 6f77 6564          "allowed
+00011b80: 2074 6f20 7573 652e 220a 2020 2020 2020   to use.".      
+00011b90: 2020 290a 2020 2020 290a 2020 2020 7374    ).    ).    st
+00011ba0: 6174 7573 203d 2053 7472 6970 6545 6e75  atus = StripeEnu
+00011bb0: 6d46 6965 6c64 280a 2020 2020 2020 2020  mField(.        
+00011bc0: 656e 756d 3d65 6e75 6d73 2e53 6574 7570  enum=enums.Setup
+00011bd0: 496e 7465 6e74 5374 6174 7573 2c0a 2020  IntentStatus,.  
+00011be0: 2020 2020 2020 6865 6c70 5f74 6578 743d        help_text=
+00011bf0: 280a 2020 2020 2020 2020 2020 2020 2253  (.            "S
+00011c00: 7461 7475 7320 6f66 2074 6869 7320 5365  tatus of this Se
+00011c10: 7475 7049 6e74 656e 742c 206f 6e65 206f  tupIntent, one o
+00011c20: 6620 7265 7175 6972 6573 5f70 6179 6d65  f requires_payme
+00011c30: 6e74 5f6d 6574 686f 642c 2022 0a20 2020  nt_method, ".   
+00011c40: 2020 2020 2020 2020 2022 7265 7175 6972           "requir
+00011c50: 6573 5f63 6f6e 6669 726d 6174 696f 6e2c  es_confirmation,
+00011c60: 2072 6571 7569 7265 735f 6163 7469 6f6e   requires_action
+00011c70: 2c20 7072 6f63 6573 7369 6e67 2c20 220a  , processing, ".
+00011c80: 2020 2020 2020 2020 2020 2020 2263 616e              "can
+00011c90: 6365 6c65 642c 206f 7220 7375 6363 6565  celed, or succee
+00011ca0: 6465 642e 220a 2020 2020 2020 2020 292c  ded.".        ),
+00011cb0: 0a20 2020 2029 0a20 2020 2075 7361 6765  .    ).    usage
+00011cc0: 203d 2053 7472 6970 6545 6e75 6d46 6965   = StripeEnumFie
+00011cd0: 6c64 280a 2020 2020 2020 2020 656e 756d  ld(.        enum
+00011ce0: 3d65 6e75 6d73 2e49 6e74 656e 7455 7361  =enums.IntentUsa
+00011cf0: 6765 2c0a 2020 2020 2020 2020 6465 6661  ge,.        defa
+00011d00: 756c 743d 656e 756d 732e 496e 7465 6e74  ult=enums.Intent
+00011d10: 5573 6167 652e 6f66 665f 7365 7373 696f  Usage.off_sessio
+00011d20: 6e2c 0a20 2020 2020 2020 2068 656c 705f  n,.        help_
+00011d30: 7465 7874 3d28 0a20 2020 2020 2020 2020  text=(.         
+00011d40: 2020 2022 496e 6469 6361 7465 7320 686f     "Indicates ho
+00011d50: 7720 7468 6520 7061 796d 656e 7420 6d65  w the payment me
+00011d60: 7468 6f64 2069 7320 696e 7465 6e64 6564  thod is intended
+00011d70: 2074 6f20 6265 2075 7365 6420 696e 2074   to be used in t
+00011d80: 6865 2066 7574 7572 652e 220a 2020 2020  he future.".    
+00011d90: 2020 2020 292c 0a20 2020 2029 0a0a 2020      ),.    )..  
+00011da0: 2020 6465 6620 5f5f 7374 725f 5f28 7365    def __str__(se
+00011db0: 6c66 293a 0a20 2020 2020 2020 2061 6363  lf):.        acc
+00011dc0: 6f75 6e74 203d 2073 656c 662e 6f6e 5f62  ount = self.on_b
+00011dd0: 6568 616c 665f 6f66 0a20 2020 2020 2020  ehalf_of.       
+00011de0: 2063 7573 746f 6d65 7220 3d20 7365 6c66   customer = self
+00011df0: 2e63 7573 746f 6d65 720a 0a20 2020 2020  .customer..     
+00011e00: 2020 2069 6620 6163 636f 756e 7420 616e     if account an
+00011e10: 6420 6375 7374 6f6d 6572 3a0a 2020 2020  d customer:.    
+00011e20: 2020 2020 2020 2020 7265 7475 726e 2028          return (
+00011e30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011e40: 2066 227b 7365 6c66 2e70 6179 6d65 6e74   f"{self.payment
+00011e50: 5f6d 6574 686f 647d 2028 7b65 6e75 6d73  _method} ({enums
+00011e60: 2e53 6574 7570 496e 7465 6e74 5374 6174  .SetupIntentStat
+00011e70: 7573 2e68 756d 616e 697a 6528 7365 6c66  us.humanize(self
+00011e80: 2e73 7461 7475 7329 7d29 220a 2020 2020  .status)})".    
+00011e90: 2020 2020 2020 2020 2020 2020 6622 2066              f" f
+00011ea0: 6f72 207b 6163 636f 756e 747d 2062 7920  or {account} by 
+00011eb0: 7b63 7573 746f 6d65 727d 220a 2020 2020  {customer}".    
+00011ec0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+00011ed0: 2020 2069 6620 6163 636f 756e 743a 0a20     if account:. 
+00011ee0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00011ef0: 6e20 280a 2020 2020 2020 2020 2020 2020  n (.            
+00011f00: 2020 2020 6622 7b73 656c 662e 7061 796d      f"{self.paym
+00011f10: 656e 745f 6d65 7468 6f64 7d20 666f 7220  ent_method} for 
+00011f20: 7b61 6363 6f75 6e74 7d2e 220a 2020 2020  {account}.".    
+00011f30: 2020 2020 2020 2020 2020 2020 6622 207b              f" {
+00011f40: 656e 756d 732e 5365 7475 7049 6e74 656e  enums.SetupInten
+00011f50: 7453 7461 7475 732e 6875 6d61 6e69 7a65  tStatus.humanize
+00011f60: 2873 656c 662e 7374 6174 7573 297d 220a  (self.status)}".
+00011f70: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00011f80: 2020 2020 2020 6966 2063 7573 746f 6d65        if custome
+00011f90: 723a 0a20 2020 2020 2020 2020 2020 2072  r:.            r
+00011fa0: 6574 7572 6e20 280a 2020 2020 2020 2020  eturn (.        
+00011fb0: 2020 2020 2020 2020 6622 7b73 656c 662e          f"{self.
+00011fc0: 7061 796d 656e 745f 6d65 7468 6f64 7d20  payment_method} 
+00011fd0: 6279 207b 6375 7374 6f6d 6572 7d2e 220a  by {customer}.".
+00011fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011ff0: 6622 207b 656e 756d 732e 5365 7475 7049  f" {enums.SetupI
+00012000: 6e74 656e 7453 7461 7475 732e 6875 6d61  ntentStatus.huma
+00012010: 6e69 7a65 2873 656c 662e 7374 6174 7573  nize(self.status
+00012020: 297d 220a 2020 2020 2020 2020 2020 2020  )}".            
+00012030: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00012040: 2028 0a20 2020 2020 2020 2020 2020 2066   (.            f
+00012050: 227b 7365 6c66 2e70 6179 6d65 6e74 5f6d  "{self.payment_m
+00012060: 6574 686f 647d 2028 7b65 6e75 6d73 2e53  ethod} ({enums.S
+00012070: 6574 7570 496e 7465 6e74 5374 6174 7573  etupIntentStatus
+00012080: 2e68 756d 616e 697a 6528 7365 6c66 2e73  .humanize(self.s
+00012090: 7461 7475 7329 7d29 220a 2020 2020 2020  tatus)})".      
+000120a0: 2020 290a 0a0a 636c 6173 7320 5061 796f    )...class Payo
+000120b0: 7574 2853 7472 6970 654d 6f64 656c 293a  ut(StripeModel):
+000120c0: 0a20 2020 2022 2222 0a20 2020 2041 2050  .    """.    A P
+000120d0: 6179 6f75 7420 6f62 6a65 6374 2069 7320  ayout object is 
+000120e0: 6372 6561 7465 6420 7768 656e 2079 6f75  created when you
+000120f0: 2072 6563 6569 7665 2066 756e 6473 2066   receive funds f
+00012100: 726f 6d20 5374 7269 7065 2c20 6f72 2077  rom Stripe, or w
+00012110: 6865 6e20 796f 7520 696e 6974 6961 7465  hen you initiate
+00012120: 0a20 2020 2061 2070 6179 6f75 7420 746f  .    a payout to
+00012130: 2065 6974 6865 7220 6120 6261 6e6b 2061   either a bank a
+00012140: 6363 6f75 6e74 206f 7220 6465 6269 7420  ccount or debit 
+00012150: 6361 7264 206f 6620 6120 636f 6e6e 6563  card of a connec
+00012160: 7465 6420 5374 7269 7065 2061 6363 6f75  ted Stripe accou
+00012170: 6e74 2e0a 0a20 2020 2053 7472 6970 6520  nt...    Stripe 
+00012180: 646f 6375 6d65 6e74 6174 696f 6e3a 2068  documentation: h
+00012190: 7474 7073 3a2f 2f73 7472 6970 652e 636f  ttps://stripe.co
+000121a0: 6d2f 646f 6373 2f61 7069 3f6c 616e 673d  m/docs/api?lang=
+000121b0: 7079 7468 6f6e 2370 6179 6f75 7473 0a20  python#payouts. 
+000121c0: 2020 2022 2222 0a0a 2020 2020 6578 7061     """..    expa
+000121d0: 6e64 5f66 6965 6c64 7320 3d20 5b22 6465  nd_fields = ["de
+000121e0: 7374 696e 6174 696f 6e22 5d0a 2020 2020  stination"].    
+000121f0: 7374 7269 7065 5f63 6c61 7373 203d 2073  stripe_class = s
+00012200: 7472 6970 652e 5061 796f 7574 0a20 2020  tripe.Payout.   
+00012210: 2073 7472 6970 655f 6461 7368 626f 6172   stripe_dashboar
+00012220: 645f 6974 656d 5f6e 616d 6520 3d20 2270  d_item_name = "p
+00012230: 6179 6f75 7473 220a 0a20 2020 2061 6d6f  ayouts"..    amo
+00012240: 756e 7420 3d20 5374 7269 7065 4465 6369  unt = StripeDeci
+00012250: 6d61 6c43 7572 7265 6e63 7941 6d6f 756e  malCurrencyAmoun
+00012260: 7446 6965 6c64 280a 2020 2020 2020 2020  tField(.        
+00012270: 6865 6c70 5f74 6578 743d 280a 2020 2020  help_text=(.    
+00012280: 2020 2020 2020 2020 2241 6d6f 756e 7420          "Amount 
+00012290: 2861 7320 6465 6369 6d61 6c29 2074 6f20  (as decimal) to 
+000122a0: 6265 2074 7261 6e73 6665 7272 6564 2074  be transferred t
+000122b0: 6f20 796f 7572 2062 616e 6b20 6163 636f  o your bank acco
+000122c0: 756e 7420 6f72 2064 6562 6974 2063 6172  unt or debit car
+000122d0: 642e 220a 2020 2020 2020 2020 290a 2020  d.".        ).  
+000122e0: 2020 290a 2020 2020 6172 7269 7661 6c5f    ).    arrival_
+000122f0: 6461 7465 203d 2053 7472 6970 6544 6174  date = StripeDat
+00012300: 6554 696d 6546 6965 6c64 280a 2020 2020  eTimeField(.    
+00012310: 2020 2020 6865 6c70 5f74 6578 743d 280a      help_text=(.
+00012320: 2020 2020 2020 2020 2020 2020 2244 6174              "Dat
+00012330: 6520 7468 6520 7061 796f 7574 2069 7320  e the payout is 
+00012340: 6578 7065 6374 6564 2074 6f20 6172 7269  expected to arri
+00012350: 7665 2069 6e20 7468 6520 6261 6e6b 2e20  ve in the bank. 
+00012360: 220a 2020 2020 2020 2020 2020 2020 2254  ".            "T
+00012370: 6869 7320 6661 6374 6f72 7320 696e 2064  his factors in d
+00012380: 656c 6179 7320 6c69 6b65 2077 6565 6b65  elays like weeke
+00012390: 6e64 7320 6f72 2062 616e 6b20 686f 6c69  nds or bank holi
+000123a0: 6461 7973 2e22 0a20 2020 2020 2020 2029  days.".        )
+000123b0: 0a20 2020 2029 0a20 2020 2061 7574 6f6d  .    ).    autom
+000123c0: 6174 6963 203d 206d 6f64 656c 732e 426f  atic = models.Bo
+000123d0: 6f6c 6561 6e46 6965 6c64 280a 2020 2020  oleanField(.    
+000123e0: 2020 2020 6865 6c70 5f74 6578 743d 280a      help_text=(.
+000123f0: 2020 2020 2020 2020 2020 2020 2260 7472              "`tr
+00012400: 7565 6020 6966 2074 6865 2070 6179 6f75  ue` if the payou
+00012410: 7420 7761 7320 6372 6561 7465 6420 6279  t was created by
+00012420: 2061 6e20 6175 746f 6d61 7465 6420 7061   an automated pa
+00012430: 796f 7574 2073 6368 6564 756c 652c 2022  yout schedule, "
+00012440: 0a20 2020 2020 2020 2020 2020 2022 616e  .            "an
+00012450: 6420 6066 616c 7365 6020 6966 2069 7420  d `false` if it 
+00012460: 7761 7320 7265 7175 6573 7465 6420 6d61  was requested ma
+00012470: 6e75 616c 6c79 2e22 0a20 2020 2020 2020  nually.".       
+00012480: 2029 0a20 2020 2029 0a20 2020 2062 616c   ).    ).    bal
+00012490: 616e 6365 5f74 7261 6e73 6163 7469 6f6e  ance_transaction
+000124a0: 203d 2053 7472 6970 6546 6f72 6569 676e   = StripeForeign
+000124b0: 4b65 7928 0a20 2020 2020 2020 2022 4261  Key(.        "Ba
+000124c0: 6c61 6e63 6554 7261 6e73 6163 7469 6f6e  lanceTransaction
+000124d0: 222c 0a20 2020 2020 2020 206f 6e5f 6465  ",.        on_de
+000124e0: 6c65 7465 3d6d 6f64 656c 732e 5345 545f  lete=models.SET_
+000124f0: 4e55 4c4c 2c0a 2020 2020 2020 2020 6e75  NULL,.        nu
+00012500: 6c6c 3d54 7275 652c 0a20 2020 2020 2020  ll=True,.       
+00012510: 2068 656c 705f 7465 7874 3d28 0a20 2020   help_text=(.   
+00012520: 2020 2020 2020 2020 2022 4261 6c61 6e63           "Balanc
+00012530: 6520 7472 616e 7361 6374 696f 6e20 7468  e transaction th
+00012540: 6174 2064 6573 6372 6962 6573 2074 6865  at describes the
+00012550: 2069 6d70 6163 7420 6f6e 2079 6f75 7220   impact on your 
+00012560: 6163 636f 756e 7420 6261 6c61 6e63 652e  account balance.
+00012570: 220a 2020 2020 2020 2020 292c 0a20 2020  ".        ),.   
+00012580: 2029 0a20 2020 2063 7572 7265 6e63 7920   ).    currency 
+00012590: 3d20 5374 7269 7065 4375 7272 656e 6379  = StripeCurrency
+000125a0: 436f 6465 4669 656c 6428 290a 2020 2020  CodeField().    
+000125b0: 6465 7374 696e 6174 696f 6e20 3d20 5061  destination = Pa
+000125c0: 796d 656e 744d 6574 686f 6446 6f72 6569  ymentMethodForei
+000125d0: 676e 4b65 7928 0a20 2020 2020 2020 206f  gnKey(.        o
+000125e0: 6e5f 6465 6c65 7465 3d6d 6f64 656c 732e  n_delete=models.
+000125f0: 5052 4f54 4543 542c 0a20 2020 2020 2020  PROTECT,.       
+00012600: 206e 756c 6c3d 5472 7565 2c0a 2020 2020   null=True,.    
+00012610: 2020 2020 6865 6c70 5f74 6578 743d 2242      help_text="B
+00012620: 616e 6b20 6163 636f 756e 7420 6f72 2063  ank account or c
+00012630: 6172 6420 7468 6520 7061 796f 7574 2077  ard the payout w
+00012640: 6173 2073 656e 7420 746f 2e22 2c0a 2020  as sent to.",.  
+00012650: 2020 290a 2020 2020 6661 696c 7572 655f    ).    failure_
+00012660: 6261 6c61 6e63 655f 7472 616e 7361 6374  balance_transact
+00012670: 696f 6e20 3d20 5374 7269 7065 466f 7265  ion = StripeFore
+00012680: 6967 6e4b 6579 280a 2020 2020 2020 2020  ignKey(.        
+00012690: 2242 616c 616e 6365 5472 616e 7361 6374  "BalanceTransact
+000126a0: 696f 6e22 2c0a 2020 2020 2020 2020 6f6e  ion",.        on
+000126b0: 5f64 656c 6574 653d 6d6f 6465 6c73 2e53  _delete=models.S
+000126c0: 4554 5f4e 554c 4c2c 0a20 2020 2020 2020  ET_NULL,.       
+000126d0: 2072 656c 6174 6564 5f6e 616d 653d 2266   related_name="f
+000126e0: 6169 6c75 7265 5f70 6179 6f75 7473 222c  ailure_payouts",
+000126f0: 0a20 2020 2020 2020 206e 756c 6c3d 5472  .        null=Tr
+00012700: 7565 2c0a 2020 2020 2020 2020 626c 616e  ue,.        blan
+00012710: 6b3d 5472 7565 2c0a 2020 2020 2020 2020  k=True,.        
+00012720: 6865 6c70 5f74 6578 743d 280a 2020 2020  help_text=(.    
+00012730: 2020 2020 2020 2020 2249 6620 7468 6520          "If the 
+00012740: 7061 796f 7574 2066 6169 6c65 6420 6f72  payout failed or
+00012750: 2077 6173 2063 616e 6365 6c65 642c 2074   was canceled, t
+00012760: 6869 7320 7769 6c6c 2062 6520 7468 6520  his will be the 
+00012770: 6261 6c61 6e63 6520 220a 2020 2020 2020  balance ".      
+00012780: 2020 2020 2020 2274 7261 6e73 6163 7469        "transacti
+00012790: 6f6e 2074 6861 7420 7265 7665 7273 6564  on that reversed
+000127a0: 2074 6865 2069 6e69 7469 616c 2062 616c   the initial bal
+000127b0: 616e 6365 2074 7261 6e73 6163 7469 6f6e  ance transaction
+000127c0: 2c20 616e 6420 220a 2020 2020 2020 2020  , and ".        
+000127d0: 2020 2020 2270 7574 7320 7468 6520 6675      "puts the fu
+000127e0: 6e64 7320 6672 6f6d 2074 6865 2066 6169  nds from the fai
+000127f0: 6c65 6420 7061 796f 7574 2062 6163 6b20  led payout back 
+00012800: 696e 2079 6f75 7220 6261 6c61 6e63 652e  in your balance.
+00012810: 220a 2020 2020 2020 2020 292c 0a20 2020  ".        ),.   
+00012820: 2029 0a20 2020 2066 6169 6c75 7265 5f63   ).    failure_c
+00012830: 6f64 6520 3d20 5374 7269 7065 456e 756d  ode = StripeEnum
+00012840: 4669 656c 6428 0a20 2020 2020 2020 2065  Field(.        e
+00012850: 6e75 6d3d 656e 756d 732e 5061 796f 7574  num=enums.Payout
+00012860: 4661 696c 7572 6543 6f64 652c 0a20 2020  FailureCode,.   
+00012870: 2020 2020 2064 6566 6175 6c74 3d22 222c       default="",
+00012880: 0a20 2020 2020 2020 2062 6c61 6e6b 3d54  .        blank=T
+00012890: 7275 652c 0a20 2020 2020 2020 2068 656c  rue,.        hel
+000128a0: 705f 7465 7874 3d28 0a20 2020 2020 2020  p_text=(.       
+000128b0: 2020 2020 2022 4572 726f 7220 636f 6465       "Error code
+000128c0: 2065 7870 6c61 696e 696e 6720 7265 6173   explaining reas
+000128d0: 6f6e 2066 6f72 2074 7261 6e73 6665 7220  on for transfer 
+000128e0: 6661 696c 7572 6520 6966 2061 7661 696c  failure if avail
+000128f0: 6162 6c65 2e20 220a 2020 2020 2020 2020  able. ".        
+00012900: 2020 2020 2253 6565 2068 7474 7073 3a2f      "See https:/
+00012910: 2f73 7472 6970 652e 636f 6d2f 646f 6373  /stripe.com/docs
+00012920: 2f61 7069 3f6c 616e 673d 7079 7468 6f6e  /api?lang=python
+00012930: 2374 7261 6e73 6665 725f 6661 696c 7572  #transfer_failur
+00012940: 6573 2e22 0a20 2020 2020 2020 2029 2c0a  es.".        ),.
+00012950: 2020 2020 290a 2020 2020 6661 696c 7572      ).    failur
+00012960: 655f 6d65 7373 6167 6520 3d20 6d6f 6465  e_message = mode
+00012970: 6c73 2e54 6578 7446 6965 6c64 280a 2020  ls.TextField(.  
+00012980: 2020 2020 2020 6465 6661 756c 743d 2222        default=""
+00012990: 2c0a 2020 2020 2020 2020 626c 616e 6b3d  ,.        blank=
+000129a0: 5472 7565 2c0a 2020 2020 2020 2020 6865  True,.        he
+000129b0: 6c70 5f74 6578 743d 280a 2020 2020 2020  lp_text=(.      
+000129c0: 2020 2020 2020 224d 6573 7361 6765 2074        "Message t
+000129d0: 6f20 7573 6572 2066 7572 7468 6572 2065  o user further e
+000129e0: 7870 6c61 696e 696e 6720 7265 6173 6f6e  xplaining reason
+000129f0: 2066 6f72 2070 6179 6f75 7420 6661 696c   for payout fail
+00012a00: 7572 6520 6966 2061 7661 696c 6162 6c65  ure if available
+00012a10: 2e22 0a20 2020 2020 2020 2029 2c0a 2020  .".        ),.  
+00012a20: 2020 290a 2020 2020 6d65 7468 6f64 203d    ).    method =
+00012a30: 2053 7472 6970 6545 6e75 6d46 6965 6c64   StripeEnumField
+00012a40: 280a 2020 2020 2020 2020 6d61 785f 6c65  (.        max_le
+00012a50: 6e67 7468 3d38 2c0a 2020 2020 2020 2020  ngth=8,.        
+00012a60: 656e 756d 3d65 6e75 6d73 2e50 6179 6f75  enum=enums.Payou
+00012a70: 744d 6574 686f 642c 0a20 2020 2020 2020  tMethod,.       
+00012a80: 2068 656c 705f 7465 7874 3d28 0a20 2020   help_text=(.   
+00012a90: 2020 2020 2020 2020 2022 5468 6520 6d65           "The me
+00012aa0: 7468 6f64 2075 7365 6420 746f 2073 656e  thod used to sen
+00012ab0: 6420 7468 6973 2070 6179 6f75 742e 2022  d this payout. "
+00012ac0: 0a20 2020 2020 2020 2020 2020 2022 6069  .            "`i
+00012ad0: 6e73 7461 6e74 6020 6973 206f 6e6c 7920  nstant` is only 
+00012ae0: 7375 7070 6f72 7465 6420 666f 7220 7061  supported for pa
+00012af0: 796f 7574 7320 746f 2064 6562 6974 2063  youts to debit c
+00012b00: 6172 6473 2e22 0a20 2020 2020 2020 2029  ards.".        )
+00012b10: 2c0a 2020 2020 290a 2020 2020 6f72 6967  ,.    ).    orig
+00012b20: 696e 616c 5f70 6179 6f75 7420 3d20 6d6f  inal_payout = mo
+00012b30: 6465 6c73 2e4f 6e65 546f 4f6e 6546 6965  dels.OneToOneFie
+00012b40: 6c64 280a 2020 2020 2020 2020 2250 6179  ld(.        "Pay
+00012b50: 6f75 7422 2c0a 2020 2020 2020 2020 6f6e  out",.        on
+00012b60: 5f64 656c 6574 653d 6d6f 6465 6c73 2e53  _delete=models.S
+00012b70: 4554 5f4e 554c 4c2c 0a20 2020 2020 2020  ET_NULL,.       
+00012b80: 206e 756c 6c3d 5472 7565 2c0a 2020 2020   null=True,.    
+00012b90: 2020 2020 626c 616e 6b3d 5472 7565 2c0a      blank=True,.
+00012ba0: 2020 2020 2020 2020 6865 6c70 5f74 6578          help_tex
+00012bb0: 743d 280a 2020 2020 2020 2020 2020 2020  t=(.            
+00012bc0: 2249 6620 7468 6973 2070 6179 6f75 7420  "If this payout 
+00012bd0: 7265 7665 7273 6573 2061 6e6f 7468 6572  reverses another
+00012be0: 2c20 7468 6973 2069 7320 7468 6520 4944  , this is the ID
+00012bf0: 206f 6620 7468 6520 6f72 6967 696e 616c   of the original
+00012c00: 2070 6179 6f75 742e 220a 2020 2020 2020   payout.".      
+00012c10: 2020 292c 0a20 2020 2029 0a20 2020 2072    ),.    ).    r
+00012c20: 6576 6572 7365 645f 6279 203d 206d 6f64  eversed_by = mod
+00012c30: 656c 732e 4f6e 6554 6f4f 6e65 4669 656c  els.OneToOneFiel
+00012c40: 6428 0a20 2020 2020 2020 2022 5061 796f  d(.        "Payo
+00012c50: 7574 222c 0a20 2020 2020 2020 206f 6e5f  ut",.        on_
+00012c60: 6465 6c65 7465 3d6d 6f64 656c 732e 5345  delete=models.SE
+00012c70: 545f 4e55 4c4c 2c0a 2020 2020 2020 2020  T_NULL,.        
+00012c80: 6e75 6c6c 3d54 7275 652c 0a20 2020 2020  null=True,.     
+00012c90: 2020 2062 6c61 6e6b 3d54 7275 652c 0a20     blank=True,. 
+00012ca0: 2020 2020 2020 2068 656c 705f 7465 7874         help_text
+00012cb0: 3d28 0a20 2020 2020 2020 2020 2020 2022  =(.            "
+00012cc0: 4966 2074 6869 7320 7061 796f 7574 2077  If this payout w
+00012cd0: 6173 2072 6576 6572 7365 642c 2074 6869  as reversed, thi
+00012ce0: 7320 6973 2074 6865 2049 4420 6f66 2074  s is the ID of t
+00012cf0: 6865 2070 6179 6f75 7420 7468 6174 2072  he payout that r
+00012d00: 6576 6572 7365 7322 0a20 2020 2020 2020  everses".       
+00012d10: 2020 2020 2022 2074 6869 7320 7061 796f       " this payo
+00012d20: 7574 2e22 0a20 2020 2020 2020 2029 2c0a  ut.".        ),.
+00012d30: 2020 2020 2020 2020 7265 6c61 7465 645f          related_
+00012d40: 6e61 6d65 3d22 7265 7665 7273 6564 5f70  name="reversed_p
+00012d50: 6179 6f75 7422 2c0a 2020 2020 290a 2020  ayout",.    ).  
+00012d60: 2020 736f 7572 6365 5f74 7970 6520 3d20    source_type = 
+00012d70: 5374 7269 7065 456e 756d 4669 656c 6428  StripeEnumField(
+00012d80: 0a20 2020 2020 2020 2065 6e75 6d3d 656e  .        enum=en
+00012d90: 756d 732e 5061 796f 7574 536f 7572 6365  ums.PayoutSource
+00012da0: 5479 7065 2c0a 2020 2020 2020 2020 6865  Type,.        he
+00012db0: 6c70 5f74 6578 743d 2254 6865 2073 6f75  lp_text="The sou
+00012dc0: 7263 6520 6261 6c61 6e63 6520 7468 6973  rce balance this
+00012dd0: 2070 6179 6f75 7420 6361 6d65 2066 726f   payout came fro
+00012de0: 6d2e 222c 0a20 2020 2029 0a20 2020 2073  m.",.    ).    s
+00012df0: 7461 7465 6d65 6e74 5f64 6573 6372 6970  tatement_descrip
+00012e00: 746f 7220 3d20 6d6f 6465 6c73 2e43 6861  tor = models.Cha
+00012e10: 7246 6965 6c64 280a 2020 2020 2020 2020  rField(.        
+00012e20: 6d61 785f 6c65 6e67 7468 3d32 3535 2c0a  max_length=255,.
+00012e30: 2020 2020 2020 2020 6465 6661 756c 743d          default=
+00012e40: 2222 2c0a 2020 2020 2020 2020 626c 616e  "",.        blan
+00012e50: 6b3d 5472 7565 2c0a 2020 2020 2020 2020  k=True,.        
+00012e60: 6865 6c70 5f74 6578 743d 280a 2020 2020  help_text=(.    
+00012e70: 2020 2020 2020 2020 2245 7874 7261 2069          "Extra i
+00012e80: 6e66 6f72 6d61 7469 6f6e 2061 626f 7574  nformation about
+00012e90: 2061 2070 6179 6f75 7420 746f 2062 6520   a payout to be 
+00012ea0: 6469 7370 6c61 7965 6420 220a 2020 2020  displayed ".    
+00012eb0: 2020 2020 2020 2020 226f 6e20 7468 6520          "on the 
+00012ec0: 7573 6572 2773 2062 616e 6b20 7374 6174  user's bank stat
+00012ed0: 656d 656e 742e 220a 2020 2020 2020 2020  ement.".        
+00012ee0: 292c 0a20 2020 2029 0a20 2020 2073 7461  ),.    ).    sta
+00012ef0: 7475 7320 3d20 5374 7269 7065 456e 756d  tus = StripeEnum
+00012f00: 4669 656c 6428 0a20 2020 2020 2020 2065  Field(.        e
+00012f10: 6e75 6d3d 656e 756d 732e 5061 796f 7574  num=enums.Payout
+00012f20: 5374 6174 7573 2c0a 2020 2020 2020 2020  Status,.        
+00012f30: 6865 6c70 5f74 6578 743d 280a 2020 2020  help_text=(.    
+00012f40: 2020 2020 2020 2020 2243 7572 7265 6e74          "Current
+00012f50: 2073 7461 7475 7320 6f66 2074 6865 2070   status of the p
+00012f60: 6179 6f75 742e 2022 0a20 2020 2020 2020  ayout. ".       
+00012f70: 2020 2020 2022 4120 7061 796f 7574 2077       "A payout w
+00012f80: 696c 6c20 6265 2060 7065 6e64 696e 6760  ill be `pending`
+00012f90: 2075 6e74 696c 2069 7420 6973 2073 7562   until it is sub
+00012fa0: 6d69 7474 6564 2074 6f20 7468 6520 6261  mitted to the ba
+00012fb0: 6e6b 2c20 220a 2020 2020 2020 2020 2020  nk, ".          
+00012fc0: 2020 2261 7420 7768 6963 6820 706f 696e    "at which poin
+00012fd0: 7420 6974 2062 6563 6f6d 6573 2060 696e  t it becomes `in
+00012fe0: 5f74 7261 6e73 6974 602e 2022 0a20 2020  _transit`. ".   
+00012ff0: 2020 2020 2020 2020 2022 4974 2077 696c           "It wil
+00013000: 6c20 7468 656e 2063 6861 6e67 6520 746f  l then change to
+00013010: 2070 6169 6420 6966 2074 6865 2074 7261   paid if the tra
+00013020: 6e73 6163 7469 6f6e 2067 6f65 7320 7468  nsaction goes th
+00013030: 726f 7567 682e 2022 0a20 2020 2020 2020  rough. ".       
+00013040: 2020 2020 2022 4966 2069 7420 646f 6573       "If it does
+00013050: 206e 6f74 2067 6f20 7468 726f 7567 6820   not go through 
+00013060: 7375 6363 6573 7366 756c 6c79 2c20 220a  successfully, ".
+00013070: 2020 2020 2020 2020 2020 2020 2269 7473              "its
+00013080: 2073 7461 7475 7320 7769 6c6c 2063 6861   status will cha
+00013090: 6e67 6520 746f 2060 6661 696c 6564 6020  nge to `failed` 
+000130a0: 6f72 2060 6361 6e63 656c 6564 602e 220a  or `canceled`.".
+000130b0: 2020 2020 2020 2020 292c 0a20 2020 2029          ),.    )
+000130c0: 0a20 2020 2074 7970 6520 3d20 5374 7269  .    type = Stri
+000130d0: 7065 456e 756d 4669 656c 6428 656e 756d  peEnumField(enum
+000130e0: 3d65 6e75 6d73 2e50 6179 6f75 7454 7970  =enums.PayoutTyp
+000130f0: 6529 0a0a 2020 2020 6465 6620 5f5f 7374  e)..    def __st
+00013100: 725f 5f28 7365 6c66 293a 0a20 2020 2020  r__(self):.     
+00013110: 2020 2072 6574 7572 6e20 6622 7b73 656c     return f"{sel
+00013120: 662e 616d 6f75 6e74 7d20 287b 656e 756d  f.amount} ({enum
+00013130: 732e 5061 796f 7574 5374 6174 7573 2e68  s.PayoutStatus.h
+00013140: 756d 616e 697a 6528 7365 6c66 2e73 7461  umanize(self.sta
+00013150: 7475 7329 7d29 220a 0a0a 636c 6173 7320  tus)})"...class 
+00013160: 5072 6963 6528 5374 7269 7065 4d6f 6465  Price(StripeMode
+00013170: 6c29 3a0a 2020 2020 2222 220a 2020 2020  l):.    """.    
+00013180: 5072 6963 6573 2064 6566 696e 6520 7468  Prices define th
+00013190: 6520 756e 6974 2063 6f73 742c 2063 7572  e unit cost, cur
+000131a0: 7265 6e63 792c 2061 6e64 2028 6f70 7469  rency, and (opti
+000131b0: 6f6e 616c 2920 6269 6c6c 696e 6720 6379  onal) billing cy
+000131c0: 636c 6520 666f 720a 2020 2020 626f 7468  cle for.    both
+000131d0: 2072 6563 7572 7269 6e67 2061 6e64 206f   recurring and o
+000131e0: 6e65 2d74 696d 6520 7075 7263 6861 7365  ne-time purchase
+000131f0: 7320 6f66 2070 726f 6475 6374 732e 0a0a  s of products...
+00013200: 2020 2020 5072 6963 6520 616e 6420 506c      Price and Pl
+00013210: 616e 206f 626a 6563 7473 2061 7265 2074  an objects are t
+00013220: 6865 2073 616d 652c 2062 7574 2075 7365  he same, but use
+00013230: 2061 2064 6966 6665 7265 6e74 2072 6570   a different rep
+00013240: 7265 7365 6e74 6174 696f 6e2e 0a20 2020  resentation..   
+00013250: 2043 7265 6174 696e 6720 6120 7265 6375   Creating a recu
+00013260: 7272 696e 6720 5072 6963 6520 696e 2053  rring Price in S
+00013270: 7472 6970 6520 616c 736f 206d 616b 6573  tripe also makes
+00013280: 2061 2050 6c61 6e20 6176 6169 6c61 626c   a Plan availabl
+00013290: 652c 2061 6e64 2076 6963 6520 7665 7273  e, and vice vers
+000132a0: 612e 0a20 2020 2054 6869 7320 6973 206e  a..    This is n
+000132b0: 6f74 2074 6865 2063 6173 6520 666f 7220  ot the case for 
+000132c0: 6120 5072 6963 6520 7769 7468 2069 6e74  a Price with int
+000132d0: 6572 7661 6c3d 6f6e 655f 7469 6d65 2e0a  erval=one_time..
+000132e0: 0a20 2020 2050 7269 6365 206f 626a 6563  .    Price objec
+000132f0: 7473 2061 7265 2061 206d 6f72 6520 7265  ts are a more re
+00013300: 6365 6e74 2041 5049 2072 6570 7265 7365  cent API represe
+00013310: 6e74 6174 696f 6e2c 2073 7570 706f 7274  ntation, support
+00013320: 206d 6f72 6520 6665 6174 7572 6573 0a20   more features. 
+00013330: 2020 2061 6e64 2069 7473 2075 7361 6765     and its usage
+00013340: 2069 7320 656e 636f 7572 6167 6564 2069   is encouraged i
+00013350: 6e73 7465 6164 206f 6620 506c 616e 206f  nstead of Plan o
+00013360: 626a 6563 7473 2e0a 0a20 2020 2053 7472  bjects...    Str
+00013370: 6970 6520 646f 6375 6d65 6e74 6174 696f  ipe documentatio
+00013380: 6e3a 0a20 2020 202d 2068 7474 7073 3a2f  n:.    - https:/
+00013390: 2f73 7472 6970 652e 636f 6d2f 646f 6373  /stripe.com/docs
+000133a0: 2f61 7069 2f70 7269 6365 730a 2020 2020  /api/prices.    
+000133b0: 2d20 6874 7470 733a 2f2f 7374 7269 7065  - https://stripe
+000133c0: 2e63 6f6d 2f64 6f63 732f 6269 6c6c 696e  .com/docs/billin
+000133d0: 672f 7072 6963 6573 2d67 7569 6465 0a20  g/prices-guide. 
+000133e0: 2020 2022 2222 0a0a 2020 2020 7374 7269     """..    stri
+000133f0: 7065 5f63 6c61 7373 203d 2073 7472 6970  pe_class = strip
+00013400: 652e 5072 6963 650a 2020 2020 6578 7061  e.Price.    expa
+00013410: 6e64 5f66 6965 6c64 7320 3d20 5b22 7072  nd_fields = ["pr
+00013420: 6f64 7563 7422 2c20 2274 6965 7273 225d  oduct", "tiers"]
+00013430: 0a20 2020 2073 7472 6970 655f 6461 7368  .    stripe_dash
+00013440: 626f 6172 645f 6974 656d 5f6e 616d 6520  board_item_name 
+00013450: 3d20 2270 7269 6365 7322 0a0a 2020 2020  = "prices"..    
+00013460: 6163 7469 7665 203d 206d 6f64 656c 732e  active = models.
+00013470: 426f 6f6c 6561 6e46 6965 6c64 280a 2020  BooleanField(.  
+00013480: 2020 2020 2020 6865 6c70 5f74 6578 743d        help_text=
+00013490: 2257 6865 7468 6572 2074 6865 2070 7269  "Whether the pri
+000134a0: 6365 2063 616e 2062 6520 7573 6564 2066  ce can be used f
+000134b0: 6f72 206e 6577 2070 7572 6368 6173 6573  or new purchases
+000134c0: 2e22 0a20 2020 2029 0a20 2020 2063 7572  .".    ).    cur
+000134d0: 7265 6e63 7920 3d20 5374 7269 7065 4375  rency = StripeCu
+000134e0: 7272 656e 6379 436f 6465 4669 656c 6428  rrencyCodeField(
+000134f0: 290a 2020 2020 6e69 636b 6e61 6d65 203d  ).    nickname =
+00013500: 206d 6f64 656c 732e 4368 6172 4669 656c   models.CharFiel
+00013510: 6428 0a20 2020 2020 2020 206d 6178 5f6c  d(.        max_l
+00013520: 656e 6774 683d 3235 302c 0a20 2020 2020  ength=250,.     
+00013530: 2020 2062 6c61 6e6b 3d54 7275 652c 0a20     blank=True,. 
+00013540: 2020 2020 2020 2068 656c 705f 7465 7874         help_text
+00013550: 3d22 4120 6272 6965 6620 6465 7363 7269  ="A brief descri
+00013560: 7074 696f 6e20 6f66 2074 6865 2070 6c61  ption of the pla
+00013570: 6e2c 2068 6964 6465 6e20 6672 6f6d 2063  n, hidden from c
+00013580: 7573 746f 6d65 7273 2e22 2c0a 2020 2020  ustomers.",.    
+00013590: 290a 2020 2020 7072 6f64 7563 7420 3d20  ).    product = 
+000135a0: 5374 7269 7065 466f 7265 6967 6e4b 6579  StripeForeignKey
+000135b0: 280a 2020 2020 2020 2020 2250 726f 6475  (.        "Produ
+000135c0: 6374 222c 0a20 2020 2020 2020 206f 6e5f  ct",.        on_
+000135d0: 6465 6c65 7465 3d6d 6f64 656c 732e 4341  delete=models.CA
+000135e0: 5343 4144 452c 0a20 2020 2020 2020 2072  SCADE,.        r
+000135f0: 656c 6174 6564 5f6e 616d 653d 2270 7269  elated_name="pri
+00013600: 6365 7322 2c0a 2020 2020 2020 2020 6865  ces",.        he
+00013610: 6c70 5f74 6578 743d 2254 6865 2070 726f  lp_text="The pro
+00013620: 6475 6374 2074 6869 7320 7072 6963 6520  duct this price 
+00013630: 6973 2061 7373 6f63 6961 7465 6420 7769  is associated wi
+00013640: 7468 2e22 2c0a 2020 2020 290a 2020 2020  th.",.    ).    
+00013650: 7265 6375 7272 696e 6720 3d20 4a53 4f4e  recurring = JSON
+00013660: 4669 656c 6428 0a20 2020 2020 2020 2064  Field(.        d
+00013670: 6566 6175 6c74 3d4e 6f6e 652c 0a20 2020  efault=None,.   
+00013680: 2020 2020 2062 6c61 6e6b 3d54 7275 652c       blank=True,
+00013690: 0a20 2020 2020 2020 206e 756c 6c3d 5472  .        null=Tr
+000136a0: 7565 2c0a 2020 2020 2020 2020 6865 6c70  ue,.        help
+000136b0: 5f74 6578 743d 280a 2020 2020 2020 2020  _text=(.        
+000136c0: 2020 2020 2254 6865 2072 6563 7572 7269      "The recurri
+000136d0: 6e67 2063 6f6d 706f 6e65 6e74 7320 6f66  ng components of
+000136e0: 2061 2070 7269 6365 2073 7563 6820 6173   a price such as
+000136f0: 2060 696e 7465 7276 616c 6020 616e 6420   `interval` and 
+00013700: 6075 7361 6765 5f74 7970 6560 2e22 0a20  `usage_type`.". 
+00013710: 2020 2020 2020 2029 2c0a 2020 2020 290a         ),.    ).
+00013720: 2020 2020 7479 7065 203d 2053 7472 6970      type = Strip
+00013730: 6545 6e75 6d46 6965 6c64 280a 2020 2020  eEnumField(.    
+00013740: 2020 2020 656e 756d 3d65 6e75 6d73 2e50      enum=enums.P
+00013750: 7269 6365 5479 7065 2c0a 2020 2020 2020  riceType,.      
+00013760: 2020 6865 6c70 5f74 6578 743d 280a 2020    help_text=(.  
+00013770: 2020 2020 2020 2020 2020 2257 6865 7468            "Wheth
+00013780: 6572 2074 6865 2070 7269 6365 2069 7320  er the price is 
+00013790: 666f 7220 6120 6f6e 652d 7469 6d65 2070  for a one-time p
+000137a0: 7572 6368 6173 6520 6f72 2061 2072 6563  urchase or a rec
+000137b0: 7572 7269 6e67 2022 0a20 2020 2020 2020  urring ".       
+000137c0: 2020 2020 2022 2873 7562 7363 7269 7074       "(subscript
+000137d0: 696f 6e29 2070 7572 6368 6173 652e 220a  ion) purchase.".
+000137e0: 2020 2020 2020 2020 292c 0a20 2020 2029          ),.    )
+000137f0: 0a20 2020 2075 6e69 745f 616d 6f75 6e74  .    unit_amount
+00013800: 203d 2053 7472 6970 6551 7561 6e74 756d   = StripeQuantum
+00013810: 4375 7272 656e 6379 416d 6f75 6e74 4669  CurrencyAmountFi
+00013820: 656c 6428 0a20 2020 2020 2020 206e 756c  eld(.        nul
+00013830: 6c3d 5472 7565 2c0a 2020 2020 2020 2020  l=True,.        
+00013840: 626c 616e 6b3d 5472 7565 2c0a 2020 2020  blank=True,.    
+00013850: 2020 2020 6865 6c70 5f74 6578 743d 280a      help_text=(.
+00013860: 2020 2020 2020 2020 2020 2020 2254 6865              "The
+00013870: 2075 6e69 7420 616d 6f75 6e74 2069 6e20   unit amount in 
+00013880: 6365 6e74 7320 746f 2062 6520 6368 6172  cents to be char
+00013890: 6765 642c 2072 6570 7265 7365 6e74 6564  ged, represented
+000138a0: 2061 7320 6120 7768 6f6c 6520 220a 2020   as a whole ".  
+000138b0: 2020 2020 2020 2020 2020 2269 6e74 6567            "integ
+000138c0: 6572 2069 6620 706f 7373 6962 6c65 2e20  er if possible. 
+000138d0: 4e75 6c6c 2069 6620 6120 7375 622d 6365  Null if a sub-ce
+000138e0: 6e74 2070 7265 6369 7369 6f6e 2069 7320  nt precision is 
+000138f0: 7265 7175 6972 6564 2e22 0a20 2020 2020  required.".     
+00013900: 2020 2029 2c0a 2020 2020 290a 2020 2020     ),.    ).    
+00013910: 756e 6974 5f61 6d6f 756e 745f 6465 6369  unit_amount_deci
+00013920: 6d61 6c20 3d20 5374 7269 7065 4465 6369  mal = StripeDeci
+00013930: 6d61 6c43 7572 7265 6e63 7941 6d6f 756e  malCurrencyAmoun
+00013940: 7446 6965 6c64 280a 2020 2020 2020 2020  tField(.        
+00013950: 6e75 6c6c 3d54 7275 652c 0a20 2020 2020  null=True,.     
+00013960: 2020 2062 6c61 6e6b 3d54 7275 652c 0a20     blank=True,. 
+00013970: 2020 2020 2020 206d 6178 5f64 6967 6974         max_digit
+00013980: 733d 3139 2c0a 2020 2020 2020 2020 6465  s=19,.        de
+00013990: 6369 6d61 6c5f 706c 6163 6573 3d31 322c  cimal_places=12,
+000139a0: 0a20 2020 2020 2020 2068 656c 705f 7465  .        help_te
+000139b0: 7874 3d28 0a20 2020 2020 2020 2020 2020  xt=(.           
+000139c0: 2022 5468 6520 756e 6974 2061 6d6f 756e   "The unit amoun
+000139d0: 7420 696e 2063 656e 7473 2074 6f20 6265  t in cents to be
+000139e0: 2063 6861 7267 6564 2c20 7265 7072 6573   charged, repres
+000139f0: 656e 7465 6420 6173 2061 2064 6563 696d  ented as a decim
+00013a00: 616c 2022 0a20 2020 2020 2020 2020 2020  al ".           
+00013a10: 2022 7374 7269 6e67 2077 6974 6820 6174   "string with at
+00013a20: 206d 6f73 7420 3132 2064 6563 696d 616c   most 12 decimal
+00013a30: 2070 6c61 6365 732e 220a 2020 2020 2020   places.".      
+00013a40: 2020 292c 0a20 2020 2029 0a0a 2020 2020    ),.    )..    
+00013a50: 2320 4d6f 7265 2061 7474 7269 6275 7465  # More attribute
+00013a60: 73e2 80a6 0a20 2020 2062 696c 6c69 6e67  s....    billing
+00013a70: 5f73 6368 656d 6520 3d20 5374 7269 7065  _scheme = Stripe
+00013a80: 456e 756d 4669 656c 6428 0a20 2020 2020  EnumField(.     
+00013a90: 2020 2065 6e75 6d3d 656e 756d 732e 4269     enum=enums.Bi
+00013aa0: 6c6c 696e 6753 6368 656d 652c 0a20 2020  llingScheme,.   
+00013ab0: 2020 2020 2062 6c61 6e6b 3d54 7275 652c       blank=True,
+00013ac0: 0a20 2020 2020 2020 2068 656c 705f 7465  .        help_te
+00013ad0: 7874 3d28 0a20 2020 2020 2020 2020 2020  xt=(.           
+00013ae0: 2022 4465 7363 7269 6265 7320 686f 7720   "Describes how 
+00013af0: 746f 2063 6f6d 7075 7465 2074 6865 2070  to compute the p
+00013b00: 7269 6365 2070 6572 2070 6572 696f 642e  rice per period.
+00013b10: 2022 0a20 2020 2020 2020 2020 2020 2022   ".            "
+00013b20: 4569 7468 6572 2060 7065 725f 756e 6974  Either `per_unit
+00013b30: 6020 6f72 2060 7469 6572 6564 602e 2022  ` or `tiered`. "
+00013b40: 0a20 2020 2020 2020 2020 2020 2022 6070  .            "`p
+00013b50: 6572 5f75 6e69 7460 2069 6e64 6963 6174  er_unit` indicat
+00013b60: 6573 2074 6861 7420 7468 6520 6669 7865  es that the fixe
+00013b70: 6420 616d 6f75 6e74 2028 7370 6563 6966  d amount (specif
+00013b80: 6965 6420 696e 2060 756e 6974 5f61 6d6f  ied in `unit_amo
+00013b90: 756e 7460 2022 0a20 2020 2020 2020 2020  unt` ".         
+00013ba0: 2020 2022 6f72 2060 756e 6974 5f61 6d6f     "or `unit_amo
+00013bb0: 756e 745f 6465 6369 6d61 6c60 2920 7769  unt_decimal`) wi
+00013bc0: 6c6c 2062 6520 6368 6172 6765 6420 7065  ll be charged pe
+00013bd0: 7220 756e 6974 2069 6e20 6071 7561 6e74  r unit in `quant
+00013be0: 6974 7960 2022 0a20 2020 2020 2020 2020  ity` ".         
+00013bf0: 2020 2022 2866 6f72 2070 7269 6365 7320     "(for prices 
+00013c00: 7769 7468 2060 7573 6167 655f 7479 7065  with `usage_type
+00013c10: 3d6c 6963 656e 7365 6460 292c 206f 7220  =licensed`), or 
+00013c20: 7065 7220 756e 6974 206f 6620 746f 7461  per unit of tota
+00013c30: 6c20 220a 2020 2020 2020 2020 2020 2020  l ".            
+00013c40: 2275 7361 6765 2028 666f 7220 7072 6963  "usage (for pric
+00013c50: 6573 2077 6974 6820 6075 7361 6765 5f74  es with `usage_t
+00013c60: 7970 653d 6d65 7465 7265 6460 292e 2022  ype=metered`). "
+00013c70: 0a20 2020 2020 2020 2020 2020 2022 6074  .            "`t
+00013c80: 6965 7265 6460 2069 6e64 6963 6174 6573  iered` indicates
+00013c90: 2074 6861 7420 7468 6520 756e 6974 2070   that the unit p
+00013ca0: 7269 6369 6e67 2077 696c 6c20 6265 2063  ricing will be c
+00013cb0: 6f6d 7075 7465 6420 7573 696e 6720 220a  omputed using ".
+00013cc0: 2020 2020 2020 2020 2020 2020 2261 2074              "a t
+00013cd0: 6965 7269 6e67 2073 7472 6174 6567 7920  iering strategy 
+00013ce0: 6173 2064 6566 696e 6564 2075 7369 6e67  as defined using
+00013cf0: 2074 6865 2060 7469 6572 7360 2061 6e64   the `tiers` and
+00013d00: 2060 7469 6572 735f 6d6f 6465 6020 220a   `tiers_mode` ".
+00013d10: 2020 2020 2020 2020 2020 2020 2261 7474              "att
+00013d20: 7269 6275 7465 732e 220a 2020 2020 2020  ributes.".      
+00013d30: 2020 292c 0a20 2020 2029 0a20 2020 206c    ),.    ).    l
+00013d40: 6f6f 6b75 705f 6b65 7920 3d20 6d6f 6465  ookup_key = mode
+00013d50: 6c73 2e43 6861 7246 6965 6c64 280a 2020  ls.CharField(.  
+00013d60: 2020 2020 2020 6d61 785f 6c65 6e67 7468        max_length
+00013d70: 3d32 3530 2c0a 2020 2020 2020 2020 6e75  =250,.        nu
+00013d80: 6c6c 3d54 7275 652c 0a20 2020 2020 2020  ll=True,.       
+00013d90: 2062 6c61 6e6b 3d54 7275 652c 0a20 2020   blank=True,.   
+00013da0: 2020 2020 2068 656c 705f 7465 7874 3d28       help_text=(
+00013db0: 0a20 2020 2020 2020 2020 2020 2022 4120  .            "A 
+00013dc0: 6c6f 6f6b 7570 206b 6579 2075 7365 6420  lookup key used 
+00013dd0: 746f 2072 6574 7269 6576 6520 7072 6963  to retrieve pric
+00013de0: 6573 2064 796e 616d 6963 616c 6c79 2066  es dynamically f
+00013df0: 726f 6d20 6120 7374 6174 6963 2073 7472  rom a static str
+00013e00: 696e 672e 220a 2020 2020 2020 2020 292c  ing.".        ),
+00013e10: 0a20 2020 2029 0a20 2020 2074 6965 7273  .    ).    tiers
+00013e20: 203d 204a 534f 4e46 6965 6c64 280a 2020   = JSONField(.  
+00013e30: 2020 2020 2020 6e75 6c6c 3d54 7275 652c        null=True,
+00013e40: 0a20 2020 2020 2020 2062 6c61 6e6b 3d54  .        blank=T
+00013e50: 7275 652c 0a20 2020 2020 2020 2068 656c  rue,.        hel
+00013e60: 705f 7465 7874 3d28 0a20 2020 2020 2020  p_text=(.       
+00013e70: 2020 2020 2022 4561 6368 2065 6c65 6d65       "Each eleme
+00013e80: 6e74 2072 6570 7265 7365 6e74 7320 6120  nt represents a 
+00013e90: 7072 6963 696e 6720 7469 6572 2e20 220a  pricing tier. ".
+00013ea0: 2020 2020 2020 2020 2020 2020 2254 6869              "Thi
+00013eb0: 7320 7061 7261 6d65 7465 7220 7265 7175  s parameter requ
+00013ec0: 6972 6573 2060 6269 6c6c 696e 675f 7363  ires `billing_sc
+00013ed0: 6865 6d65 6020 746f 2062 6520 7365 7420  heme` to be set 
+00013ee0: 746f 2060 7469 6572 6564 602e 220a 2020  to `tiered`.".  
+00013ef0: 2020 2020 2020 292c 0a20 2020 2029 0a20        ),.    ). 
+00013f00: 2020 2074 6965 7273 5f6d 6f64 6520 3d20     tiers_mode = 
+00013f10: 5374 7269 7065 456e 756d 4669 656c 6428  StripeEnumField(
+00013f20: 0a20 2020 2020 2020 2065 6e75 6d3d 656e  .        enum=en
+00013f30: 756d 732e 5072 6963 6554 6965 7273 4d6f  ums.PriceTiersMo
+00013f40: 6465 2c0a 2020 2020 2020 2020 6e75 6c6c  de,.        null
+00013f50: 3d54 7275 652c 0a20 2020 2020 2020 2062  =True,.        b
+00013f60: 6c61 6e6b 3d54 7275 652c 0a20 2020 2020  lank=True,.     
+00013f70: 2020 2068 656c 705f 7465 7874 3d28 0a20     help_text=(. 
+00013f80: 2020 2020 2020 2020 2020 2022 4465 6669             "Defi
+00013f90: 6e65 7320 6966 2074 6865 2074 6965 7269  nes if the tieri
+00013fa0: 6e67 2070 7269 6365 2073 686f 756c 6420  ng price should 
+00013fb0: 6265 2060 6772 6164 7561 7465 6460 206f  be `graduated` o
+00013fc0: 7220 6076 6f6c 756d 6560 2062 6173 6564  r `volume` based
+00013fd0: 2e20 220a 2020 2020 2020 2020 2020 2020  . ".            
+00013fe0: 2249 6e20 6076 6f6c 756d 6560 2d62 6173  "In `volume`-bas
+00013ff0: 6564 2074 6965 7269 6e67 2c20 7468 6520  ed tiering, the 
+00014000: 6d61 7869 6d75 6d20 7175 616e 7469 7479  maximum quantity
+00014010: 2077 6974 6869 6e20 6120 7065 7269 6f64   within a period
+00014020: 2022 0a20 2020 2020 2020 2020 2020 2022   ".            "
+00014030: 6465 7465 726d 696e 6573 2074 6865 2070  determines the p
+00014040: 6572 2075 6e69 7420 7072 6963 652c 2069  er unit price, i
+00014050: 6e20 6067 7261 6475 6174 6564 6020 7469  n `graduated` ti
+00014060: 6572 696e 6720 7072 6963 696e 6720 6361  ering pricing ca
+00014070: 6e20 220a 2020 2020 2020 2020 2020 2020  n ".            
+00014080: 2273 7563 6365 7373 6976 656c 7920 6368  "successively ch
+00014090: 616e 6765 2061 7320 7468 6520 7175 616e  ange as the quan
+000140a0: 7469 7479 2067 726f 7773 2e22 0a20 2020  tity grows.".   
+000140b0: 2020 2020 2029 2c0a 2020 2020 290a 2020       ),.    ).  
+000140c0: 2020 7472 616e 7366 6f72 6d5f 7175 616e    transform_quan
+000140d0: 7469 7479 203d 204a 534f 4e46 6965 6c64  tity = JSONField
+000140e0: 280a 2020 2020 2020 2020 6e75 6c6c 3d54  (.        null=T
+000140f0: 7275 652c 0a20 2020 2020 2020 2062 6c61  rue,.        bla
+00014100: 6e6b 3d54 7275 652c 0a20 2020 2020 2020  nk=True,.       
+00014110: 2068 656c 705f 7465 7874 3d28 0a20 2020   help_text=(.   
+00014120: 2020 2020 2020 2020 2022 4170 706c 7920           "Apply 
+00014130: 6120 7472 616e 7366 6f72 6d61 7469 6f6e  a transformation
+00014140: 2074 6f20 7468 6520 7265 706f 7274 6564   to the reported
+00014150: 2075 7361 6765 206f 7220 7365 7420 7175   usage or set qu
+00014160: 616e 7469 7479 2022 0a20 2020 2020 2020  antity ".       
+00014170: 2020 2020 2022 6265 666f 7265 2063 6f6d       "before com
+00014180: 7075 7469 6e67 2074 6865 2061 6d6f 756e  puting the amoun
+00014190: 7420 6269 6c6c 6564 2e20 4361 6e6e 6f74  t billed. Cannot
+000141a0: 2062 6520 636f 6d62 696e 6564 2077 6974   be combined wit
+000141b0: 6820 6074 6965 7273 602e 220a 2020 2020  h `tiers`.".    
+000141c0: 2020 2020 292c 0a20 2020 2029 0a0a 2020      ),.    )..  
+000141d0: 2020 636c 6173 7320 4d65 7461 286f 626a    class Meta(obj
+000141e0: 6563 7429 3a0a 2020 2020 2020 2020 6f72  ect):.        or
+000141f0: 6465 7269 6e67 203d 205b 2275 6e69 745f  dering = ["unit_
+00014200: 616d 6f75 6e74 225d 0a0a 2020 2020 4063  amount"]..    @c
+00014210: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
+00014220: 6566 2067 6574 5f6f 725f 6372 6561 7465  ef get_or_create
+00014230: 2863 6c73 2c20 2a2a 6b77 6172 6773 293a  (cls, **kwargs):
+00014240: 0a20 2020 2020 2020 2022 2222 4765 7420  .        """Get 
+00014250: 6f72 2063 7265 6174 6520 6120 5072 6963  or create a Pric
+00014260: 652e 2222 220a 0a20 2020 2020 2020 2074  e."""..        t
+00014270: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+00014280: 7265 7475 726e 2063 6c73 2e6f 626a 6563  return cls.objec
+00014290: 7473 2e67 6574 2869 643d 6b77 6172 6773  ts.get(id=kwargs
+000142a0: 5b22 6964 225d 292c 2046 616c 7365 0a20  ["id"]), False. 
+000142b0: 2020 2020 2020 2065 7863 6570 7420 636c         except cl
+000142c0: 732e 446f 6573 4e6f 7445 7869 7374 3a0a  s.DoesNotExist:.
+000142d0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+000142e0: 726e 2063 6c73 2e63 7265 6174 6528 2a2a  rn cls.create(**
+000142f0: 6b77 6172 6773 292c 2054 7275 650a 0a20  kwargs), True.. 
+00014300: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
+00014310: 2020 2020 6465 6620 6372 6561 7465 2863      def create(c
+00014320: 6c73 2c20 2a2a 6b77 6172 6773 293a 0a20  ls, **kwargs):. 
+00014330: 2020 2020 2020 2023 2041 2066 6577 206d         # A few m
+00014340: 696e 6f72 2074 6869 6e67 7320 6172 6520  inor things are 
+00014350: 6368 616e 6765 6420 696e 2074 6865 2061  changed in the a
+00014360: 7069 2d76 6572 7369 6f6e 206f 6620 7468  pi-version of th
+00014370: 6520 6372 6561 7465 2063 616c 6c0a 2020  e create call.  
+00014380: 2020 2020 2020 6170 695f 6b77 6172 6773        api_kwargs
+00014390: 203d 2064 6963 7428 6b77 6172 6773 290a   = dict(kwargs).
+000143a0: 2020 2020 2020 2020 6966 2061 7069 5f6b          if api_k
+000143b0: 7761 7267 735b 2275 6e69 745f 616d 6f75  wargs["unit_amou
+000143c0: 6e74 225d 3a0a 2020 2020 2020 2020 2020  nt"]:.          
+000143d0: 2020 6170 695f 6b77 6172 6773 5b22 756e    api_kwargs["un
+000143e0: 6974 5f61 6d6f 756e 7422 5d20 3d20 696e  it_amount"] = in
+000143f0: 7428 6170 695f 6b77 6172 6773 5b22 756e  t(api_kwargs["un
+00014400: 6974 5f61 6d6f 756e 7422 5d20 2a20 3130  it_amount"] * 10
+00014410: 3029 0a0a 2020 2020 2020 2020 6966 2069  0)..        if i
+00014420: 7369 6e73 7461 6e63 6528 6170 695f 6b77  sinstance(api_kw
+00014430: 6172 6773 2e67 6574 2822 7072 6f64 7563  args.get("produc
+00014440: 7422 292c 2053 7472 6970 654d 6f64 656c  t"), StripeModel
+00014450: 293a 0a20 2020 2020 2020 2020 2020 2061  ):.            a
+00014460: 7069 5f6b 7761 7267 735b 2270 726f 6475  pi_kwargs["produ
+00014470: 6374 225d 203d 2061 7069 5f6b 7761 7267  ct"] = api_kwarg
+00014480: 735b 2270 726f 6475 6374 225d 2e69 640a  s["product"].id.
+00014490: 0a20 2020 2020 2020 2073 7472 6970 655f  .        stripe_
+000144a0: 7072 6963 6520 3d20 636c 732e 5f61 7069  price = cls._api
+000144b0: 5f63 7265 6174 6528 2a2a 6170 695f 6b77  _create(**api_kw
+000144c0: 6172 6773 290a 0a20 2020 2020 2020 2061  args)..        a
+000144d0: 7069 5f6b 6579 203d 2061 7069 5f6b 7761  pi_key = api_kwa
+000144e0: 7267 732e 6765 7428 2261 7069 5f6b 6579  rgs.get("api_key
+000144f0: 2229 206f 7220 646a 7374 7269 7065 5f73  ") or djstripe_s
+00014500: 6574 7469 6e67 732e 5354 5249 5045 5f53  ettings.STRIPE_S
+00014510: 4543 5245 545f 4b45 590a 2020 2020 2020  ECRET_KEY.      
+00014520: 2020 7072 6963 6520 3d20 636c 732e 7379    price = cls.sy
+00014530: 6e63 5f66 726f 6d5f 7374 7269 7065 5f64  nc_from_stripe_d
+00014540: 6174 6128 7374 7269 7065 5f70 7269 6365  ata(stripe_price
+00014550: 2c20 6170 695f 6b65 793d 6170 695f 6b65  , api_key=api_ke
+00014560: 7929 0a0a 2020 2020 2020 2020 7265 7475  y)..        retu
+00014570: 726e 2070 7269 6365 0a0a 2020 2020 6465  rn price..    de
+00014580: 6620 5f5f 7374 725f 5f28 7365 6c66 293a  f __str__(self):
+00014590: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000145a0: 6622 7b73 656c 662e 6875 6d61 6e5f 7265  f"{self.human_re
+000145b0: 6164 6162 6c65 5f70 7269 6365 7d20 666f  adable_price} fo
+000145c0: 7220 7b73 656c 662e 7072 6f64 7563 742e  r {self.product.
+000145d0: 6e61 6d65 7d22 0a0a 2020 2020 4070 726f  name}"..    @pro
+000145e0: 7065 7274 790a 2020 2020 6465 6620 6875  perty.    def hu
+000145f0: 6d61 6e5f 7265 6164 6162 6c65 5f70 7269  man_readable_pri
+00014600: 6365 2873 656c 6629 3a0a 2020 2020 2020  ce(self):.      
+00014610: 2020 6966 2073 656c 662e 6269 6c6c 696e    if self.billin
+00014620: 675f 7363 6865 6d65 203d 3d20 2270 6572  g_scheme == "per
+00014630: 5f75 6e69 7422 3a0a 2020 2020 2020 2020  _unit":.        
+00014640: 2020 2020 756e 6974 5f61 6d6f 756e 7420      unit_amount 
+00014650: 3d20 2873 656c 662e 756e 6974 5f61 6d6f  = (self.unit_amo
+00014660: 756e 7420 6f72 2030 2920 2f20 3130 300a  unt or 0) / 100.
+00014670: 2020 2020 2020 2020 2020 2020 616d 6f75              amou
+00014680: 6e74 203d 2067 6574 5f66 7269 656e 646c  nt = get_friendl
+00014690: 795f 6375 7272 656e 6379 5f61 6d6f 756e  y_currency_amoun
+000146a0: 7428 756e 6974 5f61 6d6f 756e 742c 2073  t(unit_amount, s
+000146b0: 656c 662e 6375 7272 656e 6379 290a 2020  elf.currency).  
+000146c0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+000146d0: 2020 2020 2020 2020 2320 7469 6572 6564          # tiered
+000146e0: 2062 696c 6c69 6e67 2073 6368 656d 650a   billing scheme.
+000146f0: 2020 2020 2020 2020 2020 2020 7469 6572              tier
+00014700: 5f31 203d 2073 656c 662e 7469 6572 735b  _1 = self.tiers[
+00014710: 305d 0a20 2020 2020 2020 2020 2020 2066  0].            f
+00014720: 6f72 6d61 7474 6564 5f75 6e69 745f 616d  ormatted_unit_am
+00014730: 6f75 6e74 5f74 6965 725f 3120 3d20 6765  ount_tier_1 = ge
+00014740: 745f 6672 6965 6e64 6c79 5f63 7572 7265  t_friendly_curre
+00014750: 6e63 795f 616d 6f75 6e74 280a 2020 2020  ncy_amount(.    
+00014760: 2020 2020 2020 2020 2020 2020 2874 6965              (tie
+00014770: 725f 315b 2275 6e69 745f 616d 6f75 6e74  r_1["unit_amount
+00014780: 225d 206f 7220 3029 202f 2031 3030 2c20  "] or 0) / 100, 
+00014790: 7365 6c66 2e63 7572 7265 6e63 790a 2020  self.currency.  
+000147a0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+000147b0: 2020 2020 2020 2020 616d 6f75 6e74 203d          amount =
+000147c0: 2066 2253 7461 7274 7320 6174 207b 666f   f"Starts at {fo
+000147d0: 726d 6174 7465 645f 756e 6974 5f61 6d6f  rmatted_unit_amo
+000147e0: 756e 745f 7469 6572 5f31 7d20 7065 7220  unt_tier_1} per 
+000147f0: 756e 6974 220a 0a20 2020 2020 2020 2020  unit"..         
+00014800: 2020 2023 2073 7472 6970 6520 7368 6f77     # stripe show
+00014810: 7320 666c 6174 2066 6565 2065 7665 6e20  s flat fee even 
+00014820: 6966 2069 7420 6973 2073 6574 2074 6f20  if it is set to 
+00014830: 302e 3030 0a20 2020 2020 2020 2020 2020  0.00.           
+00014840: 2066 6c61 745f 616d 6f75 6e74 5f74 6965   flat_amount_tie
+00014850: 725f 3120 3d20 7469 6572 5f31 5b22 666c  r_1 = tier_1["fl
+00014860: 6174 5f61 6d6f 756e 7422 5d0a 2020 2020  at_amount"].    
+00014870: 2020 2020 2020 2020 6966 2066 6c61 745f          if flat_
+00014880: 616d 6f75 6e74 5f74 6965 725f 3120 6973  amount_tier_1 is
+00014890: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+000148a0: 2020 2020 2020 2020 2020 2066 6f72 6d61             forma
+000148b0: 7474 6564 5f66 6c61 745f 616d 6f75 6e74  tted_flat_amount
+000148c0: 5f74 6965 725f 3120 3d20 6765 745f 6672  _tier_1 = get_fr
+000148d0: 6965 6e64 6c79 5f63 7572 7265 6e63 795f  iendly_currency_
+000148e0: 616d 6f75 6e74 280a 2020 2020 2020 2020  amount(.        
+000148f0: 2020 2020 2020 2020 2020 2020 666c 6174              flat
+00014900: 5f61 6d6f 756e 745f 7469 6572 5f31 202f  _amount_tier_1 /
+00014910: 2031 3030 2c20 7365 6c66 2e63 7572 7265   100, self.curre
+00014920: 6e63 790a 2020 2020 2020 2020 2020 2020  ncy.            
+00014930: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00014940: 2020 2020 2020 616d 6f75 6e74 203d 2066        amount = f
+00014950: 227b 616d 6f75 6e74 7d20 2b20 7b66 6f72  "{amount} + {for
+00014960: 6d61 7474 6564 5f66 6c61 745f 616d 6f75  matted_flat_amou
+00014970: 6e74 5f74 6965 725f 317d 220a 0a20 2020  nt_tier_1}"..   
+00014980: 2020 2020 2066 6f72 6d61 745f 6172 6773       format_args
+00014990: 203d 207b 2261 6d6f 756e 7422 3a20 616d   = {"amount": am
+000149a0: 6f75 6e74 7d0a 0a20 2020 2020 2020 2069  ount}..        i
+000149b0: 6620 7365 6c66 2e72 6563 7572 7269 6e67  f self.recurring
+000149c0: 3a0a 2020 2020 2020 2020 2020 2020 696e  :.            in
+000149d0: 7465 7276 616c 5f63 6f75 6e74 203d 2073  terval_count = s
+000149e0: 656c 662e 7265 6375 7272 696e 675b 2269  elf.recurring["i
+000149f0: 6e74 6572 7661 6c5f 636f 756e 7422 5d0a  nterval_count"].
+00014a00: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+00014a10: 6e74 6572 7661 6c5f 636f 756e 7420 3d3d  nterval_count ==
+00014a20: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+00014a30: 2020 2020 696e 7465 7276 616c 203d 207b      interval = {
+00014a40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014a50: 2020 2020 2022 6461 7922 3a20 5f28 2264       "day": _("d
+00014a60: 6179 2229 2c0a 2020 2020 2020 2020 2020  ay"),.          
+00014a70: 2020 2020 2020 2020 2020 2277 6565 6b22            "week"
+00014a80: 3a20 5f28 2277 6565 6b22 292c 0a20 2020  : _("week"),.   
+00014a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014aa0: 2022 6d6f 6e74 6822 3a20 5f28 226d 6f6e   "month": _("mon
+00014ab0: 7468 2229 2c0a 2020 2020 2020 2020 2020  th"),.          
+00014ac0: 2020 2020 2020 2020 2020 2279 6561 7222            "year"
+00014ad0: 3a20 5f28 2279 6561 7222 292c 0a20 2020  : _("year"),.   
+00014ae0: 2020 2020 2020 2020 2020 2020 207d 5b73               }[s
+00014af0: 656c 662e 7265 6375 7272 696e 675b 2269  elf.recurring["i
+00014b00: 6e74 6572 7661 6c22 5d5d 0a20 2020 2020  nterval"]].     
+00014b10: 2020 2020 2020 2020 2020 2074 656d 706c             templ
+00014b20: 6174 6520 3d20 5f28 227b 616d 6f75 6e74  ate = _("{amount
+00014b30: 7d2f 7b69 6e74 6572 7661 6c7d 2229 0a20  }/{interval}"). 
+00014b40: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00014b50: 6f72 6d61 745f 6172 6773 5b22 696e 7465  ormat_args["inte
+00014b60: 7276 616c 225d 203d 2069 6e74 6572 7661  rval"] = interva
+00014b70: 6c0a 2020 2020 2020 2020 2020 2020 656c  l.            el
+00014b80: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00014b90: 2020 2020 696e 7465 7276 616c 203d 207b      interval = {
+00014ba0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014bb0: 2020 2020 2022 6461 7922 3a20 5f28 2264       "day": _("d
+00014bc0: 6179 7322 292c 0a20 2020 2020 2020 2020  ays"),.         
+00014bd0: 2020 2020 2020 2020 2020 2022 7765 656b             "week
+00014be0: 223a 205f 2822 7765 656b 7322 292c 0a20  ": _("weeks"),. 
+00014bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014c00: 2020 2022 6d6f 6e74 6822 3a20 5f28 226d     "month": _("m
+00014c10: 6f6e 7468 7322 292c 0a20 2020 2020 2020  onths"),.       
+00014c20: 2020 2020 2020 2020 2020 2020 2022 7965               "ye
+00014c30: 6172 223a 205f 2822 7965 6172 7322 292c  ar": _("years"),
+00014c40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014c50: 207d 5b73 656c 662e 7265 6375 7272 696e   }[self.recurrin
+00014c60: 675b 2269 6e74 6572 7661 6c22 5d5d 0a20  g["interval"]]. 
+00014c70: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00014c80: 656d 706c 6174 6520 3d20 5f28 227b 616d  emplate = _("{am
+00014c90: 6f75 6e74 7d20 2f20 6576 6572 7920 7b69  ount} / every {i
+00014ca0: 6e74 6572 7661 6c5f 636f 756e 747d 207b  nterval_count} {
+00014cb0: 696e 7465 7276 616c 7d22 290a 2020 2020  interval}").    
+00014cc0: 2020 2020 2020 2020 2020 2020 666f 726d              form
+00014cd0: 6174 5f61 7267 735b 2269 6e74 6572 7661  at_args["interva
+00014ce0: 6c22 5d20 3d20 696e 7465 7276 616c 0a20  l"] = interval. 
+00014cf0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00014d00: 6f72 6d61 745f 6172 6773 5b22 696e 7465  ormat_args["inte
+00014d10: 7276 616c 5f63 6f75 6e74 225d 203d 2069  rval_count"] = i
+00014d20: 6e74 6572 7661 6c5f 636f 756e 740a 0a20  nterval_count.. 
+00014d30: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00014d40: 2020 2020 2020 2020 2074 656d 706c 6174           templat
+00014d50: 6520 3d20 5f28 227b 616d 6f75 6e74 7d20  e = _("{amount} 
+00014d60: 286f 6e65 2074 696d 6529 2229 0a0a 2020  (one time)")..  
+00014d70: 2020 2020 2020 7265 7475 726e 2066 6f72        return for
+00014d80: 6d61 745f 6c61 7a79 2874 656d 706c 6174  mat_lazy(templat
+00014d90: 652c 202a 2a66 6f72 6d61 745f 6172 6773  e, **format_args
+00014da0: 290a 0a0a 636c 6173 7320 5265 6675 6e64  )...class Refund
+00014db0: 2853 7472 6970 654d 6f64 656c 293a 0a20  (StripeModel):. 
+00014dc0: 2020 2022 2222 0a20 2020 2052 6566 756e     """.    Refun
+00014dd0: 6420 6f62 6a65 6374 7320 616c 6c6f 7720  d objects allow 
+00014de0: 796f 7520 746f 2072 6566 756e 6420 6120  you to refund a 
+00014df0: 6368 6172 6765 2074 6861 7420 6861 7320  charge that has 
+00014e00: 7072 6576 696f 7573 6c79 2062 6565 6e20  previously been 
+00014e10: 6372 6561 7465 640a 2020 2020 6275 7420  created.    but 
+00014e20: 6e6f 7420 7965 7420 7265 6675 6e64 6564  not yet refunded
+00014e30: 2e20 4675 6e64 7320 7769 6c6c 2062 6520  . Funds will be 
+00014e40: 7265 6675 6e64 6564 2074 6f20 7468 6520  refunded to the 
+00014e50: 6372 6564 6974 206f 7220 6465 6269 7420  credit or debit 
+00014e60: 6361 7264 0a20 2020 2074 6861 7420 7761  card.    that wa
+00014e70: 7320 6f72 6967 696e 616c 6c79 2063 6861  s originally cha
+00014e80: 7267 6564 2e0a 0a20 2020 2053 7472 6970  rged...    Strip
+00014e90: 6520 646f 6375 6d65 6e74 6174 696f 6e3a  e documentation:
+00014ea0: 2068 7474 7073 3a2f 2f73 7472 6970 652e   https://stripe.
+00014eb0: 636f 6d2f 646f 6373 2f61 7069 3f6c 616e  com/docs/api?lan
+00014ec0: 673d 7079 7468 6f6e 2372 6566 756e 645f  g=python#refund_
+00014ed0: 6f62 6a65 6374 0a20 2020 2022 2222 0a0a  object.    """..
+00014ee0: 2020 2020 7374 7269 7065 5f63 6c61 7373      stripe_class
+00014ef0: 203d 2073 7472 6970 652e 5265 6675 6e64   = stripe.Refund
+00014f00: 0a0a 2020 2020 616d 6f75 6e74 203d 2053  ..    amount = S
+00014f10: 7472 6970 6551 7561 6e74 756d 4375 7272  tripeQuantumCurr
+00014f20: 656e 6379 416d 6f75 6e74 4669 656c 6428  encyAmountField(
+00014f30: 6865 6c70 5f74 6578 743d 2241 6d6f 756e  help_text="Amoun
+00014f40: 742c 2069 6e20 6365 6e74 732e 2229 0a20  t, in cents."). 
+00014f50: 2020 2062 616c 616e 6365 5f74 7261 6e73     balance_trans
+00014f60: 6163 7469 6f6e 203d 2053 7472 6970 6546  action = StripeF
+00014f70: 6f72 6569 676e 4b65 7928 0a20 2020 2020  oreignKey(.     
+00014f80: 2020 2022 4261 6c61 6e63 6554 7261 6e73     "BalanceTrans
+00014f90: 6163 7469 6f6e 222c 0a20 2020 2020 2020  action",.       
+00014fa0: 206f 6e5f 6465 6c65 7465 3d6d 6f64 656c   on_delete=model
+00014fb0: 732e 5345 545f 4e55 4c4c 2c0a 2020 2020  s.SET_NULL,.    
+00014fc0: 2020 2020 6e75 6c6c 3d54 7275 652c 0a20      null=True,. 
+00014fd0: 2020 2020 2020 2068 656c 705f 7465 7874         help_text
+00014fe0: 3d28 0a20 2020 2020 2020 2020 2020 2022  =(.            "
+00014ff0: 4261 6c61 6e63 6520 7472 616e 7361 6374  Balance transact
+00015000: 696f 6e20 7468 6174 2064 6573 6372 6962  ion that describ
+00015010: 6573 2074 6865 2069 6d70 6163 7420 6f6e  es the impact on
+00015020: 2079 6f75 7220 6163 636f 756e 7420 6261   your account ba
+00015030: 6c61 6e63 652e 220a 2020 2020 2020 2020  lance.".        
+00015040: 292c 0a20 2020 2029 0a20 2020 2063 6861  ),.    ).    cha
+00015050: 7267 6520 3d20 5374 7269 7065 466f 7265  rge = StripeFore
+00015060: 6967 6e4b 6579 280a 2020 2020 2020 2020  ignKey(.        
+00015070: 2243 6861 7267 6522 2c0a 2020 2020 2020  "Charge",.      
+00015080: 2020 6f6e 5f64 656c 6574 653d 6d6f 6465    on_delete=mode
+00015090: 6c73 2e43 4153 4341 4445 2c0a 2020 2020  ls.CASCADE,.    
+000150a0: 2020 2020 7265 6c61 7465 645f 6e61 6d65      related_name
+000150b0: 3d22 7265 6675 6e64 7322 2c0a 2020 2020  ="refunds",.    
+000150c0: 2020 2020 6865 6c70 5f74 6578 743d 2254      help_text="T
+000150d0: 6865 2063 6861 7267 6520 7468 6174 2077  he charge that w
+000150e0: 6173 2072 6566 756e 6465 6422 2c0a 2020  as refunded",.  
+000150f0: 2020 290a 2020 2020 6375 7272 656e 6379    ).    currency
+00015100: 203d 2053 7472 6970 6543 7572 7265 6e63   = StripeCurrenc
+00015110: 7943 6f64 6546 6965 6c64 2829 0a20 2020  yCodeField().   
+00015120: 2066 6169 6c75 7265 5f62 616c 616e 6365   failure_balance
+00015130: 5f74 7261 6e73 6163 7469 6f6e 203d 2053  _transaction = S
+00015140: 7472 6970 6546 6f72 6569 676e 4b65 7928  tripeForeignKey(
+00015150: 0a20 2020 2020 2020 2022 4261 6c61 6e63  .        "Balanc
+00015160: 6554 7261 6e73 6163 7469 6f6e 222c 0a20  eTransaction",. 
+00015170: 2020 2020 2020 206f 6e5f 6465 6c65 7465         on_delete
+00015180: 3d6d 6f64 656c 732e 5345 545f 4e55 4c4c  =models.SET_NULL
+00015190: 2c0a 2020 2020 2020 2020 7265 6c61 7465  ,.        relate
+000151a0: 645f 6e61 6d65 3d22 6661 696c 7572 655f  d_name="failure_
+000151b0: 7265 6675 6e64 7322 2c0a 2020 2020 2020  refunds",.      
+000151c0: 2020 6e75 6c6c 3d54 7275 652c 0a20 2020    null=True,.   
+000151d0: 2020 2020 2062 6c61 6e6b 3d54 7275 652c       blank=True,
+000151e0: 0a20 2020 2020 2020 2068 656c 705f 7465  .        help_te
+000151f0: 7874 3d28 0a20 2020 2020 2020 2020 2020  xt=(.           
+00015200: 2022 4966 2074 6865 2072 6566 756e 6420   "If the refund 
+00015210: 6661 696c 6564 2c20 7468 6973 2062 616c  failed, this bal
+00015220: 616e 6365 2074 7261 6e73 6163 7469 6f6e  ance transaction
+00015230: 2064 6573 6372 6962 6573 2074 6865 2022   describes the "
+00015240: 0a20 2020 2020 2020 2020 2020 2022 6164  .            "ad
+00015250: 6a75 7374 6d65 6e74 206d 6164 6520 6f6e  justment made on
+00015260: 2079 6f75 7220 6163 636f 756e 7420 6261   your account ba
+00015270: 6c61 6e63 6520 7468 6174 2072 6576 6572  lance that rever
+00015280: 7365 7320 7468 6520 696e 6974 6961 6c20  ses the initial 
+00015290: 220a 2020 2020 2020 2020 2020 2020 2262  ".            "b
+000152a0: 616c 616e 6365 2074 7261 6e73 6163 7469  alance transacti
+000152b0: 6f6e 2e22 0a20 2020 2020 2020 2029 2c0a  on.".        ),.
+000152c0: 2020 2020 290a 2020 2020 6661 696c 7572      ).    failur
+000152d0: 655f 7265 6173 6f6e 203d 2053 7472 6970  e_reason = Strip
+000152e0: 6545 6e75 6d46 6965 6c64 280a 2020 2020  eEnumField(.    
+000152f0: 2020 2020 656e 756d 3d65 6e75 6d73 2e52      enum=enums.R
+00015300: 6566 756e 6446 6169 6c75 7265 5265 6173  efundFailureReas
+00015310: 6f6e 2c0a 2020 2020 2020 2020 6465 6661  on,.        defa
+00015320: 756c 743d 2222 2c0a 2020 2020 2020 2020  ult="",.        
+00015330: 626c 616e 6b3d 5472 7565 2c0a 2020 2020  blank=True,.    
+00015340: 2020 2020 6865 6c70 5f74 6578 743d 2249      help_text="I
+00015350: 6620 7468 6520 7265 6675 6e64 2066 6169  f the refund fai
+00015360: 6c65 642c 2074 6865 2072 6561 736f 6e20  led, the reason 
+00015370: 666f 7220 7265 6675 6e64 2066 6169 6c75  for refund failu
+00015380: 7265 2069 6620 6b6e 6f77 6e2e 222c 0a20  re if known.",. 
+00015390: 2020 2029 0a20 2020 2072 6561 736f 6e20     ).    reason 
+000153a0: 3d20 5374 7269 7065 456e 756d 4669 656c  = StripeEnumFiel
+000153b0: 6428 0a20 2020 2020 2020 2065 6e75 6d3d  d(.        enum=
+000153c0: 656e 756d 732e 5265 6675 6e64 5265 6173  enums.RefundReas
+000153d0: 6f6e 2c0a 2020 2020 2020 2020 626c 616e  on,.        blan
+000153e0: 6b3d 5472 7565 2c0a 2020 2020 2020 2020  k=True,.        
+000153f0: 6465 6661 756c 743d 2222 2c0a 2020 2020  default="",.    
+00015400: 2020 2020 6865 6c70 5f74 6578 743d 2252      help_text="R
+00015410: 6561 736f 6e20 666f 7220 7468 6520 7265  eason for the re
+00015420: 6675 6e64 2e22 2c0a 2020 2020 290a 2020  fund.",.    ).  
+00015430: 2020 7265 6365 6970 745f 6e75 6d62 6572    receipt_number
+00015440: 203d 206d 6f64 656c 732e 4368 6172 4669   = models.CharFi
+00015450: 656c 6428 0a20 2020 2020 2020 206d 6178  eld(.        max
+00015460: 5f6c 656e 6774 683d 392c 0a20 2020 2020  _length=9,.     
+00015470: 2020 2064 6566 6175 6c74 3d22 222c 0a20     default="",. 
+00015480: 2020 2020 2020 2062 6c61 6e6b 3d54 7275         blank=Tru
+00015490: 652c 0a20 2020 2020 2020 2068 656c 705f  e,.        help_
+000154a0: 7465 7874 3d28 0a20 2020 2020 2020 2020  text=(.         
+000154b0: 2020 2022 5468 6520 7472 616e 7361 6374     "The transact
+000154c0: 696f 6e20 6e75 6d62 6572 2074 6861 7420  ion number that 
+000154d0: 6170 7065 6172 7320 6f6e 2065 6d61 696c  appears on email
+000154e0: 2072 6563 6569 7074 7320 7365 6e74 2022   receipts sent "
+000154f0: 0a20 2020 2020 2020 2020 2020 2022 666f  .            "fo
+00015500: 7220 7468 6973 2063 6861 7267 652e 220a  r this charge.".
+00015510: 2020 2020 2020 2020 292c 0a20 2020 2029          ),.    )
+00015520: 0a20 2020 2073 7461 7475 7320 3d20 5374  .    status = St
+00015530: 7269 7065 456e 756d 4669 656c 6428 0a20  ripeEnumField(. 
+00015540: 2020 2020 2020 2062 6c61 6e6b 3d54 7275         blank=Tru
+00015550: 652c 2065 6e75 6d3d 656e 756d 732e 5265  e, enum=enums.Re
+00015560: 6675 6e64 5374 6174 7573 2c20 6865 6c70  fundStatus, help
+00015570: 5f74 6578 743d 2253 7461 7475 7320 6f66  _text="Status of
+00015580: 2074 6865 2072 6566 756e 642e 220a 2020   the refund.".  
+00015590: 2020 290a 2020 2020 2320 746f 646f 2069    ).    # todo i
+000155a0: 6d70 6c65 6d65 6e74 2073 6f75 7263 655f  mplement source_
+000155b0: 7472 616e 7366 6572 5f72 6576 6572 7361  transfer_reversa
+000155c0: 6c20 616e 6420 7472 616e 7366 6572 5f72  l and transfer_r
+000155d0: 6576 6572 7361 6c0a 0a20 2020 2064 6566  eversal..    def
+000155e0: 2067 6574 5f73 7472 6970 655f 6461 7368   get_stripe_dash
+000155f0: 626f 6172 645f 7572 6c28 7365 6c66 293a  board_url(self):
+00015600: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00015610: 7365 6c66 2e63 6861 7267 652e 6765 745f  self.charge.get_
+00015620: 7374 7269 7065 5f64 6173 6862 6f61 7264  stripe_dashboard
+00015630: 5f75 726c 2829 0a0a 2020 2020 6465 6620  _url()..    def 
+00015640: 5f5f 7374 725f 5f28 7365 6c66 293a 0a20  __str__(self):. 
+00015650: 2020 2020 2020 2061 6d6f 756e 7420 3d20         amount = 
+00015660: 6765 745f 6672 6965 6e64 6c79 5f63 7572  get_friendly_cur
+00015670: 7265 6e63 795f 616d 6f75 6e74 2873 656c  rency_amount(sel
+00015680: 662e 616d 6f75 6e74 202f 2031 3030 2c20  f.amount / 100, 
+00015690: 7365 6c66 2e63 7572 7265 6e63 7929 0a20  self.currency). 
+000156a0: 2020 2020 2020 2073 7461 7475 7320 3d20         status = 
+000156b0: 656e 756d 732e 5265 6675 6e64 5374 6174  enums.RefundStat
+000156c0: 7573 2e68 756d 616e 697a 6528 7365 6c66  us.humanize(self
+000156d0: 2e73 7461 7475 7329 0a20 2020 2020 2020  .status).       
+000156e0: 2072 6574 7572 6e20 6622 7b61 6d6f 756e   return f"{amoun
+000156f0: 747d 2028 7b73 7461 7475 737d 2922 0a    t} ({status})".
```

### Comparing `dj_stripe-2.7.3/djstripe/models/orders.py` & `dj_stripe-2.8.0a0/djstripe/models/orders.py`

 * *Files 9% similar despite different names*

```diff
@@ -1,39 +1,54 @@
 import stripe
 from django.db import models
 
+from djstripe.models.billing import Discount
+from djstripe.settings import djstripe_settings
+
 from ..enums import OrderStatus
 from ..fields import (
     JSONField,
     StripeCurrencyCodeField,
     StripeEnumField,
     StripeForeignKey,
     StripeQuantumCurrencyAmountField,
 )
+from ..settings import djstripe_settings
 from .base import StripeModel
 
 
 class Order(StripeModel):
     """
     An Order describes a purchase being made by a customer,
     including the products & quantities being purchased, the order status,
     the payment information, and the billing/shipping details.
 
     Stripe documentation: https://stripe.com/docs/api/orders_v2/object?lang=python
     """
 
     stripe_class = stripe.Order
-    expand_fields = ["customer", "line_items", "total_details.breakdown"]
+    expand_fields = ["customer", "line_items", "discounts", "total_details.breakdown"]
     stripe_dashboard_item_name = "orders"
 
     amount_subtotal = StripeQuantumCurrencyAmountField(
-        help_text="Order cost before any discounts or taxes are applied. A positive integer representing the subtotal of the order in the smallest currency unit (e.g., 100 cents to charge $1.00 or 100 to charge 100, a zero-decimal currency)."
+        help_text=(
+            "Order cost before any discounts or taxes are applied. A positive integer"
+            " representing the subtotal of the order in the smallest currency unit"
+            " (e.g., 100 cents to charge $1.00 or 100 to charge 100, a zero-decimal"
+            " currency)."
+        )
     )
     amount_total = StripeQuantumCurrencyAmountField(
-        help_text="Total order cost after discounts and taxes are applied. A positive integer representing the cost of the order in the smallest currency unit (e.g., 100 cents to charge $1.00 or 100 to charge 100, a zero-decimal currency). To submit an order, the total must be either 0 or at least $0.50 USD or equivalent in charge currency."
+        help_text=(
+            "Total order cost after discounts and taxes are applied. A positive integer"
+            " representing the cost of the order in the smallest currency unit (e.g.,"
+            " 100 cents to charge $1.00 or 100 to charge 100, a zero-decimal"
+            " currency). To submit an order, the total must be either 0 or at least"
+            " $0.50 USD or equivalent in charge currency."
+        )
     )
     application = models.CharField(
         max_length=255,
         blank=True,
         help_text="ID of the Connect application that created the Order, if any.",
     )
     automatic_tax = JSONField(
@@ -48,15 +63,18 @@
         max_length=5000,
         help_text=(
             "The client secret of this PaymentIntent. "
             "Used for client-side retrieval using a publishable key."
         ),
     )
     currency = StripeCurrencyCodeField(
-        help_text="Three-letter ISO currency code, in lowercase. Must be a supported currency."
+        help_text=(
+            "Three-letter ISO currency code, in lowercase. Must be a supported"
+            " currency."
+        )
     )
     # not deleting order when customer is deleted, because order may be important for taxation and audit purposes
     customer = StripeForeignKey(
         "Customer",
         on_delete=models.SET_NULL,
         null=True,
         blank=True,
@@ -66,33 +84,49 @@
         null=True,
         blank=True,
         help_text="The discounts applied to the order.",
     )
     ip_address = models.GenericIPAddressField(
         null=True,
         blank=True,
-        help_text="A recent IP address of the purchaser used for tax reporting and tax location inference.",
+        help_text=(
+            "A recent IP address of the purchaser used for tax reporting and tax"
+            " location inference."
+        ),
     )
     line_items = JSONField(
-        help_text="A list of line items the customer is ordering. Each line item includes information about the product, the quantity, and the resulting cost. There is a maximum of 100 line items.",
+        help_text=(
+            "A list of line items the customer is ordering. Each line item includes"
+            " information about the product, the quantity, and the resulting cost."
+            " There is a maximum of 100 line items."
+        ),
     )
     payment = JSONField(
-        help_text="Payment information associated with the order. Includes payment status, settings, and a PaymentIntent ID",
+        help_text=(
+            "Payment information associated with the order. Includes payment status,"
+            " settings, and a PaymentIntent ID"
+        ),
     )
     payment_intent = StripeForeignKey(
         "PaymentIntent",
         on_delete=models.SET_NULL,
         null=True,
         blank=True,
-        help_text="ID of the payment intent associated with this order. Null when the order is open.",
+        help_text=(
+            "ID of the payment intent associated with this order. Null when the order"
+            " is open."
+        ),
     )
     shipping_cost = JSONField(
         null=True,
         blank=True,
-        help_text="The details of the customer cost of shipping, including the customer chosen ShippingRate.",
+        help_text=(
+            "The details of the customer cost of shipping, including the customer"
+            " chosen ShippingRate."
+        ),
     )
     shipping_details = JSONField(
         null=True,
         blank=True,
         help_text="Customer shipping information associated with the order.",
     )
     status = StripeEnumField(
@@ -100,15 +134,18 @@
     )
     tax_details = JSONField(
         null=True,
         blank=True,
         help_text="Tax details about the purchaser for this order.",
     )
     total_details = JSONField(
-        help_text="Tax, discount, and shipping details for the computed total amount of this order.",
+        help_text=(
+            "Tax, discount, and shipping details for the computed total amount of this"
+            " order."
+        ),
     )
 
     def __str__(self):
         template = f"on {self.created.strftime('%m/%d/%Y')} ({self.status})"
         if self.status in (OrderStatus.open, OrderStatus.canceled):
             return "Created " + template
         elif self.status in (
@@ -120,14 +157,29 @@
         return self.id
 
     @classmethod
     def _manipulate_stripe_object_hook(cls, data):
         data["payment_intent"] = data["payment"]["payment_intent"]
         return data
 
+    def _attach_objects_post_save_hook(
+        self,
+        cls,
+        data,
+        api_key=djstripe_settings.STRIPE_SECRET_KEY,
+        pending_relations=None,
+    ):
+        super()._attach_objects_post_save_hook(
+            cls, data, api_key=api_key, pending_relations=pending_relations
+        )
+
+        # sync every discount
+        for discount in self.discounts:
+            Discount.sync_from_stripe_data(discount, api_key=api_key)
+
     def cancel(self, api_key=None, stripe_account=None, **kwargs):
         """
         Cancels the order as well as the payment intent if one is attached.
 
         :param api_key: The api key to use for this request. \
             Defaults to djstripe_settings.STRIPE_SECRET_KEY.
         :type api_key: string
@@ -137,15 +189,19 @@
         """
         api_key = api_key or self.default_api_key
         # Prefer passed in stripe_account if set.
         if not stripe_account:
             stripe_account = self._get_stripe_account_id(api_key)
 
         return self.stripe_class.cancel(
-            self.id, api_key=api_key, stripe_account=stripe_account, **kwargs
+            self.id,
+            api_key=api_key,
+            stripe_account=stripe_account,
+            stripe_version=djstripe_settings.STRIPE_API_VERSION,
+            **kwargs,
         )
 
     def reopen(self, api_key=None, stripe_account=None, **kwargs):
         """
         Reopens a submitted order.
 
         :param api_key: The api key to use for this request. \
@@ -157,15 +213,19 @@
         """
         api_key = api_key or self.default_api_key
         # Prefer passed in stripe_account if set.
         if not stripe_account:
             stripe_account = self._get_stripe_account_id(api_key)
 
         return self.stripe_class.reopen(
-            self.id, api_key=api_key, stripe_account=stripe_account, **kwargs
+            self.id,
+            api_key=api_key,
+            stripe_account=stripe_account,
+            stripe_version=djstripe_settings.STRIPE_API_VERSION,
+            **kwargs,
         )
 
     def submit(self, api_key=None, stripe_account=None, **kwargs):
         """
         Submitting an Order transitions the status to processing and creates a PaymentIntent object
         so the order can be paid.
         If the Order has an amount_total of 0, no PaymentIntent object will be created.
@@ -181,9 +241,13 @@
         """
         api_key = api_key or self.default_api_key
         # Prefer passed in stripe_account if set.
         if not stripe_account:
             stripe_account = self._get_stripe_account_id(api_key)
 
         return self.stripe_class.submit(
-            self.id, api_key=api_key, stripe_account=stripe_account, **kwargs
+            self.id,
+            api_key=api_key,
+            stripe_account=stripe_account,
+            stripe_version=djstripe_settings.STRIPE_API_VERSION,
+            **kwargs,
         )
```

### Comparing `dj_stripe-2.7.3/djstripe/models/payment_methods.py` & `dj_stripe-2.8.0a0/djstripe/models/payment_methods.py`

 * *Files 10% similar despite different names*

```diff
@@ -46,15 +46,14 @@
 
         return instance
 
     @classmethod
     def _get_or_create_source(
         cls, data, source_type=None, api_key=djstripe_settings.STRIPE_SECRET_KEY
     ):
-
         # prefer passed in source_type
         if not source_type:
             source_type = data["object"]
 
         try:
             model = cls._model_for_type(source_type)
             model._get_or_create_from_stripe_object(data, api_key=api_key)
@@ -72,15 +71,15 @@
         elif type == "source":
             return Source
         elif type == "bank_account":
             return BankAccount
         elif type == "account":
             return Account
 
-        raise ValueError("Unknown source type: {}".format(type))
+        raise ValueError(f"Unknown source type: {type}")
 
     @property
     def object_model(self):
         return self._model_for_type(self.type)
 
     def resolve(self):
         return self.object_model.objects.get(id=self.id)
@@ -93,15 +92,14 @@
         refetch=True,
         current_ids=None,
         pending_relations=None,
         save=True,
         stripe_account=None,
         api_key=djstripe_settings.STRIPE_SECRET_KEY,
     ):
-
         raw_field_data = data.get(field_name)
         id_ = get_id_from_stripe_data(raw_field_data)
         if not id_:
             raise ValueError(f"ID not found in Stripe data: {raw_field_data!r}")
 
         if id_.startswith("card"):
             source_cls = Card
@@ -151,30 +149,29 @@
     @classmethod
     def _get_customer_or_account_from_kwargs(cls, **kwargs):
         account = kwargs.get("account")
         customer = kwargs.get("customer")
 
         if not account and not customer:
             raise StripeObjectManipulationException(
-                "{}s must be manipulated through either a Stripe Connected Account or a customer. "
-                "Pass a Customer or an Account object into this call.".format(
-                    cls.__name__
-                )
+                f"{cls.__name__} objects must be manipulated through either a "
+                "Stripe Connected Account or a customer. "
+                "Pass a Customer or an Account object into this call."
             )
 
         if account and not isinstance(account, Account):
             raise StripeObjectManipulationException(
-                "{}s must be manipulated through a Stripe Connected Account. "
-                "Pass an Account object into this call.".format(cls.__name__)
+                f"{cls.__name__} objects must be manipulated through a Stripe Connected"
+                " Account. Pass an Account object into this call."
             )
 
         if customer and not isinstance(customer, Customer):
             raise StripeObjectManipulationException(
-                "{}s must be manipulated through a Customer. "
-                "Pass a Customer object into this call.".format(cls.__name__)
+                f"{cls.__name__} objects must be manipulated through a Customer. "
+                "Pass a Customer object into this call."
             )
 
         if account:
             del kwargs["account"]
         if customer:
             del kwargs["customer"]
 
@@ -259,17 +256,18 @@
             return (
                 account.api_retrieve(api_key=api_key)
                 .external_accounts.list(object=object_name, **clean_kwargs)
                 .auto_paging_iter()
             )
 
         raise ImpossibleAPIRequest(
-            f"Can't list {object_name} without a customer or account object."
-            " This may happen if not all accounts or customer objects are in the db."
-            ' Please run "python manage.py djstripe_sync_models Account Customer" as a potential fix.'
+            f"Can't list {object_name} without a customer or account object. This may"
+            " happen if not all accounts or customer objects are in the db. Please run"
+            ' "python manage.py djstripe_sync_models Account Customer" as a potential'
+            " fix."
         )
 
     def get_stripe_dashboard_url(self) -> str:
         if self.customer:
             return self.customer.get_stripe_dashboard_url()
         elif self.account:
             return f"https://dashboard.stripe.com/{self.account.id}/settings/payouts"
@@ -306,30 +304,33 @@
         if self.customer:
             return stripe.Customer.retrieve_source(
                 self.customer.id,
                 self.id,
                 expand=self.expand_fields,
                 stripe_account=stripe_account,
                 api_key=api_key,
+                stripe_version=djstripe_settings.STRIPE_API_VERSION,
             )
 
         # try to retrieve by account attribute if retrieval by customer fails.
         if self.account:
             return stripe.Account.retrieve_external_account(
                 self.account.id,
                 self.id,
                 expand=self.expand_fields,
                 stripe_account=stripe_account,
                 api_key=api_key,
+                stripe_version=djstripe_settings.STRIPE_API_VERSION,
             )
 
         raise ImpossibleAPIRequest(
             f"Can't retrieve {self.__class__} without a customer or account object."
             " This may happen if not all accounts or customer objects are in the db."
-            ' Please run "python manage.py djstripe_sync_models Account Customer" as a potential fix.'
+            ' Please run "python manage.py djstripe_sync_models Account Customer" as a'
+            " potential fix."
         )
 
     def _api_delete(self, api_key=None, stripe_account=None, **kwargs):
         # OVERRIDING the parent version of this function
         # Cards & Banks Accounts must be manipulated through a customer or account.
 
         api_key = api_key or self.default_api_key
@@ -352,17 +353,18 @@
                 self.id,
                 api_key=api_key,
                 stripe_account=stripe_account,
                 **kwargs,
             )
 
         raise ImpossibleAPIRequest(
-            f"Can't delete {self.__class__} without a customer or account object."
-            " This may happen if not all accounts or customer objects are in the db."
-            ' Please run "python manage.py djstripe_sync_models Account Customer" as a potential fix.'
+            f"Can't delete {self.__class__} without a customer or account object. This"
+            " may happen if not all accounts or customer objects are in the db. Please"
+            ' run "python manage.py djstripe_sync_models Account Customer" as a'
+            " potential fix."
         )
 
 
 class BankAccount(LegacySourceMixin, StripeModel):
     """
     These bank accounts are payment methods on Customer objects.
     On the other hand External Accounts are transfer destinations on Account
@@ -375,44 +377,51 @@
 
     account = StripeForeignKey(
         "Account",
         on_delete=models.PROTECT,
         null=True,
         blank=True,
         related_name="bank_accounts",
-        help_text="The external account the charge was made on behalf of. Null here indicates "
-        "that this value was never set.",
+        help_text=(
+            "The external account the charge was made on behalf of. Null here indicates"
+            " that this value was never set."
+        ),
     )
     account_holder_name = models.TextField(
         max_length=5000,
         blank=True,
         help_text="The name of the person or business that owns the bank account.",
     )
     account_holder_type = StripeEnumField(
         enum=enums.BankAccountHolderType,
         help_text="The type of entity that holds the account.",
     )
     bank_name = models.CharField(
         max_length=255,
-        help_text="Name of the bank associated with the routing number "
-        "(e.g., `WELLS FARGO`).",
+        help_text=(
+            "Name of the bank associated with the routing number (e.g., `WELLS FARGO`)."
+        ),
     )
     country = models.CharField(
         max_length=2,
-        help_text="Two-letter ISO code representing the country the bank account "
-        "is located in.",
+        help_text=(
+            "Two-letter ISO code representing the country the bank account "
+            "is located in."
+        ),
     )
     currency = StripeCurrencyCodeField()
     customer = StripeForeignKey(
         "Customer", on_delete=models.SET_NULL, null=True, related_name="bank_account"
     )
     default_for_currency = models.BooleanField(
         null=True,
-        help_text="Whether this external account (BankAccount) is the default account for "
-        "its currency.",
+        help_text=(
+            "Whether this external account (BankAccount) is the default account for "
+            "its currency."
+        ),
     )
     fingerprint = models.CharField(
         max_length=16,
         help_text=(
             "Uniquely identifies this particular bank account. "
             "You can use this attribute to check whether two bank accounts are "
             "the same."
@@ -433,15 +442,18 @@
 
             if (default_payment_method and self.id == default_payment_method.id) or (
                 default_source and self.id == default_source.id
             ):
                 # current card is the default payment method or source
                 default = True
 
-            customer_template = f"{self.bank_name} {self.routing_number} ({self.human_readable_status}) {'Default' if default else ''} {self.currency}"
+            customer_template = (
+                f"{self.bank_name} {self.routing_number} ({self.human_readable_status})"
+                f" {'Default' if default else ''} {self.currency}"
+            )
             return customer_template
 
         default = getattr(self, "default_for_currency", False)
         account_template = f"{self.bank_name} {self.currency} {'Default' if default else ''} {self.routing_number} {self.last4}"
         return account_template
 
     @property
@@ -450,16 +462,17 @@
             return "Pending Verification"
         return enums.BankAccountStatus.humanize(self.status)
 
     def api_retrieve(self, **kwargs):
         if not self.customer and not self.account:
             raise ImpossibleAPIRequest(
                 "Can't retrieve a bank account without a customer or account object."
-                " This may happen if not all accounts or customer objects are in the db."
-                ' Please run "python manage.py djstripe_sync_models Account Customer" as a potential fix.'
+                " This may happen if not all accounts or customer objects are in the"
+                ' db. Please run "python manage.py djstripe_sync_models Account'
+                ' Customer" as a potential fix.'
             )
 
         return super().api_retrieve(**kwargs)
 
 
 class Card(LegacySourceMixin, StripeModel):
     """
@@ -480,16 +493,18 @@
     # Stripe Custom Connected Accounts can have cards as "Payout Sources"
     account = StripeForeignKey(
         "Account",
         on_delete=models.PROTECT,
         null=True,
         blank=True,
         related_name="cards",
-        help_text="The external account the charge was made on behalf of. Null here indicates "
-        "that this value was never set.",
+        help_text=(
+            "The external account the charge was made on behalf of. Null here indicates"
+            " that this value was never set."
+        ),
     )
     address_city = models.TextField(
         max_length=5000,
         blank=True,
         default="",
         help_text="City/District/Suburb/Town/Village.",
     )
@@ -543,23 +558,27 @@
         enum=enums.CardCheckResult,
         default="",
         blank=True,
         help_text="If a CVC was provided, results of the check.",
     )
     default_for_currency = models.BooleanField(
         null=True,
-        help_text="Whether this external account (Card) is the default account for "
-        "its currency.",
+        help_text=(
+            "Whether this external account (Card) is the default account for "
+            "its currency."
+        ),
     )
     dynamic_last4 = models.CharField(
         max_length=4,
         default="",
         blank=True,
-        help_text="(For tokenized numbers only.) The last four digits of the device "
-        "account number.",
+        help_text=(
+            "(For tokenized numbers only.) The last four digits of the device "
+            "account number."
+        ),
     )
     exp_month = models.IntegerField(help_text="Card expiration month.")
     exp_year = models.IntegerField(help_text="Card expiration year.")
     fingerprint = models.CharField(
         default="",
         blank=True,
         max_length=16,
@@ -588,15 +607,18 @@
 
             if (default_payment_method and self.id == default_payment_method.id) or (
                 default_source and self.id == default_source.id
             ):
                 # current card is the default payment method or source
                 default = True
 
-            customer_template = f"{enums.CardBrand.humanize(self.brand)} {self.last4} {'Default' if default else ''} Expires {self.exp_month} {self.exp_year}"
+            customer_template = (
+                f"{enums.CardBrand.humanize(self.brand)} {self.last4} {'Default' if default else ''} Expires"
+                f" {self.exp_month} {self.exp_year}"
+            )
             return customer_template
 
         elif self.account:
             default = getattr(self, "default_for_currency", False)
             account_template = f"{enums.CardBrand.humanize(self.brand)} {self.account.default_currency} {'Default' if default else ''} {self.last4}"
             return account_template
 
@@ -673,49 +695,61 @@
             "used or required by particular source types."
         )
     )
     statement_descriptor = models.CharField(
         max_length=255,
         default="",
         blank=True,
-        help_text="Extra information about a source. This will appear on your "
-        "customer's statement every time you charge the source.",
+        help_text=(
+            "Extra information about a source. This will appear on your "
+            "customer's statement every time you charge the source."
+        ),
     )
     status = StripeEnumField(
         enum=enums.SourceStatus,
-        help_text="The status of the source. Only `chargeable` sources can be used "
-        "to create a charge.",
+        help_text=(
+            "The status of the source. Only `chargeable` sources can be used "
+            "to create a charge."
+        ),
     )
     type = StripeEnumField(enum=enums.SourceType, help_text="The type of the source.")
     usage = StripeEnumField(
         enum=enums.SourceUsage,
-        help_text="Whether this source should be reusable or not. "
-        "Some source types may or may not be reusable by construction, "
-        "while other may leave the option at creation.",
+        help_text=(
+            "Whether this source should be reusable or not. "
+            "Some source types may or may not be reusable by construction, "
+            "while other may leave the option at creation."
+        ),
     )
 
     # Flows
     code_verification = JSONField(
         null=True,
         blank=True,
-        help_text="Information related to the code verification flow. "
-        "Present if the source is authenticated by a verification code "
-        "(`flow` is `code_verification`).",
+        help_text=(
+            "Information related to the code verification flow. "
+            "Present if the source is authenticated by a verification code "
+            "(`flow` is `code_verification`)."
+        ),
     )
     receiver = JSONField(
         null=True,
         blank=True,
-        help_text="Information related to the receiver flow. "
-        "Present if the source is a receiver (`flow` is `receiver`).",
+        help_text=(
+            "Information related to the receiver flow. "
+            "Present if the source is a receiver (`flow` is `receiver`)."
+        ),
     )
     redirect = JSONField(
         null=True,
         blank=True,
-        help_text="Information related to the redirect flow. "
-        "Present if the source is authenticated by a redirect (`flow` is `redirect`).",
+        help_text=(
+            "Information related to the redirect flow. Present if the source is"
+            " authenticated by a redirect (`flow` is `redirect`)."
+        ),
     )
 
     source_data = JSONField(help_text="The data corresponding to the source type.")
 
     customer = StripeForeignKey(
         "Customer",
         on_delete=models.SET_NULL,
@@ -784,18 +818,119 @@
         :param api_key: The api key to use for this request. \
             Defaults to djstripe_settings.STRIPE_SECRET_KEY.
         :type api_key: string
         See Stripe documentation for accepted kwargs for each object.
         :returns: an iterator over all items in the query
         """
         return Customer.stripe_class.list_sources(
-            object="source", api_key=api_key, **kwargs
+            object="source",
+            api_key=api_key,
+            stripe_version=djstripe_settings.STRIPE_API_VERSION,
+            **kwargs,
         ).auto_paging_iter()
 
 
+class SourceTransaction(StripeModel):
+    """
+    Stripe documentation: https://stripe.com/docs/sources/ach-credit-transfer#source-transactions
+    """
+
+    stripe_class = stripe.SourceTransaction
+    stripe_dashboard_item_name = "source_transactions"
+
+    description = None
+    metadata = None
+    type = enums.SourceType.ach_credit_transfer
+
+    ach_credit_transfer = JSONField(
+        help_text="The data corresponding to the ach_credit_transfer type."
+    )
+    amount = StripeDecimalCurrencyAmountField(
+        null=True,
+        blank=True,
+        help_text=(
+            "Amount (as decimal) associated with the ACH Credit Transfer. This is the"
+            " amount your customer has sent for which the source will be chargeable"
+            " once ready. "
+        ),
+    )
+    currency = StripeCurrencyCodeField()
+
+    # did not use CharField because no idea about possible max-length
+    customer_data = JSONField(
+        null=True,
+        blank=True,
+        help_text="Customer defined string used to initiate the ACH Credit Transfer.",
+    )
+    # source cannot be null but we are allowing this because the order of webhooks is not deterministic
+    source = StripeForeignKey(
+        "Source",
+        on_delete=models.SET_NULL,
+        null=True,
+        blank=True,
+    )
+    status = StripeEnumField(
+        enum=enums.SourceTransactionStatus,
+        help_text=(
+            "The status of the ACH Credit Transfer. Only `chargeable` sources can be"
+            " used to create a charge."
+        ),
+    )
+
+    def __str__(self):
+        return f"Source Transaction status={self.status}, source={self.source.id}"
+
+    def get_stripe_dashboard_url(self) -> str:
+        """Get the stripe dashboard url for this object."""
+        if (
+            not self.stripe_dashboard_item_name
+            or not self.id
+            or not self.source
+            or not self.source.id
+        ):
+            return ""
+        else:
+            return f"{self._get_base_stripe_dashboard_url()}sources/{self.source.id}"
+
+    @classmethod
+    def api_list(cls, api_key=djstripe_settings.STRIPE_SECRET_KEY, **kwargs):
+        """
+        Call the stripe API's list operation for this model.
+        :param api_key: The api key to use for this request. \
+            Defaults to djstripe_settings.STRIPE_SECRET_KEY.
+        :type api_key: string
+        See Stripe documentation for accepted kwargs for each object.
+        :returns: an iterator over all items in the query
+        """
+        return stripe.Source.list_source_transactions(
+            api_key=api_key, **kwargs
+        ).auto_paging_iter()
+
+    def api_retrieve(self, api_key=None, stripe_account=None):
+        """
+        Call the stripe API's retrieve operation for this model.
+
+        :param api_key: The api key to use for this request. \
+            Defaults to djstripe_settings.STRIPE_SECRET_KEY.
+        :type api_key: string
+        :param stripe_account: The optional connected account \
+            for which this request is being made.
+        :type stripe_account: string
+        """
+        # Prefer passed in stripe_account if set.
+        if not stripe_account:
+            stripe_account = self._get_stripe_account_id(api_key)
+
+        for source_trx in SourceTransaction.api_list(
+            id=self.source.id, api_key=api_key, stripe_account=stripe_account
+        ):
+            if source_trx.id == self.id:
+                return source_trx
+
+
 class PaymentMethod(StripeModel):
     """
     PaymentMethod objects represent your customer's payment instruments.
     You can use them with PaymentIntents to collect payments or save them
     to Customer objects to store instrument details for future payments.
 
     Stripe documentation: https://stripe.com/docs/api?lang=python#payment_methods
@@ -827,18 +962,25 @@
         help_text="The type of the PaymentMethod.",
     )
     acss_debit = JSONField(
         null=True,
         blank=True,
         help_text="Additional information for payment methods of type `acss_debit`",
     )
+    affirm = JSONField(
+        null=True,
+        blank=True,
+        help_text="Additional information for payment methods of type `affirm`",
+    )
     afterpay_clearpay = JSONField(
         null=True,
         blank=True,
-        help_text="Additional information for payment methods of type `afterpay_clearpay`",
+        help_text=(
+            "Additional information for payment methods of type `afterpay_clearpay`"
+        ),
     )
     alipay = JSONField(
         null=True,
         blank=True,
         help_text="Additional information for payment methods of type `alipay`",
     )
     au_becs_debit = JSONField(
@@ -852,14 +994,19 @@
         help_text="Additional information for payment methods of type `bacs_debit`",
     )
     bancontact = JSONField(
         null=True,
         blank=True,
         help_text="Additional information for payment methods of type `bancontact`",
     )
+    blik = JSONField(
+        null=True,
+        blank=True,
+        help_text="Additional information for payment methods of type `blik`",
+    )
     boleto = JSONField(
         null=True,
         blank=True,
         help_text="Additional information for payment methods of type `boleto`",
     )
     card = JSONField(
         null=True,
@@ -867,14 +1014,21 @@
         help_text="Additional information for payment methods of type `card`",
     )
     card_present = JSONField(
         null=True,
         blank=True,
         help_text="Additional information for payment methods of type `card_present`",
     )
+    customer_balance = JSONField(
+        null=True,
+        blank=True,
+        help_text=(
+            "Additional information for payment methods of type `customer_balance`"
+        ),
+    )
     eps = JSONField(
         null=True,
         blank=True,
         help_text="Additional information for payment methods of type `eps`",
     )
     fpx = JSONField(
         null=True,
@@ -899,44 +1053,84 @@
     interac_present = JSONField(
         null=True,
         blank=True,
         help_text=(
             "Additional information for payment methods of type `interac_present`"
         ),
     )
+    klarna = JSONField(
+        null=True,
+        blank=True,
+        help_text="Additional information for payment methods of type `klarna`",
+    )
+    konbini = JSONField(
+        null=True,
+        blank=True,
+        help_text="Additional information for payment methods of type `konbini`",
+    )
+    link = JSONField(
+        null=True,
+        blank=True,
+        help_text="Additional information for payment methods of type `link`",
+    )
     oxxo = JSONField(
         null=True,
         blank=True,
         help_text="Additional information for payment methods of type `oxxo`",
     )
     p24 = JSONField(
         null=True,
         blank=True,
         help_text="Additional information for payment methods of type `p24`",
     )
+    paynow = JSONField(
+        null=True,
+        blank=True,
+        help_text="Additional information for payment methods of type `paynow`",
+    )
+    pix = JSONField(
+        null=True,
+        blank=True,
+        help_text="Additional information for payment methods of type `pix`",
+    )
+    promptpay = JSONField(
+        null=True,
+        blank=True,
+        help_text="Additional information for payment methods of type `promptpay`",
+    )
     sepa_debit = JSONField(
         null=True,
         blank=True,
         help_text="Additional information for payment methods of type `sepa_debit`",
     )
     sofort = JSONField(
         null=True,
         blank=True,
         help_text="Additional information for payment methods of type `sofort`",
     )
+    us_bank_account = JSONField(
+        null=True,
+        blank=True,
+        help_text=(
+            "Additional information for payment methods of type `us_bank_account`"
+        ),
+    )
     wechat_pay = JSONField(
         null=True,
         blank=True,
         help_text="Additional information for payment methods of type `wechat_pay`",
     )
 
     def __str__(self):
         if self.customer:
             return f"{enums.PaymentMethodType.humanize(self.type)} for {self.customer}"
-        return f"{enums.PaymentMethodType.humanize(self.type)} is not associated with any customer"
+        return (
+            f"{enums.PaymentMethodType.humanize(self.type)} is not associated with any"
+            " customer"
+        )
 
     def get_stripe_dashboard_url(self) -> str:
         if self.customer:
             return self.customer.get_stripe_dashboard_url()
         return ""
 
     def _attach_objects_hook(
```

### Comparing `dj_stripe-2.7.3/djstripe/models/sigma.py` & `dj_stripe-2.8.0a0/djstripe/models/sigma.py`

 * *Files 7% similar despite different names*

```diff
@@ -11,33 +11,38 @@
     """
     Stripe documentation: https://stripe.com/docs/api?lang=python#scheduled_queries
     """
 
     stripe_class = stripe.sigma.ScheduledQueryRun
 
     data_load_time = StripeDateTimeField(
-        help_text="When the query was run, Sigma contained a snapshot of your "
-        "Stripe data at this time."
+        help_text=(
+            "When the query was run, Sigma contained a snapshot of your "
+            "Stripe data at this time."
+        )
     )
     error = JSONField(
         null=True,
         blank=True,
-        help_text="If the query run was not succeesful, contains information "
-        "about the failure.",
+        help_text=(
+            "If the query run was not succeesful, contains information "
+            "about the failure."
+        ),
     )
     file = StripeForeignKey(
         "file",
         on_delete=models.SET_NULL,
         null=True,
         blank=True,
         help_text="The file object representing the results of the query.",
     )
     result_available_until = StripeDateTimeField(
-        help_text="Time at which the result expires and is no longer available "
-        "for download."
+        help_text=(
+            "Time at which the result expires and is no longer available for download."
+        )
     )
     sql = models.TextField(max_length=5000, help_text="SQL for the query.")
     status = StripeEnumField(
         enum=enums.ScheduledQueryRunStatus, help_text="The query's execution status."
     )
     title = models.TextField(max_length=5000, help_text="Title of the query.")
```

### Comparing `dj_stripe-2.7.3/djstripe/models/webhooks.py` & `dj_stripe-2.8.0a0/djstripe/models/webhooks.py`

 * *Files 12% similar despite different names*

```diff
@@ -8,37 +8,39 @@
 from uuid import uuid4
 
 import stripe
 from django.db import models
 from django.utils.datastructures import CaseInsensitiveMapping
 from django.utils.functional import cached_property
 
-from ..context_managers import stripe_temporary_api_version
+from .. import signals
 from ..enums import WebhookEndpointStatus
 from ..fields import JSONField, StripeEnumField, StripeForeignKey
 from ..settings import djstripe_settings
-from ..signals import webhook_processing_error
 from .base import StripeModel, logger
 from .core import Event
 
 
 # TODO: Add Tests
 class WebhookEndpoint(StripeModel):
     stripe_class = stripe.WebhookEndpoint
     stripe_dashboard_item_name = "webhooks"
 
     api_version = models.CharField(
         max_length=64,
         blank=True,
-        help_text="The API version events are rendered as for this webhook endpoint. Defaults to the configured Stripe API Version.",
+        help_text=(
+            "The API version events are rendered as for this webhook endpoint. Defaults"
+            " to the configured Stripe API Version."
+        ),
     )
     enabled_events = JSONField(
         help_text=(
-            "The list of events to enable for this endpoint. "
-            "['*'] indicates that all events are enabled, except those that require explicit selection."
+            "The list of events to enable for this endpoint. ['*'] indicates that all"
+            " events are enabled, except those that require explicit selection."
         )
     )
     secret = models.CharField(
         max_length=256,
         blank=True,
         editable=False,
         help_text="The endpoint's secret, used to generate webhook signatures.",
@@ -89,16 +91,16 @@
 
     :param request: client request
     :type request: HTTPRequest
 
     :Returns: the client ip address
     """
 
-    # HTTP_X_FORWARDED_FOR is relevant for django running behind a proxy
-    x_forwarded_for = request.META.get("HTTP_X_FORWARDED_FOR")
+    # x-forwarded-for is relevant for django running behind a proxy
+    x_forwarded_for = request.headers.get("x-forwarded-for")
     if x_forwarded_for:
         ip = x_forwarded_for.split(",")[0]
     else:
         ip = request.META.get("REMOTE_ADDR")
 
     if not ip:
         warnings.warn(
@@ -211,30 +213,42 @@
         )
         api_key = (
             stripe_account.default_api_key
             or djstripe_settings.get_default_api_key(obj.livemode)
         )
 
         try:
+            # Validate the webhook first
+            signals.webhook_pre_validate.send(sender=cls, instance=obj)
             obj.valid = obj.validate(secret=secret, api_key=api_key)
+            signals.webhook_post_validate.send(
+                sender=cls, instance=obj, valid=obj.valid
+            )
+
             if obj.valid:
+                signals.webhook_pre_process.send(sender=cls, instance=obj)
                 if djstripe_settings.WEBHOOK_EVENT_CALLBACK:
                     # If WEBHOOK_EVENT_CALLBACK, pass it for processing
                     djstripe_settings.WEBHOOK_EVENT_CALLBACK(obj, api_key=api_key)
                 else:
                     # Process the item (do not save it, it'll get saved below)
                     obj.process(save=False, api_key=api_key)
+                signals.webhook_post_process.send(
+                    sender=cls, instance=obj, api_key=api_key
+                )
         except Exception as e:
-            max_length = WebhookEventTrigger._meta.get_field("exception").max_length
+            max_length = cls._meta.get_field("exception").max_length
             obj.exception = str(e)[:max_length]
             obj.traceback = format_exc()
 
             # Send the exception as the webhook_processing_error signal
-            webhook_processing_error.send(
-                sender=WebhookEventTrigger,
+            signals.webhook_processing_error.send(
+                sender=cls,
+                instance=obj,
+                api_key=api_key,
                 exception=e,
                 data=getattr(e, "http_body", ""),
             )
 
             # re-raise the exception so Django sees it
             raise e
         finally:
@@ -252,16 +266,37 @@
     @property
     def is_test_event(self):
         event_id = self.json_body.get("id")
         return event_id and event_id.endswith("_00000000000000")
 
     def verify_signature(
         self, secret: str, tolerance: int = djstripe_settings.WEBHOOK_TOLERANCE
-    ):
-        pass
+    ) -> bool:
+        if not secret:
+            raise ValueError("Cannot verify event signature without a secret")
+
+        # HTTP headers are case-insensitive, but we store them as a dict.
+        headers = CaseInsensitiveMapping(self.headers)
+        signature = headers.get("stripe-signature")
+        local_cli_signing_secret = headers.get("x-djstripe-webhook-secret")
+        try:
+            # check if the x-djstripe-webhook-secret Custom Header exists
+            if local_cli_signing_secret:
+                # Set Endpoint Signing Secret to the output of Stripe CLI
+                # for signature verification
+                secret = local_cli_signing_secret
+
+            stripe.WebhookSignature.verify_header(
+                self.body, signature, secret, tolerance
+            )
+        except stripe.error.SignatureVerificationError:
+            logger.exception("Failed to verify header")
+            return False
+        else:
+            return True
 
     def validate(
         self,
         api_key: str = None,
         secret: str = djstripe_settings.WEBHOOK_SECRET,
         tolerance: int = djstripe_settings.WEBHOOK_TOLERANCE,
         validation_method=djstripe_settings.WEBHOOK_VALIDATION,
@@ -278,52 +313,33 @@
         if "id" not in local_data or "livemode" not in local_data:
             logger.error(
                 '"id" not in json body or "livemode" not in json body(%s)', local_data
             )
             return False
 
         if self.is_test_event:
-            logger.info("Test webhook received and discarded: {}".format(local_data))
+            logger.info("Test webhook received and discarded: %s", local_data)
             return False
 
         if validation_method is None:
             # validation disabled
             warnings.warn("WEBHOOK VALIDATION is disabled.")
             return True
         elif validation_method == "verify_signature":
-            if not secret:
-                raise ValueError("Cannot verify event signature without a secret")
-            # HTTP headers are case-insensitive, but we store them as a dict.
-            headers = CaseInsensitiveMapping(self.headers)
-            signature = headers.get("stripe-signature")
-            local_cli_signing_secret = headers.get("x-djstripe-webhook-secret")
-            try:
-                # check if the x-djstripe-webhook-secret Custom Header exists
-                if local_cli_signing_secret:
-                    # Set Endpoint Signing Secret to the output of Stripe CLI
-                    # for signature verification
-                    secret = local_cli_signing_secret
-
-                stripe.WebhookSignature.verify_header(
-                    self.body, signature, secret, tolerance
-                )
-            except stripe.error.SignatureVerificationError:
-                logger.exception("Failed to verify header")
-                return False
-            else:
-                return True
+            return self.verify_signature(secret=secret)
 
         livemode = local_data["livemode"]
         api_key = api_key or djstripe_settings.get_default_api_key(livemode)
 
         # Retrieve the event using the api_version specified in itself
-        with stripe_temporary_api_version(local_data["api_version"], validate=False):
-            remote_data = Event.stripe_class.retrieve(
-                id=local_data["id"], api_key=api_key
-            )
+        remote_data = Event.stripe_class.retrieve(
+            id=local_data["id"],
+            api_key=api_key,
+            stripe_version=local_data["api_version"],
+        )
 
         return local_data["data"] == remote_data["data"]
 
     def process(self, save=True, api_key: str = None):
         # Reset traceback and exception in case of reprocessing
         self.exception = ""
         self.traceback = ""
```

### Comparing `dj_stripe-2.7.3/djstripe/settings.py` & `dj_stripe-2.8.0a0/djstripe/settings.py`

 * *Files 5% similar despite different names*

```diff
@@ -3,46 +3,42 @@
 """
 import stripe
 from django.apps import apps as django_apps
 from django.conf import settings
 from django.core.exceptions import ImproperlyConfigured
 from django.utils.module_loading import import_string
 
-from .checks import validate_stripe_api_version
-
 
 class DjstripeSettings:
     """Container for Dj-stripe settings
 
     :return: Initialised settings for Dj-stripe.
     :rtype: object
 
     """
 
     DEFAULT_STRIPE_API_VERSION = "2020-08-27"
 
-    ZERO_DECIMAL_CURRENCIES = set(
-        [
-            "bif",
-            "clp",
-            "djf",
-            "gnf",
-            "jpy",
-            "kmf",
-            "krw",
-            "mga",
-            "pyg",
-            "rwf",
-            "vnd",
-            "vuv",
-            "xaf",
-            "xof",
-            "xpf",
-        ]
-    )
+    ZERO_DECIMAL_CURRENCIES = {
+        "bif",
+        "clp",
+        "djf",
+        "gnf",
+        "jpy",
+        "kmf",
+        "krw",
+        "mga",
+        "pyg",
+        "rwf",
+        "vnd",
+        "vuv",
+        "xaf",
+        "xof",
+        "xpf",
+    }
 
     def __init__(self):
         # Set STRIPE_API_HOST if you want to use a different Stripe API server
         # Example: https://github.com/stripe/stripe-mock
         if hasattr(settings, "STRIPE_API_HOST"):
             stripe.api_base = getattr(settings, "STRIPE_API_HOST")
 
@@ -63,22 +59,14 @@
     @property
     def get_idempotency_key(self):
         return self.get_callback_function(
             "DJSTRIPE_IDEMPOTENCY_KEY_CALLBACK", self._get_idempotency_key
         )
 
     @property
-    def USE_NATIVE_JSONFIELD(self):
-        return getattr(settings, "DJSTRIPE_USE_NATIVE_JSONFIELD", True)
-
-    @property
-    def PRORATION_POLICY(self):
-        return getattr(settings, "DJSTRIPE_PRORATION_POLICY", None)
-
-    @property
     def DJSTRIPE_WEBHOOK_URL(self):
         return getattr(settings, "DJSTRIPE_WEBHOOK_URL", r"^webhook/$")
 
     @property
     def WEBHOOK_TOLERANCE(self):
         return getattr(
             settings, "DJSTRIPE_WEBHOOK_TOLERANCE", stripe.Webhook.DEFAULT_TOLERANCE
@@ -171,24 +159,22 @@
         if callable(func):
             return func
 
         if isinstance(func, str):
             func = import_string(func)
 
         if not callable(func):
-            raise ImproperlyConfigured(
-                "{name} must be callable.".format(name=setting_name)
-            )
+            raise ImproperlyConfigured(f"{setting_name} must be callable.")
 
         return func
 
     def _get_idempotency_key(self, object_type, action, livemode) -> str:
         from .models import IdempotencyKey
 
-        action = "{}:{}".format(object_type, action)
+        action = f"{object_type}:{action}"
         idempotency_key, _created = IdempotencyKey.objects.get_or_create(
             action=action, livemode=livemode
         )
         return str(idempotency_key.uuid)
 
     def get_default_api_key(self, livemode) -> str:
         """
@@ -226,16 +212,16 @@
             subscriber_model = django_apps.get_model(model_name)
         except ValueError:
             raise ImproperlyConfigured(
                 "DJSTRIPE_SUBSCRIBER_MODEL must be of the form 'app_label.model_name'."
             )
         except LookupError:
             raise ImproperlyConfigured(
-                "DJSTRIPE_SUBSCRIBER_MODEL refers to model '{model}' "
-                "that has not been installed.".format(model=model_name)
+                f"DJSTRIPE_SUBSCRIBER_MODEL refers to model '{model_name}' "
+                "that has not been installed."
             )
 
         if (
             "email"
             not in [field_.name for field_ in subscriber_model._meta.get_fields()]
         ) and not hasattr(subscriber_model, "email"):
             raise ImproperlyConfigured(
@@ -251,28 +237,10 @@
                 raise ImproperlyConfigured(
                     "DJSTRIPE_SUBSCRIBER_MODEL_REQUEST_CALLBACK must be implemented "
                     "if a DJSTRIPE_SUBSCRIBER_MODEL is defined."
                 )
 
         return subscriber_model
 
-    def set_stripe_api_version(self, version=None, validate=True):
-        """
-        Set the desired API version to use for Stripe requests.
-
-        :param version: The version to set for the Stripe API.
-        :type version: ``str``
-        :param validate: If True validate the value for the specified version).
-        :type validate: ``bool``
-        """
-        version = version or self.STRIPE_API_VERSION
-
-        if validate:
-            valid = validate_stripe_api_version(version)
-            if not valid:
-                raise ValueError("Bad stripe API version: {}".format(version))
-
-        stripe.api_version = version
-
 
 # initialise the settings object
 djstripe_settings = DjstripeSettings()
```

### Comparing `dj_stripe-2.7.3/djstripe/signals.py` & `dj_stripe-2.8.0a0/djstripe/signals.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,15 +1,27 @@
 """
 signals are sent for each event Stripe sends to the app
 
 Stripe docs for Webhooks: https://stripe.com/docs/webhooks
 """
 from django.dispatch import Signal
 
-# providing_args=["data", "exception"]
+# providing_args=["instance", "api_key"]
+webhook_pre_validate = Signal()
+
+# providing_args=["instance", "api_key", "valid"]
+webhook_post_validate = Signal()
+
+# providing_args=["instance", "api_key"]
+webhook_pre_process = Signal()
+
+# providing_args=["instance", "api_key"]
+webhook_post_process = Signal()
+
+# providing_args=["instance", "api_key", "exception", "data"]
 webhook_processing_error = Signal()
 
 ENABLED_EVENTS = [
     # Update this by copy-pasting the "enabled_events" enum values from
     # https://raw.githubusercontent.com/stripe/openapi/master/openapi/spec3.json
     "*",
     "account.application.authorized",
@@ -57,23 +69,31 @@
     "customer.discount.updated",
     "customer.source.created",
     "customer.source.deleted",
     "customer.source.expiring",
     "customer.source.updated",
     "customer.subscription.created",
     "customer.subscription.deleted",
+    "customer.subscription.paused",
     "customer.subscription.pending_update_applied",
     "customer.subscription.pending_update_expired",
+    "customer.subscription.resumed",
     "customer.subscription.trial_will_end",
     "customer.subscription.updated",
     "customer.tax_id.created",
     "customer.tax_id.deleted",
     "customer.tax_id.updated",
     "customer.updated",
+    "customer_cash_balance_transaction.created",
     "file.created",
+    "financial_connections.account.created",
+    "financial_connections.account.deactivated",
+    "financial_connections.account.disconnected",
+    "financial_connections.account.reactivated",
+    "financial_connections.account.refreshed_balance",
     "identity.verification_session.canceled",
     "identity.verification_session.created",
     "identity.verification_session.processing",
     "identity.verification_session.redacted",
     "identity.verification_session.requires_input",
     "identity.verification_session.verified",
     "invoice.created",
@@ -103,26 +123,15 @@
     "issuing_dispute.created",
     "issuing_dispute.funds_reinstated",
     "issuing_dispute.submitted",
     "issuing_dispute.updated",
     "issuing_transaction.created",
     "issuing_transaction.updated",
     "mandate.updated",
-    "order.canceled",
-    "order.completed",
     "order.created",
-    "order.inventory_reservation_expired",
-    "order.payment_completed",
-    "order.payment_failed",
-    "order.payment_succeeded",
-    "order.processing",
-    "order.reopened",
-    "order.submitted",
-    "order.updated",
-    "order_return.created",
     "payment_intent.amount_capturable_updated",
     "payment_intent.canceled",
     "payment_intent.created",
     "payment_intent.partially_funded",
     "payment_intent.payment_failed",
     "payment_intent.processing",
     "payment_intent.requires_action",
@@ -133,14 +142,15 @@
     "payment_method.automatically_updated",
     "payment_method.detached",
     "payment_method.updated",
     "payout.canceled",
     "payout.created",
     "payout.failed",
     "payout.paid",
+    "payout.reconciliation_completed",
     "payout.updated",
     "person.created",
     "person.deleted",
     "person.updated",
     "plan.created",
     "plan.deleted",
     "plan.updated",
@@ -157,14 +167,16 @@
     "quote.created",
     "quote.finalized",
     "radar.early_fraud_warning.created",
     "radar.early_fraud_warning.updated",
     "recipient.created",
     "recipient.deleted",
     "recipient.updated",
+    "refund.created",
+    "refund.updated",
     "reporting.report_run.failed",
     "reporting.report_run.succeeded",
     "reporting.report_type.updated",
     "review.closed",
     "review.opened",
     "setup_intent.canceled",
     "setup_intent.created",
@@ -200,16 +212,14 @@
     "test_helpers.test_clock.ready",
     "topup.canceled",
     "topup.created",
     "topup.failed",
     "topup.reversed",
     "topup.succeeded",
     "transfer.created",
-    "transfer.failed",
-    "transfer.paid",
     "transfer.reversed",
     "transfer.updated",
     "treasury.credit_reversal.created",
     "treasury.credit_reversal.posted",
     "treasury.debit_reversal.completed",
     "treasury.debit_reversal.created",
     "treasury.debit_reversal.initial_credit_granted",
@@ -230,26 +240,16 @@
     "treasury.outbound_transfer.created",
     "treasury.outbound_transfer.expected_arrival_date_updated",
     "treasury.outbound_transfer.failed",
     "treasury.outbound_transfer.posted",
     "treasury.outbound_transfer.returned",
     "treasury.received_credit.created",
     "treasury.received_credit.failed",
-    "treasury.received_credit.reversed",
     "treasury.received_credit.succeeded",
     "treasury.received_debit.created",
-    # deprecated (no longer in events_types list) - TODO can be deleted?
-    "checkout_beta.session_succeeded",
-    "issuer_fraud_record.created",
-    "payment_intent.requires_capture",
-    "payment_method.card_automatically_updated",
-    "issuing_dispute.created",
-    "issuing_dispute.updated",
-    "issuing_settlement.created",
-    "issuing_settlement.updated",
     # special case? - TODO can be deleted?
     "ping",
 ]
 
 
 # A signal for each Event type. See https://stripe.com/docs/api/events/types
```

### Comparing `dj_stripe-2.7.3/djstripe/sync.py` & `dj_stripe-2.8.0a0/djstripe/sync.py`

 * *Files identical despite different names*

### Comparing `dj_stripe-2.7.3/djstripe/templates/djstripe/admin/change_form.html` & `dj_stripe-2.8.0a0/djstripe/templates/djstripe/admin/change_form.html`

 * *Files identical despite different names*

### Comparing `dj_stripe-2.7.3/djstripe/templates/djstripe/admin/confirm_action.html` & `dj_stripe-2.8.0a0/djstripe/templates/djstripe/admin/confirm_action.html`

 * *Files identical despite different names*

### Comparing `dj_stripe-2.7.3/djstripe/templates/djstripe/admin/webhook_endpoint/delete_confirmation.html` & `dj_stripe-2.8.0a0/djstripe/templates/djstripe/admin/webhook_endpoint/delete_confirmation.html`

 * *Files identical despite different names*

### Comparing `dj_stripe-2.7.3/djstripe/urls.py` & `dj_stripe-2.8.0a0/djstripe/urls.py`

 * *Files identical despite different names*

### Comparing `dj_stripe-2.7.3/djstripe/utils.py` & `dj_stripe-2.8.0a0/djstripe/utils.py`

 * *Files 12% similar despite different names*

```diff
@@ -40,15 +40,15 @@
     Convert a Stripe API timestamp response (unix epoch) to a native datetime.
     """
     if response is None:
         # Allow passing None to convert_tstamp()
         return response
 
     # Overrides the set timezone to UTC - I think...
-    tz = timezone.utc if settings.USE_TZ else None
+    tz = get_timezone_utc() if settings.USE_TZ else None
 
     return datetime.datetime.fromtimestamp(response, tz)
 
 
 # TODO: Finish this.
 CURRENCY_SIGILS = {"CAD": "$", "EUR": "", "GBP": "", "USD": "$"}
 
@@ -59,15 +59,15 @@
     amount_two_decimals = f"{amount:.2f}"
     return f"{sigil}{intcomma(amount_two_decimals)} {currency}"
 
 
 class QuerySetMock(QuerySet):
     """
     A mocked QuerySet class that does not handle updates.
-    Used by UpcomingInvoice.invoiceitems.
+    Used by UpcomingInvoice.invoiceitems (deprecated) and UpcomingInvoice.lineitems.
     """
 
     @classmethod
     def from_iterable(cls, model, iterable):
         instance = cls(model)
         instance._result_cache = list(iterable)
         instance._prefetch_done = True
@@ -104,7 +104,21 @@
     model = app_config.get_model(model_name)
     return model
 
 
 def get_queryset(pks, model_name):
     model = get_model(model_name)
     return model.objects.filter(pk__in=pks)
+
+
+def get_timezone_utc():
+    """
+    Returns UTC attribute in a backwards compatible way.
+
+    UTC attribute has been moved from django.utils.timezone module to
+    datetime.timezone class
+    """
+    try:
+        # Django 4+
+        return datetime.timezone.utc
+    except AttributeError:
+        return timezone.utc
```

### Comparing `dj_stripe-2.7.3/djstripe/views.py` & `dj_stripe-2.8.0a0/djstripe/views.py`

 * *Files 4% similar despite different names*

```diff
@@ -24,15 +24,16 @@
 
     If the webhook cannot be verified, returns HTTP 400.
 
     If an exception happens during processing, returns HTTP 500.
     """
 
     def post(self, request, uuid=None):
-        if "HTTP_STRIPE_SIGNATURE" not in request.META:
+        # https://stripe.com/docs/webhooks/signatures
+        if "stripe-signature" not in request.headers:
             # Do not even attempt to process/store the event if there is
             # no signature in the headers so we avoid overfilling the db.
             logger.error("HTTP_STRIPE_SIGNATURE is missing")
             return HttpResponseBadRequest()
 
         # uuid is passed for new-style webhook views only.
         # old-style defaults to no account.
```

### Comparing `dj_stripe-2.7.3/djstripe/webhooks.py` & `dj_stripe-2.8.0a0/djstripe/webhooks.py`

 * *Files identical despite different names*

### Comparing `dj_stripe-2.7.3/docs/README.md` & `dj_stripe-2.8.0a0/docs/README.md`

 * *Files 8% similar despite different names*

```diff
@@ -29,26 +29,32 @@
 -   Support for multiple accounts and API keys
 -   Stripe Connect (partial support)
 -   Tested with Stripe API `2020-08-27` (see [API versions](api_versions.md#dj-stripe_latest_tested_version))
 
 ## Requirements
 
 -   Django >=3.2
--   Python >=3.7.12
+-   Python >=3.8
 -   PostgreSQL engine (recommended) >=9.6
 -   MySQL engine: MariaDB >=10.2 or MySQL >=5.7
 -   SQLite: Not recommended in production. Version >=3.26 required.
 
 ## Installation
 
-See [installation](docs/installation.md) instructions.
+See [installation](https://dj-stripe.dev/dj-stripe/2.7/installation/) instructions.
 
 ## Changelog
 
-[See release notes on Read the Docs](https://dj-stripe.github.io/dj-stripe/history/2_5_0/).
+[See release notes on Read the Docs](history/2_7_0/).
+
+<!-- This link *will* get stale again eventually. There should be an index page for the
+     changelog that can be linked to.
+
+     For example:
+     https://squidfunk.github.io/mkdocs-material/setup/setting-up-navigation/#section-index-pages -->
 
 ## Funding and Support
 
 <a href="https://stripe.com">
   <img alt="Stripe Logo" src="./logos/stripe_blurple.svg" width="250px" />
 </a>
```

#### html2text {}

```diff
@@ -16,21 +16,21 @@
 endpoint and start receiving model updates. You will then have a copy of all
 the Stripe models available in Django models, as soon as they are updated! The
 full documentation is available [on Read the Docs](https://dj-stripe.github.io/
 dj-stripe/). ## Features - Stripe Core - Stripe Billing - Stripe Cards (JS v2)
 and Sources (JS v3) - Payment Methods and Payment Intents (SCA support) -
 Support for multiple accounts and API keys - Stripe Connect (partial support) -
 Tested with Stripe API `2020-08-27` (see [API versions](api_versions.md#dj-
-stripe_latest_tested_version)) ## Requirements - Django >=3.2 - Python >=3.7.12
-- PostgreSQL engine (recommended) >=9.6 - MySQL engine: MariaDB >=10.2 or MySQL
+stripe_latest_tested_version)) ## Requirements - Django >=3.2 - Python >=3.8 -
+PostgreSQL engine (recommended) >=9.6 - MySQL engine: MariaDB >=10.2 or MySQL
 >=5.7 - SQLite: Not recommended in production. Version >=3.26 required. ##
-Installation See [installation](docs/installation.md) instructions. ##
-Changelog [See release notes on Read the Docs](https://dj-stripe.github.io/dj-
-stripe/history/2_5_0/). ## Funding and Support [Stripe_Logo] You can now become
-a sponsor to dj-stripe with [GitHub Sponsors](https://github.com/sponsors/dj-
+Installation See [installation](https://dj-stripe.dev/dj-stripe/2.7/
+installation/) instructions. ## Changelog [See release notes on Read the Docs]
+(history/2_7_0/).  ## Funding and Support [Stripe_Logo] You can now become a
+sponsor to dj-stripe with [GitHub Sponsors](https://github.com/sponsors/dj-
 stripe). We've been bringing dj-stripe to the world for over 7 years and are
 excited to be able to start dedicating some real resources to the project. Your
 sponsorship helps us keep a team of maintainers actively working to improve dj-
 stripe and ensure it stays up-to-date with the latest Stripe changes. If you
 use dj-stripe commercially, we would encourage you to invest in its continued
 development by [signing up for a paid plan](https://github.com/sponsors/dj-
 stripe). Corporate sponsors [receive priority support and development time]
```

### Comparing `dj_stripe-2.7.3/pyproject.toml` & `dj_stripe-2.8.0a0/pyproject.toml`

 * *Files 13% similar despite different names*

```diff
@@ -1,29 +1,31 @@
 [tool.poetry]
 name = "dj-stripe"
-version = "2.7.3"
+version = "2.8.0-alpha.0"
 description = "Django + Stripe made easy"
 license = "MIT"
 authors = [
     "Alexander Kavanaugh <alex@kavdev.io>",
     "Jerome Leclanche <jerome@leclan.ch>",
 ]
 readme = "docs/README.md"
 homepage = "https://dj-stripe.dev"
 repository = "https://github.com/dj-stripe/dj-stripe"
-documentation = "https://dj-stripe.github.io/dj-stripe/"
+documentation = "https://dj-stripe.dev/dj-stripe/"
 classifiers = [
     "Development Status :: 5 - Production/Stable",
     "Environment :: Web Environment",
     "Intended Audience :: Developers",
     "Topic :: Office/Business :: Financial",
     "Topic :: Software Development :: Libraries :: Python Modules",
     "Framework :: Django",
     "Framework :: Django :: 3.2",
     "Framework :: Django :: 4.0",
+    "Framework :: Django :: 4.1",
+    "Framework :: Django :: 4.2",
 ]
 
 packages = [
     { include = "djstripe" }
 ]
 include = [
     "AUTHORS.md",
@@ -36,30 +38,28 @@
 ]
 
 [tool.poetry.urls]
 "Funding" = "https://github.com/sponsors/dj-stripe"
 
 
 [tool.poetry.dependencies]
-python = "^3.7.12"
+python = "^3.8.0"
 django = ">=3.2"
-jsonfield = ">=3.0"
 stripe = ">=2.48.0,<5.0.0"
 psycopg2 = { version = "^2.8.5", optional = true }
 mysqlclient = { version = ">=1.4.0", optional = true }
 
 [tool.poetry.group.dev]
 optional = true
 [tool.poetry.group.dev.dependencies]
-black = ">=22.6.0"
-isort = ">=5.10.1"
-pre-commit = ">=2.20.0"
-pytest = ">=7.1.2"
+black = ">=23.3.0"
+isort = ">=5.12.0"
+pytest = ">=7.3.1"
 pytest-django = ">=4.5.2"
-mypy = ">=0.971"
+mypy = ">=1.2.0"
 
 # flake8 = ">=5.0.4"
 # Why is flake8 commented out?
 # The short version: flake8 is pinned to an old version of importlib-metadata
 # which clashes with other dependencies (such as mkdocs in our case).
 #
 # For the longer version, you have to look at these links:
@@ -100,26 +100,34 @@
 # the lives of others. Who was a little too grumpy at work and decided to take it
 # out on someone and waste hours of their life by making illogical demands, just
 # out of spite.
 #
 # I'm grateful flake8 exists. But it's not a useful enough tool to allow it to
 # waste our time like this, and it's largely been displaced by the other tools:
 # mypy, isort, and black. So let's stick to those instead.
+pre-commit = "^3.0.4"
 
 [tool.poetry.group.docs]
 optional = true
 [tool.poetry.group.docs.dependencies]
 mkdocs = ">=1.3.1"
 mkdocs-material = ">=8.4.2"
 mkdocs-autorefs = ">=0.4.1"
 mkdocstrings = {extras = ["python"], version = ">=0.19.0"}
 mike = ">=1.1.2"
 jinja2 = "<3.1.0"
 
 
+[tool.poetry.group.ci]
+optional = true
+[tool.poetry.group.ci.dependencies]
+coverage = {version = "^6.5.0", extras = ["toml"]}
+tox = "^3.26.0"
+tox-gh-actions = "^2.10.0"
+
 [tool.poetry.extras]
 postgres = ["psycopg2"]
 mysql = ["mysqlclient"]
 
 [tool.isort]
 profile = "black"
```

### Comparing `dj_stripe-2.7.3/setup.py` & `dj_stripe-2.8.0a0/PKG-INFO`

 * *Files 22% similar despite different names*

```diff
@@ -1,43 +1,122 @@
-# -*- coding: utf-8 -*-
-from setuptools import setup
+Metadata-Version: 2.1
+Name: dj-stripe
+Version: 2.8.0a0
+Summary: Django + Stripe made easy
+Home-page: https://dj-stripe.dev
+License: MIT
+Author: Alexander Kavanaugh
+Author-email: alex@kavdev.io
+Requires-Python: >=3.8.0,<4.0.0
+Classifier: Development Status :: 5 - Production/Stable
+Classifier: Environment :: Web Environment
+Classifier: Framework :: Django
+Classifier: Framework :: Django :: 3.2
+Classifier: Framework :: Django :: 4.0
+Classifier: Framework :: Django :: 4.1
+Classifier: Framework :: Django :: 4.2
+Classifier: Intended Audience :: Developers
+Classifier: License :: OSI Approved :: MIT License
+Classifier: Programming Language :: Python :: 3
+Classifier: Programming Language :: Python :: 3.8
+Classifier: Programming Language :: Python :: 3.9
+Classifier: Programming Language :: Python :: 3.10
+Classifier: Programming Language :: Python :: 3.11
+Classifier: Topic :: Office/Business :: Financial
+Classifier: Topic :: Software Development :: Libraries :: Python Modules
+Provides-Extra: mysql
+Provides-Extra: postgres
+Requires-Dist: django (>=3.2)
+Requires-Dist: mysqlclient (>=1.4.0) ; extra == "mysql"
+Requires-Dist: psycopg2 (>=2.8.5,<3.0.0) ; extra == "postgres"
+Requires-Dist: stripe (>=2.48.0,<5.0.0)
+Project-URL: Documentation, https://dj-stripe.dev/dj-stripe/
+Project-URL: Funding, https://github.com/sponsors/dj-stripe
+Project-URL: Repository, https://github.com/dj-stripe/dj-stripe
+Description-Content-Type: text/markdown
+
+# dj-stripe - Django + Stripe Made Easy
+
+[![Stripe Verified Partner](https://img.shields.io/static/v1?label=Stripe&message=Verified%20Partner&color=red&style=for-the-badge)](https://stripe.com/docs/libraries#community-libraries)
+<br>
+
+[![CI tests](https://github.com/dj-stripe/dj-stripe/actions/workflows/ci.yml/badge.svg)](https://github.com/dj-stripe/dj-stripe/actions/workflows/ci.yml)
+[![Package Downloads](https://img.shields.io/pypi/dm/dj-stripe)](https://pypi.org/project/dj-stripe/)
+[![Documentation](https://img.shields.io/static/v1?label=Docs&message=READ&color=informational&style=plastic)](https://dj-stripe.github.io/dj-stripe/)
+[![Sponsor dj-stripe](https://img.shields.io/static/v1?label=Sponsor&message=%E2%9D%A4&logo=GitHub&color=red&style=plastic)](https://github.com/sponsors/dj-stripe)
+[![MIT License](https://img.shields.io/static/v1?label=License&message=MIT&color=informational&style=plastic)](https://github.com/sponsors/dj-stripe)
+
+Stripe Models for Django.
+
+## Introduction
+
+dj-stripe implements all of the Stripe models, for Django. Set up your
+webhook endpoint and start receiving model updates. You will then have
+a copy of all the Stripe models available in Django models, as soon as
+they are updated!
+
+The full documentation is available [on Read the Docs](https://dj-stripe.github.io/dj-stripe/).
+
+## Features
+
+-   Stripe Core
+-   Stripe Billing
+-   Stripe Cards (JS v2) and Sources (JS v3)
+-   Payment Methods and Payment Intents (SCA support)
+-   Support for multiple accounts and API keys
+-   Stripe Connect (partial support)
+-   Tested with Stripe API `2020-08-27` (see [API versions](api_versions.md#dj-stripe_latest_tested_version))
+
+## Requirements
+
+-   Django >=3.2
+-   Python >=3.8
+-   PostgreSQL engine (recommended) >=9.6
+-   MySQL engine: MariaDB >=10.2 or MySQL >=5.7
+-   SQLite: Not recommended in production. Version >=3.26 required.
+
+## Installation
+
+See [installation](https://dj-stripe.dev/dj-stripe/2.7/installation/) instructions.
+
+## Changelog
+
+[See release notes on Read the Docs](history/2_7_0/).
+
+<!-- This link *will* get stale again eventually. There should be an index page for the
+     changelog that can be linked to.
+
+     For example:
+     https://squidfunk.github.io/mkdocs-material/setup/setting-up-navigation/#section-index-pages -->
+
+## Funding and Support
+
+<a href="https://stripe.com">
+  <img alt="Stripe Logo" src="./logos/stripe_blurple.svg" width="250px" />
+</a>
+
+You can now become a sponsor to dj-stripe with [GitHub Sponsors](https://github.com/sponsors/dj-stripe).
+
+We've been bringing dj-stripe to the world for over 7 years and are excited to be able to start
+dedicating some real resources to the project.
+
+Your sponsorship helps us keep a team of maintainers actively working to improve dj-stripe and
+ensure it stays up-to-date with the latest Stripe changes. If you use dj-stripe commercially, we would encourage you to invest in its continued
+development by [signing up for a paid plan](https://github.com/sponsors/dj-stripe).
+Corporate sponsors [receive priority support and development time](project/support.md).
+
+All contributions through GitHub sponsors flow into our [Open Collective](https://opencollective.com/dj-stripe), which holds our funds and keeps
+an open ledger on how donations are spent.
+
+## Our Gold sponsors
+
+<a href="https://stripe.com">
+  <img alt="Stripe Logo" src="./logos/stripe_blurple.svg" width="250px" />
+</a>
+
+## Similar libraries
+
+-   [dj-paypal](https://github.com/HearthSim/dj-paypal)
+    ([PayPal](https://www.paypal.com/))
+-   [dj-paddle](https://github.com/paddle-python/dj-paddle)
+    ([Paddle](https://paddle.com/))
 
-packages = \
-['djstripe',
- 'djstripe.admin',
- 'djstripe.management',
- 'djstripe.management.commands',
- 'djstripe.migrations',
- 'djstripe.models']
-
-package_data = \
-{'': ['*'],
- 'djstripe': ['locale/fr/LC_MESSAGES/*',
-              'locale/ru/LC_MESSAGES/*',
-              'templates/djstripe/admin/*',
-              'templates/djstripe/admin/webhook_endpoint/*']}
-
-install_requires = \
-['django>=3.2', 'jsonfield>=3.0', 'stripe>=2.48.0,<5.0.0']
-
-extras_require = \
-{'mysql': ['mysqlclient>=1.4.0'], 'postgres': ['psycopg2>=2.8.5,<3.0.0']}
-
-setup_kwargs = {
-    'name': 'dj-stripe',
-    'version': '2.7.3',
-    'description': 'Django + Stripe made easy',
-    'long_description': '# dj-stripe - Django + Stripe Made Easy\n\n[![Stripe Verified Partner](https://img.shields.io/static/v1?label=Stripe&message=Verified%20Partner&color=red&style=for-the-badge)](https://stripe.com/docs/libraries#community-libraries)\n<br>\n\n[![CI tests](https://github.com/dj-stripe/dj-stripe/actions/workflows/ci.yml/badge.svg)](https://github.com/dj-stripe/dj-stripe/actions/workflows/ci.yml)\n[![Package Downloads](https://img.shields.io/pypi/dm/dj-stripe)](https://pypi.org/project/dj-stripe/)\n[![Documentation](https://img.shields.io/static/v1?label=Docs&message=READ&color=informational&style=plastic)](https://dj-stripe.github.io/dj-stripe/)\n[![Sponsor dj-stripe](https://img.shields.io/static/v1?label=Sponsor&message=%E2%9D%A4&logo=GitHub&color=red&style=plastic)](https://github.com/sponsors/dj-stripe)\n[![MIT License](https://img.shields.io/static/v1?label=License&message=MIT&color=informational&style=plastic)](https://github.com/sponsors/dj-stripe)\n\nStripe Models for Django.\n\n## Introduction\n\ndj-stripe implements all of the Stripe models, for Django. Set up your\nwebhook endpoint and start receiving model updates. You will then have\na copy of all the Stripe models available in Django models, as soon as\nthey are updated!\n\nThe full documentation is available [on Read the Docs](https://dj-stripe.github.io/dj-stripe/).\n\n## Features\n\n-   Stripe Core\n-   Stripe Billing\n-   Stripe Cards (JS v2) and Sources (JS v3)\n-   Payment Methods and Payment Intents (SCA support)\n-   Support for multiple accounts and API keys\n-   Stripe Connect (partial support)\n-   Tested with Stripe API `2020-08-27` (see [API versions](api_versions.md#dj-stripe_latest_tested_version))\n\n## Requirements\n\n-   Django >=3.2\n-   Python >=3.7.12\n-   PostgreSQL engine (recommended) >=9.6\n-   MySQL engine: MariaDB >=10.2 or MySQL >=5.7\n-   SQLite: Not recommended in production. Version >=3.26 required.\n\n## Installation\n\nSee [installation](docs/installation.md) instructions.\n\n## Changelog\n\n[See release notes on Read the Docs](https://dj-stripe.github.io/dj-stripe/history/2_5_0/).\n\n## Funding and Support\n\n<a href="https://stripe.com">\n  <img alt="Stripe Logo" src="./logos/stripe_blurple.svg" width="250px" />\n</a>\n\nYou can now become a sponsor to dj-stripe with [GitHub Sponsors](https://github.com/sponsors/dj-stripe).\n\nWe\'ve been bringing dj-stripe to the world for over 7 years and are excited to be able to start\ndedicating some real resources to the project.\n\nYour sponsorship helps us keep a team of maintainers actively working to improve dj-stripe and\nensure it stays up-to-date with the latest Stripe changes. If you use dj-stripe commercially, we would encourage you to invest in its continued\ndevelopment by [signing up for a paid plan](https://github.com/sponsors/dj-stripe).\nCorporate sponsors [receive priority support and development time](project/support.md).\n\nAll contributions through GitHub sponsors flow into our [Open Collective](https://opencollective.com/dj-stripe), which holds our funds and keeps\nan open ledger on how donations are spent.\n\n## Our Gold sponsors\n\n<a href="https://stripe.com">\n  <img alt="Stripe Logo" src="./logos/stripe_blurple.svg" width="250px" />\n</a>\n\n## Similar libraries\n\n-   [dj-paypal](https://github.com/HearthSim/dj-paypal)\n    ([PayPal](https://www.paypal.com/))\n-   [dj-paddle](https://github.com/paddle-python/dj-paddle)\n    ([Paddle](https://paddle.com/))\n',
-    'author': 'Alexander Kavanaugh',
-    'author_email': 'alex@kavdev.io',
-    'maintainer': 'None',
-    'maintainer_email': 'None',
-    'url': 'https://dj-stripe.dev',
-    'packages': packages,
-    'package_data': package_data,
-    'install_requires': install_requires,
-    'extras_require': extras_require,
-    'python_requires': '>=3.7.12,<4.0.0',
-}
-
-
-setup(**setup_kwargs)
```

#### html2text {}

```diff
@@ -1,60 +1,61 @@
-# -*- coding: utf-8 -*- from setuptools import setup packages = \ ['djstripe',
-'djstripe.admin', 'djstripe.management', 'djstripe.management.commands',
-'djstripe.migrations', 'djstripe.models'] package_data = \ {'': ['*'],
-'djstripe': ['locale/fr/LC_MESSAGES/*', 'locale/ru/LC_MESSAGES/*', 'templates/
-djstripe/admin/*', 'templates/djstripe/admin/webhook_endpoint/*']}
-install_requires = \ ['django>=3.2', 'jsonfield>=3.0', 'stripe>=2.48.0,<5.0.0']
-extras_require = \ {'mysql': ['mysqlclient>=1.4.0'], 'postgres':
-['psycopg2>=2.8.5,<3.0.0']} setup_kwargs = { 'name': 'dj-stripe', 'version':
-'2.7.3', 'description': 'Django + Stripe made easy', 'long_description': '# dj-
-stripe - Django + Stripe Made Easy\n\n[![Stripe Verified Partner](https://
+Metadata-Version: 2.1 Name: dj-stripe Version: 2.8.0a0 Summary: Django + Stripe
+made easy Home-page: https://dj-stripe.dev License: MIT Author: Alexander
+Kavanaugh Author-email: alex@kavdev.io Requires-Python: >=3.8.0,<4.0.0
+Classifier: Development Status :: 5 - Production/Stable Classifier: Environment
+:: Web Environment Classifier: Framework :: Django Classifier: Framework ::
+Django :: 3.2 Classifier: Framework :: Django :: 4.0 Classifier: Framework ::
+Django :: 4.1 Classifier: Framework :: Django :: 4.2 Classifier: Intended
+Audience :: Developers Classifier: License :: OSI Approved :: MIT License
+Classifier: Programming Language :: Python :: 3 Classifier: Programming
+Language :: Python :: 3.8 Classifier: Programming Language :: Python :: 3.9
+Classifier: Programming Language :: Python :: 3.10 Classifier: Programming
+Language :: Python :: 3.11 Classifier: Topic :: Office/Business :: Financial
+Classifier: Topic :: Software Development :: Libraries :: Python Modules
+Provides-Extra: mysql Provides-Extra: postgres Requires-Dist: django (>=3.2)
+Requires-Dist: mysqlclient (>=1.4.0) ; extra == "mysql" Requires-Dist: psycopg2
+(>=2.8.5,<3.0.0) ; extra == "postgres" Requires-Dist: stripe (>=2.48.0,<5.0.0)
+Project-URL: Documentation, https://dj-stripe.dev/dj-stripe/ Project-URL:
+Funding, https://github.com/sponsors/dj-stripe Project-URL: Repository, https:/
+/github.com/dj-stripe/dj-stripe Description-Content-Type: text/markdown # dj-
+stripe - Django + Stripe Made Easy [![Stripe Verified Partner](https://
 img.shields.io/static/
 v1?label=Stripe&message=Verified%20Partner&color=red&style=for-the-badge)]
-(https://stripe.com/docs/libraries#community-libraries)\n
-\n\n[![CI tests](https://github.com/dj-stripe/dj-stripe/actions/workflows/
-ci.yml/badge.svg)](https://github.com/dj-stripe/dj-stripe/actions/workflows/
-ci.yml)\n[![Package Downloads](https://img.shields.io/pypi/dm/dj-stripe)]
-(https://pypi.org/project/dj-stripe/)\n[![Documentation](https://
-img.shields.io/static/
+(https://stripe.com/docs/libraries#community-libraries)
+[![CI tests](https://github.com/dj-stripe/dj-stripe/actions/workflows/ci.yml/
+badge.svg)](https://github.com/dj-stripe/dj-stripe/actions/workflows/ci.yml) [!
+[Package Downloads](https://img.shields.io/pypi/dm/dj-stripe)](https://
+pypi.org/project/dj-stripe/) [![Documentation](https://img.shields.io/static/
 v1?label=Docs&message=READ&color=informational&style=plastic)](https://dj-
-stripe.github.io/dj-stripe/)\n[![Sponsor dj-stripe](https://img.shields.io/
+stripe.github.io/dj-stripe/) [![Sponsor dj-stripe](https://img.shields.io/
 static/v1?label=Sponsor&message=%E2%9D%A4&logo=GitHub&color=red&style=plastic)]
-(https://github.com/sponsors/dj-stripe)\n[![MIT License](https://
-img.shields.io/static/
-v1?label=License&message=MIT&color=informational&style=plastic)](https://
-github.com/sponsors/dj-stripe)\n\nStripe Models for Django.\n\n##
-Introduction\n\ndj-stripe implements all of the Stripe models, for Django. Set
-up your\nwebhook endpoint and start receiving model updates. You will then
-have\na copy of all the Stripe models available in Django models, as soon
-as\nthey are updated!\n\nThe full documentation is available [on Read the Docs]
-(https://dj-stripe.github.io/dj-stripe/).\n\n## Features\n\n- Stripe Core\n-
-Stripe Billing\n- Stripe Cards (JS v2) and Sources (JS v3)\n- Payment Methods
-and Payment Intents (SCA support)\n- Support for multiple accounts and API
-keys\n- Stripe Connect (partial support)\n- Tested with Stripe API `2020-08-27`
-(see [API versions](api_versions.md#dj-stripe_latest_tested_version))\n\n##
-Requirements\n\n- Django >=3.2\n- Python >=3.7.12\n- PostgreSQL engine
-(recommended) >=9.6\n- MySQL engine: MariaDB >=10.2 or MySQL >=5.7\n- SQLite:
-Not recommended in production. Version >=3.26 required.\n\n##
-Installation\n\nSee [installation](docs/installation.md) instructions.\n\n##
-Changelog\n\n[See release notes on Read the Docs](https://dj-stripe.github.io/
-dj-stripe/history/2_5_0/).\n\n## Funding and Support\n\n\n_[Stripe
-Logo]\n\n\nYou can now become a sponsor to dj-stripe with [GitHub Sponsors]
-(https://github.com/sponsors/dj-stripe).\n\nWe\'ve been bringing dj-stripe to
-the world for over 7 years and are excited to be able to start\ndedicating some
-real resources to the project.\n\nYour sponsorship helps us keep a team of
-maintainers actively working to improve dj-stripe and\nensure it stays up-to-
-date with the latest Stripe changes. If you use dj-stripe commercially, we
-would encourage you to invest in its continued\ndevelopment by [signing up for
-a paid plan](https://github.com/sponsors/dj-stripe).\nCorporate sponsors
-[receive priority support and development time](project/support.md).\n\nAll
-contributions through GitHub sponsors flow into our [Open Collective](https://
-opencollective.com/dj-stripe), which holds our funds and keeps\nan open ledger
-on how donations are spent.\n\n## Our Gold sponsors\n\n\n_[Stripe_Logo]\n\n\n##
-Similar libraries\n\n- [dj-paypal](https://github.com/HearthSim/dj-paypal)\n (
-[PayPal](https://www.paypal.com/))\n- [dj-paddle](https://github.com/paddle-
-python/dj-paddle)\n ([Paddle](https://paddle.com/))\n', 'author': 'Alexander
-Kavanaugh', 'author_email': 'alex@kavdev.io', 'maintainer': 'None',
-'maintainer_email': 'None', 'url': 'https://dj-stripe.dev', 'packages':
-packages, 'package_data': package_data, 'install_requires': install_requires,
-'extras_require': extras_require, 'python_requires': '>=3.7.12,<4.0.0', } setup
-(**setup_kwargs)
+(https://github.com/sponsors/dj-stripe) [![MIT License](https://img.shields.io/
+static/v1?label=License&message=MIT&color=informational&style=plastic)](https:/
+/github.com/sponsors/dj-stripe) Stripe Models for Django. ## Introduction dj-
+stripe implements all of the Stripe models, for Django. Set up your webhook
+endpoint and start receiving model updates. You will then have a copy of all
+the Stripe models available in Django models, as soon as they are updated! The
+full documentation is available [on Read the Docs](https://dj-stripe.github.io/
+dj-stripe/). ## Features - Stripe Core - Stripe Billing - Stripe Cards (JS v2)
+and Sources (JS v3) - Payment Methods and Payment Intents (SCA support) -
+Support for multiple accounts and API keys - Stripe Connect (partial support) -
+Tested with Stripe API `2020-08-27` (see [API versions](api_versions.md#dj-
+stripe_latest_tested_version)) ## Requirements - Django >=3.2 - Python >=3.8 -
+PostgreSQL engine (recommended) >=9.6 - MySQL engine: MariaDB >=10.2 or MySQL
+>=5.7 - SQLite: Not recommended in production. Version >=3.26 required. ##
+Installation See [installation](https://dj-stripe.dev/dj-stripe/2.7/
+installation/) instructions. ## Changelog [See release notes on Read the Docs]
+(history/2_7_0/).  ## Funding and Support [Stripe_Logo] You can now become a
+sponsor to dj-stripe with [GitHub Sponsors](https://github.com/sponsors/dj-
+stripe). We've been bringing dj-stripe to the world for over 7 years and are
+excited to be able to start dedicating some real resources to the project. Your
+sponsorship helps us keep a team of maintainers actively working to improve dj-
+stripe and ensure it stays up-to-date with the latest Stripe changes. If you
+use dj-stripe commercially, we would encourage you to invest in its continued
+development by [signing up for a paid plan](https://github.com/sponsors/dj-
+stripe). Corporate sponsors [receive priority support and development time]
+(project/support.md). All contributions through GitHub sponsors flow into our
+[Open Collective](https://opencollective.com/dj-stripe), which holds our funds
+and keeps an open ledger on how donations are spent. ## Our Gold sponsors
+[Stripe_Logo] ## Similar libraries - [dj-paypal](https://github.com/HearthSim/
+dj-paypal) ([PayPal](https://www.paypal.com/)) - [dj-paddle](https://
+github.com/paddle-python/dj-paddle) ([Paddle](https://paddle.com/))
```

